
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../chapter-23/">
      
      
        <link rel="next" href="../../exp/1/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>24. 国产容器管理平台KubeSphere实战排错 - My Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 13c.7 0 1.37.13 2 .35V9l-6-6H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h8.35c-.22-.63-.35-1.3-.35-2 0-3.31 2.69-6 6-6m-5-8.5 5.5 5.5H14V4.5m8.5 12.75L17.75 22 15 19l1.16-1.16 1.59 1.59 3.59-3.59 1.16 1.41Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kubesphere" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="My Notes" class="md-header__button md-logo" aria-label="My Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4c-1.92 0-3.5 1.58-3.5 3.5 0 .93.38 1.78 1 2.41-1.53 1-2.5 2.71-2.5 4.59 0 3.03 2.47 5.5 5.5 5.5 1.76 0 3.5-.46 5-1.34l-1-1.73c-1.22.7-2.6 1.07-4 1.07-1.94 0-3.5-1.55-3.5-3.5a3.49 3.49 0 0 1 2.59-3.38l5.21-1.4-.52-1.93L11.83 9c-.75-.1-1.33-.72-1.33-1.5 0-.84.66-1.5 1.5-1.5.26 0 .5.07.75.2l1-1.73C13.22 4.16 12.61 4 12 4Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              24. 国产容器管理平台KubeSphere实战排错
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to Auto mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to Auto mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/squidfunk/mkdocs-material" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    squidfunk/mkdocs-material
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../AIGC/" class="md-tabs__link">
          
  
    
  
  AIGC

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Kubernetes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="My Notes" class="md-nav__button md-logo" aria-label="My Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4c-1.92 0-3.5 1.58-3.5 3.5 0 .93.38 1.78 1 2.41-1.53 1-2.5 2.71-2.5 4.59 0 3.03 2.47 5.5 5.5 5.5 1.76 0 3.5-.46 5-1.34l-1-1.73c-1.22.7-2.6 1.07-4 1.07-1.94 0-3.5-1.55-3.5-3.5a3.49 3.49 0 0 1 2.59-3.38l5.21-1.4-.52-1.93L11.83 9c-.75-.1-1.33-.72-1.33-1.5 0-.84.66-1.5 1.5-1.5.26 0 .5.07.75.2l1-1.73C13.22 4.16 12.61 4 12 4Z"/></svg>

    </a>
    My Notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/squidfunk/mkdocs-material" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    squidfunk/mkdocs-material
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Home
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../AIGC/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    AIGC
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            AIGC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AWS/ai/1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ai
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AIGC/amazon_bedrock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Amazon Bedrock
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.Kubernetes概述
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.核心组件/附件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. 集群部署
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. 入门命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. 配置清单使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. POD 配置清单
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. 控制器配置清单
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Service 配置清单
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. ingress 控制器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. POD 存储卷
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11. 配置信息容器化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12. StatefulSet 控制器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13. 用户认证系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14. 用户权限系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15. dashboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16. 网络通信
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-17/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17. 调度策略
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-18/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18. 高级调度设置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-19/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19. 容器资源限制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-20/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    20. HeapSter监控（废弃中）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-21/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21. 新一代监控架构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-22/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    22. K8S包管理器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    23. ETCD详解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    24. 国产容器管理平台KubeSphere实战排错
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    24. 国产容器管理平台KubeSphere实战排错
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#241" class="md-nav__link">
    <span class="md-ellipsis">
      24.1 清理退出状态的容器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#242-pod" class="md-nav__link">
    <span class="md-ellipsis">
      24.2 清理异常或被驱逐的 pod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#243-docker" class="md-nav__link">
    <span class="md-ellipsis">
      24.3 Docker 数据迁移
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#244-kubesphere" class="md-nav__link">
    <span class="md-ellipsis">
      24.4 kubesphere 网络排错
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#245-kubesphere" class="md-nav__link">
    <span class="md-ellipsis">
      24.5 kubesphere 应用路由异常
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#246-jenkins-agent" class="md-nav__link">
    <span class="md-ellipsis">
      24.6 Jenkins 的 Agent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#247-devops-mail" class="md-nav__link">
    <span class="md-ellipsis">
      24.7 Devops 中 Mail的发送
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#248-kubesphere" class="md-nav__link">
    <span class="md-ellipsis">
      24.8 kubesphere应用上传问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="24.8 kubesphere应用上传问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2481-413" class="md-nav__link">
    <span class="md-ellipsis">
      24.8.1 文件上传413
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2482-504" class="md-nav__link">
    <span class="md-ellipsis">
      24.8.2 大文件上传后端504
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#249" class="md-nav__link">
    <span class="md-ellipsis">
      24.9 跨域问题
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2410" class="md-nav__link">
    <span class="md-ellipsis">
      24.10 添加节点
    </span>
  </a>
  
    <nav class="md-nav" aria-label="24.10 添加节点">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#24101-ceph" class="md-nav__link">
    <span class="md-ellipsis">
      24.10.1 ceph集群添加节点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24102-node" class="md-nav__link">
    <span class="md-ellipsis">
      24.10.2 node节点添加
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2411-k8s" class="md-nav__link">
    <span class="md-ellipsis">
      24.11 K8s集群资源不均
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2412-kubesphere-devops" class="md-nav__link">
    <span class="md-ellipsis">
      24.12 kubesphere devops工程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2413-kubesphere" class="md-nav__link">
    <span class="md-ellipsis">
      24.13 kubesphere 应用安装
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      参考链接
    </span>
  </a>
  
    <nav class="md-nav" aria-label="参考链接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      视频
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      请我喝咖啡☕️
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    随笔
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            随笔
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exp/1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../blog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/k8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k8s
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#241" class="md-nav__link">
    <span class="md-ellipsis">
      24.1 清理退出状态的容器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#242-pod" class="md-nav__link">
    <span class="md-ellipsis">
      24.2 清理异常或被驱逐的 pod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#243-docker" class="md-nav__link">
    <span class="md-ellipsis">
      24.3 Docker 数据迁移
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#244-kubesphere" class="md-nav__link">
    <span class="md-ellipsis">
      24.4 kubesphere 网络排错
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#245-kubesphere" class="md-nav__link">
    <span class="md-ellipsis">
      24.5 kubesphere 应用路由异常
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#246-jenkins-agent" class="md-nav__link">
    <span class="md-ellipsis">
      24.6 Jenkins 的 Agent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#247-devops-mail" class="md-nav__link">
    <span class="md-ellipsis">
      24.7 Devops 中 Mail的发送
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#248-kubesphere" class="md-nav__link">
    <span class="md-ellipsis">
      24.8 kubesphere应用上传问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="24.8 kubesphere应用上传问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2481-413" class="md-nav__link">
    <span class="md-ellipsis">
      24.8.1 文件上传413
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2482-504" class="md-nav__link">
    <span class="md-ellipsis">
      24.8.2 大文件上传后端504
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#249" class="md-nav__link">
    <span class="md-ellipsis">
      24.9 跨域问题
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2410" class="md-nav__link">
    <span class="md-ellipsis">
      24.10 添加节点
    </span>
  </a>
  
    <nav class="md-nav" aria-label="24.10 添加节点">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#24101-ceph" class="md-nav__link">
    <span class="md-ellipsis">
      24.10.1 ceph集群添加节点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24102-node" class="md-nav__link">
    <span class="md-ellipsis">
      24.10.2 node节点添加
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2411-k8s" class="md-nav__link">
    <span class="md-ellipsis">
      24.11 K8s集群资源不均
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2412-kubesphere-devops" class="md-nav__link">
    <span class="md-ellipsis">
      24.12 kubesphere devops工程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2413-kubesphere" class="md-nav__link">
    <span class="md-ellipsis">
      24.13 kubesphere 应用安装
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      参考链接
    </span>
  </a>
  
    <nav class="md-nav" aria-label="参考链接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      视频
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      请我喝咖啡☕️
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="kubesphere">二十四 国产容器管理平台KubeSphere实战排错</h1>
<blockquote>
<p>概述：近期在使用QingCloud的Kubesphere，极好的用户体验，私有化部署，无基础设施依赖，无 Kubernetes 依赖，支持跨物理机、虚拟机、云平台部署，可以纳管不同版本、不同厂商的 Kubernetes 集群。在k8s上层进行了封装实现了基于角色的权限控制，DevOPS流水线快速实现CI/CD，内置harbor/gitlab/jenkins/sonarqube等常用工具，基于基于 OpenPitrix 提供应用的全生命周期管理，包含开发、测试、发布、升级，下架等应用相关操作自己体验还是非常的棒。
同样作为开源项目，难免存在一些bug，在自己的使用中遇到下排错思路，非常感谢qingcloud社区提供的技术协助，对k8s有兴趣的可以去体验下国产的平台，如丝般顺滑的体验，rancher的用户也可以来对不体验下。</p>
</blockquote>
<h2 id="241">24.1 清理退出状态的容器</h2>
<p>在集群运行一段时间后，有些container由于异常状态退出Exited，需要去及时清理释放磁盘，可以将其设置成定时任务执行</p>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="l l-Scalar l-Scalar-Plain">docker rm `docker ps -a | grep Exited |awk &#39;{print $1}&#39;`</span>
</code></pre></div>
<h2 id="242-pod">24.2 清理异常或被驱逐的 pod</h2>
<ul>
<li>清理kubesphere-devops-system的ns下清理</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl delete pods -n kubesphere-devops-system $(kubectl get pods -n kubesphere-devops-system | grep Evicted |awk &#39;{print $1}&#39;)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="l l-Scalar l-Scalar-Plain">kubectl delete pods -n kubesphere-devops-system $(kubectl get pods -n kubesphere-devops-system | grep CrashLoopBackOff |awk &#39;{print $1}&#39;)</span>
</code></pre></div>
<ul>
<li>为方便清理指定ns清理evicted/crashloopbackoff的pod/清理exited的容器</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">#!/bin/bash</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="c1"># auth:kaliarch</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="l l-Scalar l-Scalar-Plain">clear_evicted_pod() {</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ns=$1</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">kubectl delete pods -n ${ns} $(kubectl get pods -n ${ns} | grep Evicted |awk &#39;{print $1}&#39;)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="l l-Scalar l-Scalar-Plain">clear_crash_pod() {</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ns=$1</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">kubectl delete pods -n ${ns} $(kubectl get pods -n ${ns} | grep CrashLoopBackOff |awk &#39;{print $1}&#39;)</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="l l-Scalar l-Scalar-Plain">clear_exited_container() {</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">docker rm `docker ps -a | grep Exited |awk &#39;{print $1}&#39;`</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="l l-Scalar l-Scalar-Plain">}</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="l l-Scalar l-Scalar-Plain">echo &quot;1.clear exicted pod&quot;</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="l l-Scalar l-Scalar-Plain">echo &quot;2.clear crash pod&quot;</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="l l-Scalar l-Scalar-Plain">echo &quot;3.clear exited container&quot;</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="l l-Scalar l-Scalar-Plain">read -p &quot;Please input num:&quot; num</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="l l-Scalar l-Scalar-Plain">case ${num} in</span><span class="w"> </span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="l l-Scalar l-Scalar-Plain">&quot;1&quot;)</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">read -p &quot;Please input oper namespace:&quot; ns</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">clear_evicted_pod ${ns}</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">;;</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="l l-Scalar l-Scalar-Plain">&quot;2&quot;)</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">read -p &quot;Please input oper namespace:&quot; ns</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">clear_crash_pod ${ns}</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">;;</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="l l-Scalar l-Scalar-Plain">&quot;3&quot;)</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">clear_exited_container</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">;;</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="l l-Scalar l-Scalar-Plain">&quot;*&quot;)</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;input error&quot;</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">;;</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="l l-Scalar l-Scalar-Plain">esac</span>
</code></pre></div>
<ul>
<li>清理全部ns中evicted/crashloopbackoff的pod</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># 获取所有ns</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get ns | grep -v &quot;NAME&quot; |awk &#39;{print $1}&#39;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="l l-Scalar l-Scalar-Plain"># 清理驱逐状态的pod</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="l l-Scalar l-Scalar-Plain">for ns in `kubectl get ns | grep -v &quot;NAME&quot; | awk &#39;{print $1}&#39;`;do kubectl delete pods -n ${ns} $(kubectl get pods -n ${ns} | grep &quot;Evicted&quot; |awk &#39;{print $1}&#39;);done</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="l l-Scalar l-Scalar-Plain"># 清理异常pod</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="l l-Scalar l-Scalar-Plain">for ns in `kubectl get ns | grep -v &quot;NAME&quot; | awk &#39;{print $1}&#39;`;do kubectl delete pods -n ${ns} $(kubectl get pods -n ${ns} | grep &quot;CrashLoopBackOff&quot; |awk &#39;{print $1}&#39;);done</span>
</code></pre></div>
<h2 id="243-docker">24.3 Docker 数据迁移</h2>
<p>在安装过程中未指定docker数据目录，系统盘50G，随着时间推移磁盘不够用，需要迁移docker数据，使用软连接方式：
首选挂载新磁盘到/data目录</p>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="l l-Scalar l-Scalar-Plain">systemctl stop docker</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="l l-Scalar l-Scalar-Plain">mkdir -p /data/docker/</span><span class="w">  </span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="l l-Scalar l-Scalar-Plain">rsync -avz /var/lib/docker/ /data/docker/</span><span class="w">  </span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="l l-Scalar l-Scalar-Plain">mv /var/lib/docker /data/docker_bak</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="l l-Scalar l-Scalar-Plain">ln -s /data/docker /var/lib/</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="l l-Scalar l-Scalar-Plain">systemctl daemon-reload</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="l l-Scalar l-Scalar-Plain">systemctl start docker</span>
</code></pre></div>
<h2 id="244-kubesphere">24.4 kubesphere 网络排错</h2>
<ul>
<li>问题描述：</li>
</ul>
<p>在kubesphere的node节点或master节点，手动去启动容器，在容器里面无法连通公网，是我的配置哪里不对么，之前默认使用calico，现在改成fluannel也不行，在kubesphere中部署deployment中的pod的容器上可以出公网，在node或master单独手动启动的访问不了公网</p>
<p>查看手动启动的容器网络上走的docker0</p>
<div class="language-text highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>root@fd1b8101475d:/# ip a
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    inet 127.0.0.1/8 scope host lo
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>       valid_lft forever preferred_lft forever
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN group default qlen 1
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    link/ipip 0.0.0.0 brd 0.0.0.0
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>105: eth0@if106: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>       valid_lft forever preferred_lft forever
</code></pre></div>
<p>在pods中的容器网络用的是kube-ipvs0</p>
<div class="language-text highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    inet 127.0.0.1/8 scope host lo
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>       valid_lft forever preferred_lft forever
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop qlen 1
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    link/ipip 0.0.0.0 brd 0.0.0.0
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>4: eth0@if18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    link/ether c2:27:44:13:df:5d brd ff:ff:ff:ff:ff:ff
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    inet 10.233.97.175/32 scope global eth0
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>       valid_lft forever preferred_lft forever
</code></pre></div>
<ul>
<li>解决方案：</li>
</ul>
<p>查看docker启动配置</p>
<p><a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315175714.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315175714.png" /></a></p>
<p>修改文件/etc/systemd/system/docker.service.d/docker-options.conf中去掉参数：--iptables=false  这个参数等于false时会不写iptables</p>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p p-Indicator">[</span><span class="nv">Service</span><span class="p p-Indicator">]</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="l l-Scalar l-Scalar-Plain">Environment=&quot;DOCKER_OPTS=  --registry-mirror=https://registry.docker-cn.com --data-root=/var/lib/docker --log-opt max-size=10m --log-opt max-file=3 --insecure-registry=harbor.devops.kubesphere.local:30280&quot;</span>
</code></pre></div>
<h2 id="245-kubesphere">24.5 kubesphere 应用路由异常</h2>
<p>在kubesphere中应用路由ingress使用的是nginx，在web界面配置会导致两个host使用同一个ca证书，可以通过注释文件配置</p>
<p>⚠️注意：ingress控制deployment在：</p>
<p><a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315175735.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315175735.png" /></a></p>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod-app-ingress</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod-net-route</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8631859&#39;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod-app-ingress</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">生产环境应用路由</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/client-body-buffer-size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024m</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2048m</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-read-timeout</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3600&#39;</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-send-timeout</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1800&#39;</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/service-upstream</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">smartms.tools.anchnet.com</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">smartms-ca</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">smartsds.tools.anchnet.com</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">smartsds-ca</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">smartms.tools.anchnet.com</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">              </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">smartms-frontend-svc</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">              </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">smartsds.tools.anchnet.com</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">              </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">smartsds-frontend-svc</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">              </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
<h2 id="246-jenkins-agent">24.6 Jenkins 的 Agent</h2>
<p>用户在自己的使用场景当中，可能会使用不同的语言版本活不同的工具版本。这篇文档主要介绍如何替换内置的 agent。</p>
<p>默认base-build镜像中没有sonar-scanner工具，Kubesphere Jenkins 的每一个 agent 都是一个Pod，如果要替换内置的agent，就需要替换 agent 的相应镜像。</p>
<p>构建最新 kubesphere/builder-base:advanced-1.0.0 版本的 agent 镜像</p>
<p>更新为指定的自定义镜像：ccr.ccs.tencentyun.com/testns/base:v1</p>
<p>参考链接：<a href="https://kubesphere.io/docs/advanced-v2.0/zh-CN/devops/devops-admin-faq/#%E5%8D%87%E7%BA%A7-jenkins-agent-%E7%9A%84%E5%8C%85%E7%89%88%E6%9C%AC">https://kubesphere.io/docs/advanced-v2.0/zh-CN/devops/devops-admin-faq/#%E5%8D%87%E7%BA%A7-jenkins-agent-%E7%9A%84%E5%8C%85%E7%89%88%E6%9C%AC</a>
<a class="glightbox" href="../3.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="alt text" src="../3.jpg" /></a>
<a class="glightbox" href="../4-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="alt text" src="../4-1.png" /></a></p>
<p>在 KubeSphere 修改 jenkins-casc-config 以后，您需要在 Jenkins Dashboard 系统管理下的 configuration-as-code 页面重新加载您更新过的系统配置。</p>
<p>参考：</p>
<p><a href="https://kubesphere.io/docs/advanced-v2.0/zh-CN/devops/jenkins-setting/#%E7%99%BB%E9%99%86-jenkins-%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD">https://kubesphere.io/docs/advanced-v2.0/zh-CN/devops/jenkins-setting/#%E7%99%BB%E9%99%86-jenkins-%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD</a>
<a class="glightbox" href="../5-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="alt text" src="../5-1.png" /></a></p>
<p>jenkins中更新base镜像
<a class="glightbox" href="../6-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="alt text" src="../6-1.png" /></a></p>
<p>⚠️先修改kubesphere中jenkins的配置，<a href="http://xxxxxxxxx:30800/system-workspace/projects/kubesphere-devops-system/configmaps/jenkins-casc-config">jenkins-casc-config</a></p>
<h2 id="247-devops-mail">24.7 Devops 中 Mail的发送</h2>
<p>参考：<a href="https://www.cloudbees.com/blog/mail-step-jenkins-workflow">https://www.cloudbees.com/blog/mail-step-jenkins-workflow</a></p>
<p>内置变量：</p>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>变量名</strong></th>
<th style="text-align: left;"><strong>解释</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">BUILD_NUMBER</td>
<td style="text-align: left;">The current build number, such as "153"</td>
</tr>
<tr>
<td style="text-align: left;">BUILD_ID</td>
<td style="text-align: left;">The current build ID, identical to BUILD_NUMBER for builds created in 1.597+, but a YYYY-MM-DD_hh-mm-ss timestamp for older builds</td>
</tr>
<tr>
<td style="text-align: left;">BUILD_DISPLAY_NAME</td>
<td style="text-align: left;">The display name of the current build, which is something like "#153" by default.</td>
</tr>
<tr>
<td style="text-align: left;">JOB_NAME</td>
<td style="text-align: left;">Name of the project of this build, such as "foo" or "foo/bar". (To strip off folder paths from a Bourne shell script, try: ${JOB_NAME})</td>
</tr>
<tr>
<td style="text-align: left;">BUILD_TAG</td>
<td style="text-align: left;">String of "jenkins-${JOB_NAME}-${BUILD_NUMBER}". Convenient to put into a resource file, a jar file, etc for easier identification.</td>
</tr>
<tr>
<td style="text-align: left;">EXECUTOR_NUMBER</td>
<td style="text-align: left;">The unique number that identifies the current executor (among executors of the same machine) that’s carrying out this build. This is the number you see in the "build executor status", except that the number starts from 0, not 1.</td>
</tr>
<tr>
<td style="text-align: left;">NODE_NAME</td>
<td style="text-align: left;">Name of the slave if the build is on a slave, or "master" if run on master</td>
</tr>
<tr>
<td style="text-align: left;">NODE_LABELS</td>
<td style="text-align: left;">Whitespace-separated list of labels that the node is assigned.</td>
</tr>
<tr>
<td style="text-align: left;">WORKSPACE</td>
<td style="text-align: left;">The absolute path of the directory assigned to the build as a workspace.</td>
</tr>
<tr>
<td style="text-align: left;">JENKINS_HOME</td>
<td style="text-align: left;">The absolute path of the directory assigned on the master node for Jenkins to store data.</td>
</tr>
<tr>
<td style="text-align: left;">JENKINS_URL</td>
<td style="text-align: left;">Full URL of Jenkins, like <a href="http://server:port/jenkins/">http://server:port/jenkins/</a> (note: only available if Jenkins URL set in system configuration)</td>
</tr>
<tr>
<td style="text-align: left;">BUILD_URL</td>
<td style="text-align: left;">Full URL of this build, like <a href="http://server:port/jenkins/job/foo/15/">http://server:port/jenkins/job/foo/15/</a> (Jenkins URL must be set)</td>
</tr>
<tr>
<td style="text-align: left;">SVN_REVISION</td>
<td style="text-align: left;">Subversion revision number that's currently checked out to the workspace, such as "12345"</td>
</tr>
<tr>
<td style="text-align: left;">SVN_URL</td>
<td style="text-align: left;">Subversion URL that's currently checked out to the workspace.</td>
</tr>
<tr>
<td style="text-align: left;">JOB_URL</td>
<td style="text-align: left;">Full URL of this job, like <a href="http://server:port/jenkins/job/foo/">http://server:port/jenkins/job/foo/</a> (Jenkins URL must be set)</td>
</tr>
</tbody>
</table>
<p>最终自己写了适应自己业务的模版，可以直接使用  </p>
<p><div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nt">mail to</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;xuel@net.com&#39;</span><span class="err">,</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">charset:&#39;UTF-8&#39;, // or GBK/GB18030</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">mimeType:&#39;text/plain&#39;, // or text/html</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">subject</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Kubesphere</span><span class="nv"> </span><span class="s">${env.JOB_NAME}</span><span class="nv"> </span><span class="s">[${env.BUILD_NUMBER}]</span><span class="nv"> </span><span class="s">发布正常Running</span><span class="nv"> </span><span class="s">Pipeline:</span><span class="nv"> </span><span class="s">${currentBuild.fullDisplayName}&quot;</span><span class="err">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">          </span><span class="nt">body</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;&quot;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">          </span><span class="s">---------Anchnet</span><span class="nv"> </span><span class="s">Devops</span><span class="nv"> </span><span class="s">Kubesphere</span><span class="nv"> </span><span class="s">Pipeline</span><span class="nv"> </span><span class="s">job--------------------</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">          </span><span class="s">项目名称</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">${env.JOB_NAME}</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">          </span><span class="s">构建次数</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">${env.BUILD_NUMBER}</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">          </span><span class="s">扫描信息</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">地址:${SONAR_HOST}</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">          </span><span class="s">镜像地址</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">${REGISTRY}/${QHUB_NAMESPACE}/${APP_NAME}:${IMAGE_TAG}</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">          </span><span class="s">构建详情：SUCCESSFUL:</span><span class="nv"> </span><span class="s">Job</span><span class="nv"> </span><span class="s">${env.JOB_NAME}</span><span class="nv"> </span><span class="s">[${env.BUILD_NUMBER}]</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">          </span><span class="s">构建状态</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">${env.JOB_NAME}</span><span class="nv"> </span><span class="s">jenkins</span><span class="nv"> </span><span class="s">发布运行正常</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">          </span><span class="s">构建URL</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">${env.BUILD_URL}&quot;&quot;&quot;</span>
</code></pre></div>
<a class="glightbox" href="../7-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="alt text" src="../7-1.png" /></a>
<a class="glightbox" href="../8-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="alt text" src="../8-1.png" /></a></p>
<h2 id="248-kubesphere">24.8 kubesphere应用上传问题</h2>
<h3 id="2481-413">24.8.1 文件上传413</h3>
<p>将应用部署进入kubesphere中，应用中有设置上传文件功能，测试上次异常无法正常上传，文件上传，ingress413报错，kubesphere使用的是ingress-nginx控制器，可以在其中注解添加k-v来支持，</p>
<p>解决方案：应用路由自定义max body size</p>
<p>https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#custom-max-body-size</p>
<h3 id="2482-504">24.8.2 大文件上传后端504</h3>
<p>大文件上传后端响应504解决方案：</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>proxy<span class="w"> </span><span class="nb">read</span><span class="w"> </span>timeoutnginx.ingress.kubernetes.io/proxy-read-timeout
</code></pre></div>
<h2 id="249">24.9 跨域问题</h2>
<p>kubesphere使用ingress-nginx支持跨域，可以参考以下链接在注解中添加</p>
<p>https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#enable-cors</p>
<p>测试环境可以使用可以使用hosts，将域名解析到本地，前端利用nginx来做静态文件服务，反向代理后端api，可以参考示例：</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>server<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span>listen<span class="w"> </span><span class="m">80</span><span class="p">;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span>server_name<span class="w"> </span>localhost<span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="c1"># 强制https跳转</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">  </span><span class="c1"># rewrite ^(.*)$ https://$host$1 permanent;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span>location<span class="w"> </span>/<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span>index<span class="w">      </span>index.html<span class="p">;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span>root<span class="w">       </span>/smart-frontend<span class="p">;</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">    </span>try_files<span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri</span>/<span class="w"> </span>/index.html<span class="p">;</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span>client_body_buffer_size<span class="w"> </span>200m<span class="p">;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span>charset<span class="w"> </span>utf-8<span class="p">;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">  </span>location<span class="w"> </span>/api<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">      </span>proxy_pass<span class="w"> </span>http://smart-backend:8080/api<span class="p">;</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">      </span>proxy_read_timeout<span class="w"> </span><span class="m">1200</span><span class="p">;</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">      </span>client_max_body_size<span class="w"> </span>1024m<span class="p">;</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">      </span>gzip<span class="w">  </span>on<span class="p">;</span><span class="w"> </span><span class="c1">#开启gzip</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">      </span>gzip_vary<span class="w"> </span>on<span class="p">;</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">      </span>gzip_min_length<span class="w"> </span>1k<span class="p">;</span><span class="w"> </span><span class="c1">#不压缩临界值,大于1k的才压缩,一般不用改</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">      </span>gzip_buffers<span class="w"> </span><span class="m">4</span><span class="w"> </span>16k<span class="p">;</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">      </span>gzip_comp_level<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span><span class="c1">#压缩级别,数字越大压缩的越好</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">      </span>gzip_types<span class="w">  </span>text/plain<span class="w"> </span>application/javascript<span class="w"> </span>application/x-javascript<span class="w"> </span>text/css<span class="w"> </span>application/xml<span class="w"> </span>text/javascript<span class="w"> </span>application/x-httpd-php<span class="w"> </span>image/jpeg<span class="w"> </span>image/gif<span class="w"> </span>image/png<span class="w"> </span>image/x-icon<span class="p">;</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="o">}</span>
</code></pre></div>
<h2 id="2410">24.10  添加节点</h2>
<p>后期逐渐业务上来，集群节点资源不足，新增node节点，将node节点的数据盘添加到ceph节点</p>
<h3 id="24101-ceph">24.10.1 ceph集群添加节点</h3>
<ul>
<li>
<p>系统配置</p>
</li>
<li>
<p>免费密钥配置</p>
</li>
<li>hosts配置</li>
<li>docker安装并迁移至数据盘</li>
<li>cgroup启用</li>
<li>ceph数据节点添加</li>
</ul>
<p>ceph集群配置添加node03集群的数据盘节点（如果数据存储类足够，可以不用添加数据节点）</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="o">[</span>root@node03<span class="w"> </span>docker<span class="o">]</span><span class="c1"># mkfs.xfs /dev/vdd</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="o">[</span>root@node03<span class="w"> </span>docker<span class="o">]</span><span class="c1"># mkdir -p /var/local/osd3</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="o">[</span>root@node03<span class="w"> </span>docker<span class="o">]</span><span class="c1"># mount /dev/vdd /var/local/osd3/</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>添加vdd到/etc/fstab中
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="o">[</span>root@node03<span class="w"> </span>docker<span class="o">]</span><span class="c1"># yum -y install yum-plugin-priorities epel-release</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="o">[</span>root@node03<span class="w"> </span>yum.repos.d<span class="o">]</span><span class="c1"># chmod 777 -R /var/local/osd3/</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="o">[</span>root@node03<span class="w"> </span>yum.repos.d<span class="o">]</span><span class="c1"># chmod 777 -R /var/local/osd3/*  master节点利用ceph-deploy部署node03节点[root@master ceph]# ceph-deploy install node03</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="o">[</span>root@master<span class="w"> </span>ceph<span class="o">]</span><span class="c1"># ceph-deploy  gatherkeys master</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="o">[</span>root@master<span class="w"> </span>ceph<span class="o">]</span><span class="c1"># ceph-deploy osd prepare node03:/var/local/osd3</span>
</code></pre></div>
<ul>
<li>激活osd</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="o">[</span>root@master<span class="w"> </span>ceph<span class="o">]</span><span class="c1"># ceph-deploy osd activate node03:/var/local/osd3</span>
</code></pre></div>
<ul>
<li>查看状态</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="o">[</span>root@master<span class="w"> </span>ceph<span class="o">]</span><span class="c1"># ceph-deploy osd list master node01 node02 node03</span>
</code></pre></div>
<ul>
<li>拷贝密钥</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="o">[</span>root@master<span class="w"> </span>ceph<span class="o">]</span><span class="c1"># ceph-deploy admin master node01 node02 node03</span>
</code></pre></div>
<ul>
<li>在node03节点设置权限</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="o">[</span>root@node03<span class="w"> </span>yum.repos.d<span class="o">]</span><span class="c1"># chmod +r /etc/ceph/ceph.client.admin.keyring</span>
</code></pre></div>
<ul>
<li>在master设置MDS</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="o">[</span>root@master<span class="w"> </span>ceph<span class="o">]</span><span class="c1"># ceph-deploy mds create node01 node02 node03</span>
</code></pre></div>
<ul>
<li>查看状态</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="o">[</span>root@master<span class="w"> </span>ceph<span class="o">]</span><span class="c1"># ceph health</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="o">[</span>root@master<span class="w"> </span>ceph<span class="o">]</span><span class="c1"># ceph - 由于是新增node节点，数据需要平衡回填，此刻查看集群状态[root@master conf]# ceph -s</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span>cluster<span class="w"> </span>5b9eb8d2-1c12-4f6d-ae9c-85078795794b
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">     </span>health<span class="w"> </span>HEALTH_ERR
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">            </span><span class="m">44</span><span class="w"> </span>pgs<span class="w"> </span>backfill_wait
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">            </span><span class="m">1</span><span class="w"> </span>pgs<span class="w"> </span>backfilling
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">            </span><span class="m">1</span><span class="w"> </span>pgs<span class="w"> </span>inconsistent
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">            </span><span class="m">45</span><span class="w"> </span>pgs<span class="w"> </span>stuck<span class="w"> </span>unclean
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">            </span>recovery<span class="w"> </span><span class="m">1</span>/55692<span class="w"> </span>objects<span class="w"> </span>degraded<span class="w"> </span><span class="o">(</span><span class="m">0</span>.002%<span class="o">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">            </span>recovery<span class="w"> </span><span class="m">9756</span>/55692<span class="w"> </span>objects<span class="w"> </span>misplaced<span class="w"> </span><span class="o">(</span><span class="m">17</span>.518%<span class="o">)</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">            </span><span class="m">2</span><span class="w"> </span>scrub<span class="w"> </span>errors
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">     </span>monmap<span class="w"> </span>e1:<span class="w"> </span><span class="m">1</span><span class="w"> </span>mons<span class="w"> </span>at<span class="w"> </span><span class="o">{</span><span class="nv">master</span><span class="o">=</span><span class="m">172</span>.16.60.2:6789/0<span class="o">}</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">            </span>election<span class="w"> </span>epoch<span class="w"> </span><span class="m">35</span>,<span class="w"> </span>quorum<span class="w"> </span><span class="m">0</span><span class="w"> </span>master
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">     </span>osdmap<span class="w"> </span>e2234:<span class="w"> </span><span class="m">4</span><span class="w"> </span>osds:<span class="w"> </span><span class="m">4</span><span class="w"> </span>up,<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="k">in</span><span class="p">;</span><span class="w"> </span><span class="m">45</span><span class="w"> </span>remapped<span class="w"> </span>pgs
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">            </span>flags<span class="w"> </span>sortbitwise,require_jewel_osds
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">      </span>pgmap<span class="w"> </span>v5721471:<span class="w"> </span><span class="m">192</span><span class="w"> </span>pgs,<span class="w"> </span><span class="m">2</span><span class="w"> </span>pools,<span class="w"> </span><span class="m">104</span><span class="w"> </span>GB<span class="w"> </span>data,<span class="w"> </span><span class="m">27846</span><span class="w"> </span>objects
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">            </span><span class="m">230</span><span class="w"> </span>GB<span class="w"> </span>used,<span class="w"> </span><span class="m">1768</span><span class="w"> </span>GB<span class="w"> </span>/<span class="w"> </span><span class="m">1999</span><span class="w"> </span>GB<span class="w"> </span>avail
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">            </span><span class="m">1</span>/55692<span class="w"> </span>objects<span class="w"> </span>degraded<span class="w"> </span><span class="o">(</span><span class="m">0</span>.002%<span class="o">)</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">            </span><span class="m">9756</span>/55692<span class="w"> </span>objects<span class="w"> </span>misplaced<span class="w"> </span><span class="o">(</span><span class="m">17</span>.518%<span class="o">)</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">                 </span><span class="m">146</span><span class="w"> </span>active+clean
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">                  </span><span class="m">44</span><span class="w"> </span>active+remapped+wait_backfill
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">                   </span><span class="m">1</span><span class="w"> </span>active+remapped+backfilling
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">                   </span><span class="m">1</span><span class="w"> </span>active+clean+inconsistent
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>recovery<span class="w"> </span>io<span class="w"> </span><span class="m">50492</span><span class="w"> </span>kB/s,<span class="w"> </span><span class="m">13</span><span class="w"> </span>objects/s
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">  </span>client<span class="w"> </span>io<span class="w"> </span><span class="m">20315</span><span class="w"> </span>B/s<span class="w"> </span>wr,<span class="w"> </span><span class="m">0</span><span class="w"> </span>op/s<span class="w"> </span>rd,<span class="w"> </span><span class="m">5</span><span class="w"> </span>op/s<span class="w"> </span>wr<span class="w"> </span>
</code></pre></div>
<ul>
<li>最终的问题，目前由于新增了node节点，新增ceph数据节点需要数据同步</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="o">[</span>root@master<span class="w"> </span>conf<span class="o">]</span><span class="c1"># ceph -s</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span>cluster<span class="w"> </span>5b9eb8d2-1c12-4f6d-ae9c-85078795794b
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">     </span>health<span class="w"> </span>HEALTH_ERR
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">            </span><span class="m">1</span><span class="w"> </span>pgs<span class="w"> </span>inconsistent
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">            </span><span class="m">2</span><span class="w"> </span>scrub<span class="w"> </span>errors
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">     </span>monmap<span class="w"> </span>e1:<span class="w"> </span><span class="m">1</span><span class="w"> </span>mons<span class="w"> </span>at<span class="w"> </span><span class="o">{</span><span class="nv">master</span><span class="o">=</span><span class="m">172</span>.16.60.2:6789/0<span class="o">}</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">            </span>election<span class="w"> </span>epoch<span class="w"> </span><span class="m">35</span>,<span class="w"> </span>quorum<span class="w"> </span><span class="m">0</span><span class="w"> </span>master
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">     </span>osdmap<span class="w"> </span>e2324:<span class="w"> </span><span class="m">4</span><span class="w"> </span>osds:<span class="w"> </span><span class="m">4</span><span class="w"> </span>up,<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="k">in</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">            </span>flags<span class="w"> </span>sortbitwise,require_jewel_osds
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">      </span>pgmap<span class="w"> </span>v5723479:<span class="w"> </span><span class="m">192</span><span class="w"> </span>pgs,<span class="w"> </span><span class="m">2</span><span class="w"> </span>pools,<span class="w"> </span><span class="m">104</span><span class="w"> </span>GB<span class="w"> </span>data,<span class="w"> </span><span class="m">27848</span><span class="w"> </span>objects
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">            </span><span class="m">229</span><span class="w"> </span>GB<span class="w"> </span>used,<span class="w"> </span><span class="m">1769</span><span class="w"> </span>GB<span class="w"> </span>/<span class="w"> </span><span class="m">1999</span><span class="w"> </span>GB<span class="w"> </span>avail
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">                 </span><span class="m">191</span><span class="w"> </span>active+clean
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">                   </span><span class="m">1</span><span class="w"> </span>active+clean+inconsistent
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">  </span>client<span class="w"> </span>io<span class="w"> </span><span class="m">78305</span><span class="w"> </span>B/s<span class="w"> </span>wr,<span class="w"> </span><span class="m">0</span><span class="w"> </span>op/s<span class="w"> </span>rd,<span class="w"> </span><span class="m">18</span><span class="w"> </span>op/s<span class="w"> </span>wr修复<span class="o">[</span>root@master<span class="w"> </span>conf<span class="o">]</span><span class="c1"># ceph -s</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">    </span>cluster<span class="w"> </span>5b9eb8d2-1c12-4f6d-ae9c-85078795794b
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">     </span>health<span class="w"> </span>HEALTH_OK
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">     </span>monmap<span class="w"> </span>e1:<span class="w"> </span><span class="m">1</span><span class="w"> </span>mons<span class="w"> </span>at<span class="w"> </span><span class="o">{</span><span class="nv">master</span><span class="o">=</span><span class="m">172</span>.16.60.2:6789/0<span class="o">}</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">            </span>election<span class="w"> </span>epoch<span class="w"> </span><span class="m">35</span>,<span class="w"> </span>quorum<span class="w"> </span><span class="m">0</span><span class="w"> </span>master
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">     </span>osdmap<span class="w"> </span>e2324:<span class="w"> </span><span class="m">4</span><span class="w"> </span>osds:<span class="w"> </span><span class="m">4</span><span class="w"> </span>up,<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="k">in</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">            </span>flags<span class="w"> </span>sortbitwise,require_jewel_osds
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">      </span>pgmap<span class="w"> </span>v5724320:<span class="w"> </span><span class="m">192</span><span class="w"> </span>pgs,<span class="w"> </span><span class="m">2</span><span class="w"> </span>pools,<span class="w"> </span><span class="m">104</span><span class="w"> </span>GB<span class="w"> </span>data,<span class="w"> </span><span class="m">27848</span><span class="w"> </span>objects
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">            </span><span class="m">229</span><span class="w"> </span>GB<span class="w"> </span>used,<span class="w"> </span><span class="m">1769</span><span class="w"> </span>GB<span class="w"> </span>/<span class="w"> </span><span class="m">1999</span><span class="w"> </span>GB<span class="w"> </span>avail
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">                 </span><span class="m">192</span><span class="w"> </span>active+clean
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">  </span>client<span class="w"> </span>io<span class="w"> </span><span class="m">227</span><span class="w"> </span>kB/s<span class="w"> </span>wr,<span class="w"> </span><span class="m">0</span><span class="w"> </span>op/s<span class="w"> </span>rd,<span class="w"> </span><span class="m">7</span><span class="w"> </span>op/s<span class="w"> </span>wr
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="c1"># 同步完成</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="o">[</span>root@master<span class="w"> </span>conf<span class="o">]</span><span class="c1"># ceph health</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>HEALTH_OK
</code></pre></div>
<h3 id="24102-node">24.10.2 node节点添加</h3>
<p>kubesphere为方便新增节点，提供了方便的脚步一键新增，可参考：https://kubesphere.com.cn/docs/v2.1/zh-CN/installation/add-nodes/ </p>
<p>修改host.ini</p>
<p>```[all]
master ansible_connection=local  ip=172.16.60.2
node01  ansible_host=172.16.60.3  ip=172.16.60.3 
node02  ansible_host=172.16.60.4  ip=172.16.60.4
node03  ansible_host=172.16.60.5  ip=172.16.60.5
[kube-master]
master         <br />
[kube-node]
master
node01 <br />
node02
node03
<div class="language-text highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>在 &quot;/script&quot; 目录执行 add-nodes.sh脚本。待扩容脚本执行成功后，即可看到包含新节点的集群节点信息，可通过 KubeSphere 控制台的菜单选择 基础设施 然后进入 主机管理 页面查看，或者通过 Kubectl 工具执行 kubectl get node命令，查看扩容后的集群节点详细信息。
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>```shell
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>[root@master scripts]# ./add-nodes.sh
</code></pre></div></p>
<p>查看验证</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="o">[</span>root@master<span class="w"> </span>conf<span class="o">]</span><span class="c1"># kubectl get nodes -owide</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>NAME<span class="w">     </span>STATUS<span class="w">   </span>ROLES<span class="w">         </span>AGE<span class="w">    </span>VERSION<span class="w">   </span>INTERNAL-IP<span class="w">   </span>EXTERNAL-IP<span class="w">   </span>OS-IMAGE<span class="w">                </span>KERNEL-VERSION<span class="w">          </span>CONTAINER-RUNTIME
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>master<span class="w">   </span>Ready<span class="w">    </span>master<span class="w">        </span>136d<span class="w">   </span>v1.15.5<span class="w">   </span><span class="m">172</span>.16.60.2<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">3</span>.10.0-693.el7.x86_64<span class="w">   </span>docker://18.6.2
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>node01<span class="w">   </span>Ready<span class="w">    </span>node,worker<span class="w">   </span>136d<span class="w">   </span>v1.15.5<span class="w">   </span><span class="m">172</span>.16.60.3<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">3</span>.10.0-693.el7.x86_64<span class="w">   </span>docker://18.6.2
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>node02<span class="w">   </span>Ready<span class="w">    </span>node,worker<span class="w">   </span>136d<span class="w">   </span>v1.15.5<span class="w">   </span><span class="m">172</span>.16.60.4<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">3</span>.10.0-693.el7.x86_64<span class="w">   </span>docker://18.6.2
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>node03<span class="w">   </span>Ready<span class="w">    </span>worker<span class="w">        </span>10m<span class="w">    </span>v1.15.5<span class="w">   </span><span class="m">172</span>.16.60.5<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">3</span>.10.0-693.el7.x86_64<span class="w">   </span>docker://19.3.5
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="o">[</span>root@master<span class="w"> </span>conf<span class="o">]</span><span class="c1"># kubectl label node  node-role.kubernetes.io/node=</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>common.yaml<span class="w">            </span>hosts.ini<span class="w">              </span>plugin-qingcloud.yaml<span class="w">  </span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="o">[</span>root@master<span class="w"> </span>conf<span class="o">]</span><span class="c1"># kubectl label node node03  node-role.kubernetes.io/node=   </span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>node/node03<span class="w"> </span>labeled
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="o">[</span>root@master<span class="w"> </span>conf<span class="o">]</span><span class="c1"># kubectl get nodes -owide                                </span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>NAME<span class="w">     </span>STATUS<span class="w">   </span>ROLES<span class="w">         </span>AGE<span class="w">    </span>VERSION<span class="w">   </span>INTERNAL-IP<span class="w">   </span>EXTERNAL-IP<span class="w">   </span>OS-IMAGE<span class="w">                </span>KERNEL-VERSION<span class="w">          </span>CONTAINER-RUNTIME
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>master<span class="w">   </span>Ready<span class="w">    </span>master<span class="w">        </span>136d<span class="w">   </span>v1.15.5<span class="w">   </span><span class="m">172</span>.16.60.2<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">3</span>.10.0-693.el7.x86_64<span class="w">   </span>docker://18.6.2
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>node01<span class="w">   </span>Ready<span class="w">    </span>node,worker<span class="w">   </span>136d<span class="w">   </span>v1.15.5<span class="w">   </span><span class="m">172</span>.16.60.3<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">3</span>.10.0-693.el7.x86_64<span class="w">   </span>docker://18.6.2
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>node02<span class="w">   </span>Ready<span class="w">    </span>node,worker<span class="w">   </span>136d<span class="w">   </span>v1.15.5<span class="w">   </span><span class="m">172</span>.16.60.4<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">3</span>.10.0-693.el7.x86_64<span class="w">   </span>docker://18.6.2
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>node03<span class="w">   </span>Ready<span class="w">    </span>node,worker<span class="w">   </span>11m<span class="w">    </span>v1.15.5<span class="w">   </span><span class="m">172</span>.16.60.5<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">3</span>.10.0-693.el7.x86_64<span class="w">   </span>docker://19.3.5
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="o">[</span>root@master<span class="w"> </span>conf<span class="o">]</span><span class="c1"># </span>
</code></pre></div>
<p><a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180530.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180530.png" /></a></p>
<h2 id="2411-k8s">24.11  K8s集群资源不均</h2>
<p>可以发现k8s资源使用不均衡，之前的部署应用为制定nodeSelect，导致一些系统服务运行在node节点，查看node2内存占用很大,导致集群异常告警或重启</p>
<p><a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180550.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180550.png" /></a></p>
<p>可以通过查看</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-o<span class="w"> </span>wide<span class="w"> </span>--all-namespaces<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>node02<span class="w"> </span><span class="p">|</span>awk<span class="w"> </span><span class="s1">&#39;{print $1,  $2}&#39;</span>
</code></pre></div>
<p>将一些系统应用通过nodeselect来调度到master节点，以减轻node2节点的内存压力。</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="sb">`</span>kubectl<span class="w">  </span>get<span class="w"> </span>nodes<span class="w"> </span>--show-labels<span class="sb">`</span>
</code></pre></div>
<p>在node2上查看系统组建添加nodeselector来重新调度</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="w">      </span>nodeSelector:
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">        </span>node-role.kubernetes.io/master:<span class="w"> </span>master
</code></pre></div>
<p><a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180603.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180603.png" /></a></p>
<p>查看现存在node2上面的kubesphere系统deployment</p>
<p><a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180621.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180621.png" /></a></p>
<p>通过调度完成，查看node2的内存负载已经下来了</p>
<p><a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180634.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180634.png" /></a></p>
<h2 id="2412-kubesphere-devops">24.12 kubesphere devops工程</h2>
<p>新增了node03节点，devops工程一周为队列中为此时运行该job的实例未完成初始化，登录集群查看，node03上的base pod在pull agent镜像，为了快速，直接在node节点，save base镜像然后在node03上load</p>
<p><a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180658.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180658.png" /></a></p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="o">[</span>root@master<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl describe pods -n kubesphere-devops-system $(kubectl get pods -n kubesphere-devops-system |grep -E &quot;^base&quot; |awk &#39;{print $1}&#39;)</span>
</code></pre></div>
<p><a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180736.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315180736.png" /></a></p>
<h2 id="2413-kubesphere">24.13  kubesphere 应用安装</h2>
<p>目前自己的kubesphere集群为2.1，在具体的在项目中添加了repo后，后台回自己去同步镜像数据还是需要为手动在那个地方触发下，我添加了几个helm 的repo，好像里面的chart没有在web界面显示，在添加了repo的项目下，我新建应用，然后选择来自kubesphere的应用商店，其中只有几个charts，发现不了添加的helm 源的chartscharts，在服务器内部是可以使用命令search到。咨询社区暂时为收到回复，记得v2.0版本后台有个任务会去同步charts，目前2.1版本，先使用helm命令在集群内进行手动helm安装</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="o">[</span>root@master<span class="w"> </span>common-service<span class="o">]</span><span class="c1"># helm install -n consul --namespace common-service -f consul/values-production.yaml consul/</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>NAME:<span class="w">   </span>consul
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>LAST<span class="w"> </span>DEPLOYED:<span class="w"> </span>Tue<span class="w"> </span>Jan<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">17</span>:56:27<span class="w"> </span><span class="m">2020</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>NAMESPACE:<span class="w"> </span>common-service
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>STATUS:<span class="w"> </span>DEPLOYED
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>RESOURCES:
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="o">==</span>&gt;<span class="w"> </span>v1/Pod<span class="o">(</span>related<span class="o">)</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>NAME<span class="w">      </span>READY<span class="w">  </span>STATUS<span class="w">   </span>RESTARTS<span class="w">  </span>AGE
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>consul-0<span class="w">  </span><span class="m">0</span>/2<span class="w">    </span>Pending<span class="w">  </span><span class="m">0</span><span class="w">         </span><span class="nv">0s</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="o">==</span>&gt;<span class="w"> </span>v1/Service
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>NAME<span class="w">       </span>TYPE<span class="w">       </span>CLUSTER-IP<span class="w">   </span>EXTERNAL-IP<span class="w">  </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">                                                </span>AGE
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>consul<span class="w">     </span>ClusterIP<span class="w">  </span>None<span class="w">         </span>&lt;none&gt;<span class="w">       </span><span class="m">8400</span>/TCP,8301/TCP,8301/UDP,8300/TCP,8600/TCP,8600/UDP<span class="w">  </span>1s
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>consul-ui<span class="w">  </span>ClusterIP<span class="w">  </span><span class="m">10</span>.233.59.7<span class="w">  </span>&lt;none&gt;<span class="w">       </span><span class="m">80</span>/TCP<span class="w">                                                 </span><span class="nv">1s</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="o">==</span>&gt;<span class="w"> </span>v1/StatefulSet
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>NAME<span class="w">    </span>READY<span class="w">  </span>AGE
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>consul<span class="w">  </span><span class="m">0</span>/3<span class="w">    </span><span class="nv">0s</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="o">==</span>&gt;<span class="w"> </span>v1beta1/PodDisruptionBudget
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>NAME<span class="w">        </span>MIN<span class="w"> </span>AVAILABLE<span class="w">  </span>MAX<span class="w"> </span>UNAVAILABLE<span class="w">  </span>ALLOWED<span class="w"> </span>DISRUPTIONS<span class="w">  </span>AGE
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>consul-pdb<span class="w">  </span><span class="m">1</span><span class="w">              </span>N/A<span class="w">              </span><span class="m">0</span><span class="w">                    </span>1s
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>NOTES:
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="w">  </span>**<span class="w"> </span>Please<span class="w"> </span>be<span class="w"> </span>patient<span class="w"> </span><span class="k">while</span><span class="w"> </span>the<span class="w"> </span>chart<span class="w"> </span>is<span class="w"> </span>being<span class="w"> </span>deployed<span class="w"> </span>**
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="w">  </span>Consul<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>accessed<span class="w"> </span>within<span class="w"> </span>the<span class="w"> </span>cluster<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">8300</span><span class="w"> </span>at<span class="w"> </span>consul.common-service.svc.cluster.local
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>In<span class="w"> </span>order<span class="w"> </span>to<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>Consul<span class="w"> </span>Web<span class="w"> </span>UI:
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="w">    </span>kubectl<span class="w"> </span>port-forward<span class="w"> </span>--namespace<span class="w"> </span>common-service<span class="w"> </span>svc/consul-ui<span class="w"> </span><span class="m">80</span>:80
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Consul URL: http://127.0.0.1:80&quot;</span>
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a>
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a>Please<span class="w"> </span>take<span class="w"> </span>into<span class="w"> </span>account<span class="w"> </span>that<span class="w"> </span>you<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span><span class="nb">wait</span><span class="w"> </span><span class="k">until</span><span class="w"> </span>a<span class="w"> </span>cluster<span class="w"> </span>leader<span class="w"> </span>is<span class="w"> </span>elected<span class="w"> </span>before<span class="w"> </span>using<span class="w"> </span>the<span class="w"> </span>Consul<span class="w"> </span>Web<span class="w"> </span>UI.
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a>
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a>
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a>In<span class="w"> </span>order<span class="w"> </span>to<span class="w"> </span>check<span class="w"> </span>the<span class="w"> </span>status<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>cluster<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span>run<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>command:
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a>
<a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a>
<a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a><span class="w">    </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>consul-0<span class="w"> </span>--<span class="w"> </span>consul<span class="w"> </span>members
<a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a>
<a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a>
<a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a>Furthermore,<span class="w"> </span>to<span class="w"> </span>know<span class="w"> </span>which<span class="w"> </span>Consul<span class="w"> </span>node<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>cluster<span class="w"> </span>leader<span class="w"> </span>run<span class="w"> </span>this<span class="w"> </span>other<span class="w"> </span>command:
<a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a>
<a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a>
<a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a><span class="w">    </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>consul-0<span class="w"> </span>--<span class="w"> </span>consul<span class="w"> </span>operator<span class="w"> </span>raf
</code></pre></div>
<p><img alt="image-20200125133812075" src="" /></p>
<p>具体问题可以参考帖子：https://kubesphere.com.cn/forum/d/669-kubesphere</p>
<h2 id="_1">参考链接</h2>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">Kubernetes官网教程</a></li>
<li><a href="https://www.kubernetes.org.cn/k8s">Kubernetes中文社区</a></li>
<li><a href="https://jimmysong.io/kubernetes-handbook/cloud-native/from-kubernetes-to-cloud-native.html">从Kubernetes到Cloud Native</a></li>
<li><a href="https://www.bookstack.cn/read/feiskyer-kubernetes-handbook/appendix-ecosystem.md">Kubernetes Handbook</a></li>
<li><a href="https://www.kancloud.cn/huyipow/kubernetes/722822">Kubernetes从入门到实战</a></li>
<li><a href="https://kubernetes.feisky.xyz/">Kubernetes指南</a></li>
<li><a href="https://ramitsurana.github.io/awesome-kubernetes/">awesome-kubernetes</a></li>
<li><a href="https://www.qikqiak.com/k8s-book/">从Docker到Kubernetes进阶</a></li>
<li><a href="https://www.qikqiak.com/tdd-book/">python微服务实战</a></li>
<li><a href="https://jimmysong.io/kubernetes-handbook/cloud-native/from-kubernetes-to-cloud-native.html">云原生之路</a></li>
<li><a href="https://landscape.cncf.io/">CNCF Cloud Native Interactive Landscape</a></li>
</ul>
<h3 id="_2">视频</h3>
<ul>
<li><a href="https://www.bilibili.com/video/av35847195/?p=16&amp;t=3931">马哥(docker容器技术+k8s集群技术)</a></li>
<li><a href="https://www.acfun.cn/v/ac10232871">微服务容器化实战</a></li>
</ul>
<hr />
<p>如果此笔记对您有任何帮助，更多文章，欢迎关注博客一块学习交流👏</p>
<p>​   </p>
<h3 id="_3">请我喝咖啡☕️</h3>
<ul>
<li>微信
<a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315181628.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="微信" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315181628.png" /></a>)</li>
<li>支付宝
<a class="glightbox" href="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315181115.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="支付宝" src="https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200315181115.png" /></a></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../chapter-23/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 23. ETCD详解">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                23. ETCD详解
              </div>
            </div>
          </a>
        
        
          
          <a href="../../exp/1/" class="md-footer__link md-footer__link--next" aria-label="Next: Command Line">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Command Line
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2024 Martin Donath – <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
    
    
    
      
      
    
    <a href="https://fosstodon.org/@squidfunk" target="_blank" rel="noopener me" title="fosstodon.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.footer", "content.tooltips", "announce.dismiss", "content.code.copy", "search.suggest", "search.share", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.instant.preview", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.path", "navigation.indexes", "navigation.top", null, "toc.follow", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>