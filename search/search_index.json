{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Index","text":"<p>\u4e16\u754c\u9876\u7ea7\u4e03\u5927\u7ba1\u7406\u5de5\u5177\uff1aSWOT\u3001PDCA\u30016W2H\u3001SMART\u3001WBS\u3001\u65f6\u95f4\u7ba1\u7406\u3001\u4e8c\u516b\u539f\u5219\u3001\u6ce2\u7279\u4e94\u529b\u5206\u6790</p> <p>\u5bfc\u8bed\uff1a\u6240\u8c13\u4eba\u6027\uff0c\u7b80\u6d01\u63cf\u8ff0\u4e3a\u201c\u5df1\u6240\u4e0d\u6b32\uff0c\u52ff\u65bd\u4e8e\u4eba\u201d\uff0c\u4f9d\u5faa\u4eba\u6027\u662f\u7ba1\u7406\u6700\u4fbf\u6377\u65b9\u5f0f\u3002\u76f4\u81f3\u4eca\u5929\uff0c\u6211\u4eec\u4f9d\u7136\u53ef\u4ee5\u501f\u52a9\u53e4\u4eba\u7406\u5ff5\u6765\u7ba1\u7406\u4f01\u4e1a\uff0c\u5176\u4e2d\u4e00\u8109\u76f8\u627f\u7684\u5c31\u662f\u4eba\u6027\u3002</p>"},{"location":"#swot","title":"SWOT\u5206\u6790\u6cd5","text":"<p>SWOT\u5206\u6790\u5230\u5e95\u662f\u4ec0\u4e48\uff1a</p> <p></p> <ul> <li>S\uff1a\u4f18\u52bf(strengths)</li> </ul> <p>\u4f01\u4e1a\u5185\u90e8\u7684\u4f18\u52bf\u548c\u6838\u5fc3\u7ade\u4e89\u3002\u4f8b\u5982\uff0c\u9ad8\u54c1\u8d28\u7684\u4ea7\u54c1\u3001\u4e13\u7684\u56e2\u961f\u3001\u826f\u597d\u7684\u54c1\u724c\u58f0\u8a89\u3001\u521b\u65b0\u80fd\u529b\u7b49\u3002</p> <ul> <li>\u52a3\u52bf(Weaknesses)</li> </ul> <p>\u4f01\u4e1a\u5185\u90e8\u7684\u52a3\u52bf\u548c\u4e0d\u8db3\u3002\u4f8b\u5982\uff0c\u7f3a\u4e4f\u5e02\u573a\u4efd\u989d\u3001\u8d22\u52a1\u72b6\u51b5\u4e0d\u7a33\u5b9a\u3001\u4ea7\u54c1\u6280\u672f\u843d\u540e\u3001\u7ba1\u7406\u4f53\u7cfb\u8584\u5f31\u7b49</p> <ul> <li>O\uff1a\u673a\u4f1a(opportunities)</li> </ul> <p>\u5916\u90e8\u73af\u5883\u4e2d\u53ef\u4ee5\u5229\u7528\u7684\u6709\u5229\u56e0\u7d20\u3002\u4f8b\u5982\uff0c\u5e02\u573a\u9700\u6c42\u589e\u957f\u3001\u6280\u672f\u8fdb\u6b65\u3001\u653f\u7b56\u652f\u6301\u3001\u7ade\u4e89\u5bf9\u624b\u5f31\u52bf\u7b49\u3002</p> <ul> <li>T\uff1a\u5a01\u80c1(threats)</li> </ul> <p>\u5916\u90e8\u73af\u5883\u4e2d\u5bf9\u7ec4\u7ec7\u4ea7\u751f\u4e0d\u5229\u5f71\u54cd\u7684\u56e0\u7d20\u3002\u4f8b\u5982\uff0c\u5e02\u573a\u7ade\u4e89\u52a0\u5267\u3001\u6cd5\u89c4\u53d8\u5316\u3001\u7ecf\u6d4e\u8870\u9000\u3001\u65b0\u5174\u7ade\u4e89\u5bf9\u624b\u7b49\u3002</p> <p>SO \u4f18\u52bf+\u673a\u4f1a\uff1a\u5229\u7528\u5e73\u53f0\u4e0e\u81ea\u8eab\u4eba\u8109\u7684\u4f18\u52bf\u8ba9\u8001\u5ba2\u6237\u8fdb\u884c\u8f6c\u4ecb\u7ecd\uff0c\u4ece\u800c\u83b7\u53d6\u66f4\u591a\u8d44\u6e90\uff1b\u4f9d\u9760\u5185\u90e8\u4f18\u52bf\uff0c\u5229\u7528\u5916\u90e8\u673a\u4f1a\u3002</p> <p>ST \u4f18\u52bf+\u5a01\u80c1\uff1a\u5229\u7528\u7530\u5fcc\u8d5b\u9a6c\u7684\u8ba1\u8c0b\uff0c\u7528\u81ea\u5bb6\u4ea7\u54c1\u7684\u4f18\u52bf\u8d76\u8d85\u7ade\u4e89\u5bf9\u624b\uff1b\u5229\u7528\u5185\u90e8\u4f18\u52bf\uff0c\u89c4\u907f\u5916\u90e8\u5a01\u80c1\u3002</p> <p>WO \u52a3\u52bf+\u673a\u4f1a\uff1a\u5fc3\u6025\u5403\u4e0d\u4e86\u70ed\u8c46\u8150\uff0c\u4e00\u6b21\u53ea\u670d\u52a11-2\u4e2a\u5ba2\u6237\uff1b\u5229\u7528\u5916\u90e8\u673a\u4f1a\uff0c\u5f25\u8865\u5185\u90e8\u52a3\u52bf\u3002</p> <p>WT \u52a3\u52bf+\u5a01\u80c1\uff1a\u4e3a\u4e86\u83b7\u5f97\u5ba2\u6237\u8ba4\u53ef\uff0c\u5bf9\u81ea\u5df1\u53cd\u590d\u8fdb\u884c\u6697\u793a\uff0c\u8981\u6bd4\u7ade\u4e89\u5bf9\u624b\u66f4\u7528\u5fc3\u7684\u670d\u52a1\u5ba2\u6237\uff1b\u51cf\u5c11\u5185\u90e8\u52a3\u52bf\uff0c\u89c4\u907f\u5916\u90e8\u5a01\u80c1\u3002</p> <p>\u5728\u5b8c\u6210\u73af\u5883\u56e0\u7d20\u5206\u6790\u548cSWOT\u77e9\u9635\u7684\u6784\u9020\u540e\uff0c\u4fbf\u53ef\u4ee5\u5236\u5b9a\u51fa\u76f8\u5e94\u7684\u884c\u52a8\u8ba1\u5212\u3002</p> <p>\u5236\u5b9a\u8ba1\u5212\u7684\u57fa\u672c\u601d\u8def\u662f\uff1a\u53d1\u6325\u4f18\u52bf\u56e0\u7d20\uff0c\u514b\u670d\u5f31\u70b9\u56e0\u7d20\uff0c\u5229\u7528\u673a\u4f1a\u56e0\u7d20\uff0c\u5316\u89d2\u7f8a\u5a01\u80c1\u56e0\u7d20\uff1b</p> <p>\u8003\u8651\u8fc7\u53bb\uff0c\u7acb\u8db3\u5f53\u524d\uff0c\u7740\u773c\u672a\u6765\u3002\u8fd0\u7528\u7cfb\u7edf\u5206\u6790\u7684\u7efc\u5408\u5206\u6790\u65b9\u6cd5\uff0c\u5c06\u6392\u5217\u4e0e\u8003\u8651\u7684\u5404\u79cd\u73af\u5883\u56e0\u7d20\u76f8\u4e92\u5339\u914d\u8d77\u6765\u52a0\u4ee5\u7ec4\u5408\uff0c\u5f97\u51fa\u4e00\u7cfb\u5217\u516c\u53f8\u672a\u6765\u53d1\u5c55\u7684\u53ef\u9009\u62e9\u5bf9\u7b56\u3002</p> <p>\u7b56\u7565\u65b9\u6848\u6309SWOT\u6bd4\u8f83\u7ed3\u679c\uff0c\u5f97\u5230\u4ee5\u4e0b\u56db\u79cd\uff1a \u2705\u6295\u5165\u8d44\u6e90\u52a0\u5f3a\u4f18\u52bf\u80fd\u529b\u3001\u4e89\u53d6\u673a\u4f1a\uff08SO\uff1a\u6700\u5927\u4e0e\u6700\u5927\u7b56\u7565\uff09</p> <p>\u2705\u6295\u5165\u8d44\u6e90\u52a0\u5f3a\u4f18\u52bf\u80fd\u529b\u3001\u51cf\u4f4e\u5a01\u80c1\uff08ST\uff1a\u6700\u5927\u4e0e\u6700\u5c0f\u7b56\u7565\uff09</p> <p>\u2705\u6295\u5165\u8d44\u6e90\u6539\u5584\u5f31\u52bf\u80fd\u529b\u3001\u4e89\u53d6\u673a\u4f1a\uff08WO\uff1a\u6700\u5c0f\u4e0e\u6700\u5927\u7b56\u7565\uff09</p> <p>\u2705\u6295\u5165\u8d44\u6e90\u6539\u5584\u5f31\u52bf\u80fd\u529b\u3001\u51cf\u4f4e\u5a01\u80c1\uff08WT\uff1a\u6700\u5c0f\u4e0e\u6700\u5c0f\u7b56\u7565\uff09</p>"},{"location":"#pdca","title":"PDCA\u5faa\u73af\u89c4\u5219","text":"<p>\u5f00\u59cb\u6709\u8ba1\u5212\uff0c\u4e8b\u4e8b\u6709\u95ed\u73af  \ud83d\udd37PDCA\u5faa\u73af\u53c8\u53eb\u6234\u660e\u73af\uff0c\u662f\u7f8e\u56fd\u8d28\u91cf\u7ba1\u7406\u4e13\u5bb6\u4f11\u54c8\u7279\u535a\u58eb\u9996\u5148\u63d0\u51fa\u7684\uff0c\u7531\u6234\u660e\u91c7\u7eb3\u3001\u5ba3\u4f20\uff0c\u83b7\u5f97\u666e\u53ca\uff0c\u4ece\u800c\u4e5f\u88ab\u79f0\u4e3a\u201c\u6234\u660e\u73af\u201d\u3002PDCA\u5373Plan\uff08\u8ba1\u5212\uff09\u3001Do\uff08\u6267\u884c\uff09\u3001Check\uff08\u68c0\u67e5\uff09\u548c Act\uff08\u5904\u7406\uff09\u3002</p> <p>\ud83d\udd37P(\u8ba1\u5212) : \u4ece\u95ee\u9898\u7684\u5b9a\u4e49\u5230\u884c\u52a8\u8ba1\u5212\u3164</p> <p>\ud83d\udd37D(\u6267\u884c) : \u5b9e\u65bd\u884c\u52a8\u8ba1\u5212\u3164</p> <p>\ud83d\udd37C(\u68c0\u67e5) : \u8bc4\u4f30\u7ed3\u679c\u3164</p> <p>\ud83d\udd37A(\u6539\u8fdb) : \u6807\u51c6\u5316\u548c\u8fdb\u4e00\u6b65\u63a8\u5e7f \u3164 \u5faa\u73af\u7684\u7279\u70b9\uff1a \u25cf\u5927\u73af\u5957\u5c0f\u73af\uff0c\u5c0f\u73af\u4fdd\u5927\u73af\uff0c\u63a8\u52a8\u5927\u5faa\u73af</p> <p>\u25cf\u5faa\u73af\u662f\u722c\u697c\u68af\u4e0a\u5347\u5f0f\u7684\u5faa\u73af \u4e00\u4e2a\u5faa\u73af\u8fd0\u8f6c\u7ed3\u675f\uff0c\u8d28\u91cf\u5c31\u4f1a\u63d0\u9ad8\u4e00\u6b65\uff0c\u7136\u540e\u518d\u5236\u5b9a\u4e0b\u4e00\u4e2a\u5faa\u73af\uff0c\u518d\u8fd0 \u8f6c\u3001\u518d\u63d0\u9ad8\uff0c\u4e0d\u65ad\u524d\u8fdb\uff0c\u4e0d\u65ad\u63d0\u9ad8\u3002</p> <p>\u25cfPDCA\u5faa\u73af\u662f\u7efc\u5408\u6027\u5faa\u73af 4\u4e2a\u9636\u6bb5\u662f\u76f8\u5bf9\u7684\uff0c\u5b83\u4eec\u4e4b\u95f4\u4e0d\u662f\u622a\u7136\u5206\u5f00\u7684</p> <p>\u25cf\u63a8\u52a8PDCA\u5faa\u73af\u7684\u5173\u952e\u662f\u201c\u5904\u7406\u201d\u9636\u6bb5</p>"},{"location":"#6w2h","title":"6W2H\u5206\u6790\u6cd5","text":"<p> 1.\u76ee\u6807(which)\u2014\u2014\u9009\u62e9\u7684\u76ee\u6807/\u5bf9\u8c61 \u4e2a\u4eba/\u516c\u53f8\u6709\u4ec0\u4e48\u6837\u7684\u76ee\u6807\uff0c\u9009\u62e9\u505a\u4ec0\u4e48\u6837\u7684\u4ea7\u54c1\uff1f</p> <p>2.\u539f\u56e0(why )\u2014\u2014\u8fd9\u6837\u9009\u62e9\u7684\u7406\u7531 \u4e3a\u4ec0\u4e48\u8981\u751f\u4ea7\u8fd9\u4e2a\u4ea7\u54c1\uff1f\u80fd\u4e0d\u80fd\u751f\u4ea7\u522b\u7684\uff1f\u6211\u5230\u5e95\u5e94\u8be5\u751f\u4ea7\u4ec0\u4e48\uff1f</p> <p>3.\u5bf9\u8c61(what)\u2014\u2014\u529f\u80fd\u4e0e\u672c\u8d28 \u8fd9\u4e2a\u4ea7\u54c1\u7684\u529f\u80fd\u5982\u4f55\uff1f\u5b83\u80fd\u6ee1\u8db3\u54ea\u4e9b\u5ba2\u6237\u548c\u4eba\u7fa4\u7684\u9700\u6c42\uff1f</p> <p>4.\u573a\u6240(where)\u2014\u2014\u4ec0\u4e48\u5730\u70b9 \u751f\u4ea7\u662f\u5728\u54ea\u91cc\uff1f\u4e3a\u4ec0\u4e48\u504f\u504f\u8981\u5728\u8fd9\u4e2a\u5730\u65b9\uff1f\u6362\u4e2a\u5730\u65b9\u884c\u4e0d\u884c\uff1f</p> <p>5.\u65f6\u95f4\u548c\u7a0b\u5e8f(when)\u2014\u2014\u4ec0\u4e48\u65f6\u5019 \u65f6\u95f4\u4e0e\u8282\u594f\u7684\u628a\u63e1\u662f\u5341\u5206\u91cd\u8981\u7684\uff0c\u6293\u4f4f\u65f6\u673a</p> <p>6.\u7ec4\u7ec7\u6216\u4eba(who)\u2014\u2014\u8d23\u4efb\u5355\u4f4d\u3001\u8d23\u4efb\u4eba \u8fd9\u4e2a\u4e8b\u60c5\u662f\u8c01\u8d1f\u8d23\uff0c\u8c01\u5728\u505a\uff1f\u4e3a\u4ec0\u4e48\u8981\u8ba9\u4ed6\u505a\uff1f</p> <p>7.\u5982\u4f55\u505a\uff08how to do\uff09\u2014\u2014\u5982\u4f55\u63d0 \u9ad8\u6548\u7387 8.\u4ef7\u503c(how much)\u2014\u2014\u6210\u672c\u591a\u5c11\uff0c\u6027\u4ef7\u6bd4\u5982\u4f55\uff1f</p> <p>6W2H\u662f\u4e00\u4e2a\u4ee5\u4ef7\u503c\u4e3a\u5bfc\u5411\u7684\u6807\u51c6\u5316\u601d\u7ef4\u6d41\u7a0b\uff0c\u662f\u4eba\u4eec\u5728\u8ffd\u6c42\u7406\u60f3\u548c\u76ee\u6807\u7684\u8fc7\u7a0b\u4e2d\u90fd\u8981\u7ecf\u8fc7\u9009\u62e9\u76ee\u6807 \uff08which\uff09\u2192\u9009\u62e9\u539f\u56e0\uff08why\uff09\u2192\u529f\u80fd\u5982\u4f55\u2192\uff08what\uff09\u2192\u4ec0\u4e48\u573a\u5730\uff08where\uff09\u2192\u4ec0\u4e48\u65f6\u95f4\uff08when\uff09\u2192\u4ec0\u4e48\u7ec4\u7ec7\uff08who\uff09\u2192\u5982\u4f55\u63d0 \u9ad8\u6548\u7387\uff08how to do\uff09\u2192\u6027\u4ef7\u6bd4\u5982\u4f55\uff08how much\uff09</p>"},{"location":"#smart","title":"SMART\u6a21\u578b","text":"<p>\u597d\u7684\u76ee\u6807\u662f\u9075\u4ecesmart\u539f\u5219\u7684\uff0c\u65e0\u8bba\u662f\u5de5\u4f5c\u4e2d\u7684\u76ee\u6807\u8fd8\u662f\u751f\u6d3b\u4e2d\u7684\u76ee\u6807\u3002</p> <p>\u4ec0\u4e48\u662fsmart\u539f\u5219\u5462\uff0c\u7b80\u5355\u4e5f\u5c31\u662f\u4e00\u4e2a\u76ee\u6807\u9700\u8981\u662f\u5177\u4f53\u7684\u3001\u53ef\u8861\u91cf\u7684\u3001\u53ef\u5b9e\u73b0\u7684\u3001\u4e0e\u957f\u671f\u613f\u666f\u8981\u76f8\u5173\u7684\u3001\u8981\u6709\u65f6\u95f4\u9650\u5236\u7684\u3002  \u4ec0\u4e48\u662f\u201cSmart\u539f\u5219\u62c6\u89e3\u76ee\u6807\u201d\uff1f\u5b83\u662f\u6307\u5c06\u76ee\u6807\u6309\u7167\u4ee5\u4e0b\u4e94\u4e2a\u539f\u5219\u8fdb\u884c\u62c6\u89e3\uff0c\u5206\u522b\u662f\uff1a\ud83d\udc47</p> <p>Specific\uff08\u5177\u4f53\u7684\uff09\uff1a\u76ee\u6807\u5fc5\u987b\u660e\u786e\u5177\u4f53\uff0c\u4e0d\u80fd\u592a\u7b3c\u7edf\u3002\u6bd4\u5982\u8bf4\uff0c\u4e0d\u8981\u53ea\u662f\u8bf4\u60f3\u51cf\u80a5\uff0c\u800c\u662f\u8981\u89c4\u5b9a\u4f53\u91cd\u51cf\u5c11\u591a\u5c11\uff0c\u65f6\u95f4\u5468\u671f\u662f\u591a\u4e45\u3002</p> <p>Measurable\uff08\u53ef\u8861\u91cf\u7684\uff09\uff1a\u76ee\u6807\u5fc5\u987b\u662f\u53ef\u8861\u91cf\u7684\uff0c\u80fd\u591f\u6709\u5177\u4f53\u7684\u6807\u51c6\u6765\u8861\u91cf\u5b8c\u6210\u7684\u7a0b\u5ea6\u3002\u4f8b\u5982\uff0c\u8bbe\u5b9a\u6bcf\u5468\u51cf\u91cd0.5\u516c\u65a4\u4f5c\u4e3a\u8861\u91cf\u6807\u51c6\u3002</p> <p>Attainable\uff08\u53ef\u5b9e\u73b0\u7684\uff09\uff1a\u76ee\u6807\u5fc5\u987b\u662f\u53ef\u5b9e\u73b0\u7684\uff0c\u4e0d\u80fd\u8fc7\u9ad8\u6216\u8fc7\u4f4e\u3002\u5c0f\u76ee\u6807\u7684\u5b8c\u6210\u5c06\u6709\u52a9\u4e8e\u63d0\u9ad8\u81ea\u4fe1\u5fc3\u548c\u52a8\u529b\u3002</p> <p>Relevant\uff08\u76f8\u5173\u7684\uff09\uff1a\u76ee\u6807\u5fc5\u987b\u4e0e\u4f60\u7684\u6574\u4f53\u89c4\u5212\u548c\u76ee\u6807\u76f8\u7b26\u3002\u4f8b\u5982\uff0c\u51cf\u80a5\u53ef\u4ee5\u662f\u8eab\u4f53\u5065\u5eb7\u7684\u4e00\u4e2a\u5b50\u76ee\u6807\uff0c\u5b83\u5bf9\u5b9e\u73b0\u6574\u4f53\u76ee\u6807\u662f\u6709\u5e2e\u52a9\u7684\u3002</p> <p>Time-bound\uff08\u65f6\u95f4\u9650\u5236\u7684\uff09\uff1a\u76ee\u6807\u5fc5\u987b\u6709\u4e00\u4e2a\u660e\u786e\u7684\u5b8c\u6210\u65f6\u95f4\u3002\u5728\u8fd9\u4e2a\u65f6\u95f4\u4e4b\u524d\u5b8c\u6210\u76ee\u6807\u53ef\u4ee5\u8ba9\u4f60\u66f4\u6709\u52a8\u529b\u3002</p>"},{"location":"#abc","title":"\u60c5\u7eeaABC\u7406\u8bba","text":"<p>ABC\u6a21\u578b\u4e2d\u7684\u4e09\u4e2a\u5b57\u6bcd\u4ee3\u8868\u4e86\u4ee5\u4e0b\u4e09\u4e2a\u6982\u5ff5\uff1a</p> <p>A (Activating Event)\uff1a\u6fc0\u53d1\u4e8b\u4ef6\u3002\u8fd9\u662f\u6307\u4efb\u4f55\u53d1\u751f\u5728\u4e2a\u4f53\u751f\u6d3b\u4e2d\u7684\u5916\u90e8\u4e8b\u4ef6\u6216\u8005\u5185\u90e8\u4f53\u9a8c\uff0c\u5982\u5931\u53bb\u5de5\u4f5c\u3001\u9047\u5230\u4ea4\u901a\u5835\u585e\u3001\u63a5\u6536\u6279\u8bc4\u7b49\u3002</p> <p>B (Beliefs)\uff1a\u4fe1\u5ff5\u3002\u8fd9\u662f\u6307\u4e2a\u4f53\u5bf9\u4e8e\u6fc0\u53d1\u4e8b\u4ef6\u7684\u8ba4\u77e5\u8bc4\u4ef7\u548c\u89e3\u91ca\uff0c\u5305\u62ec\u5bf9\u4e8b\u4ef6\u7684\u76f4\u63a5\u89e3\u91ca\uff08\u5373\u201c\u81ea\u52a8\u601d\u7ef4\u201d\uff09\u4ee5\u53ca\u66f4\u6df1\u5c42\u6b21\u7684\u6838\u5fc3\u4fe1\u5ff5\u3002\u4fe1\u5ff5\u53ef\u4ee5\u662f\u7406\u6027\u7684\uff0c\u4e5f\u53ef\u4ee5\u662f\u975e\u7406\u6027\u7684\u3002</p> <p>C (Consequences)\uff1a\u540e\u679c\u3002\u8fd9\u662f\u6307\u4e2a\u4f53\u5728\u6301\u6709\u7279\u5b9a\u4fe1\u5ff5\u7684\u57fa\u7840\u4e0a\u4ea7\u751f\u7684\u60c5\u7eea\u548c\u884c\u4e3a\u53cd\u5e94\u3002\u60c5\u7eeaABC\u7406\u8bba\u8ba4\u4e3a\uff0c\u60c5\u7eea\u548c\u884c\u4e3a\u7684\u540e\u679c\u5e76\u975e\u76f4\u63a5\u7531\u6fc0\u53d1\u4e8b\u4ef6\u672c\u8eab\u5f15\u8d77\uff0c\u800c\u662f\u7531\u4e2a\u4f53\u5bf9\u4e8b\u4ef6\u7684\u4fe1\u5ff5\u89e3\u91ca\u6240\u51b3\u5b9a\u3002</p> <p>\u60c5\u7eeaABC\u7406\u8bba\u7684\u6838\u5fc3\u89c2\u70b9\u662f\uff0c\u4eba\u4eec\u7684\u60c5\u7eea\u56f0\u6270\u5f80\u5f80\u6e90\u4e8e\u4e0d\u5408\u7406\u7684\u4fe1\u5ff5\uff0c\u5373\u975e\u7406\u6027\u4fe1\u5ff5\u3002\u8fd9\u4e9b\u975e\u7406\u6027\u4fe1\u5ff5\u53ef\u80fd\u5305\u62ec\u8fc7\u5ea6\u6982\u62ec\u3001\u707e\u96be\u5316\u601d\u7ef4\u3001\u9ed1\u767d\u601d\u7ef4\u7b49\u3002</p> <p>\u901a\u8fc7\u8bc6\u522b\u548c\u6311\u6218\u8fd9\u4e9b\u975e\u7406\u6027\u4fe1\u5ff5\uff0c\u4e2a\u4f53\u53ef\u4ee5\u6539\u53d8\u81ea\u5df1\u5bf9\u6fc0\u53d1\u4e8b\u4ef6\u7684\u89e3\u8bfb\uff0c\u4ece\u800c\u6539\u53d8\u60c5\u7eea\u548c\u884c\u4e3a\u7684\u540e\u679c\uff0c\u5b9e\u73b0\u60c5\u7eea\u7684\u8c03\u8282\u548c\u6539\u5584\u3002</p>"},{"location":"#20","title":"\u4e8c\u516b\u5b9a\u5f8b\uff5c\u6293\u4f4f\u6700\u91cd\u8981\u768420%","text":"<p>\u4e8c\u516b\u5b9a\u5f8b|||\u8bf4\u8d77\u300c\u4e8c\u516b\u5b9a\u5f8b\u300d\uff0c\u6211\u4eec\u901a\u5e38\u90fd\u4e0d\u89c9\u5f97\u964c\u751f\uff1a\u4e16\u754c\u4e0a80%\u7684\u8d22\u5bcc\uff0c\u638c\u63e1\u572820%\u7684\u4eba\u624b\u4e2d\u3002\u662f\u610f\u5927\u5229\u7ecf\u6d4e\u5b66\u5bb6\u5df4\u83b1\u591a\u53d1\u73b0\u7684\u3002</p> <p>\u5728\u4ed6\u770b\u6765\uff0c\u5728\u4efb\u4f55\u7279\u5b9a\u7fa4\u4f53\u4e2d\uff0c\u91cd\u8981\u7684\u56e0\u5b50\u901a\u5e38\u53ea\u5360\u5c11\u6570\uff0c\u7ea620%\uff0c\u800c\u5176\u4f5980%\u7684\u56e0\u5b50\u5219\u5360\u591a\u6570\uff0c\u4f46\u5374\u662f\u4e0d\u91cd\u8981\u7684\uff0c\u56e0\u6b64\u53ea\u8981\u80fd\u63a7\u5236\u5177\u6709\u91cd\u8981\u6027\u7684\u5c11\u6570\u56e0\u5b50\u5373\u80fd\u63a7\u5236\u5168\u5c40\u3002</p> <p>\u5728\u751f\u6d3b\u4e2d\uff0c\u4e8c\u516b\u5b9a\u5f8b\u65e0\u5904\u4e0d\u5728\u3002</p> <p>20%\u7684\u4eba\u505a\u4e8b\u4e1a\uff0c80%\u7684\u4eba\u505a\u4e8b\u60c5\uff1b 20%\u7684\u4eba\u8bb0\u7b14\u8bb0\uff0c80%\u7684\u4eba\u5fd8\u6027\u597d\uff1b 20%\u7684\u4eba\u6709\u76ee\u6807\uff0c80%\u7684\u4eba\u7231\u778e\u60f3\uff1b 20%\u7684\u4eba\u60f3\u6539\u53d8\u81ea\u5df1\uff0c80%\u7684\u4eba\u60f3\u6539\u53d8\u522b\u4eba\uff1b 20%\u7684\u4eba\u660e\u5929\u7684\u4e8b\u60c5\u4eca\u5929\u505a\uff0c80%\u7684\u4eba\u4eca\u5929\u7684\u4e8b\u60c5\u660e\u5929\u505a\uff1b 20%\u7684\u4eba\u5728\u6295\u8d44\u8005\u8d5a\u94b1\u4e8680%\u7684\u5e02\u573a\u6536\u76ca......</p> <p>\u4e8c\u516b\u5b9a\u5f8b\u7684\u4e09\u70b9\u542f\u793a</p> <p>1.\u6d1e\u5bdf\u5206\u6790\uff0c\u6df1\u5165\u601d\u8003\uff0c\u627e\u51fa20%\u7684\u5173\u952e\u56e0\u7d20\u3002 2.\u9501\u5b9a20%\u7684\u56e0\u7d20\uff0c\u641e\u6e05\u695a\u4ed6\u80cc\u540e\u7684\u672c\u8d28\u548c\u89c4\u5f8b\u3002 3.\u6295\u516580%\u7684\u7cbe\u529b\u53bb\u505a\u597d\u5b83\u4eec\u3002</p>"},{"location":"#_2","title":"\u6ce2\u7279\u4e94\u529b\u5206\u6790","text":"<p>\u2776 \u77e5\u8bc6\u548c\u8d44\u6e90\u7684\u50a8\u5907 \u4f60\u7684\u4e13\u4e1a\u77e5\u8bc6\u548c\u6280\u80fd \u4f60\u7684\u4eba\u8109\u3001\u8d44\u6e90 \u662f\u5426\u4e3a\u7a00\u7f3a\u4eba\u624d \u662f\u5426\u6709\u7ee7\u7eed\u5b66\u4e60/\u63d0\u5347</p> <p>\u2777 \u540c\u4e1a\u7ade\u4e89\u8005 \u4ece\u4e8b\u884c\u4e1a\u7684\u5927\u73af\u5883\u600e\u4e48\u6837 \u5728\u5e02\u573a\u4e0a\u7684\u7ade\u4e89\u529b\u5982\u4f55 \u540c\u884c\u5c97\u4f4d\u5728\u5176\u4ed6\u4f01\u4e1a\u7684\u5728\u804c/\u521b\u4e1a\u7684\u4eba\u53d1\u5c55\u60c5\u51b5</p> <p>\u2778 \u5e02\u573a\u8ba4\u53ef\u5ea6 \u804c\u573a\u53d1\u5c55\u8def\u5f84 \u540c\u5b66\u5386\u3001\u8d44\u5386\u7684\u5e02\u573a\u85aa\u916c\u521b\u4e1a\u6216\u526f\u4e1a\u7684\u53d8\u73b0\u80fd\u529b</p> <p>\u2779 \u88ab\u66ff\u4ee3\u7684\u53ef\u80fd\u6027 \u540c\u7b49\u80fd\u529b\u7684\u6c42\u804c\u8005\u66ff\u4ee3\u7684\u53ef\u80fd\u6027 \u5176\u4ed6\u5c97\u4f4d/\u4e13\u4e1a\u66ff\u4ee3\u7684\u53ef\u80fd\u6027 AI\u4eba\u5de5\u667a\u80fd\u66ff\u4ee3\u7684\u53ef\u80fd\u6027</p> <p>\u277a \u6f5c\u5728\u7ade\u4e89\u8005 \u4f60\u5c1a\u4e0d\u5177\u5907\u7684\u80fd\u529b\u6216\u5c97\u4f4d\u8981\u6c42\u57f9\u517b\u6210\u672c\u600e\u4e48\u6837</p> <p>\u4f01\u4e1a\u6216\u54c1\u724c\u5b9e\u6218\u7ecf\u8425\uff0c\u6c38\u8fdc\u5927\u8fc7\u4e8e\u4e00\u5207\u5916\u5728\u7684\u8f85\u52a9\u5de5\u5177\u6216\u670d\u52a1\u3002\u4e0d\u7ba1\u662f\u6218\u7565\u54a8\u8be2\u3001\u8425\u9500\u7b56\u5212\u3001\u5a92\u4f53\u4f20\u64ad\u8fd8\u662f\u5185\u5bb9\u8bbe\u8ba1\uff0c\u89e3\u51b3\u5355\u65b9\u9762\u95ee\u9898\uff0c\u5e76\u4e0d\u80fd\u51b3\u5b9a\u4f01\u4e1a\u6216\u54c1\u724c\u7684\u6574\u4f53\u7ecf\u8425\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5927\u90e8\u5206\u4f01\u4e1a\u81ea\u8eab\u6bd4\u5916\u90e8\u54a8\u8be2\u6216\u7b56\u5212\u673a\u6784\uff0c\u66f4\u61c2\u7ecf\u8425\uff0c\u66f4\u61c2\u7b56\u7565\u3002</p> <p>\u4e3e\u4e2a\u5f88\u7b80\u5355\u7684\u4f8b\u5b50\uff1a\u6c14\u5019\u662f\u4e00\u4e2a\u5f88\u590d\u6742\u7684\u7cfb\u7edf\uff0c\u867d\u7136\u6709\u5927\u6c14\u5019\u73af\u5883\u7684\u5b58\u5728\uff0c\u4f46\u6bcf\u4e2a\u5c40\u90e8\u5730\u533a\uff0c\u7531\u4e8e\u590d\u6742\u591a\u53d8\u7684\u539f\u56e0\uff0c\u4e0d\u7ba1\u662f\u5730\u7406\u56e0\u7d20\u8fd8\u662f\u4eba\u4e3a\u5e72\u9884\uff0c\u90fd\u4f1a\u9020\u6210\u5c0f\u6c14\u5019\u7684\u4e0d\u540c\u3002</p> <p>\u6587\u5316\u7ecf\u6d4e\u4e5f\u5b58\u5728\u540c\u6837\u7684\u590d\u6742\u6027\uff0c\u5b8f\u89c2\u7ecf\u6d4e\u7e41\u8363\u6216\u8005\u8870\u9000\uff0c\u867d\u7136\u5f71\u54cd\u4e86\u5927\u591a\u6570\u7fa4\u4f53\uff0c\u4f46\u4e0d\u59a8\u788d\u5c0f\u7fa4\u4f53\u7684\u8d2b\u7a77\u6216\u5bcc\u88d5\u3002</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"about/","title":"Quae loquentem ad quod","text":""},{"location":"about/#illum-proximitas-fulva","title":"Illum proximitas fulva","text":"<p>Lorem markdownum inposuere possem fastus numerandos aquas perosus omnipotens Caeneus; tibi animam resistunt. Es miscenda tempora concrescere Minos, iam adhuc et medioque. Scilicet curru rapiunt summo caestibus rorantesque, non ubi terra voluptas sine, sed primum tenet, mali. Retroque paelex novissima glaebam prohibete praestanti Aeneae conubia exclamat.</p>"},{"location":"about/#in-ensis-fine-insignis-pervenientia-putant-posco","title":"In ensis fine insignis pervenientia putant posco","text":"<p>Intexere inmunitamque virtus stirpes nisi resonabat delicta securus, pectora tecumque sociare lucente caede. Vana agitabitur multi; infans imitamina naturae et memores pennas pondere ira stabat Hesperio arbor et.</p>"},{"location":"about/#iuvit-ipsa-calescit","title":"Iuvit ipsa calescit","text":"<p>Seu illa, undis coegi serpentis tertius pondere? Ex iusque, falce mediis erat Rhadamanthon equos, undas non cupit excubias per. Quondam terrae subiecto, momordit si modo Ceycis ruunt, sum cedere pete avenis quoque meus contraria et amantes.</p> <p>Verbis nutricis huic. Sic est homini, hoc procis duae fer Bienoris natis? Sanguine Ianthe et radiis pondus bracchia tenent tui manet et herbas cetera quoque coram! Ferox Priamusque ignotae, et addiderat vapore minuat, est arcem facibus auxiliare vultu. Nullosque heres deseruitque magna tertius Amphitryoniaden vultumque volentes: canisve pallentia in ante.</p>"},{"location":"about/#sistraque-apta","title":"Sistraque apta","text":"<p>Nitidissima actaque dabit modo viscera ales, auctor quod, in victorem fecit. Credant se dapes plura, mihi negate toto pedum placidis repercussae tenaci donisque et fertilis huic flavus Regi: eadem. Nec noctes sedebat duorum; sola, illa Oenopiam dixit. Proceres pater. Iaculum modo origo moventem fuerat.</p> <ul> <li>Qui aliquam</li> <li>Per est optima praecontrectatque dominae terribili</li> <li>Fui dextras miscet parabat telluris adhaesit revexit</li> <li>Formae lammina mihi</li> <li>Inmensum glandes ille est Graiae</li> </ul>"},{"location":"about/#dixit-et-nec-nec-robora-undae-reluxit","title":"Dixit et nec nec robora undae reluxit","text":"<p>Calentes Iuno parenti bracchia, quod esto. Dum potentior primo postquam centum blanditur dedignata arma.</p> <p>Mollito rapimur est, adicis Paris; olim unda peraget valens ea vultus silvani; mea sunt cadunt. Oscula referens ferrea nisi oraque sic pedesque inpulsaque: mitior inmixtos quae.</p>"},{"location":"AIGC/","title":"README","text":""},{"location":"AIGC/#column-alignment","title":"Column alignment","text":"Method Description notes <code>GET</code>      Fetch resource yes <code>PUT</code>  Update resource yes <code>DELETE</code>      Delete resource yes"},{"location":"AIGC/MAMBA/","title":"Model-Mamba","text":"<p>Mamba: Linear-Time Sequence Modeling with Seletive State Spaces </p> <p>Mamba \u662f\u4e00\u4e2a\u7ebf\u6027\u5e8f\u5217\u6a21\u578b\uff0c\u76ee\u7684\u662f\u6253\u8d25transformer\u6a21\u578b</p>","tags":["AIGC","Models"]},{"location":"AIGC/amazon_bedrock/","title":"Amazon Bedrock","text":"<p>Date:2024/4/8</p>"},{"location":"AIGC/amazon_bedrock/#amazon-bedrock","title":"Amazon Bedrock","text":"<p>\u5de5\u4f5c\u6d41\uff1a     </p>"},{"location":"AIGC/amazon_bedrock/#agent","title":"Agent:","text":""},{"location":"AIGC/amazon_bedrock/#claude-3","title":"Claude 3","text":"<ul> <li>\u652f\u6301200k token \u8d85\u957f\u4e0a\u4e0b\u6587</li> <li>\u9488\u5bf9\u67d0\u4e9b\u7279\u6b8a\u573a\u666f\uff0c\u4f1a\u5f00\u653e\u652f\u63011M token \u7684\u4e0a\u4e0b\u6587\u7a97\u53e3</li> <li>\u5927\u6d77\u635e\u9488\uff08Needle in A haystack,NIAH\uff09\u53ec\u56de\u7387\u8868\u73b0\u4f18\u5f02</li> </ul> <p>Claude3\u4e09\u79cd\u89c4\u683c\u4e2d\u7684\u5404\u4e2a\u4f18\u52bf\uff1a</p> <pre><code>Opus --\u6700\u5f3a\u5927\nsonnet --\u6700\u5747\u8861\nHaiku --\u6700\u8f7b\u5feb\n</code></pre> <p>Bedrock\u6982\u8981\u4ecb\u7ecd</p> <p>AWS Bedrock\u662f\u4e00\u79cd\u57fa\u4e8e\u4eba\u5de5\u667a\u80fd\u7684\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u6846\u67b6,\u65e8\u5728\u5229\u7528\u57fa\u7840\u6a21\u578b\u5feb\u901f\u6784\u5efa\u548c\u6269\u5c55\u667a\u80fd\u5e94\u7528\u7a0b\u5e8f\u3002\u5b83\u63d0\u4f9b\u4e86\u5bf9\u4e3b\u6d41\u57fa\u7840\u6a21\u578b\u7684\u7edf\u4e00API\u8bbf\u95ee,\u5e76\u5141\u8bb8\u4f01\u4e1a\u4f7f\u7528\u81ea\u8eab\u6570\u636e\u5bf9\u6a21\u578b\u8fdb\u884c\u5fae\u8c03,\u6ee1\u8db3\u7279\u5b9a\u4e1a\u52a1\u9700\u6c42\u3002Bedrock\u786e\u4fdd\u4e86\u6570\u636e\u9690\u79c1\u3001\u5b89\u5168\u6027\u548c\u5408\u89c4\u6027,\u652f\u6301\u6784\u5efa\u667a\u80fd\u4ee3\u7406\u6267\u884c\u590d\u6742\u4efb\u52a1,\u5e76\u901a\u8fc7\u68c0\u7d22\u589e\u5f3a\u751f\u6210\u7b49\u6280\u672f\u589e\u5f3a\u6a21\u578b\u80fd\u529b\u3002\u540c\u65f6,\u5b83\u63d0\u4f9b\u4e86\u7ecf\u6d4e\u9ad8\u6548\u7684\u89e3\u51b3\u65b9\u6848,\u65e0\u9700\u7ba1\u7406\u57fa\u7840\u8bbe\u65bd\u3002\u603b\u7684\u6765\u8bf4,AWS Bedrock\u4e3a\u4f01\u4e1a\u5e26\u6765\u4e86AI\u9a71\u52a8\u7684\u5e94\u7528\u5f00\u53d1\u65b0\u8303\u5f0f,\u52a0\u901f\u4e86\u667a\u80fd\u5e94\u7528\u7684\u6784\u5efa\u548c\u90e8\u7f72\u3002  AWS Bedrock\u4e3a\u4f01\u4e1a\u63d0\u4f9b\u4e86\u591a\u79cd\u4e3b\u6d41\u57fa\u7840\u6a21\u578b\u7684\u9009\u62e9,\u5305\u62ecAI21 Labs\u7684Jurassic-2\u3001Anthropic\u7684Claude\u7cfb\u5217\u3001Cohere\u7684Command\u548cEmbed\u3001Mistral AI\u7684Mistral\u7b49\u3002\u8fd9\u4e9b\u6a21\u578b\u6db5\u76d6\u4e86\u81ea\u7136\u8bed\u8a00\u5904\u7406\u3001\u8ba1\u7b97\u673a\u89c6\u89c9\u3001\u591a\u6a21\u6001\u7b49\u591a\u4e2a\u9886\u57df,\u53ef\u7528\u4e8e\u6784\u5efa\u5404\u79cd\u667a\u80fd\u5e94\u7528\u3002\u9664\u4e86\u7b2c\u4e09\u65b9\u6a21\u578b,Bedrock\u8fd8\u96c6\u6210\u4e86Meta\u7684LLaMA\u6a21\u578b\u3001Stability AI\u7684Stable Diffusion\u7b49\u77e5\u540d\u5f00\u6e90\u6a21\u578b\u3002\u540c\u65f6,\u4e9a\u9a6c\u900a\u81ea\u8eab\u7684\u6a21\u578b\u5982Amazon Titan\u4e5f\u5728\u5185\u7f6e\u9009\u62e9\u4e4b\u5217,\u4e3a\u4f01\u4e1a\u5ba2\u6237\u63d0\u4f9b\u66f4\u591a\u53ef\u9760\u3001\u4f18\u8d28\u7684\u6a21\u578b\u8d44\u6e90\u3002\u901a\u8fc7\u63d0\u4f9b\u4e30\u5bcc\u7684\u57fa\u7840\u6a21\u578b\u9009\u62e9\u3002 AWS Bedrock\u63d0\u4f9b\u4e86\u4e00\u79cd\u65e0\u670d\u52a1\u5668\u7684\u65b9\u5f0f,\u901a\u8fc7\u7edf\u4e00API\u5c06\u5404\u79cd\u57fa\u7840\u6a21\u578b\u96c6\u6210\u3002\u5f00\u53d1\u8005\u53ea\u9700\u901a\u8fc7\u8be5API\u53d1\u51fa\u8bf7\u6c42,Bedrock\u4fbf\u4f1a\u57fa\u4e8e\u8bf7\u6c42\u5185\u5bb9\u9009\u62e9\u5408\u9002\u7684\u6a21\u578b\u3001\u5b8c\u6210\u6a21\u578b\u63a8\u7406\u5e76\u8fd4\u56de\u7ed3\u679c\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d,Bedrock\u4f1a\u81ea\u52a8\u5904\u7406\u5e95\u5c42\u57fa\u7840\u67b6\u6784\u3001\u6a21\u578b\u90e8\u7f72\u3001\u8fd0\u884c\u7ba1\u7406\u7b49\u590d\u6742\u7ec6\u8282,\u5f00\u53d1\u8005\u65e0\u9700\u5173\u6ce8\u8fd9\u4e9b\u5185\u90e8\u7ec6\u8282\u3002\u540c\u65f6,Bedrock\u652f\u6301\u4e2a\u6027\u5316\u5fae\u8c03,\u5141\u8bb8\u4f01\u4e1a\u4f7f\u7528\u81ea\u6709\u6570\u636e\u5bf9\u6a21\u578b\u8fdb\u884c\u4f18\u5316,\u6ee1\u8db3\u7279\u5b9a\u4e1a\u52a1\u9700\u6c42\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f,Bedrock\u663e\u8457\u964d\u4f4e\u4e86AI\u5e94\u7528\u5f00\u53d1\u7684\u590d\u6742\u6027,\u4f7f\u4f01\u4e1a\u80fd\u591f\u9ad8\u6548\u5229\u7528\u5404\u79cd\u57fa\u7840\u6a21\u578b\u7684\u80fd\u529b,\u5feb\u901f\u6784\u5efa\u548c\u4ea4\u4ed8\u667a\u80fd\u5e94\u7528\u3002</p> <p>Bedrock/Claude3 \u6838\u5fc3\u4f18\u52bf</p> <p>Claude 3\u7cfb\u5217\u6a21\u578b \u5728\u591a\u9879AI\u7cfb\u7edf\u5e38\u7528\u8bc4\u4f30\u6d4b\u8bd5\u96c6\u4e2d\uff0c\u5305\u62ec\u672c\u79d1\u7ea7\u522b\u4e13 \u5bb6\u77e5\u8bc6(MMLU)\u3001\u7814\u7a76\u751f\u7ea7\u522b\u4e13\u5bb6\u63a8 \u7406(GPQA)\u3001\u57fa\u7840\u6570\u5b66(GSM8K, MATH)\uff0c\u591a\u8bed\u79cd\u6570\u5b66(MGSM)\uff0c\u9605\u8bfb \u7406\u89e3(RACE-H)\uff0c\u5e38\u8bc6\u63a8\u7406 (HellaSwag)\uff0c\u4ee3\u7801\u9886\u57df\u5747\u53d6\u5f97\u9886\u5148\u4e1a\u754c\u7684\u6027\u80fd\u3002\u5176\u4e2dOpus\u6a21\u578b\u5c55\u73b0\u4e86\u63a5\u8fd1\u4eba\u7c7b\u6c34 \u5e73\u7684\u7406\u89e3\u548c\u6d41\u7545\u5ea6\uff0c\u5728\u590d\u6742\u4efb\u52a1\u4e0a\u7684\u8868\u73b0\u9886\u5148\u540c\u7c7b\u6a21\u578b\u3002</p> <p>\u5728\u4ef7\u683c\u3001\u901f\u5ea6\u3001\u6548\u679c\u4e09\u4e2a\u65b9\u9762\uff0cClaude 3\u7cfb\u5217\u5728\u8fd9\u4e09\u4e2a\u7ef4\u5ea6\u4e0a\u7684\u8868\u73b0,\u65e0\u8bba\u662f\u8ffd\u6c42\u6781\u9ad8\u667a\u80fd\u6c34\u5e73\u7684Opus\u7248\u672c,\u8fd8\u662f\u6ce8\u91cd\u6210\u672c\u6548\u76ca\u7684Haiku\u7248\u672c,\u90fd\u80fd\u5728\u901f\u5ea6\u3001\u667a\u80fd\u548c\u6210\u672c\u4e4b\u95f4\u8fbe\u5230\u7406\u60f3\u7684\u5e73\u8861,\u6ee1\u8db3\u4e0d\u540c\u5ba2\u6237\u7684\u5dee\u5f02\u5316\u9700\u6c42\u3002\u5728\u591a\u6a21\u6001\u80fd\u529b\u4e0a\uff0c\u76f8\u6bd4GPT-3.5T\u5728\u591a\u6a21\u6001\u80fd\u529b\u4e0a\u7684\u7f3a\u5931\uff0c,Claude 3\u5404\u7248\u672c\u652f\u6301\u591a\u6a21\u6001\u529f\u80fd,\u80fd\u591f\u540c\u65f6\u5904\u7406\u6587\u672c\u3001\u56fe\u50cf\u7b49\u4e0d\u540c\u7c7b\u578b\u6570\u636e,\u62e5\u6709\u66f4\u5e7f\u9614\u7684\u5e94\u7528\u573a\u666f\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u4ece\u6210\u672c\u6570\u636e\u6765\u770b,Claude 3\u7684\u6bcf\u4e07Token\u8f93\u5165\u548c\u8f93\u51fa\u6210\u672c\u5728\u540c\u7c7b\u4ea7\u54c1\u4e2d\u5904\u4e8e\u76f8\u5bf9\u4f4e\u5ec9\u7684\u6c34\u5e73,\u5c24\u5176\u662fHaiku\u7248\u672c,\u8f93\u5165\u6210\u672c\u4ec50.25\u7f8e\u5143/\u4e07Token,\u8f93\u51fa\u6210\u672c4-15\u7f8e\u5143/\u4e07Token,\u6027\u4ef7\u6bd4\u6781\u9ad8\u3002\u56e0\u6b64\uff0cClaude 3\u6a21\u578b\u5bb6\u65cf\u7684\u5b9a\u4f4d\u662f\u5728\u667a\u80fd\u6c34\u5e73\u3001\u63a8\u7406\u901f\u5ea6\u548c\u6210\u672c\u4e4b\u95f4\u5bfb\u6c42\u6700\u4f73\u5e73\u8861,\u5e76\u63d0\u4f9b\u591a\u6a21\u6001\u652f\u6301\u548c\u4f18\u79c0\u7684\u6027\u4ef7\u6bd4,\u4f7f\u5176\u80fd\u591f\u6ee1\u8db3\u4e0d\u540c\u5ba2\u6237\u7684\u5dee\u5f02\u5316\u9700\u6c42\u3002</p> <p>Claude 3 Haiku\u7248\u672c\u7684\u8f93\u5165\u6210\u672c\u4ec5\u4e3a\u6bcf\u4e07Token 0.25\u7f8e\u5143,\u8f93\u51fa\u6210\u672c\u4e3a1.25\u7f8e\u5143/\u4e07Token,\u76f8\u6bd4\u540c\u7ea7\u522b\u7684gpt-3.5-turbo-0125\u6a21\u578b\u7684\u8f93\u5165\u6210\u672c0.5\u7f8e\u5143/\u4e07Token\u548c\u8f93\u51fa\u6210\u672c1.5\u7f8e\u5143/\u4e07Token,\u4ef7\u683c\u4e0a\u5177\u6709\u8fd1\u4e00\u500d\u7684\u4f18\u52bf\u3002\u5373\u4fbf\u662f\u4e2d\u9ad8\u7aef\u7684Claude 3 Sonnet\u7248\u672c,\u5176\u8f93\u5165\u6210\u672c\u4e3a\u6bcf\u4e07Token 3\u7f8e\u5143,\u800cGPT-4 Turbo\u7684\u8f93\u5165\u6210\u672c\u4e3a10\u7f8e\u5143/\u4e07Token,Claude 3 Sonnet\u7684\u8f93\u5165\u6210\u672c\u4ec5\u4e3aGPT-4 Turbo\u768430%\u5de6\u53f3,\u4ef7\u683c\u4f18\u52bf\u660e\u663e\u3002\u5728\u8f93\u51fa\u6210\u672c\u65b9\u9762,Claude 3 Sonnet\u4e3a15\u7f8e\u5143/\u4e07Token,\u800cGPT-4 Turbo\u4e3a30\u7f8e\u5143/\u4e07Token,Claude 3 Sonnet\u7684\u8f93\u51fa\u6210\u672c\u662fGPT-4 Turbo\u7684\u4e00\u534a\u5de6\u53f3\u3002</p> <p>Claude 3\u7cfb\u5217\u6a21\u578b\u5177\u5907\u4e0e\u5176\u4ed6\u9886\u5148\u6a21\u578b\u76f8\u5ab2\u7f8e\u7684\u9ad8\u7ea7\u89c6\u89c9\u8bc6\u522b\u80fd\u529b\uff0c\u652f\u6301\u5904\u7406\u5404\u79cd\u683c\u5f0f(JPEG, PNG, GIF, WebPage\uff09\u591a\u79cd\u7c7b\u578b\u7c7b\u578b\uff08\u7167\u7247\uff0c\u56fe\u8868\uff0c\u6280\u672f\u7ed8\u56fe\u7b49\uff09\u7684\u56fe\u7247\u3002\u4fee\u590d\u4e86\u201c\u8fc7\u5ea6\u62d2\u7edd\u201d\u95ee\u9898\uff0c\u9762\u5bf9\u53ef\u80fd\u89e6\u53ca\u5230\u7cfb\u7edf\u5b89\u5168\u8fb9\u754c\u7684\u95ee\u9898\u65f6\uff0cClaude 3\u7cfb\u5217\u6a21\u578b\u63d0\u5347\u4e86\u7406\u89e3\u7a0b\u5ea6\uff0c\u80fd\u591f\u8fa8\u522b\u771f\u6b63\u7684\u98ce\u9669\uff0c\u63d0\u5347\u4e86\u521b\u9020\u6027\u7684\u4eba\u7269\u8868\u73b0\u3002\u6700\u540e\uff0c\u63d0\u5347\u4e86\u51c6\u786e\u6027\uff0c\u5728\u5904\u7406\u6311\u6218\u6027\u5f00\u653e\u95ee\u9898\u65f6\uff0cClaude 3\u51c6\u786e\u6027\u76f8\u6bd4Claude2.1\u51c6\u786e\u6027\u660e\u663e\u63d0\u5347\uff0c\u5e76\u4e14\u51cf\u5c11\u4e86\u9519\u8bef\u7b54\u6848\u3002Claude 3\u7cfb\u5217\u6a21\u578b\uff0c\u5168\u90e8\u90fd\u652f\u6301200K token\u7684\u4e0a\u4e0b\u6587\u7a97\u53e3\uff0c\u6b64\u5916\u9488\u5bf9\u67d0\u4e9b\u7279\u6b8a\u573a\u666f\uff0c\u4f1a\u5f00\u653e\u652f\u63011M token\u7684\u4e0a\u4e0b\u6587 \u7a97\u53e3\u3002\u5927\u6d77\u635e\u9488 \uff08Needle In A Haystack, NIAH)\u53ec\u56de\u7387\u8868\u73b0\u4f18\u5f02\uff0c\u751a\u81f3\u8fd8\u80fd\u8bc6\u522b\u51fa\u6d4b\u8bd5\u672c\u8eab\u7684\u5c40\u9650\uff0c\u6bd4\u5982\u53d1\u73b0\u67d0\u201c\u76ee\u6807\u201d\u53e5\u5b50\u660e\u663e\u662f\u540e\u6765\u4eba\u4e3a\u6dfb\u52a0\u8fdb\u539f\u59cb\u6587\u672c\u7684\u3002</p> <p>Bedrock \u9500\u552e\u573a\u666f\u5efa\u8bae</p> <p>Bedrock\u4e0eClaude 3\u63d0\u4f9b\u4e86\u5e7f\u6cdb\u7684\u5e94\u7528\u573a\u666f,\u6db5\u76d6\u4e86\u4ece\u89c6\u89c9\u7406\u89e3\u3001\u56fe\u50cf\u5904\u7406\u3001\u6587\u672c\u751f\u6210\u5230\u5bf9\u8bdd\u4ea4\u4e92\u7b49\u591a\u4e2a\u9886\u57df\u3002\u5176\u6838\u5fc3\u529f\u80fd\u5305\u62ec:\u89c6\u89c9\u8ba4\u77e5\u80fd\u529b,\u5982\u56fe\u50cf\u7406\u89e3\u3001\u76ee\u6807\u68c0\u6d4b\u3001\u56fe\u50cf\u5206\u5272\u3001\u56fe\u7247\u7ffb\u8bd1\u7b49,\u80fd\u591f\u9ad8\u6548\u5904\u7406\u5404\u79cd\u89c6\u89c9\u5185\u5bb9\u3002\u6587\u672c\u751f\u6210\u80fd\u529b,\u53ef\u751f\u6210\u591a\u79cd\u7c7b\u578b\u7684\u6587\u672c,\u5982\u6458\u8981\u3001\u6545\u4e8b\u3001\u8425\u9500\u6587\u6848\u7b49,\u540c\u65f6\u652f\u6301\u6839\u636e\u4e0a\u4e0b\u6587\u751f\u6210\u76f8\u5173\u5185\u5bb9\u3002\u5bf9\u8bdd\u4ea4\u4e92\u80fd\u529b,\u80fd\u4e0e\u7528\u6237\u8fdb\u884c\u81ea\u7136\u8bed\u8a00\u5bf9\u8bdd,\u56de\u7b54\u95ee\u9898\u3001\u63d0\u4f9b\u5efa\u8bae,\u5e76\u652f\u6301\u4e2a\u6027\u5316\u5b9a\u5236\u3002\u6b64\u5916,Bedrock\u8fd8\u63d0\u4f9b\u4e86RAG(Retrieval Augmented Generation)\u529f\u80fd,\u5c06\u77e5\u8bc6\u68c0\u7d22\u4e0e\u751f\u6210\u76f8\u7ed3\u5408,\u8f93\u51fa\u66f4\u52a0\u51c6\u786e\u3001\u4fe1\u606f\u4e30\u5bcc\u7684\u5185\u5bb9\u3002\u4ee3\u7801\u8f85\u52a9\u3001\u6570\u636e\u5904\u7406\u3001\u4ee3\u7406\u64cd\u4f5c\u7b49\u80fd\u529b,\u4e5f\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u4e86\u5168\u65b9\u4f4d\u7684\u652f\u6301\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u4f7f\u7528Bedrock\u7684\u5e94\u7528\u573a\u666f\u4e3e\u4f8b\uff1a 1. \u4f7f\u7528Bedrock\u6784\u5efaRAG\u5e94\u7528   1. \u63d0\u5347\u529e\u516c\u4f53\u9a8c\uff0c\u667a\u80fd\u5199\u4f5c\u52a9\u624b Amazon Bedrock \u6784\u5efa\u7684\u77e5\u8bc6\u589e\u5f3a\u751f\u6210\u7cfb\u7edf(RAG)\u4e3a\u7528\u6237\u63d0\u4f9b\u667a\u80fd\u5199\u4f5c\u8f85\u52a9,\u901a\u8fc7\u878d\u5408\u68c0\u7d22\u548c\u95ee\u7b54\u3001\u8bed\u6cd5\u68c0\u67e5\u7b49\u529f\u80fd,\u63d0\u5347\u7528\u6237\u6587\u6863\u521b\u4f5c\u4f53\u9a8c\u3002\u8be5\u7cfb\u7edf\u80fd\u591f\u6839\u636e\u7528\u6237\u8f93\u5165\u7684\u5173\u952e\u8bcd\u6216\u4e3b\u9898,\u4ece\u77e5\u8bc6\u5e93\u4e2d\u68c0\u7d22\u76f8\u5173\u5185\u5bb9,\u5e76\u5c06\u5176\u667a\u80fd\u6574\u5408\u5230\u6587\u6863\u4e2d,\u8f85\u52a9\u7528\u6237\u64b0\u5199\u3002\u540c\u65f6,\u7cfb\u7edf\u8fd8\u5177\u5907\u8bed\u6cd5\u7ea0\u9519\u3001\u4e0a\u4e0b\u6587\u5173\u8054\u7b49\u589e\u5f3a\u529f\u80fd,\u786e\u4fdd\u8f93\u51fa\u5185\u5bb9\u7684\u8fde\u8d2f\u6027\u548c\u51c6\u786e\u6027\u3002\u65e0\u8bba\u662f\u751f\u6210\u957f\u6587\u672c\u3001\u6458\u8981,\u8fd8\u662f\u56de\u7b54\u95ee\u9898,RAG\u7cfb\u7edf\u90fd\u53ef\u4ee5\u7ed9\u51fa\u9ad8\u8d28\u91cf\u7684\u54cd\u5e94,\u5927\u5e45\u63d0\u9ad8\u5199\u4f5c\u6548\u7387,\u4e3a\u7528\u6237\u5e26\u6765\u667a\u80fd\u5316\u3001\u4e2a\u6027\u5316\u7684\u5199\u4f5c\u4f53\u9a8c\u3002   2. \u57fa\u4e8e AI \u4e0e\u6587\u6863\u5bf9\u8bdd\uff0c\u91cd\u6784\u9605\u8bfb\u65b9\u5f0f \u2013 \u667a\u80fd AI \u9605\u8bfb\u52a9\u624b APP \u4e9a\u9a6c\u900aBedrock\u6784\u5efa\u7684\u77e5\u8bc6\u589e\u5f3a\u751f\u6210\u7cfb\u7edf(RAG)\u878d\u5408\u4e86AI\u4e0e\u6587\u6863\u5904\u7406,\u4e3a\u7528\u6237\u63d0\u4f9b\u667a\u80fdAI\u9605\u8bfb\u52a9\u624bAPP\u7684\u529f\u80fd\u3002\u8be5\u7cfb\u7edf\u80fd\u591f\u667a\u80fd\u9605\u8bfb\u6587\u732e\u5185\u5bb9,\u6279\u91cf\u6587\u732e\u603b\u7ed3,\u63d0\u9ad8\u9605\u8bfb\u6548\u7387\u3002\u540c\u65f6,\u5b83\u8fd8\u652f\u6301\u9488\u5bf9\u6587\u732e\u5b9e\u65f6\u4ea4\u4e92\u5bf9\u8bdd,\u8f7b\u677e\u83b7\u5f97\u667a\u80fd\u89e3\u8bfb,\u9ad8\u6548\u7406\u89e3\u590d\u6742\u5185\u5bb9\u3002\u901a\u8fc7\u5c06\u77e5\u8bc6\u68c0\u7d22\u4e0e\u5185\u5bb9\u751f\u6210\u76f8\u7ed3\u5408,RAG\u7cfb\u7edf\u4e3a\u7528\u6237\u5e26\u6765\u5168\u65b0\u7684\u6587\u732e\u9605\u8bfb\u548c\u7406\u89e3\u4f53\u9a8c,\u5927\u5e45\u63d0\u5347\u5b66\u4e60\u7814\u7a76\u6548\u7387,\u662f\u57fa\u4e8eAI\u4e0e\u6587\u6863\u5bf9\u8bdd\u7684\u91cd\u8981\u521b\u65b0\u5e94\u7528\u3002   3. \u5feb\u901f\u5b8c\u6210\u4ea7\u54c1\u5347\u7ea7\uff0c\u63d0\u4f9b\u4f01\u4e1a\u7ea7\u751f\u6210 AI \u77e5\u8bc6\u5e94\u7528\u4ea7\u54c1 \u5229\u7528Amazon Bedrock\u7684\u6784\u5efa\u6846\u67b6,\u4f01\u4e1a\u53ef\u4ee5\u5feb\u901f\u5b9a\u5236\u548c\u6784\u5efa\u51fa\u9002\u5408\u81ea\u8eab\u9700\u6c42\u7684AI\u5e94\u7528\u573a\u666f,\u4f8b\u5982\u57fa\u4e8e\u77e5\u8bc6\u5e93\u7684\u95ee\u7b54\u7cfb\u7edf\u3001\u667a\u80fd\u6587\u6863\u6458\u8981\u548c\u7406\u89e3\u7b49\u3002Amazon Bedrock\u5728\u6570\u636e\u5b89\u5168\u5c42\u9762\u7ed9\u4e88\u5145\u5206\u4fdd\u969c,\u4fdd\u8bc1\u4e86\u4f01\u4e1a\u7684\u6570\u636e\u548c\u6a21\u578b\u5728\u5176\u79c1\u6709\u4e91\u73af\u5883\u4e2d\u5b89\u5168\u90e8\u7f72\u548c\u8fd0\u884c,\u5e76\u4e0eAmazon\u7684\u77e5\u8bc6\u670d\u52a1\u548c\u6a21\u578b(\u5982VPC)\u76f8\u96c6\u6210,\u786e\u4fdd\u6570\u636e\u7684\u79c1\u5bc6\u6027\u548c\u5b89\u5168\u6027\u3002\u53e6\u5916,\u5b83\u8fd8\u652f\u6301\u4e0eAmazon OpenSearch Service\u65e0\u7f1d\u96c6\u6210,\u5b9e\u73b0\u5bf9\u5927\u89c4\u6a21\u6587\u6863\u7684\u9ad8\u6548\u68c0\u7d22\u548c\u7406\u89e3,\u4e3a\u4f01\u4e1a\u5185\u90e8\u63d0\u4f9b\u4f18\u8d28\u7684\u77e5\u8bc6\u7ba1\u7406\u548c\u5171\u4eab\u5e73\u53f0\u3002 2. \u4f7f\u7528Bedrock\u6784\u5efa\u89d2\u8272\u626e\u6f14\u5e94\u7528   1. AI\u89d2\u8272\u804a\u5929\uff0cAI\u4f34\u4fa3/AI\u804a\u5929\u673a\u5668\u4eba \u53ef\u4ee5\u5b9a\u5236\u4e2a\u6027\u5316\u89d2\u8272,\u4ece\u800c\u63d0\u4f9b\u66f4\u5177\u5438\u5f15\u529b\u548c\u6c89\u6d78\u611f\u7684\u4ea4\u4e92\u4f53\u9a8c\u3002\u8be5\u670d\u52a1\u63d0\u4f9b24/7\u5168\u5929\u5019\u8fd0\u8425,\u7528\u6237\u53ef\u4ee5\u968f\u65f6\u4e0eAI\u4f19\u4f34\u8fdb\u884c\u81ea\u7136\u5bf9\u8bdd\u548c\u4e92\u52a8\u3002AI\u4f19\u4f34\u4e0d\u4ec5\u5177\u5907\u6e38\u620f\u548c\u5a31\u4e50\u529f\u80fd,\u8fd8\u80fd\u5206\u6790\u7528\u6237\u504f\u597d,\u4e3a\u7528\u6237\u63a8\u8350\u4e2a\u6027\u5316\u7684\u5185\u5bb9,\u5982\u7535\u5f71\u3001\u4e66\u7c4d\u548c\u7535\u89c6\u8282\u76ee\u7b49\u3002\u901a\u8fc7Amazon Bedrock,\u5f00\u53d1\u8005\u80fd\u591f\u8f7b\u677e\u6784\u5efa\u5f15\u4eba\u5165\u80dc\u7684AI\u4f19\u4f34\u5e94\u7528,\u6ee1\u8db3\u7528\u6237\u5bf9\u4e8e\u667a\u80fd\u865a\u62df\u4f19\u4f34\u7684\u9700\u6c42\u3002   2. \u4e3a\u7528\u6237\u63d0\u4f9b\u60c5\u7eea\u966a\u62a4 \u901a\u8fc7Bedrock\u6784\u5efa\u7684\u89d2\u8272\u626e\u6f14\u5e94\u7528\uff0c,\u7528\u6237\u53ef\u4ee5\u4e0eAI\u52a9\u7406\u8fdb\u884c\u81ea\u7136\u5730\u5bf9\u8bdd\u4e92\u52a8,\u6db5\u76d6\u9ad8\u5ea6\u5b9a\u5236\u5316\u7684\u8bbe\u7f6e\u3001\u5730\u70b9\u8bc6\u522b\u3001\u8bed\u97f3\u8bc6\u522b\u7b49\u591a\u79cd\u573a\u666f\u3002\u8fd9\u79cdAI\u5bf9\u8bdd\u7cfb\u7edf\u7d2f\u8ba1\u670d\u52a1\u4e86\u8d85\u8fc7\u4e00\u4e07\u79cd\u7528\u4f8b,\u603b\u5171\u652f\u6301\u4e867000\u4e07\u6b21\u4eba\u673a\u5bf9\u8bdd\u3002\u65e0\u8bba\u662f\u5e94\u7528\u4e8e\u7ebf\u4e0a\u7ebf\u4e0b\u7684\u4ea7\u54c1\u9500\u552e,\u8fd8\u662f\u4f01\u4e1a\u5ba2\u6237\u670d\u52a1\u573a\u666f,Amazon Bedrock\u90fd\u80fd\u4e3aAI\u52a9\u7406\u8d4b\u80fd,\u63d0\u4f9b\u9ad8\u6548\u3001\u4eba\u6027\u5316\u7684\u865a\u62df\u52a9\u7406\u4f53\u9a8c,\u662f\u6784\u5efa\u667a\u80fd\u52a9\u624b\u670d\u52a1\u7684\u5f3a\u5927\u5e95\u5c42\u6280\u672f\u652f\u6491\u3002 3. \u4f7f\u7528Bedrock\u6784\u5efa\u6587\u672c\u5206\u6790\u7c7b\u5e94\u7528 Amazon Bedrock\u80fd\u591f\u5bf9\u7528\u6237\u5728\u6e38\u620f\u4e2d\u7684\u5373\u65f6\u6587\u5b57\u804a\u5929\u8fdb\u884c\u5206\u6790,\u8bc6\u522b\u51fa\u5b58\u5728\u4e8e\u804a\u5929\u5185\u5bb9\u4e2d\u7684\u8272\u60c5\u3001\u5e7f\u544a\u3001\u9a9a\u6270\u7b49\u4e0d\u5f53\u5185\u5bb9,\u5e76\u5bf9\u8fd9\u4e9b\u4e0d\u5408\u89c4\u5185\u5bb9\u8fdb\u884c\u5ba1\u67e5\u548c\u8fc7\u6ee4\u3002\u540c\u65f6,\u5b83\u4e5f\u80fd\u8bc6\u522b\u591a\u79cd\u8bed\u8a00\u548c\u8bed\u5883,\u786e\u4fdd\u5728\u4e0d\u540c\u573a\u666f\u4e0b\u90fd\u80fd\u51c6\u786e\u7406\u89e3\u7528\u6237\u4ea4\u6d41\u7684\u672c\u8d28\u542b\u4e49\u3002 \u8be5\u670d\u52a1\u5229\u7528\u81ea\u7136\u8bed\u8a00\u5904\u7406\u548c\u6df1\u5ea6\u5b66\u4e60\u7b49\u6280\u672f,\u5bf9\u804a\u5929\u8bed\u6599\u8fdb\u884c\u60c5\u611f\u5206\u6790\u3001\u4e3b\u9898\u8bc6\u522b\u7b49\u5904\u7406,\u4e3a\u7528\u6237\u63d0\u4f9b\u8d34\u5fc3\u5468\u5230\u7684\u8bed\u6599\u7b5b\u9009\u548c\u5206\u6790\u6d1e\u89c1\u3002\u8fd9\u79cd\u5f3a\u5927\u7684\u6587\u672c\u5206\u6790\u80fd\u529b,\u80fd\u591f\u4e3a\u6e38\u620f\u5f00\u53d1\u8005\u8425\u9020\u5b89\u5168\u3001\u5065\u5eb7\u7684\u5728\u7ebf\u6e38\u620f\u73af\u5883,\u63d0\u5347\u7528\u6237\u4f53\u9a8c,\u662fAmazon Bedrock\u5728\u6e38\u620f\u884c\u4e1a\u7684\u91cd\u8981\u5e94\u7528\u573a\u666f\u4e4b\u4e00\u3002 4. \u4f7f\u7528Bedrock\u6784\u5efa\u6587\u672c\u751f\u6210\u7c7b\u5e94\u7528 Amazon Bedrock\u5229\u7528\u4eba\u5de5\u667a\u80fd\u6280\u672f\u4f18\u5316\u4e86\u4e9a\u9a6c\u900a\u5546\u54c1\u7684\u6587\u6848\u5185\u5bb9,\u4e3a\u987e\u5ba2\u63d0\u4f9b\u66f4\u7cbe\u51c6\u3001\u6613\u61c2\u7684\u4ea7\u54c1\u8bc4\u8bba\u548c\u63cf\u8ff0\u4fe1\u606f\u3002\u5b83\u901a\u8fc7\u5206\u679015\u4ebf\u6761\u7528\u6237\u8bc4\u8bba\u548c\u8bc4\u7ea7\u6570\u636e,\u81ea\u52a8\u751f\u6210\u5177\u6709\u9ad8\u8d28\u91cf\u548c\u51c6\u786e\u5ea6\u7684\u8bc4\u8bba\u6458\u8981,\u4e3a\u987e\u5ba2\u5448\u73b0\u7b80\u6d01\u6709\u529b\u7684\u4ea7\u54c1\u8bc4\u4ef7,\u63d0\u5347\u4e86\u7528\u6237\u7684\u8d2d\u7269\u4f53\u9a8c\u3002 \u8be5\u89e3\u51b3\u65b9\u6848\u5c06\u4eba\u5de5\u667a\u80fd\u4e0e\u7535\u5546\u4e1a\u52a1\u6df1\u5ea6\u878d\u5408,\u901a\u8fc7\u667a\u80fd\u751f\u6210\u6587\u672c\u7684\u65b9\u5f0f,\u4e0d\u4ec5\u51cf\u8f7b\u4e86\u4eba\u5de5\u7f16\u5199\u4ea7\u54c1\u63cf\u8ff0\u7684\u5de5\u4f5c\u8d1f\u62c5,\u66f4\u80fd\u786e\u4fdd\u4ea7\u54c1\u4fe1\u606f\u4e0e\u5ba2\u6237\u771f\u5b9e\u9700\u6c42\u9ad8\u5ea6\u5339\u914d,\u5e2e\u52a9\u5ba2\u6237\u505a\u51fa\u66f4\u660e\u667a\u7684\u8d2d\u4e70\u51b3\u7b56\u3002 5. \u6784\u5efa\u667a\u80fd\u7535\u5546\u641c\u7d22\u63a8\u8350\u5e94\u7528 \u901a\u8fc7\u5229\u7528Bedrock\u63d0\u4f9b\u6a21\u578b\u7684\u81ea\u7136\u8bed\u8a00\u5904\u7406\u548c\u673a\u5668\u5b66\u4e60\u80fd\u529b,\u53ef\u4ee5\u4e3a\u7528\u6237\u63d0\u4f9b\u4e2a\u6027\u5316\u7684\u5546\u54c1\u63a8\u8350\u548c\u667a\u80fd\u641c\u7d22\u670d\u52a1\u3002\u8be5\u7cfb\u7edf\u7ed3\u5408\u4e86\u7528\u6237\u5386\u53f2\u6570\u636e\u3001\u8d2d\u7269\u504f\u597d\u548c\u641c\u7d22\u8bb0\u5f55\u7b49\u4fe1\u606f,\u5229\u7528Bedrock\u7684\u6a21\u578b,\u5bf9\u7528\u6237\u9700\u6c42\u8fdb\u884c\u5206\u6790\u548c\u7406\u89e3\u3002\u7cfb\u7edf\u4f1a\u81ea\u52a8\u751f\u6210\u4e2a\u6027\u5316\u5546\u54c1\u63a8\u8350\u5217\u8868,\u5e76\u63d0\u4f9b\u667a\u80fd\u95ee\u7b54\u548c\u641c\u7d22\u4f18\u5316,\u5e2e\u52a9\u7528\u6237\u5feb\u901f\u7cbe\u51c6\u5730\u627e\u5230\u60f3\u8981\u7684\u5546\u54c1\u3002</p> <p>Claude3\u4f18\u52bf\u573a\u666f \u4ece\u7528\u6237\u573a\u666f\u6765\u770b: \u7ffb\u8bd1\u573a\u666f\uff1a\u4f8b\u5982\u89c6\u9891\u5b57\u5e55\u7ffb\u8bd1\u3001\u82f1\u6587\u6587\u6863\u3001\u8bf4\u660e\u4e66\u7ffb\u8bd1\uff08\u82f1\u7ffb\u4e2d\uff09\uff0c\u901a\u8fc7pe\u8bbe\u7f6e\u597d\uff0c\u51e0\u4e4e\u53ef\u4ee5\u505a\u5230\u4e00\u5b57\u4e0d\u5dee\u7684\u7ffb\u8bd1 \u4e8b\u5b9e\u95ee\u7b54\uff1a\u5386\u53f2\u4e8b\u4ef6\u6c47\u603b \u5185\u5bb9\u751f\u6210\uff1a\u5c0f\u8bf4\u7eed\u5199\u3001\u89d2\u8272\u751f\u6210\u4e0e\u626e\u6f14 RAG\u573a\u666f\uff1a\u957f\u6587\u672c+function calling \u4ee3\u7801\u8f85\u52a9\uff1a\u4ee3\u7801\u751f\u6210\u3001\u6570\u636e\u5904\u7406\u3001\u4ee3\u7801\u4f18\u5316\u548c\u89e3\u8bfb\u3001\u751f\u6210\u5355\u5143\u6d4b\u8bd5\u7b49 \u56fe\u50cf\u8bc6\u522b\uff1a\u7ed9\u56fe\u7247\u6253\u6807\u7b7e\u3001\u7ed8\u672c\u6253\u6807\u7b7e\u3001\u52a8\u6f2b\u6253\u6807\u7b7e+\u5ba1\u6838\u3001\u751f\u6210\u5546\u54c1\u8be6\u60c5/\u6807\u7b7e\u3001\u5546\u54c1\u56fe\u7247\u7406\u89e3\uff0c\u5546\u54c1\u8be6\u60c5\u7ffb\u8bd1\u6da6\u8272\u3001\u89c6\u9891\u8fde\u7eed\u5e27\u7406\u89e3\u3001\u7ed9\u89c6\u9891\u6253\u6807\u7b7e \u56fe\u50cf\u7406\u89e3\uff1a\u56fe\u7247/\u89c6\u9891\u8fde\u7eed\u5e27\u7406\u89e3\u95ee\u7b54\u3001\u5e38\u8bc6\u6027\u6570\u503c\u7406\u89e3\u3001\u591a\u56fe\u4fe1\u606f\u63d0\u53d6+\u603b\u7ed3\u3001\u8fd0\u7ef4\u56fe\u8868\u7406\u89e3\u3001\u67b6\u6784\u56fe\u7406\u89e3\u3001\u8bfe\u5802\u677f\u4e66\u7b49\u4e00\u4e9b\u624b\u5199\u7684\u975e\u7ed3\u6784\u5316\u7406\u89e3 OCR\u8bc6\u522b\uff1a\u56fe\u7247\u4fe1\u606f\u63d0\u53d6,\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1,\u6bd4\u5982\u5e7f\u544a\u4fe1\u606f\u63d0\u53d6,\u4e0d\u540c\u683c\u5f0f\u8ba2\u5355\u4fe1\u606f\u6574\u7406 \u56fe\u50cf\u95ee\u7b54\uff1a\u5982\u666e\u901a\u4e8b\u4ef6\u5ea7\u8c08\u3001\u533b\u7597\u95ee\u7b54\u7b49 \u4f01\u4e1a\u5185\u90e8\uff1a\u7535\u5546\u6e38\u620f\u7b49\u5ba2\u6237\u6570\u8bc4\u8bba/\u8206\u60c5\u5206\u6790\u3001UGC\u5185\u5bb9\u5ba1\u6838\u3001\u591a\u9014\u5f84\u7ffb\u8bd1;\u56fe\u8868\u4f30\u503c\u63d0\u53d6/\u8be6\u7ec6\u63cf\u8ff0/\u6982\u8ff0;\u6d41\u7a0b\u56fe\u8bc6\u522b/PDF\u6587\u6863\u8bc6\u522b/\u6587\u6863\u5185\u56fe\u7247\u8bc6\u522b \u667a\u80fd\u5ba2\u670d\uff1a\u7535\u5546\u3001To C\u573a\u666f\u5e94\u7528\u3001\u91cd\u76f4\u884c\u4e1a\u8d44\u8baf\u7c7b\u670d\u52a1/\u5bf9\u8bdd\u673a\u5668\u4eba/\u667a\u80fd\u8bbe\u5907 \u8425\u9500\uff1a\u63d0\u9ad8\u8425\u8fd0\u6548\u7387(\u9501\u8d27\u7535\u5546\u6e20\u9053\u5e73\u53f0\u5546\u54c1\u63a8\u9001\u3001\u5e7f\u544a\u6587\u6848\u3001\u793e\u4ea4\u5a92\u4f53\u7d20\u6750\u751f\u6210\u3001\u90ae\u4ef6/\u8bc4\u8bba\u81ea\u52a8\u56de\u590d) function calling\uff1asonnet\u7684\u80fd\u529b\u7ed3\u5408\u4ef7\u683c\uff0c\u5f00\u8f9f gpt 3.5\u548cgpt 4\u4e4b\u95f4\u7684\u65b0\u8d5b\u9053\uff0c\u662f\u6211\u4eec\u6700\u597d\u7684\u6b66\u5668,\u5ba2\u6237\u5728\u4f7f\u7528 gpt 3.5 \u548c gpt 4 \u505afunction calling\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u9047\u5230gpt 3.5\u6548\u679c\u4e0d\u4e00\u5b9a\u597d\uff0cgpt 4\u53c8\u592a\u8d35\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u5f15\u5165sonnet\u3002 \u4ece\u884c\u4e1a\u6765\u770b: \u7535\u5546\uff1a\u667a\u80fd\u5ba2\u670d\u3001\u670d\u88c5\u6253\u6807\u3001\u5e7f\u544a\u6587\u6848\u3001\u793e\u4ea4\u5a92\u4f53\u7d20\u6750\u751f\u6210\u3001\u90ae\u4ef6/\u8bc4\u8bba\u56de\u590d\u3001\u552e\u540e\u670d\u52a1\u77e5\u8bc6\u5e93 \u6e38\u620f\uff1a\u5185\u5bb9\u5ba1\u6838(\u6587\u5b57+\u56fe\u7247)\u3001role play\u89d2\u8272\u578b\u5e94\u7528\u3001NPC\u5bf9\u8bdd\u3001\u6e38\u620f\u884c\u4e3a\u5206\u6790(Text2SQL) \u5e7f\u544a&amp;\u5a92\u4f53\uff1a\u5e7f\u544a\u521b\u610f\u3001\u5b66\u9738\u7ffb\u8bd1\u3001\u5b9e\u65f6\u5e7f\u544a\u8c03\u751f\u6210\u3001\u667a\u80fd\u5e7f\u544a\u5206\u6790\u5e08... \u7269\u8054\u7f51\uff1a\u667a\u80fd\u5bb6\u5c45\u3001\u4ea7\u54c1\u4fe1\u606f\u77e5\u8bc6\u5e93/\u667a\u80fd\u5ba2\u670d \u6559\u80b2\uff1aAI\u8001\u5e08\u3001LLM\u89e3\u9898 \u8de8\u884c\u4e1a\uff1a\u4ee3\u7801\u52a9\u624b\u3001\u8fd0\u7ef4\u52a9\u624b\u3001\u901a\u7528\u7ffb\u8bd1(\u51c6\u786e\u6027\u548c\u672c\u5730\u5316\u6548\u679c\u597d)\u3001\u5408\u540c\u5ba1\u67e5\u3001\u6cd5\u5f8b\u6848\u4ef6\u95ee\u91cf\u5316\u68c0\u7d22 \u5236\u9020\u4e1a\uff1a\u8ba2\u5355\u7167\u7247OCR\u8bc6\u522b,\u77e5\u8bc6\u5e93</p> <p>Bedrock &amp; Claude 3 \u5408\u4f5c\u4f19\u4f34\u89e3\u51b3\u65b9\u6848\u5efa\u8bae</p> <p>1\u3001AI\u80fd\u529b\u63a5\u5165 \u57fa\u4e8e\u670d\u52a1\u6216API\u63a5\u5165,\u5e2e\u52a9\u5ba2\u6237\u5feb\u901f\u5f00\u901a\u548c\u4f7f\u7528Bedrock\u3002\u76ee\u6807\u5ba2\u6237\u5305\u62ec\u5e0c\u671b\u7b80\u5355\u4f7f\u7528AI\u529f\u80fd\u7684\u5ba2\u6237\uff0c\u6216\u9700\u8981\u9ad8\u5355\u72ec\u4f7f\u7528FM\u529f\u80fd\u7684\u5ba2\u6237\u3002\u6280\u672f\u8981\u6c42\u548c\u5b9e\u65bd\u5468\u671f\u8f83\u4f4e\u3002 2\u3001AI\u80fd\u529b\u5e73\u53f0 \u57fa\u4e8e\u80fd\u529b\u63a5\u5165,\u63d0\u4f9b\u66f4\u591a\u63a5\u5165\u6e20\u9053,\u63d0\u4f9b\u9884\u5b9a\u4e49\u63d0\u793a\u8bcd\u53ca\u5b9a\u5236PE\u670d\u52a1\u3002\u76ee\u6807\u5ba2\u6237\u662f\u6709\u5927\u91cf\u548c\u590d\u6742\u9700\u6c42\u7684\u5ba2\u6237\uff0c\u9700\u8981\u5de5\u4f5c\u9700\u8981\u77e5\u8bc6\u4e2d\u5fc3/\u80fd\u529b\u652f\u6301\u7684\u5ba2\u6237\u3002\u6280\u672f\u8981\u6c42\u548c\u5b9e\u65bd\u5468\u671f\u9002\u4e2d\u3002 3\u3001RAG\u589e\u5f3a \u57fa\u4e8eBedrock KB\u6216Agent\u80fd\u529b,\u4e3a\u5ba2\u6237\u5feb\u901f\u6784\u5efa\u667a\u80fd\u77e5\u8bc6\u5e93,\u589e\u5f3a\u5ba2\u6237\u73b0\u6709\u4e1a\u52a1\u80fd\u529b\u3002\u76ee\u6807\u5ba2\u6237\u662f\u6709\u5927\u91cf\u548c\u590d\u6742\u9700\u6c42\uff0c\u9700\u8981\u5de5\u4f5c\u9700\u8981\u77e5\u8bc6\u4e2d\u5fc3/\u80fd\u529b\u652f\u6301\u7684\u5ba2\u6237\u3002\u6280\u672f\u8981\u6c42\u548c\u5b9e\u65bd\u5468\u671f\u8f83\u9ad8\u3002 4\u3001\u54a8\u8be2\u53ca\u670d\u52a1 \u57fa\u4e8e\u81ea\u8eab\u548c\u501f\u52a9AWS\u6280\u672f\u80fd\u529b,\u63d0\u4f9bAI\u5b9e\u65bd\u3001AI\u8fd0\u7ef4\u7b49\u589e\u5f3a\u670d\u52a1\u3002\u76ee\u6807\u5ba2\u6237\u662f\u6709\u81ea\u5efa\"\u667a\u80fd\u5927\u8111\"\u9700\u6c42\uff0c\u6216\u9700\u8981\u901a\u8fc7\u8fdc\u7a0b\u9ad8\u7ea7\u6280\u672f\u652f\u6301\u7684\u5ba2\u6237\u3002\u6280\u672f\u8981\u6c42\u548c\u5b9e\u65bd\u5468\u671f\u6700\u9ad8\u3002</p> <p>Bedrock \u8d26\u53f7\u5f00\u901a\u6d41\u7a0b</p> <p>\u5bf9\u4e8e\u7533\u8bf7Claude\u6a21\u578b\u4f7f\u7528\u7684\u7528\u6237\uff0c\u9996\u5148,\u7528\u6237\u9700\u8981\u5728Bedrock\u5e73\u53f0\u7684\u7279\u5b9aregion\u5185\u624b\u52a8\u542f\u7528\u5bf9\u5e94\u6a21\u578b\u7684\u8bbf\u95ee\u6743\u9650\u3002\u8fd9\u4e00\u8fc7\u7a0b\u9700\u8981\u8fdb\u5165Model Access\u2192Management\u2192Model Management\u754c\u9762,\u5e76\u63d0\u4ea4\u4f7f\u7528\u8be6\u60c5\u540e\u4fdd\u5b58\u8bbe\u7f6e\u3002\u5176\u6b21,\u5bf9\u4e8eClaude\u6a21\u578b,\u7528\u6237\u7b2c\u4e00\u6b21\u542f\u7528\u65f6\u9700\u8981\u5148\u901a\u8fc7\"submit use case details\"\u63d0\u4ea4\u6a21\u578b\u4f7f\u7528\u8be6\u60c5,\u5f85\u5ba1\u6838\u901a\u8fc7\u540e\u65b9\u53ef\u8bbf\u95ee\u8be5\u6a21\u578b\u3002\u540c\u65f6\u8be5\u8fc7\u7a0b\u53ef\u80fd\u9700\u8981\u4e00\u5b9a\u65f6\u95f4,\u671f\u95f4\u65e0\u6cd5\u7acb\u5373\u83b7\u5f97\u6a21\u578b\u8bbf\u95ee\u6743\u9650\u3002\u6700\u540e,\u5f85\u6a21\u578b\u8bbf\u95ee\u6743\u9650\u8bbe\u7f6e\u5b8c\u6210\u540e,\u7b26\u5408\u6761\u4ef6\u7684\u7528\u6237\u5373\u53ef\u5728\u6a21\u578b\u5217\u8868\u4e2d\u67e5\u770b\u5e76\u4f7f\u7528\u6240\u9700\u7684Claude\u6a21\u578b\u3002\u5bf9\u4e8e\u4f7f\u7528\u5176\u4ed6\u6a21\u578b\u7684\u7528\u6237\uff0c\u5982AI21 Labs\u3001Cohere\u3001Meta\u3001Mistral AI\u3001Stability AI\u4ee5\u53catitan\u7cfb\u5217\u7684\u6a21\u578b,\u8fdb\u5165Model Access\u2192Management\u754c\u9762\uff0c\u9009\u4e2d\u6240\u9700\u8981\u7684\u6a21\u578b\u540e\uff0c\u4fdd\u5b58\u5373\u53ef\u3002</p> <p>\u6839\u636eAnthropic\u670d\u52a1\u6761\u6b3e\u7684\u7ea6\u5b9a,\u4e2d\u56fd\u5927\u9646\u53ca\u9999\u6e2f\u5747\u4e0d\u5728\u5176\u670d\u52a1\u8303\u56f4\u5185,\u56e0\u6b64GCR\u5ba2\u6237\u9700\u8981\u6ee1\u8db3\u5982\u4e0b\u5408\u89c4\u8981\u6c42\u3002\u9996\u5148,\u5f00\u901a\u8d26\u53f7\u4f5c\u4e3a\u516c\u53f8\u4e3b\u4f53,\u4f7f\u7528\u6a21\u578b\u7684\u4e1a\u52a1\u573a\u666f\u4ee5\u53ca\u670d\u52a1\u7684\u6700\u7ec8\u7528\u6237\u5747\u4e3a\u4e2d\u56fd\u5927\u9646\u53ca\u9999\u6e2f\u4e4b\u5916\u3002\u540c\u65f6,\u5f00\u901a\u8d26\u53f7\u4ee5\u53ca\u5176\u5173\u8054\u7684Payer\u8d26\u53f7(\u82e5\u6709)\u7684\u4e0b\u6e38\u652f\u4ed8\u4fe1\u606f\u4e5f\u9700\u8981\u8bbe\u7f6e\u4e3a\u4e2d\u56fd\u5927\u9646\u53ca\u9999\u6e2f\u4e4b\u5916\u3002</p> <p>\u5177\u4f53\u5305\u62ec\u4e3b\u8d26\u53f7\u53caPayer\u8d26\u53f7\u7684\u8d26\u5355\u5730\u5740\u3001\u56fd\u5bb6/\u5730\u533a\u4ee3\u7801\u3001\u8054\u7cfb\u4eba\u5730\u5740\u53ca\u8054\u7cfb\u4fe1\u606f\u7b49,\u5747\u9700\u8981\u8bbe\u7f6e\u5728\u4e2d\u56fd\u5927\u9646\u53ca\u9999\u6e2f\u5730\u533a\u4e4b\u5916\u3002\u6700\u540e,Anthropic\u4f1a\u5b9a\u671f\u62bd\u67e5Bedrock Claude\u8d26\u53f7\u7684\u5408\u89c4\u6027,\u82e5GCR\u8d26\u53f7\u4e0d\u7b26\u5408\u4e0a\u8ff0\u8981\u6c42\u5219\u4f1a\u5b58\u5728\u88ab\u8981\u6c42\u505c\u670d\u7684\u98ce\u9669\u3002Bedrock\u540e\u53f0\u4f1a\u5728\u6a21\u578b\u8ba2\u9605\u8fc7\u7a0b\u4e2d\u68c0\u6d4b\u5f53\u524d\u8d26\u53f7\u7684\u7a0e\u52a1\u4fe1\u606f\uff0c\u82e5\u7a0e\u52a1\u5185\u5bb9\u5982\u201d business legal address\u201d\u6216\u201d country code\u201d\u7b49\u5b58\u5728\u4e2d\u56fd\u5927\u9646\u6216\u9999\u6e2f\u4fe1\u606f\uff0c\u5219\u65e0\u6cd5\u5ba1\u6838\u901a\u8fc7\u3002\u9700\u8981\u8054\u7cfb\u5bf9\u5e94bd\uff0c\u6216\u8005pdm\uff0c\u534f\u52a9\u5ba2\u6237\u68c0\u67e5\u8d26\u53f7\u7684Tax Setting\u4fe1\u606f\uff0c\u586b\u62a5\u6ee1\u8db3\u6761\u4ef6\u7684\u4fe1\u606f\u540e\u63d0\u4ea4\u8ba2\u9605\u7533\u8bf7\u3002</p> <p>\u4ee5\u4e0b\u5217\u4e3e\u4e86\u5f00\u901aBedrock\u6a21\u578b\u6743\u9650\u5e38\u89c1\u7684\u95ee\u9898 1\u3001\"this offer is not available to accept in this country\",\u4e3b\u8981\u662f\u7531\u4e8e\u5ba2\u6237\u6240\u5728\u56fd\u5bb6/\u5730\u533a\u4e0eBedrock\u540e\u53f0\u7a0e\u52a1\u8bbe\u7f6e\u4fe1\u606f\u4e0d\u7b26,\u5305\u62ec\u4e1a\u52a1\u6cd5\u5f8b\u5730\u5740\u3001\u56fd\u5bb6\u4ee3\u7801\u7b49,\u5bfc\u81f4\u65e0\u6cd5\u5728\u4e2d\u56fd\u5927\u9646\u6216\u9999\u6e2f\u5730\u533a\u5f00\u901a\u76f8\u5173\u670d\u52a1\u6216\u8fdb\u884c\u67d0\u4e9b\u64cd\u4f5c\u3002 2\u3001\"operation not allowed\"\u5ba2\u6237\u4e3a\u65b0\u8d26\u6237\u4e14\u88ab\u540e\u53f0\u6807\u8bb0\u4e3afraud\uff0c\u9700\u8981\u8054\u7cfbaws support\u89e3\u51b3\u3002 \u9996\u5148,\u5bf9\u4e8e\"this offer is not available to accept in this country\"\u548c\"operation not allowed\"\u7b49\u62a5\u9519,\u4e3b\u8981\u662f\u7531\u4e8e\u5ba2\u6237\u6240\u5728\u56fd\u5bb6/\u5730\u533a\u4e0eBedrock\u540e\u53f0\u7a0e\u52a1\u8bbe\u7f6e\u4fe1\u606f\u4e0d\u7b26,\u5305\u62ec\u4e1a\u52a1\u6cd5\u5f8b\u5730\u5740\u3001\u56fd\u5bb6\u4ee3\u7801\u7b49,\u5bfc\u81f4\u65e0\u6cd5\u5728\u4e2d\u56fd\u5927\u9646\u6216\u9999\u6e2f\u5730\u533a\u5f00\u901a\u76f8\u5173\u670d\u52a1\u6216\u8fdb\u884c\u67d0\u4e9b\u64cd\u4f5c\u3002 3\u3001\u5bf9\u4e8e\"no identity based policy allows the aws-marketplace:ViewSubscriptions action\"\u7684\u62a5\u9519,\u662f\u7531\u4e8e\u5ba2\u6237\u7684IAM\u6743\u9650\u8bbe\u7f6e\u95ee\u9898,\u9700\u8981\u8d4b\u4e88Marketplace\u76f8\u5173\u6743\u9650\u3002 \u5176\u6b21,\u5bf9\u4e8e\"no identity based policy allows the aws-marketplace:ViewSubscriptions action\"\u7684\u62a5\u9519,\u662f\u7531\u4e8e\u5ba2\u6237\u7684IAM\u6743\u9650\u8bbe\u7f6e\u95ee\u9898,\u9700\u8981\u8d4b\u4e88Marketplace\u76f8\u5173\u6743\u9650\u3002 4\u3001\"AccessDeniedException: You don't have access to the model with the specified model\"\u5219\u8868\u793a\u5ba2\u6237\u8d26\u53f7\u7f3a\u4e4f\u8bbf\u95ee\u6307\u5b9a\u6a21\u578b\u7684\u6388\u6743\u8bb8\u53ef\u3002 5\u3001\u5982\u679c\u5ba2\u6237\u65e0\u6cd5\u5728tax setting\u9875\u9762\u4fee\u6539\u76f8\u5173\u8bbe\u7f6e,\u53ef\u80fd\u662f\u7531\u4e8e\u5176\u8d26\u53f7\u5df2\u5173\u8054\u4e86Payer Account,\u5e76\u5c06Payer Account\u8bbe\u4e3a\u4e86\u4e3b\u8d26\u53f7,\u4ece\u800c\u65e0\u6cd5\u76f4\u63a5\u4fee\u6539tax setting\u4fe1\u606f\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u9700\u8981\u5148\u5728Payer Account\u7684tax setting\u9875\u9762\u8fdb\u884c\u4fee\u6539,\u7136\u540e\u518d\u540c\u6b65\u56de\u5ba2\u6237\u7684\u672c\u8d26\u53f7,\u5e76\u63a7\u5236\u53f0\u9875\u9762\u8fdb\u884c\u4fee\u6539\u3002 \u6700\u540e,\u5982\u679c\u5ba2\u6237\u65e0\u6cd5\u5728tax setting\u9875\u9762\u4fee\u6539\u76f8\u5173\u8bbe\u7f6e,\u53ef\u80fd\u662f\u7531\u4e8e\u5176\u8d26\u53f7\u5df2\u5173\u8054\u4e86Payer Account,\u5e76\u5c06Payer Account\u8bbe\u4e3a\u4e86\u4e3b\u8d26\u53f7,\u4ece\u800c\u65e0\u6cd5\u76f4\u63a5\u4fee\u6539tax setting\u4fe1\u606f\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u9700\u8981\u5148\u5728Payer Account\u7684tax setting\u9875\u9762\u8fdb\u884c\u4fee\u6539,\u7136\u540e\u518d\u540c\u6b65\u56de\u5ba2\u6237\u7684\u672c\u8d26\u53f7,\u5e76\u63a7\u5236\u53f0\u9875\u9762\u8fdb\u884c\u4fee\u6539\u3002 \u603b\u7684\u6765\u8bf4,\u4e0a\u8ff0\u62a5\u9519\u4e3b\u8981\u6d89\u53ca\u8d26\u53f7\u6ce8\u518c\u5730\u3001\u7a0e\u52a1\u8bbe\u7f6e\u3001\u6743\u9650\u914d\u7f6e\u7b49\u65b9\u9762\u7684\u95ee\u9898,\u5ba2\u6237\u9700\u8981\u6839\u636e\u5177\u4f53\u62a5\u9519\u63d0\u793a\u5e76\u7ed3\u5408\u8d26\u53f7\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u76f8\u5e94\u7684\u68c0\u67e5\u548c\u8c03\u6574\u3002</p> <p>Bedrock \u8d26\u5355\u8ba1\u8d39\u6ce8\u610f\u4e8b\u9879</p> <p>Bedrock\u63d0\u4f9b\u4e86\u4e09\u79cd\u8ba1\u8d39\u65b9\u5f0f,\u4ee5\u6ee1\u8db3\u4e0d\u540c\u573a\u666f\u7684\u9700\u6c42 1. On-demand\u65b9\u5f0f\u9002\u7528\u4e8e\u77ed\u671f\u5185\u5076\u5c14\u4f7f\u7528\u7684\u60c5\u51b5,\u6839\u636e\u8f93\u5165\u7684\u63d0\u793a\u8bcd(Prompt)\u548c\u8f93\u51fa\u7684token\u6570\u91cf\u8ba1\u8d39,\u7075\u6d3b\u6027\u9ad8,\u4f46\u5bf9\u4e8e\u9ad8\u5e76\u53d1\u6216\u957f\u671f\u4f7f\u7528\u6210\u672c\u8f83\u9ad8\u3002 2. Provisioned Throughput\u65b9\u5f0f\u5219\u91c7\u7528\u9884\u5148\u8d2d\u4e70\u6a21\u578b\u5355\u5143(Model Unit)\u7684\u5f62\u5f0f,\u76f8\u5bf9\u4e8eOn-demand\u6709\u66f4\u9ad8\u7684\u5bb9\u91cf\u4fdd\u8bc1,\u652f\u63011\u4e2a\u6708\u62166\u4e2a\u6708\u7684\u4f7f\u7528\u627f\u8bfa\u671f,\u9002\u5408\u4e2d\u957f\u671f\u3001\u8f83\u4e3a\u7a33\u5b9a\u7684\u4f7f\u7528\u573a\u666f,\u6309\u5c0f\u65f6\u8ba1\u8d39,\u53ef\u5b9e\u73b0\u6210\u672c\u4f18\u5316\u3002 3. Fine tuning\u65b9\u5f0f\u9762\u5411\u9700\u8981\u5728\u57fa\u7840\u6a21\u578b\u4e0a\u8fdb\u884c\u4e2a\u6027\u5316\u8c03\u4f18\u7684\u5ba2\u6237,\u6309\u6a21\u578b\u5927\u5c0f\u3001\u8bad\u7ec3token\u6570\u91cf\u3001\u6a21\u578b\u5b58\u50a8\u4ee5\u53ca\u6a21\u578b\u63a8\u7406\u4e09\u65b9\u9762\u8ba1\u8d39\u3002\u5176\u4e2d\u6a21\u578b\u5fae\u8c03token\u6570\u91cf = \u6a21\u578b\u5fae\u8c03\u6570\u636e\u96c6 token \u603b\u6570 * \u6a21\u578b\u5fae\u8c03\u6b21\u6570(Epoch)\u3002 \u5982\u4f55\u8d2d\u4e70 Provisioned throughput \u540e\u53f0\u6309\u7167\u5cf0\u503c TPM \u9884\u7559\u541e\u5410\u91cf\uff0c\u786e\u4fdd\u5728\u6d41\u91cf\u9ad8\u5cf0\u671f\u95f4\u4e00\u81f4\u7684\u5ba2 \u6237\u4f53\u9a8c\uff1b\u5ba2\u6237\u9700\u8981 \u6309\u5c0f\u65f6\u8ba1\u8d39\uff0c\u627f\u8bfa\u671f\u9650\u4e3a 1 \u4e2a\u6708\u6216 6 \u4e2a\u6708\uff0c\u5ef6\u957f\u627f\u8bfa\u671f\u9650\u4f1a\u4eab\u53d7\u6298\u6263\u3002Bedrock \u4f1a\u81ea\u52a8\u914d\u7f6e\u8d2d\u4e70\u7684\u6a21\u578b\u5355\u5143\uff0c\u5e76\u751f\u6210\u7528\u4e8e PT \u63a8\u7406\u7684\u552f \u4e00 ARN \uff0c\u5ba2\u6237\u53ea\u9700\u8981\u6839\u636e\u65b0\u7684 ARN \u6765\u8c03\u7528 API \u63a5\u53e3\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u8d44\u6e90\u72ec\u5360\uff1b\u5728\u540c\u4e00\u4e2a\u8d26\u6237\u4e0b\uff0c\u5ba2\u6237\u53ef\u4ee5\u6309\u9700\u7075\u6d3b\u5730\u4f7f\u7528 OD \u6a21\u5f0f\u4ee5\u53ca\u591a\u4e2a PT \u6a21\u5f0f\u8fdb\u884c\u63a8\u7406\u3002</p> <p>\u9500\u552e\u8bdd\u672f\u53c2\u8003</p> <p>Bedrock\u53ef\u4ee5\u5207\u5165\u7684\u75db\u70b9   - Bedrock\u540c\u65f6\u63d0\u4f9bAI21 Labs\u3001Cohere\u3001Claude\u3001Meta\u3001Mistral AI\u3001Stability AI\uff0c\u4ee5\u53ca\u4e9a\u9a6c\u900a\u81ea\u5df1\u7b49\u591a\u4e2a\u516c\u53f8\u4e0d\u540c\u7684\u591a\u4e2a\u7248\u672c\u7684\u6a21\u578b\uff0c\u65b9\u4fbf\u60a8\u53bb\u505a\u4e0d\u540c\u6a21\u578b\u7684\u6d4b\u8bd5\u5bf9\u6bd4\u3002 - Bedrock Claude \u8f93\u5165token\u652f\u6301\u5230100k\uff0cClaude3\u8f93\u5165token\u652f\u6301\u5230200K( OpenAI\u4e0a\u7684 GPT-4\u6700\u9ad8\u652f\u6301 32K\uff0cOpenAI\u4e0a\u7684 GPT-3.5\u6700\u9ad8\u652f\u630116K\uff09\u3002 - \u610f\u5473\u7740Claude\u6a21\u578b\u53ef\u4ee5\u4e00\u6b21\u6027\u5206\u6790\u5927\u7ea675000\u4e2a\u5355\u8bcd\uff0c\u51e0\u4e4e\u662f\u76ee\u524d\u5546\u4e1a\u53ef\u7528\u6a21\u578b\u4e2d\u201c\u8bb0\u6027\u201d\u6700\u597d\u7684 - \u4ee3\u8868\u80fd\u591f\u8bb0\u4f4f\u66f4\u591a\u8fd1\u671f\u5bf9\u8bdd\u7684\u5185\u5bb9 - Claude3\u652f\u6301\u591a\u6a21\u6001\uff0c\u53ef\u4ee5\u5f88\u597d\u7684\u8bc6\u522b\u6587\u7ae0\u4e2d\u7684\u56fe\u7247\u3001\u8868\u683c\u3001\u67b6\u6784\u56fe\u3001\u6d41\u7a0b\u56fe\u3001\u624b\u5199\u4f53\u7b49\u975e\u7ed3\u6784\u5316\u6570\u636e\uff0c\u800cgpt3.5\u4e0d\u652f\u6301\u591a\u6a21\u6001\u3002 - Bedrock\u63d0\u4f9b\u66f4\u9ad8\u7684SLA( 99.9% SLA vs. OpenAI no SLA)\u3002 - Bedrock\u53ef\u7528\u6765\u5e94\u5bf9ChatGPT\u5c01\u53f7\u4ee5\u53caOpenAI API \u4e0d\u53ef\u7528\u7684\u65f6\u5019\uff0c\u4e9a\u9a6c\u900a\u63d0\u4f9b\u591a\u4e2a\u63a5\u53e3\u53ef\u4ee5\u63d0\u4f9b\u81ea\u8eab\u670d\u52a1\u7684\u9ad8\u53ef\u7528\u3002 - Claude3 sonnet\u5b9a\u4f4d\u662f\u4ecb\u4e8eGPT3.5\u548c4\u4e4b\u95f4\u7684\u65b0\u9009\u62e9\uff0cSonnet\u5728\u90e8\u5206\u573a\u666f\u6548\u679c\u4f18\u4e8eGPT4\uff0c\u6210\u672c\u5374\u66f4\u4f4e\uff1b\u5c31\u7b97\u6d4b\u8bd5\u7ed3\u679c\u6253\u5e73\u7684\u573a\u666f\uff0c\u4e5f\u6709\u4ef7\u683c\u4f18\u52bf\u53ef\u4ee5\u8003\u8651\u3002 - Bedrock\u63d0\u4f9b\u7684\u4e13\u4e1a\u529f\u5305\u62ecKnowledge Base, Agent, model evaluation\u7b49\u9664\u4e86\u57fa\u7840\u6a21\u578b\u4e4b\u5916\u7684\u80fd\u529b\uff0c\u65b9\u4fbf\u5ba2\u6237\u5feb\u901f\u6784\u5efa\u7aef\u5230\u7aef\u7684\u751f\u6210\u5f0fAI\u5e94\u7528\u3002 - \u5408\u89c4\u89d2\u5ea6\uff0c\u7528\u6237\u7684\u6570\u636e\u5728\u4f20\u8f93\u548c\u4fdd\u5b58\u65f6\u90fd\u662f\u52a0\u5bc6\u7684\uff0c\u6570\u636e\u4e0d\u4f1a\u7528\u4e8e\u6a21\u578b\u8bad\u7ec3\uff0c\u4e5f\u4e0d\u4f1a\u5171\u4eab\u7ed9 \u7b2c\u4e09\u65b9\u7684\u6a21\u578b\u5382\u5546\uff0cBedrock \u4e0a \u9664\u4e86amazon \u81ea\u5df1\u7684titan\u6a21\u578b\uff0c\u5176\u4f59\u90fd\u662f \u7b2c\u4e09\u65b9 \u6a21\u578b\uff0c\u7528\u6237\u8c03\u7528\u7b2c\u4e09\u65b9\u6a21\u578b\u7684 ip\uff0c\u8bf7\u6c42\uff0caws \u4e0d\u4f1a\u5171\u4eab\u7ed9\u7b2c\u4e09\u65b9\u516c\u53f8\u3002 - \u5927\u6a21\u578b\u901a\u5e38\u53ea\u662f\u5e94\u7528\u7cfb\u7edf\u91cc\u7684\u4e00\u4e2a\u5b50\u6a21\u5757\uff0c\u9700\u8981\u914d\u5408\u8ba1\u7b97\uff0c\u6570\u636e\u5e93\uff0c\u6570\u636e\u5206\u6790\u7b49\u670d\u52a1\uff0cBedrock \u53ef\u4ee5\u548c\u8fd9\u4e9b\u670d\u52a1\u7ec4\u5408\uff0c\u5f62\u6210\u7aef\u5230\u7aef\u7684\u5e94\u7528\u3002 \u6c9f\u901a\u6b65\u9aa4 - \u786e\u5b9a\u5ba2\u6237\u80cc\u666f   1. \u5ba2\u6237\u57fa\u672c\u80cc\u666f\u4fe1\u606f\u6536\u96c6\uff0c\u9488\u5bf9Claude\u6f5c\u5728\u7528\u6237\uff0c\u6536\u96c6\u5ba2\u6237\u662f\u5426\u6709\u6d77\u5916\u4e3b\u4f53\uff08\u9700\u8981\u975eHK\uff09   2. \u662f\u5426\u6709\u4f7f\u7528GenAI\u7684\u9700\u6c42   3.  \u5bf9GenAI\u7684\u9700\u6c42\u662f\u5bf9\u5916\u63d0\u4f9b\u8fd8\u662f\u5bf9\u5185\u90e8\u4f7f\u7528\uff0c\u5206\u522b\u7684\u4f7f\u7528\u4eba\u6570\u6216\u8005\u91cf\u7ea7   4. \u4e86\u89e3\u5ba2\u6237\u76f8\u5173\u4e1a\u52a1\u573a\u666f   5. \u5bf9GenAI\u7684\u9700\u6c42\u662f\u6587\u5b57\u751f\u6210\u8fd8\u662f\u56fe\u50cf\u751f\u6210   6. \u5ba2\u6237\u7684\u6280\u672f\u56e2\u961f\u6784\u6210   7. \u5ba2\u6237\u7684\u89d2\u8272\uff1abuyer \u8fd8\u662fbuilder\u6216\u8005Model consumer / Model tuner   8. \u5ba2\u6237\u5bf9\u6a21\u578b\u8bc4\u4ef7\u6807\u51c6\uff1a\u901f\u5ea6\u3001\u6027\u80fd\u8fd8\u662f\u56de\u7b54\u7684\u51c6\u786e\u6027 - \u786e\u5b9a\u5ba2\u6237\u73b0\u72b6 \u662f\u5426\u4f7f\u7528\u8fc7\u5927\u6a21\u578b\u3001\u662f\u5426\u63a5\u89e6\u8fc7genai\u76f8\u5173\u4ea7\u54c1\u3001\u662f\u5426\u542c\u8bf4\u8fc7\u6216\u8005\u4f7f\u7528\u8fc7Claude2/3\u3001\u662f\u5426\u5728\u4f7f\u7528\u5176\u4ed6\u5e73\u53f0\u7684GenAI\u76f8\u5173\u4ea7\u54c1\u3001\u76ee\u524d\u4f7f\u7528\u5927\u6a21\u578b\u7684\u65b9\u5f0f\uff08api\u8c03\u7528\u8fd8\u662f\u8bf4\u5728\u7b2c\u4e09\u65b9model provider\u5e73\u53f0\u4e0a\u4f7f\u7528\uff09\u3001\u4f7f\u7528\u9891\u7387\u4ee5\u53ca\u6708\u5ea6\u6210\u672c\u3001\u662f\u5426\u6709\u4e0e\u4ee3\u7406\u5546\u7b7e\u7ea6\uff0c\u76ee\u524d\u6709\u4ec0\u4e48\u75db\u70b9\uff08\u53ef\u4eceOpenAI\u5c01\u53f7\u3001SLA\u3001\u6210\u672c\u3001\u8f93\u5165token\u5f71\u54cd\u3001\u6a21\u578b\u62d2\u7b54\u7b49\u65b9\u9762\u5207\u5165\uff09\u3002 - \u5bf9Bedrock\u7684\u60f3\u6cd5 \u662f\u5426\u8003\u8651\u4f7f\u7528Bedrock\u3001\u6709\u4ec0\u4e48\u611f\u5174\u8da3\u7684\u6a21\u578b\u3001\u662f\u57fa\u4e8e\u4f5c\u4e3agpt\u7684backup\u8fd8\u662f\u4ec0\u4e48\u5176\u4ed6\u7684\u8003\u91cf\u3002 - \u5047\u5982\u5ba2\u6237\u5df2\u6709GENAI\u4f7f\u7528\u6a21\u578b\u573a\u666f\uff0c\u4e3a\u4ec0\u4e48\u8981\u9009\u62e9aws\u7684Claude3\uff1f\uff08\u6216\u8005\u8bf4\u4e3a\u4ec0\u4e48\u5ba2\u6237\u8981\u9009\u62e9Claude\u800c\u4e0d\u662fgpt\u6216\u8005Gemini\uff09   1. \u5bf9\u4e8eGPT\u6216Gemini\u5ba2\u6237\uff0cClaude3\u6709\u4e09\u79cd\u7248\u672c\u53ef\u4f9b\u7528\u6237\u9009\u62e9\uff0c\u7528\u6237\u53ef\u6839\u636e\u573a\u666f\u9700\u6c42\u548c\u9884\u7b97\u9009\u62e9\u6700\u9002\u5408\u7684\u6a21\u578b * Claude 3 Haiku \u6bd4 GPT 3.5T \u66f4\u5feb\u3001\u66f4\u4fbf\u5b9c\u3001\u66f4\u667a\u80fd\uff0c\u4e14\u652f\u6301\u591a\u6a21\u6001\u2014\u5bf9\u4e8e\u76ee\u524d\u4f7f\u7528GPT3.5\u5ba2\u6237\u6765\u8bf4\uff0c\u8fd9\u7edd\u5bf9\u662f\u4e00\u4e2a\u66f4\u597d\u7684\u9009\u62e9\u3002\uff08\u793a\u4f8b\u573a\u666f\uff1achatbot\uff1b\u5feb\u901f\u4f4e\u6210\u672c\u7684\u7ffb\u8bd1\uff1b\u5185\u5bb9\u5ba1\u6838\uff1b\u63d0\u53d6\u6587\u672c\u548c\u56fe\u50cf\u4e2d\u7684\u6570\u636e\u7b49\u7b49\uff09 * Claude 3 Sonnet \u6bd4 GPT-4T \u4fbf\u5b9c\uff0c\u667a\u80fd\u7a0b\u5ea6\u76f8\u5f53\uff0c\u901f\u5ea6\u4e0d\u76f8\u4e0a\u4e0b\uff0c\u5728\u67d0\u4e9b\u4f7f\u7528\u60c5\u51b5\u4e0b\u8fd8\u4f1a\u66f4\u5feb\u3002\u5b83\u7684\u4ef7\u503c\u66f4\u9ad8\uff0c\u51c6\u786e\u5ea6\u548c\u53ef\u9760\u6027\u4e5f\u66f4\u9ad8\u3002Sonnet \u5728\u57fa\u51c6\u6d4b\u8bd5\u4e2d\u7684\u5f97\u5206\u9ad8\u4e8e Gemini 1.0 Pro\u3002\uff08\u793a\u4f8b\u573a\u666f\uff1a\u5206\u6790\u4f01\u4e1a\u77e5\u8bc6\uff0c\u83b7\u53d6\u6570\u636e\u6d1e\u5bdf\uff1b\u9884\u6d4b\u91d1\u878d\u548c\u5e02\u573a\u6a21\u578b\uff1b\u4e2a\u6027\u5316\u5ba2\u6237\u5206\u6790\u8425\u9500\uff1b\u63d0\u9ad8\u65e5\u5e38\u751f\u4ea7\u529b\u7b49\u7b49\uff09 * Claude 3 Opus \u6bd4 GPT-4T \u6216 Gemini Ultra \u66f4\u667a\u80fd\uff0c\u5728\u8bb8\u591a\u7528\u4e8e\u8bc4\u4f30\u8fd9\u4e9b\u578b\u53f7\u6027\u80fd\u7684\u57fa\u51c6\u6d4b\u8bd5\u4e2d\u90fd\u5904\u4e8e\u9886\u5148\u5730\u4f4d\u3002\u4f7f\u7528 GPT-4T \u5728\u4eba\u5de5\u667a\u80fd\u524d\u6cbf\u521b\u9020\u65b0\u4f53\u9a8c\u7684\u5ba2\u6237\u5e94\u8fc1\u79fb\u5230 Claude 3 Opus\u3002\uff08\u793a\u4f8b\u573a\u666f\uff1a\u590d\u6742\u4efb\u52a1\u81ea\u52a8\u5316\uff1b\u6587\u732e\u89e3\u6790\u7efc\u8ff0\uff1b\u89e3\u51b3\u590d\u6742\u95ee\u9898\u7b49\u7b49\uff09 * Bedrock\u53ef\u4ee5\u7528\u6765\u5e94\u5bf9ChatGPT\u5c01\u53f7\u4ee5\u53caOpenAI API \u4e0d\u53ef\u7528\u7684\u65f6\u5019\uff0c\u591a\u4e2a\u63a5\u53e3\u53ef\u4ee5\u63d0\u4f9b\u81ea\u8eab\u670d\u52a1\u7684\u9ad8\u53ef\u7528\u3002   2. \u5bf9\u4e8e\u8001\u7248\u7684Claude\u7528\u6237\uff0c\u90fd\u5e94\u8be5\u9009\u62e9\u5347\u7ea7\u5230Claude3 * \u5982\u679c\u7528\u6237\u6b63\u5728\u4f7f\u7528Claude 2.0 \u6216 Claude 2.1 \u2014\u2014 Claude 3 Sonnet \u6bd4 Claude 2.1 \u66f4\u5feb\u3001\u66f4\u667a\u80fd\u3001\u66f4\u4fbf\u5b9c * \u5982\u679c\u7528\u6237\u6b63\u5728\u4f7f\u7528Claude Instant 1.2 \u2014\u2014 Claude 3 Haiku \u6bd4 Claude Instant 1.2 \u66f4\u5feb\u3001\u66f4\u667a\u80fd\u3001\u66f4\u4fbf\u5b9c\uff0c\u6211\u4eec\u5efa\u8bae\u5728 Claude 3 Haiku \u53d1\u5e03\u65f6\u5347\u7ea7 * Claude3\u4fee\u590d\u4e86\u201c\u8fc7\u5ea6\u62d2\u7edd\u201d\u7684\u95ee\u9898\uff0c\u73b0\u5728\u7684Claude3\u5728\u9762\u5bf9\u7cfb\u7edf\u5b89\u5168\u8fb9\u754c\u4e0a\u7684\u95ee\u9898\u65f6\uff0c\u80fd\u591f\u66f4\u7cbe\u786e\u5730\u8fa8\u522b\u98ce\u9669\uff0c\u964d\u4f4e\u62d2\u7edd\u56de\u7b54\u7684\u53ef\u80fd   3. \u76f8\u6bd4\u76f4\u63a5\u4f7f\u7528Anthropic\u5b98\u7f51 * Claude\u652f\u6301\u6309region\u90e8\u7f72\uff0c\u5ba2\u6237\u7684\u6570\u636e\u4e0d\u4f1a\u5206\u4eab\u7ed9Anthropic\uff0c\u4e5f\u4e0d\u4f1a\u7528\u4e8e\u6a21\u578b\u8bad\u7ec3\uff0c\u5728\u6570\u636e\u5408\u89c4\u6027\u4e0a\u66f4\u6709\u4fdd\u969c. * \u5982\u679c\u60a8\u9700\u8981\u6784\u5efa\u751f\u6210\u5f0fAI\uff0c\u4f5c\u4e3a\u7aef\u5230\u7aef\u5e94\u7528\uff0c\u4f7f\u7528Bedrock\u8c03\u7528Claude\u80fd\u5341\u5206\u65b9\u4fbf\u7684\u4e0e\u73b0\u6709\u4e91\u670d\u52a1\u96c6\u6210   4. Token\u4f18\u52bf Claude3\u5168\u7cfb\u652f\u6301200k token\u4e0a\u4e0b\u6587\uff0c\u7279\u6b8a\u573a\u666f\u53ef\u652f\u63011M token   5. \u591a\u6a21\u6001\u4f18\u52bf  Claude3\u7684\u591a\u6a21\u6001\u80fd\u529b\u80fd\u591f\u5904\u7406\u591a\u79cd\u683c\u5f0f\uff08JPEG\u3001PNG\u3001GIF\u3001Webp\uff09\u548c\u591a\u79cd\u7c7b\u578b\uff08\u7167\u7247\uff0c\u56fe\u8868\uff0c\u6280\u672f\u7ed8\u56fe\u3001\u67b6\u6784\u56fe\u3001\u8fd0\u7ef4\u56fe\u3001\u975e\u7ed3\u6784\u5316\u6570\u636e\u5982\u677f\u4e66\u3001\u624b\u5199\u4f53\u7b49\uff09\u7684\u56fe\u7247\uff0c\u5e76\u4e14\u80fd\u591f\u4ece\u56fe\u7247\u4e2d\u83b7\u5f97\u7406\u89e3\uff0c\u5e2e\u52a9\u62d3\u5c55\u7528\u6237\u7684\u4f7f\u7528\u573a\u666f.   6. Claude 3\u5728Bedrock\u4e0eGCP\u4e0a\u7684\u5bf9\u6bd4 GCP\u4e2d\u8bf7\u6c42\u94fe\u66f4\u957f,\u7531\u4e8e\u76ee\u524d\u8fd8\u662fPrivate Preview\u9636\u6bb5\uff0c\u5f88\u5bb9\u6613\u88ab\u62d2\u7edd \u6a21\u578b\u8fc1\u79fb\u5230Claude3\u4f1a\u6d89\u53ca\u54ea\u4e9b\u5de5\u4f5c\u91cf - \u4eceClaude instance/2\u8fc1\u79fb\u5230Claude 3\u7684\u65b9\u5f0f   1. \u4fee\u6539\u4ee3\u7801\u8c03\u7528\u4e2d\u7684model ID.   2. Claude3  API call\u4eceText Completions API \u8f6c\u4e3a Messages API\uff0c\u5347\u7ea7\u9700\u8981\u4fee\u6539\u4e00\u4e0b\u5bf9\u8bdd\u683c\u5f0f\uff0c\u6709\u5de5\u5177\u8fdb\u884c\u8f6c\u6362.    3. Claude3 \u66f4\u667a\u80fd\uff0c\u53ef\u4ee5\u9002\u5f53\u66f4\u6539\u90e8\u5206prompt\uff0c\u51cf\u5c11token\u6d88\u8017. - \u4eceOther \u6a21\u578b\u8fc1\u79fb\u5230 Claude3   1. \u7aef\u5230\u7aef\u5e94\u7528\u4e2d\uff0c\u6d89\u53ca\u5230\u670d\u52a1\u5668\uff0c\u6570\u636e\u5e93\u7b49\uff0c\u4f46\u662f\u65e0\u8bba\u4f7f\u7528\u4f55\u79cd\u6a21\u578b\uff0c\u90fd\u4e0d\u5f71\u54cd\u8fd9\u90e8\u5206\u8d44\u6e90\uff0c\u65e0\u9700\u8fc1\u79fb\u3002\u4f46\u662f\u51fa\u4e8e\u7f51\u7edc\u5ef6\u8fdf\u7b49\u6027\u80fd\u8003\u91cf\uff0c\u5c06\u670d\u52a1\u5668\u548c\u6570\u636e\u5b58\u50a8\uff0c\u8ba1\u7b97\u7b49\u5e94\u7528\u90fd\u90e8\u7f72\u5728AWS\uff0c\u7f51\u7edc\u5ef6\u8fdf\u80fd\u4f4e\u4e00\u4e9b\uff0c\u4e14\u670d\u52a1\u4e4b\u95f4\u7684\u96c6\u6210\u66f4\u65b9\u4fbf.   2. \u90e8\u5206PE\u8c03\u6574\uff0cClaude3\u66f4\u65b0\u4ee5\u540ePE\u5bf9\u7528\u6237\u66f4\u52a0\u53cb\u597d\uff0c\u8c03\u6574\u91cf\u4e5f\u53d8\u5c0f.   3. \u4ee3\u7801API\u8c03\u6574\uff0cClaude3\u540c\u6837\u4f7f\u7528Messages API\uff0cAPI\u8c03\u7528\u8c03\u6574\u66f4\u5c0f. - \u8ba4\u771f\u503e\u542c\u5ba2\u6237\u5173\u952e\u8bcd\uff0c\u4f8b\u5982\uff1a \u6587\u672c\u751f\u6210/\u56fe\u50cf\u751f\u6210/\u8bc6\u522b/\u8d85\u5206/Bedrock/role play / character / \u60c5\u611f\u966a\u4f34 / gpt / chatgpt / \u6587\u751f\u6587 /\u56fe\u751f\u56fe/ Claude / \u804a\u5929 / \u5bf9\u8bdd / chatbot / \u591a\u6a21\u6001 / GenAI / OpenAI/\u6570\u5b57\u4eba/\u667a\u80fd\u4f5c\u66f2/\u7b49\uff0c\u8fd9\u4e9b\u8bcd\u662f\u4e0d\u9519\u7684\u8868\u660eGenAI\u5546\u673a\u7684\u5b58\u5728.</p>"},{"location":"AWS/EKS/Createyourfirstcluster-console/","title":"Create  cluster \u2013 AWS console","text":""},{"location":"AWS/EKS/Createyourfirstcluster-console/#step-1-create-your-amazon-eks-cluster","title":"Step 1: Create your Amazon EKS cluster","text":"<ol> <li> <p>Create an Amazon VPC with public and private subnets that meets Amazon EKS requirements.Replace region-code with any AWS Region that is supported by Amazon EKS. For a list of AWS Regions, see Amazon EKS endpoints and quotas in the AWS General Reference guide. You can replace my-eks-vpc-stack with any name you choose. <pre><code>aws cloudformation create-stack \\\n  --region region-code \\\n  --stack-name my-eks-vpc-stack \\\n  --template-url https://s3.us-west-2.amazonaws.com/amazon-eks/cloudformation/2020-10-29/amazon-eks-vpc-private-subnets.yaml\n</code></pre></p> </li> <li> <p>Create a cluster IAM role and attach the required Amazon EKS IAM managed policy to it.</p> <p>a. Copy the following contents to a file named  eks-cluster-role-trust-policy.json  <pre><code>    {\n      \"Version\": \"2012-10-17\",\n      \"Statement\": [\n        {\n          \"Effect\": \"Allow\",\n          \"Principal\": {\n            \"Service\": \"ec2.amazonaws.com\"\n          },\n          \"Action\": \"sts:AssumeRole\"\n        }\n      ]\n    }\n</code></pre>   b. Create the role.   <pre><code>  aws iam create-role \\\n    --role-name myAmazonEKSClusterRole \\\n    --assume-role-policy-document file://\"eks-cluster-role-trust-policy.json\"\n</code></pre>   c. Attach the required Amazon EKS managed IAM policy to the role.   <pre><code>aws iam attach-role-policy \\\n  --policy-arn arn:aws:iam::aws:policy/AmazonEKSClusterPolicy \\\n  --role-name myAmazonEKSClusterRole\n</code></pre> 3. Open the Amazon EKS console at https://console.aws.amazon.com/eks/home#/clusters. Make sure that the AWS Region shown in the upper right of your console is the AWS Region that you want to create your cluster in. If it's not, choose the dropdown next to the AWS Region name and choose the AWS Region that you want to use.</p> </li> <li> <p>Choose Add cluster, and then choose Create. If you don't see this option, then choose Clusters in the left navigation pane first.</p> </li> <li> <p>On the Configure cluster page, do the following:</p> <ul> <li> <p>Enter a Name for your cluster, such as my-cluster. The name can contain only alphanumeric characters (case-sensitive) and hyphens. It must start with an alphabetic character and can't be longer than 100 characters.</p> </li> <li> <p>For Cluster Service Role, choose myAmazonEKSClusterRole.</p> </li> <li> <p>Leave the remaining settings at their default values and choose Next.</p> </li> </ul> </li> <li> <p>On the Specify networking page, do the following:</p> <ul> <li>Choose the ID of the VPC that you created in a previous step from the VPC dropdown list. It is something like vpc-00x0000x000x0x000 | my-eks-vpc-stack-VPC.</li> <li>Leave the remaining settings at their default values and choose Next.</li> </ul> </li> <li> <p>On the Configure observability page, choose Next.</p> </li> <li> <p>On the Select add-ons page, choose Next. <code>For more information on add-ons, see Amazon EKS add-ons.</code></p> </li> <li> <p>On the Configure selected add-ons settings page, choose Next.</p> </li> <li> <p>On the Review and create page, choose Create.</p> </li> </ol> <p>To the right of the cluster's name, the cluster status is Creating for several minutes until the cluster provisioning process completes. Don't continue to the next step until the status is Active.</p> <p>Note</p> <p> You might receive an error that one of the Availability Zones in your request doesn't have sufficient capacity to create an Amazon EKS cluster. If this happens, the error output contains the Availability Zones that can support a new cluster. Retry creating your cluster with at least two subnets that are located in the supported Availability Zones for your account. For more information, see Insufficient capacity.</p>"},{"location":"AWS/EKS/Createyourfirstcluster-console/#step-2configure-your-computer-to-communicate-with-your-cluster","title":"Step 2:Configure your computer to communicate with your cluster","text":"<p>In this section, you create a kubeconfig file for your cluster. The settings in this file enable the kubectl CLI to communicate with your cluster.</p> <ol> <li>Create or update a kubeconfig file for your cluster. Replace <code>region-code</code> with the AWS Region that you created your cluster in. Replace <code>my-cluster</code> with the name of your cluster.     <pre><code>aws eks update-kubeconfig --region region-code --name my-cluster\n</code></pre>   By default, the config file is created in ~/.kube or the new cluster's configuration is added to an existing config file in ~/.kube. 2.Test your configuration.     <pre><code>kubectl get svc\n</code></pre></li> </ol> <p>Note</p> <p>If you receive any authorization or resource type errors, see Unauthorized or access denied (kubectl) in the troubleshooting topic.</p> <p>An example output is as follows. <pre><code>NAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE\nsvc/kubernetes   ClusterIP   10.100.0.1   &lt;none&gt;        443/TCP   1m\n</code></pre></p>"},{"location":"AWS/EKS/Createyourfirstcluster-console/#step-3create-nodes","title":"Step 3:Create nodes","text":"Managed nodes \u2013 LinuxFargate \u2013 Linux <p>Create a managed node group, specifying the subnets and node IAM role that you created in previous steps.</p> <ol> <li> <p>To create your Amazon EC2 Linux managed node group     Create a node IAM role and attach the required Amazon EKS IAM managed policy to it. The Amazon EKS node kubelet daemon makes calls to AWS APIs on your behalf. Nodes receive permissions for these API calls through an IAM instance profile and associated policies.</p> <ol> <li>Copy the following contents to a file named node-role-trust-policy.json.     <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n</code></pre></li> <li>Create the node IAM role.     <pre><code>aws iam create-role \\\n  --role-name myAmazonEKSNodeRole \\\n  --assume-role-policy-document file://\"node-role-trust-policy.json\"\n</code></pre></li> <li>Attach the required managed IAM policies to the role.     <pre><code>aws iam attach-role-policy \\\n  --policy-arn arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy \\\n  --role-name myAmazonEKSNodeRole\naws iam attach-role-policy \\\n  --policy-arn arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly \\\n  --role-name myAmazonEKSNodeRole\naws iam attach-role-policy \\\n  --policy-arn arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy \\\n  --role-name myAmazonEKSNodeRole\n</code></pre></li> </ol> </li> <li> <p>Open the Amazon EKS console at https://console.aws.amazon.com/eks/home#/clusters</p> </li> <li> <p>Choose the name of the cluster that you created in Step 1: Create your Amazon EKS cluster, such as <code>my-cluster</code>.</p> </li> <li> <p>On the my-cluster page, do the following:</p> <ol> <li> <p>Choose the Compute tab.</p> </li> <li> <p>Choose Add Node Group.</p> </li> </ol> </li> <li> <p>Copy the following contents to a file named node-role-trust-policy.json.     <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n</code></pre></p> </li> <li>Copy the following contents to a file named node-role-trust-policy.json.</li> </ol> <p>Create a Fargate profile. When Kubernetes Pods are deployed with criteria that matches the criteria defined in the profile, the Pods are deployed to Fargate. To create a Fargate profile</p> <ol> <li> <p>Create an IAM role and attach the required Amazon EKS IAM managed policy to it. When your cluster creates Pods on Fargate infrastructure, the components running on the Fargate infrastructure must make calls to AWS APIs on your behalf. This is so that they can do actions such as pull container images from Amazon ECR or route logs to other AWS services. The Amazon EKS Pod execution role provides the IAM permissions to do this.</p> <ol> <li>Copy the following contents to a file named pod-execution-role-trust-policy.json. Replace region-code with the AWS Region that your cluster is in. If you want to use the same role in all AWS Regions in your account, replace region-code with . Replace 111122223333 with your account ID and my-cluster with the name of your cluster. If you want to use the same role for all clusters in your account, replace my-cluster with .   <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Condition\": {\n        \"ArnLike\": {\n            \"aws:SourceArn\": \"arn:aws:eks:region-code:111122223333:fargateprofile/my-cluster/*\"\n        }\n      },\n      \"Principal\": {\n        \"Service\": \"eks-fargate-pods.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n</code></pre></li> <li>Create a Pod execution IAM role.   <pre><code>aws iam create-role \\\n  --role-name AmazonEKSFargatePodExecutionRole \\\n  --assume-role-policy-document file://\"pod-execution-role-trust-policy.json\"\n</code></pre></li> <li> <p>Open the Amazon EKS console at https://console.aws.amazon.com/eks/home#/clusters.</p> </li> <li> <p>Copy the following contents to a file named node-role-trust-policy.json.</p> </li> <li>Copy the following contents to a file named node-role-trust-policy.json.</li> </ol> </li> <li> <p>Please refer to https://docs.aws.amazon.com/eks/latest/userguide/getting-started-console.html</p> </li> </ol>"},{"location":"AWS/EKS/Createyourfirstcluster-console/#step-4view-resources-seeing-in-aws-console-plaform","title":"Step 4:View resources  (seeing In aws console plaform)","text":""},{"location":"AWS/EKS/Createyourfirstcluster-console/#step-5delete-resources-seeing-in-aws-console-plaform","title":"Step 5:Delete resources   (seeing In aws console plaform)","text":""},{"location":"AWS/EKS/Createyourfirstcluster%E2%80%93eksctl/","title":"Create cluster \u2013 eksctl","text":"<p>This guide helps you to create all of the required resources to get started with Amazon Elastic Kubernetes Service (Amazon EKS) using eksctl, a simple command line utility for creating and managing Kubernetes clusters on Amazon EKS. At the end of this tutorial, you will have a running Amazon EKS cluster that you can deploy applications to.</p>"},{"location":"AWS/EKS/Createyourfirstcluster%E2%80%93eksctl/#step-1-install-eksctl","title":"Step 1: Install eksctl","text":"For UnixFor Windows <pre><code># for ARM systems, set ARCH to: `arm64`, `armv6` or `armv7`\nARCH=amd64\nPLATFORM=$(uname -s)_$ARCH\n\ncurl -sLO \"https://github.com/eksctl-io/eksctl/releases/latest/download/eksctl_$PLATFORM.tar.gz\"\n\n# (Optional) Verify checksum\ncurl -sL \"https://github.com/eksctl-io/eksctl/releases/latest/download/eksctl_checksums.txt\" | grep $PLATFORM | sha256sum --check\n\ntar -xzf eksctl_$PLATFORM.tar.gz -C /tmp &amp;&amp; rm eksctl_$PLATFORM.tar.gz\n\nsudo mv /tmp/eksctl /usr/local/bin\n</code></pre> <p>Direct download (latest release): AMD64/x86_64 - ARMv6 - ARMv7 - ARM64</p> <p>Or Third-Party Installers (Not Recommended) <pre><code>choco install eksctl\n</code></pre></p>"},{"location":"AWS/EKS/Createyourfirstcluster%E2%80%93eksctl/#step-2-create-your-amazon-eks-cluster-and-nodes","title":"Step 2: Create your Amazon EKS cluster and nodes","text":"Managed nodes \u2013 LinuxFargate \u2013 Linux <pre><code>eksctl create cluster --name my-cluster --region region-code\n</code></pre> <pre><code>eksctl create cluster --name my-cluster --region region-code --fargate\n</code></pre> <p>Cluster creation takes several minutes. During creation you'll see several lines of output. The last line of output is similar to the following example line.</p> <p><code>[...] [\u2713]  EKS cluster \"my-cluster\" in \"region-code\" region is ready</code></p>"},{"location":"AWS/EKS/Createyourfirstcluster%E2%80%93eksctl/#step-2-view-kubernetes-resources","title":"Step 2: View Kubernetes resources","text":"<ol> <li>View your cluster nodes. <pre><code>kubectl get nodes -o wide\n</code></pre></li> <li>View the workloads running on your cluster. <pre><code>kubectl get pods -A -o wide\n</code></pre></li> </ol>"},{"location":"AWS/EKS/Createyourfirstcluster%E2%80%93eksctl/#step-3-delete-your-cluster-and-nodes","title":"Step 3: Delete your cluster and nodes","text":"<pre><code>eksctl delete cluster --name my-cluster --region region-code\n</code></pre>"},{"location":"AWS/EKS/Starting%20eks/","title":"Get started with Amazon EKS","text":"Step_content <p><code>To create your first cluster and its associated resources, see Getting started with Amazon EKS. In general,   getting started with Amazon EKS involves the following steps.</code></p> <ol> <li> <p>Create a cluster \u2013 Start by creating your cluster using eksctl, AWS Management Console, AWS CLI, or one of the AWS SDKs.</p> </li> <li> <p>Choose your approach to compute resources \u2013 Decide between AWS Fargate, Karpenter, managed node groups, and self-managed nodes.</p> </li> <li> <p>Setup \u2013 Set up the necessary controllers, drivers, and services.</p> </li> <li> <p>Deploy workloads \u2013 Tailor your Kubernetes workloads to best utilize the resources and capabilities of your chosen node type.</p> </li> <li> <p>Management \u2013 Oversee your workloads, integrating AWS services to streamline operations and enhance workload performance. You can view information about your workloads using the AWS Management Console.</p> </li> </ol>"},{"location":"AWS/EKS/Starting%20eks/#step-1-set-up-the-aws-cli-see-previous-chapter","title":"Step 1: Set up the AWS CLI See previous chapter","text":""},{"location":"AWS/EKS/Starting%20eks/#step-2-installing-or-updating-kubectl","title":"Step 2\uff1a Installing or updating kubectl","text":"windowslinuxmacOS <p>To install or update kubectl on Windows Open a PowerShell terminal.</p> <p>Download the kubectl binary for your cluster's Kubernetes version from Amazon S3.</p> <p>Kubernetes 1.29 <pre><code>curl.exe -O https://s3.us-west-2.amazonaws.com/amazon-eks/1.29.0/2024-01-04/bin/windows/amd64/kubectl.exe\n</code></pre> Or Kubernetes 1.28 <pre><code>curl.exe -O https://s3.us-west-2.amazonaws.com/amazon-eks/1.28.5/2024-01-04/bin/windows/amd64/kubectl.exe\n</code></pre> After you install kubectl, you can verify its version</p> <pre><code>kubectl version --client\n</code></pre> <ol> <li>Download the kubectl binary for your cluster's Kubernetes version from Amazon S3. Kubernetes 1.29 <pre><code>curl -O https://s3.us-west-2.amazonaws.com/amazon-eks/1.29.0/2024-01-04/bin/linux/amd64/kubectl\n</code></pre></li> <li><pre><code>chmod +x ./kubectl\n</code></pre></li> <li><pre><code>kubectl version --client\n</code></pre></li> </ol> <p>Note</p> <p>You must use a kubectl version that is within one minor version difference of your Amazon EKS cluster control plane. For example, a 1.28 kubectl client works with Kubernetes 1.27, 1.28, and 1.29 clusters.</p>"},{"location":"AWS/ai/1/","title":"4/18/2024 16:00-17:00 \u300a\u5927\u8bed\u8a00\u6a21\u578b\u5fae\u8c03\u4e0e\u79c1\u6709\u5316\u90e8\u7f72\u300b","text":"<p>  https://github.com/colorzhang/TinyLM  </p>","tags":["Foo","Bar"]},{"location":"AWS/command%20line%20interface/configure-cli/","title":"CENTOS7.X SSH/NETWORK","text":"","tags":["SSH"]},{"location":"AWS/command%20line%20interface/configure-cli/#configure-aws-cli","title":"Configure AWS CLI","text":"<p>Note</p> <p>Where are configuration settings(configure_files) stored??</p> <p><code>linux&gt;\uff1a~/.aws/</code> <code>windows&gt;: ~/.aws/</code></p> <p>How o get the ak/sk from aws console? Click here</p>","tags":["SSH"]},{"location":"AWS/command%20line%20interface/configure-cli/#to-create-an-access-key","title":"To create an access key","text":"<ol> <li> <p>Sign into the AWS Management Console.</p> </li> <li> <p>In the top right, choose your AWS user name to open the navigation menu. For example, choose webadmin. Then choose Security credentials.</p> </li> <li> <p>Under Access keys, choose Create access key.</p> </li> <li> <p>Choose Command Line Interface (CLI), then choose Next.</p> </li> <li> <p>Choose Create access key.</p> </li> <li> <p>Choose Download .csv file.</p> </li> </ol>","tags":["SSH"]},{"location":"AWS/command%20line%20interface/configure-cli/#to-configure-the-aws-cli","title":"To configure the AWS CLI","text":"","tags":["SSH"]},{"location":"AWS/command%20line%20interface/configure-cli/#credentials-file","title":"Credentials file","text":"<pre><code>[default]\naws_access_key_id=ASIAIOSFODNN7EXAMPLE\naws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\naws_session_token = IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGEXAMPLE\n\n\n[user1]\naws_access_key_id=ASIAI44QH8DHBEXAMPLE\naws_secret_access_key=je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY\naws_session_token = fcZib3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGEXAMPLE\n</code></pre>","tags":["SSH"]},{"location":"AWS/command%20line%20interface/configure-cli/#config-file","title":"Config file","text":"<pre><code>[default]\nregion=us-west-2\noutput=json\n\n[profile user1]\nregion=us-east-1\noutput=text\n</code></pre>","tags":["SSH"]},{"location":"AWS/command%20line%20interface/configure-cli/#using-default-profiles","title":"Using default profiles","text":"<pre><code>aws ec2 describe-instances # --profile default ,This option is omitted\n</code></pre>","tags":["SSH"]},{"location":"AWS/command%20line%20interface/configure-cli/#using-named-profiles","title":"Using named profiles","text":"<pre><code>aws ec2 describe-instances --profile user1\n</code></pre>","tags":["SSH"]},{"location":"AWS/command%20line%20interface/configure-cli/#setting-the-aws_profile-environment-variable-as-the-default-profile","title":"setting the AWS_PROFILE environment variable as the default profile","text":"Linux or macOSwindows <pre><code>export AWS_PROFILE=user1\n</code></pre> <p><code>setx AWS_PROFILE user1</code></p>","tags":["SSH"]},{"location":"AWS/command%20line%20interface/install-cli/","title":"Install CLI","text":"<p>AWS CLI  is an open source tool that enables you to interact with AWS services using commands in your command-line shell. </p>"},{"location":"AWS/command%20line%20interface/install-cli/#install-aws-cli","title":"Install  AWS CLI","text":"Code windowslinuxmacOS <p>1.Download and run the AWS CLI MSI installer  https://awscli.amazonaws.com/AWSCLIV2.msi 2. verify version <pre><code>aws --version\n# aws-cli/2.15.19 Python/3.11.6 Windows/10 exe/AMD64 prompt/off\n</code></pre></p> <p>linux x86 <pre><code>curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"\nunzip awscliv2.zip\nsudo ./aws/install\n</code></pre> linux ARM <pre><code>curl \"https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip\" -o \"awscliv2.zip\"\nunzip awscliv2.zip\nsudo ./aws/install\n</code></pre></p> <p>The following steps show how to install the latest version of the AWS CLI by using the standard macOS user interface and your browser.</p> <p>In your browser, download the macOS pkg file: https://awscli.amazonaws.com/AWSCLIV2.pkg</p> <p>Run your downloaded file and follow the on-screen instructions. You can choose to install the AWS CLI in the following ways:</p> <p>For all users on the computer (requires sudo)</p> <p>You can install to any folder, or choose the recommended default folder of /usr/local/aws-cli.</p> <p>The installer automatically creates a symlink at /usr/local/bin/aws that links to the main program in the installation folder you chose.</p> <p>For only the current user (doesn't require sudo)</p> <p>You can install to any folder to which you have write permission.</p> <p>Due to standard user permissions, after the installer finishes, you must manually create a symlink file in your $PATH that points to the aws and aws_completer programs by using the following commands at the command prompt. If your $PATH includes a folder you can write to, you can run the following command without sudo if you specify that folder as the target's path. If you don't have a writable folder in your $PATH, you must use sudo in the commands to get permissions to write to the specified target folder. The default location for a symlink is /usr/local/bin/.</p> <p><pre><code>sudo ln -s /folder/installed/aws-cli/aws /usr/local/bin/aws\nsudo ln -s /folder/installed/aws-cli/aws_completer /usr/local/bin/aws_completer\n</code></pre> Note You can view debug logs for the installation by pressing Cmd+L anywhere in the installer. This opens a log pane that enables you to filter and save the log. The log file is also automatically saved to /var/log/install.log. To verify that the shell can find and run the aws command in your $PATH, use the following commands.</p> <p><pre><code>which aws\n/usr/local/bin/aws \naws --version\naws-cli/2.15.19 Python/3.11.6 Darwin/23.3.0 botocore/2.4.5\n</code></pre> If the aws command cannot be found, you might need to restart your terminal or follow the troubleshooting in Troubleshoot AWS CLI</p>"},{"location":"AWS/command%20line%20interface/install-cli/#abc","title":"abc","text":"<p>\u5e26\u6709\u5de5\u5177\u63d0\u793a\u7684\u56fe\u6807 </p> <p>Note</p> <p>saasd; asdasd (1)  1.  \u6211\u662f\u6ce8\u91ca</p> Note <p>saasd; asdasd </p> <p>The HTML specification is maintained by the W3C.</p> <p>2</p> Tab 1Tab 2 <p>Lorem ipsum dolor sit amet, (1) consectetur adipiscing elit.</p> <ol> <li> I'm an annotation!</li> </ol> <p>Phasellus posuere in sem ut cursus (1)</p> <ol> <li> I'm an annotation as well!</li> </ol>"},{"location":"Learn_english/1/","title":"1","text":"<p>crucial \u81f3\u5173\u91cd\u8981\u7684 aspect  \u65b9\u9762 we have nested to definition files together \u5d4c\u5957</p> <p>anime noun  UK  /\u02c8\u00e6n.\u026a.me\u026a/ US  /\u02c8\u00e6n.\u0259.me\u026a/ Until recently, anime had little more than a cult following outside Japan. \u4ee5\u524d\uff0c\u65e5\u672c\u52a8\u753b\u7247\u5728\u65e5\u672c\u4ee5\u5916\u7684\u8ffd\u968f\u8005\u4e0d\u591a\uff0c\u8fd9\u79cd\u60c5\u51b5\u6700\u8fd1\u53d1\u751f\u4e86\u6539\u53d8\u3002</p> <p>curriculum noun [ C ]  UK  /k\u0259\u02c8r\u026ak.j\u0259.l\u0259m/ US  /k\u0259\u02c8r\u026ak.j\u0259.l\u0259m/ the school curriculum \u5b66\u6821\u8bfe\u7a0b the subjects studied in a school, college, etc. and what each subject includes</p>"},{"location":"blog/","title":"My awsome Blogs, welcome!","text":"<code>Linux</code> <code>Windows</code> <code>AI</code> <code>K8S</code> <code>AWS</code>"},{"location":"blog/2024/01/31/centos-ops/","title":"Centos Ops","text":"","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#linux","title":"\u67e5\u770blinux\u7cfb\u7edf\u4e2d\u7684\u4fe1\u606f","text":"","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#_1","title":"\u67e5\u770b\u7cfb\u7edf\u7248\u672c","text":"<pre><code>[root@localhost ~]# cat /etc/redhat-release\nCentOS Linux release 7.9.2009 (Core)\n</code></pre>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#hostname","title":"\u67e5\u770bhostname","text":"<pre><code>[root@localhost ~]# hostname\nlocalhost.localdomain\n[root@localhost ~]# cat /etc/hostname\nlocalhost.localdomain\n</code></pre>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#hostname_1","title":"\u4fee\u6539\u4e3b\u673a\u540dhostname","text":"","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#_2","title":"\u4e34\u65f6\u4fee\u6539","text":"<p>\u901a\u8fc7hostname $\u4e3b\u673a\u540d\u6765\u4fee\u6539\uff0c\u91cd\u542f\u540e\u5c31\u4f1a\u6062\u590d\u56de\u53bb</p>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#_3","title":"\u6c38\u4e45\u4fee\u6539","text":"<p>\u901a\u8fc7<code>hostnamectl set-hostname $\u4e3b\u673a\u540d</code>\u6765\u4fee\u6539</p> <p>hostnamectl\u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u662fcentos7\u540e\u624d\u5f15\u5165\u7684. </p> <pre><code>\u5728CentOS7\u4e2d\u6709\u4e09\u79cd\u5b9a\u4e49\u7684\u4e3b\u673a\u540d:\n-  \u9759\u6001\u7684\uff08static\uff09: \u4e5f\u79f0\u4e3a\u5185\u6838\u4e3b\u673a\u540d\uff0c\u662f\u7cfb\u7edf\u5728\u542f\u52a8\u65f6\u4ece/etc/hostname\u5185\u81ea\u52a8\u521d\u59cb\u5316\u7684\u4e3b\u673a\u540d\uff1b\n-  \u77ac\u6001\u7684\uff08transient\uff09\uff1a\u662f\u5728\u7cfb\u7edf\u8fd0\u884c\u65f6\u4e34\u65f6\u5206\u914d\u7684\u4e3b\u673a\u540d\uff1b\n-  \u7075\u6d3b\u7684\uff08pretty\uff09\uff1a\u5141\u8bb8\u4f7f\u7528\u7279\u6b8a\u5b57\u7b26\u7684\u4e3b\u673a\u540d\n</code></pre> <pre><code>[root@localhost ~]# hostnamectl set-hostname k8s-master\n[root@localhost ~]# cat /etc/hostname #\u6ce8\uff1a\u8bbe\u7f6e\u9759\u6001\u4e3b\u673a\u540d\u53ea\u5bf9\u65b0\u8fde\u63a5\u7684\u4f1a\u8bdd\u7acb\u5373\u751f\u6548\uff0c\u5bf9\u4e8e\u5f53\u524d\u8fde\u63a5\u5219\u4e0d\u751f\u6548\uff0c\u9700\u8981\u91cd\u65b0\u8fde\u63a5\u5373\u53ef\u67e5\u770b\u6548\u679c\nk8s-master  \n[root@k8s-master ~]# cat /etc/hostname  #\u8fd9\u91cc\u662f\u91cd\u8fde\u540e\u7684\u6548\u679c\nk8s-master\n</code></pre>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#yum","title":"yum\u547d\u4ee4","text":"","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#yum_1","title":"\u5efa\u7acbyum\u4ed3\u5e93\u7f13\u5b58","text":"<p>\u6211\u4eec\u5728\u66f4\u65b0yum\u6e90\u6216\u8005\u51fa\u73b0\u914d\u7f6eyum\u6e90\u4e4b\u540e\uff0c\u901a\u5e38\u90fd\u4f1a\u4f7f\u7528yum makecache \u751f\u6210\u7d22\u5f15\u7f13\u5b58\u7d22\u5f15\u63d0\u4f9b\u641c\u7d22\u5b89\u88c5\u901f\u5ea6,\u7d22\u5f15\u7f13\u5b58\u5b58\u50a8\u4f4d\u7f6e\uff1a /var/cache/yum/  yum makecache fast\u547d\u4ee4\u662f\u5c06\u8f6f\u4ef6\u5305\u4fe1\u606f\u63d0\u524d\u5728\u672c\u5730\u7d22\u5f15\u7f13\u5b58\uff0c\u7528\u6765\u63d0\u9ad8\u641c\u7d22\u5b89\u88c5\u8f6f\u4ef6\u7684\u901f\u5ea6,\u5efa\u8bae\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u63d0\u5347yum\u5b89\u88c5\u7684\u901f\u5ea6\u3002  <pre><code>yum makecache #[fast]\n</code></pre></p>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#yum_2","title":"\u6e05\u7406yum\u6240\u6709\u7f13\u5b58","text":"<p>yum \u4f1a\u628a\u4e0b\u8f7d\u7684\u8f6f\u4ef6\u5305\u548cheader\u5b58\u50a8\u5728cache\u4e2d\u800c\u4e0d\u81ea\u52a8\u5220\u9664\u3002\u5982\u679c\u89c9\u5f97\u5360\u7528\u78c1\u76d8\u7a7a\u95f4\uff0c\u53ef\u4ee5\u4f7f\u7528yum clean\u6307\u4ee4\u6e05\u9664\u7d22\u5f15\u7f13\u5b58\u548c\u4e0b\u8f7d\u5305\u7684\u7f13\u5b58\u3002 <pre><code>yum clean all\n</code></pre></p> <p>verify</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. <pre><code>[root@localhost 7]#  cd /var/cache/yum/ \n[root@localhost 7]#  du -sh *\n112M    base\n8.0K    CentOS-Base\n8.0K    docker-ce-stable\n163M    epel\n4.2M    extras\n12K gitlab_gitlab-ce\n12K gitlab_gitlab-ce-source\n8.0K    mysql56-community\n8.0K    mysql-connectors-community\n8.0K    mysql-tools-community\n8.0K    nginx\n0   onlyoffice\n4.0K    timedhosts\n0   timedhosts.22657\n0   timedhosts.txt\n114M    updates\n0   zabbix\n0   zabbix-non-supported\n</code></pre></p>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#scp","title":"scp\u547d\u4ee4","text":"","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#_4","title":"\u4e0a\u4f20 \u901a\u8fc7\u7f51\u7edc\u4f20\u8f93\u6587\u4ef6\u5230\u76ee\u7684\u5730","text":"<pre><code>scp *.repo root@k8s-master:/etc/yum.repos.d/\n</code></pre> <pre><code>graph LR\n  A[Start] --&gt; B{Error?};\n  B --&gt;|Yes| C[Hmm...];\n  C --&gt; D[Debug];\n  D --&gt; B;\n  B ----&gt;|No| E[Yay!];\n  B ------&gt; AAA;</code></pre> <p>Lorem ipsum<sup>1</sup> dolor sit amet, consectetur adipiscing elit.[^2]</p>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#bacd","title":"bacd","text":"<p>asd asdasd</p>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#linux-tail","title":"Linux tail \u547d\u4ee4","text":"<pre><code>tail [\u53c2\u6570] [\u6587\u4ef6]  \n</code></pre>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#_5","title":"\u53c2\u6570","text":"<ul> <li>-f \u5faa\u73af\u8bfb\u53d6</li> <li>-q \u4e0d\u663e\u793a\u5904\u7406\u4fe1\u606f</li> <li>-v \u663e\u793a\u8be6\u7ec6\u7684\u5904\u7406\u4fe1\u606f</li> <li>-c&lt;\u6570\u76ee&gt; \u663e\u793a\u7684\u5b57\u8282\u6570</li> <li>-n&lt;\u884c\u6570&gt; \u663e\u793a\u6587\u4ef6\u7684\u5c3e\u90e8 n \u884c\u5185\u5bb9</li> <li>--pid=PID \u4e0e-f\u5408\u7528,\u8868\u793a\u5728\u8fdb\u7a0bID,PID\u6b7b\u6389\u4e4b\u540e\u7ed3\u675f</li> <li>-q, --quiet, --silent \u4ece\u4e0d\u8f93\u51fa\u7ed9\u51fa\u6587\u4ef6\u540d\u7684\u9996\u90e8</li> <li>-s, --sleep-interval=S \u4e0e-f\u5408\u7528,\u8868\u793a\u5728\u6bcf\u6b21\u53cd\u590d\u7684\u95f4\u9694\u4f11\u7720S\u79d2</li> </ul>","tags":["yum"]},{"location":"blog/2024/01/31/centos-ops/#usage","title":"Usage","text":"<p>\u8981\u663e\u793a notes.log \u6587\u4ef6\u7684\u6700\u540e 10 \u884c\uff0c\u8bf7\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\uff1a <pre><code>tail notes.log         # \u9ed8\u8ba4\u663e\u793a\u6700\u540e 10 \u884c\n</code></pre> \u6b64\u547d\u4ee4\u663e\u793a notes.log \u6587\u4ef6\u7684\u6700\u540e 10 \u884c\u3002\u5f53\u5c06\u67d0\u4e9b\u884c\u6dfb\u52a0\u81f3 notes.log \u6587\u4ef6\u65f6\uff0ctail \u547d\u4ee4\u4f1a\u7ee7\u7eed\u663e\u793a\u8fd9\u4e9b\u884c\u3002 \u663e\u793a\u4e00\u76f4\u7ee7\u7eed\uff0c\u76f4\u5230\u60a8\u6309\u4e0b\uff08Ctrl-C\uff09\u7ec4\u5408\u952e\u505c\u6b62\u663e\u793a\u3002</p> <p>\u663e\u793a\u6587\u4ef6 notes.log \u7684\u5185\u5bb9\uff0c\u4ece\u7b2c 20 \u884c\u81f3\u6587\u4ef6\u672b\u5c3e: <pre><code>tail -n +20 notes.log\n</code></pre></p> <p>\u663e\u793a\u6587\u4ef6 notes.log \u7684\u6700\u540e 10 \u4e2a\u5b57\u7b26: <pre><code>tail -c 10 notes.log\n</code></pre></p> <ol> <li> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.\u00a0\u21a9</p> </li> </ol>","tags":["yum"]},{"location":"blog/2021/01/31/linux-volume/","title":"Linux Volume","text":"<p>\u6807\u51c6\u5206\u533a\uff1a\u6807\u51c6\u5206\u533a\u53ef\u4ee5\u5305\u542b\u6587\u4ef6\u7cfb\u7edf\u6216\u4ea4\u6362\u7a7a\u95f4\uff0c\u4e5f\u80fd\u63d0\u4f9b\u4e00\u4e2a\u5bb9\u5668\uff0c\u7528\u4e8e\u8f6f\u4ef6RAID\u548cLVM\u7269\u7406\u5377\u3002</p> <p>BTRFS\uff1aBtrfs\u662f\u4e00\u4e2a\u5177\u6709\u51e0\u4e2a\u8bbe\u5907\u76f8\u540c\u7684\u7279\u5f81\u7684\u6587\u4ef6\u7cfb\u7edf\u3002\u5b83\u80fd\u591f\u5904\u7406\u548c\u7ba1\u7406\u591a\u4e2a\u6587\u4ef6\uff0c\u5927\u6587\u4ef6\u548c\u5927\u4f53\u79ef\u6bd4\u7684ext2\uff0cext3\u548cext4\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>LVM\uff08\u903b\u8f91\u5377\uff09\uff1a\u521b\u5efa\u4e00\u4e2aLVM\u5206\u533a\u81ea\u52a8\u751f\u6210\u4e00\u4e2aLVM\u903b\u8f91\u5377\u3002 LVM\u53ef\u4ee5\u5728\u4f7f\u7528\u7269\u7406\u78c1\u76d8\u65f6\uff0c\u63d0\u9ad8\u6027\u80fd\u3002\u666e\u901a\u7684\u78c1\u76d8\u5206\u533a\u7ba1\u7406\u65b9\u5f0f\u5728\u903b\u8f91\u5206\u533a\u5212\u5206\u597d\u4e4b\u540e\u5c31\u65e0\u6cd5\u6539\u53d8\u5176\u5927\u5c0f\uff0c\u5f53\u4e00\u4e2a\u903b\u8f91\u5206\u533a\u5b58\u653e\u4e0d\u4e0b\u67d0\u4e2a\u6587\u4ef6\u65f6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u56e0\u4e3a\u53d7\u4e0a\u5c42\u6587\u4ef6\u7cfb\u7edf\u7684\u9650\u5236\uff0c\u4e5f\u4e0d\u80fd\u8de8\u8d8a\u591a\u4e2a\u5206\u533a\u6765\u5b58\u653e\uff0c\u6240\u4ee5\u4e5f\u4e0d\u80fd\u540c\u65f6\u653e\u5230\u522b\u7684\u78c1\u76d8\u4e0a\u3002\u800c\u9047\u5230\u51fa\u73b0\u67d0\u4e2a\u5206\u533a\u7a7a\u95f4\u8017\u5c3d\u65f6\uff0c\u89e3\u51b3\u7684\u65b9\u6cd5\u901a\u5e38\u662f\u4f7f\u7528\u7b26\u53f7\u94fe\u63a5\uff0c\u6216\u8005\u4f7f\u7528\u8c03\u6574\u5206\u533a\u5927\u5c0f\u7684\u5de5\u5177\uff0c\u4f46\u8fd9\u53ea\u662f\u6682\u65f6\u89e3\u51b3\u529e\u6cd5\uff0c\u6ca1\u6709\u4ece\u6839\u672c\u4e0a\u89e3\u51b3\u95ee\u9898\u3002\u968f\u7740Linux\u7684\u903b\u8f91\u5377\u7ba1\u7406\uff08LVM\uff09\u529f\u80fd\u7684\u51fa\u73b0\uff0c\u8fd9\u4e9b\u95ee\u9898\u90fd\u8fce\u5203\u800c\u89e3\uff0c\u7528\u6237\u5728\u65e0\u9700\u505c\u673a\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u65b9\u4fbf\u5730\u8c03\u6574\u5404\u4e2a\u5206\u533a\u5927\u5c0f</p> <p>LVM\u7cbe\u7b80\u914d\u7f6e\uff1a\u4f7f\u7528\u81ea\u52a8\u7cbe\u7b80\u914d\u7f6e\uff0c\u4f60\u53ef\u4ee5\u7ba1\u7406\u7684\u81ea\u7531\u7a7a\u95f4\uff0c\u88ab\u79f0\u4e3a\u7cbe\u7b80\u6c60\uff0c\u5b83\u53ef\u4ee5\u6839\u636e\u9700\u8981\u7531\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u53ef\u4ee5\u5206\u914d\u7ed9\u8bbe\u5907\u4efb\u610f\u6570\u91cf\u7684\u5b58\u50a8\u6c60\u3002\u6240\u9700\u7684\u5b58\u50a8\u7a7a\u95f4\u5177\u6709\u6210\u672c\u6548\u76ca\u7684\u5206\u914d\u65f6\uff0c\u8584\u6c60\u53ef\u4ee5\u52a8\u6001\u5730\u6269\u5c55\u3002\u67d0\u4e9b\u5206\u533a\u56fa\u5b9a\u53ea\u80fd\u662f\u6807\u51c6\u5206\u533a\uff0c\u5373\u4f7f\u9009\u62e9LVM\u4e5f\u4f1a\u81ea\u52a8\u8bbe\u7f6e\u4e3a\u6807\u51c6\u5206\u533a\u3002 \u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014</p> <p>P46 \u8fd9\u91cc\u6709\u4e2a\u5751\uff0c\u90e8\u7f72metrics-server\u53d1\u73b0top pod\u53ea\u80fd\u89c2\u5bdf\u5230\u5176\u4e2d\u4e00\u4e2apod\uff0c\u9700\u8981\u5728spec\u4e0b\u9762\u4e5f\u5c31\u662fcontainers\u5e73\u7ea7\u52a0\u4e2a\u53c2\u6570hostNetwork: true\uff0c\u5c31\u80fd\u89e3\u51b3\uff0c\u539f\u56e0\u662f\u56e0\u4e3a\u4f7f\u7528calico cni\u63d2\u4ef6\u4f1a\u6709\u901a\u4fe1\u6545\u969c\u7684\u95ee\u9898</p> <p></p>","tags":["Volume"]},{"location":"blog/2024/01/31/centos7-sshnetwork/","title":"CENTOS7.* SSH/Network","text":"","tags":["SSH"]},{"location":"blog/2024/01/31/centos7-sshnetwork/#network","title":"\u914d\u7f6enetwork\u7f51\u5361\u4fe1\u606f","text":"","tags":["SSH"]},{"location":"blog/2024/01/31/centos7-sshnetwork/#_1","title":"\u7f16\u8f91\u7f51\u7edc\u63a5\u53e3\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>vi /etc/sysconfig/network-scripts/ifcfg-eth0\n</code></pre> <pre><code>TYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nIPADDR=10.0.0.10\nPREFIX=24\nGAITEWAY=10.0.0.1\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=no\nIPV6_AUTOCONF=no\nIPV6_DEFROUTE=no\nIPV6_FAILURE_FATAL=no\nIPV6_ADDR_GEN_MODE=stable-privacy\nNAME=eth0\nUUID=3d02essf7-7de0-4d3f-8dc1-f32db784aab5\nDEVICE=eth0\nONBOOT=yes\n</code></pre>","tags":["SSH"]},{"location":"blog/2024/01/31/centos7-sshnetwork/#ssh","title":"\u914d\u7f6essh","text":"","tags":["SSH"]},{"location":"blog/2024/01/31/centos7-sshnetwork/#ssh_1","title":"\u7f16\u8f91ssh\u914d\u7f6e\u6587\u4ef6","text":"<p><pre><code>vi /etc/ssh/sshd_config \n</code></pre> \u627e\u5230\u4e0b\u97622\u9879\uff0c\u628a no \u6539\u4e3a yes <pre><code>PermitRootLogin yes\nPasswordAuthentication yes\n</code></pre> The <code>range()</code> function is used to generate a sequence of numbers.</p>","tags":["SSH"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/","title":"K8s cluster -- kubeadm","text":"","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#prerequisition","title":"prerequisition:","text":"<ul> <li>3\u53f0\u670d\u52a1\u5668\u6216\u865a\u62df\u673a</li> <li>\u6700\u4f4e\u914d\u7f6e\uff1a2CPU\u30012GB Memory\u300120GB disk</li> <li>\u6700\u597d\u80fd\u8054\u7f51\uff0c\u4e0d\u80fd\u8054\u7f51\u9700\u8981\u6709\u63d0\u4f9b\u961f\u53cb\u955c\u50cf\u7684\u79c1\u6709\u4ed3\u5e93                              .</li> </ul>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#_1","title":"\u8f6f\u4ef6\u73af\u5883:","text":"<ul> <li>\u64cd\u4f5c\u7cfb\u7edf\uff1acentos7</li> <li>Docker\uff1a 20+</li> <li>k8s\uff1a1.23.6</li> </ul>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#_2","title":"\u5b89\u88c5\u6b65\u9aa4:","text":"1.  \u521d\u59cb\u64cd\u4f5c\uff08\u6240\u6709\u8282\u70b9\uff09 2.  \u5b89\u88c5\u57fa\u7840\u8f6f\u4ef6\uff08\u6240\u6709\u8282\u70b9\uff09 3.  \u90e8\u7f72kubernetes Master 4.  \u52a0\u5165kubernetes Node 5.  \u90e8\u7f72CNI\u7f51\u7edc\u63d2\u4ef6 5.  \u6d4b\u8bd5\u96c6\u7fa4 <pre><code># \u521b\u5efa\u90e8\u7f72\nkubectl create deployment nginx --image=nginx\n\n# \u66b4\u9732\u7aef\u53e3\nkubectl expose deployment nginx --port=80 --type=NodePort\n\n# \u67e5\u770b pod \u4ee5\u53ca\u670d\u52a1\u4fe1\u606f\nkubectl get pod,svc\n</code></pre> 6.  \u6d4b\u8bd5\u96c6\u7fa4 <ol> <li> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.consectetur adipiscing elitconsectetur adipiscing elit\u00a0\u21a9</p> </li> </ol>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#_3","title":"\u5173\u95ed\u9632\u706b\u5899","text":"<pre><code>systemctl stop firewalld\nsystemctl disable firewalld\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#selinux","title":"\u5173\u95edselinux","text":"<pre><code>sed -i 's/enforcing/disabled/' /etc/selinux/config  # \u6c38\u4e45\nsetenforce 0  # \u4e34\u65f6\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#swap","title":"\u5173\u95edswap","text":"<p><pre><code>swapoff -a  # \u4e34\u65f6\nsed -ri 's/.*swap.*/#&amp;/' /etc/fstab    # \u6c38\u4e45\n</code></pre> \u5173\u95ed\u5b8cswap\u540e\uff0c\u4e00\u5b9a\u8981\u91cd\u542f\u4e00\u4e0b\u865a\u62df\u673a\uff01\uff01\uff01</p>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#_4","title":"\u6839\u636e\u89c4\u5212\u8bbe\u7f6e\u4e3b\u673a\u540d","text":"<pre><code>hostnamectl set-hostname &lt;hostname&gt;\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#masterhosts","title":"\u5728master\u6dfb\u52a0hosts","text":"<pre><code>cat &gt;&gt; /etc/hosts &lt;&lt; EOF\n192.168.113.120 k8s-master\n192.168.113.121 k8s-node1\n192.168.113.122 k8s-node2\nEOF\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#ipv4iptables","title":"\u5c06\u6865\u63a5\u7684IPv4\u6d41\u91cf\u4f20\u9012\u5230iptables\u7684\u94fe","text":"<pre><code>cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n\nsysctl --system  # \u751f\u6548\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#_5","title":"\u65f6\u95f4\u540c\u6b65","text":"<pre><code>yum install ntpdate -y\nntpdate time.windows.com\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#docker","title":"\u57fa\u4e8e\u6587\u6863\u4e2d\u7684\u5b89\u88c5 Docker \u6587\u4ef6\u8fdb\u884c\u5b89\u88c5","text":"","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#uninstall-old-versions","title":"Uninstall old versions","text":"<p><code>sudo yum remove docker \\                 docker-client \\                 docker-client-latest \\                 docker-common \\                 docker-latest \\                 docker-latest-logrotate \\                 docker-logrotate \\                 docker-engine</code></p>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#set-up-the-repository","title":"Set up the repository","text":"<p><pre><code>sudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n</code></pre> \u672c\u5b9e\u9a8c\u6309\u88c5Docker 20+ <pre><code>[root@node1 yum.repos.d]# yum list docker-ce --showduplicates | sort -r\n* updates: mirrors.bupt.edu.cn\nLoading mirror speeds from cached hostfile\nLoaded plugins: fastestmirror\n* extras: mirrors.nju.edu.cn\ndocker-ce.x86_64            3:26.0.2-1.el7                      docker-ce-stable\ndocker-ce.x86_64            3:26.0.1-1.el7                      docker-ce-stable\n&lt;...&gt;\n[root@node1 yum.repos.d]#sudo yum install docker-ce-3:23.0.1-1.el7 docker-ce-cli-3:23.0.1-1.el7 containerd.io docker-buildx-plugin docker-compose-plugin\n</code></pre></p> <p>\u542f\u52a8docker \u51fa\u73b0 \u2018 Failed to start docker.service: Unit not found. \u2019 \u9519\u8bef ,\u56e0\u4e3a\u7f3a\u5c11 rhel-push-plugin.socket \u5355\u5143\uff0c\u8be5\u5355\u5143\u662frhel-push-plugin\u8f6f\u4ef6\u5305\u7684\u4e00\u90e8\u5206\u3002\u6240\u4ee5\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u6307\u4ee4\u5c31\u53ef\u4ee5\u6210\u529f\u89e3\u51b3curl -sSL https://get.docker.com/ | sh \u63d0\u793a\u3002\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684\u547d\u4ee4\u662f\uff1a sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</p>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#install-docker-engine","title":"Install Docker Engine","text":"","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#yum","title":"\u6dfb\u52a0\u963f\u91cc\u4e91yum\u6e90","text":"<pre><code>cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\n\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#kubeadmkubeletkubectl","title":"\u5b89\u88c5kubeadm/kubelet/kubectl","text":"<pre><code>yum install -y kubelet-1.23.6 kubeadm-1.23.6 kubectl-1.23.6\n\nsystemctl enable kubelet\n\n# \u914d\u7f6e\u5173\u95ed Docker \u7684 cgroups\uff0c\u4fee\u6539 /etc/docker/daemon.json\uff0c\u52a0\u5165\u4ee5\u4e0b\u5185\u5bb9\n\"exec-opts\": [\"native.cgroupdriver=systemd\"]\n\n# \u91cd\u542f docker\nsystemctl daemon-reload\nsystemctl restart docker\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#master","title":"\u5728 Master \u8282\u70b9\u4e0b\u6267\u884c","text":"<pre><code>kubeadm init \\\n--apiserver-advertise-address=10.0.0.10 \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--kubernetes-version v1.23.6 \\\n--service-cidr=192.168.0.0/20 \\\n--pod-network-cidr=192.168.0.0/16\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#_6","title":"\u5b89\u88c5\u6210\u529f\u540e\uff0c\u590d\u5236\u5982\u4e0b\u914d\u7f6e\u5e76\u6267\u884c","text":"<pre><code>mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\nkubectl get nodes\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#k8s-node1-k8s-node2","title":"\u5206\u522b\u5728 k8s-node1 \u548c k8s-node2 \u6267\u884c","text":"<pre><code># \u4e0b\u65b9\u547d\u4ee4\u53ef\u4ee5\u5728 k8s master \u63a7\u5236\u53f0\u521d\u59cb\u5316\u6210\u529f\u540e\u590d\u5236 join \u547d\u4ee4\n\nkubeadm join 172.26.120.200:6443 --token 152ar6.aag6akqgoiwjd5j1 \\\n--discovery-token-ca-cert-hash sha256:d708981fd0179a12cfb2c1062bf5a18a473cd8a5f269b8070d3eec10c70ac446 \n\n# \u5982\u679c\u521d\u59cb\u5316\u7684 token \u4e0d\u5c0f\u5fc3\u6e05\u7a7a\u4e86\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6\u6216\u8005\u91cd\u65b0\u7533\u8bf7\n# \u5982\u679c token \u5df2\u7ecf\u8fc7\u671f\uff0c\u5c31\u91cd\u65b0\u7533\u8bf7\n\nkubeadm token create\n\n# token \u6ca1\u6709\u8fc7\u671f\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6\nkubeadm token list\n\n# \u83b7\u53d6 --discovery-token-ca-cert-hash \u503c\uff0c\u5f97\u5230\u503c\u540e\u9700\u8981\u5728\u524d\u9762\u62fc\u63a5\u4e0a sha256:\nopenssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | \\\nopenssl dgst -sha256 -hex | sed 's/^.* //'\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#_7","title":"\u68c0\u67e5\u7ed3\u679c\u4fe1\u606f\u65b9\u6cd5\uff1a","text":"<pre><code>\u68c0\u67e5\u7ec4\u4ef6\uff1akubectl get componentstatus \u6216 kubectl get cs\n\u68c0\u67e5pod\u4fe1\u606f\uff1a\n[root@k8s-master ~]# kubectl get pods\nNo resources found in default namespace.\n\u67e5\u4e0d\u5230pod\u4fe1\u606f\u662f\u56e0\u4e3a\u547d\u540d\u7a7a\u95f4\u95ee\u9898\uff0c\u96c6\u7fa4\u521a\u521b\u5efa\u7684\u65f6\u5019\u4e0d\u662f\u653e\u5728\u9ed8\u8ba4namespace\uff0c\u5e94\u7528\uff1a\nkubectl get pods -n kube-system\n[root@k8s-master ~]# kubectl get pods -n kube-system\nNAME                                 READY   STATUS    RESTARTS   AGE\ncoredns-6d8c4cb4d-gzfgk              0/1     Pending   0          13m\ncoredns-6d8c4cb4d-mj4pn              0/1     Pending   0          13m\netcd-k8s-master                      1/1     Running   0          13m\nkube-apiserver-k8s-master            1/1     Running   0          13m\nkube-controller-manager-k8s-master   1/1     Running   0          13m\nkube-proxy-55xrt                     1/1     Running   0          10m\nkube-proxy-8brl5                     1/1     Running   0          12m\nkube-proxy-hlg99                     1/1     Running   0          13m\nkube-scheduler-k8s-master            1/1     Running   0          13m\n\u8fd9\u91cc\u53d1\u73b0coredns \u662fpending\u72b6\u6001\uff0c\u8fd9\u662f\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0\u5bfc\u81f4\u65e0\u6cd5\u4e0b\u8f7d\uff0c\u9700\u8981\u7ee7\u7eed\u4e0b\u9762\u6b65\u9aa45\u2193\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#master_1","title":"\u5728 master \u8282\u70b9\u4e0a\u6267\u884c","text":"<pre><code>## \u4e0b\u8f7d calico \u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u80fd\u4f1a\u7f51\u7edc\u8d85\u65f6\n\ncurl https://docs.projectcalico.org/manifests/calico.yaml -O\n\n\n# \u4fee\u6539 calico.yaml \u6587\u4ef6\u4e2d\u7684 CALICO_IPV4POOL_CIDR \u914d\u7f6e\uff0c\u4fee\u6539\u4e3a\u4e0e\u521d\u59cb\u5316\u7684 cidr \u76f8\u540c\n\n# \u4fee\u6539 IP_AUTODETECTION_METHOD \u4e0b\u7684\u7f51\u5361\u540d\u79f0\n\n# \u5220\u9664\u955c\u50cf docker.io/ \u524d\u7f00\uff0c\u907f\u514d\u4e0b\u8f7d\u8fc7\u6162\u5bfc\u81f4\u5931\u8d25\nsed -i 's#docker.io/##g' calico.yaml\n\n#\u6267\u884c\u8fd9\u4e2a\u6587\u4ef6calico.yaml\uff0c\u7528kubectl apply \uff0c\u56e0\u4e3a\u662f\u805a\u5408\u6587\u4ef6\uff0c\u6240\u6709\u7528apply\nkubectl apply -f calico.yaml\n\n#\u518d\u6b21\u67e5\u770bpod \uff0c\u7b49\u5f85\u51e0\u5206\u949f\u53d1\u73b0\u591a\u4e86pod\u4ee5\u53cacoredns \u4e5f\u597d\u4e86\nkubectl get po -n kube-system\n\n#\u73b0\u5728\u770b\u4e0b\u65b0\u7684pod\u5728\u5e72\u4ec0\u4e48\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/04/19/k8s-cluster----kubeadm/#_8","title":"\u6d4b\u8bd5\u96c6\u7fa4","text":"<pre><code># \u521b\u5efa\u90e8\u7f72\nkubectl create deployment nginx --image=nginx\n\n# \u66b4\u9732\u7aef\u53e3\nkubectl expose deployment nginx --port=80 --type=NodePort\n\n# \u67e5\u770b pod \u4ee5\u53ca\u670d\u52a1\u4fe1\u606f\nkubectl get pod,svc\n</code></pre>","tags":["k8s","kubeadm"]},{"location":"blog/2024/01/31/k8s-resources-classifcation/","title":"k8s Resources Classifcation","text":"","tags":["k8s"]},{"location":"blog/2024/01/31/k8s-resources-classifcation/#k8s","title":"k8s\u8d44\u6e90\u7684\u5206\u7c7b","text":"<p>\u5143\u7a7a\u95f4\u3001\u96c6\u7fa4\u3001\u547d\u540d\u7a7a\u95f4 </p>","tags":["k8s"]},{"location":"blog/2024/01/31/k8s-resources-classifcation/#_1","title":"\u7b80\u5355\u7684\u5206\u7c7b\u4e3a\u4ee5\u4e0b\u51e0\u79cd\u8d44\u6e90\u5bf9\u8c61\uff1a","text":"\u7c7b\u522b \u540d\u79f0 \u8d44\u6e90\u5bf9\u8c61 Pod\u3001ReplicaSet\u3001ReplicationController\u3001Deployment\u3001StatefulSet\u3001DaemonSet\u3001Job\u3001CronJob\u3001HorizontalPodAutoscaling\u3001Node\u3001Namespace\u3001Service\u3001Ingress\u3001Label\u3001CustomResourceDefinition \u5b58\u50a8\u5bf9\u8c61 Volume\u3001PersistentVolume\u3001Secret\u3001ConfigMap \u7b56\u7565\u5bf9\u8c61 SecurityContext\u3001ResourceQuota\u3001LimitRange \u8eab\u4efd\u5bf9\u8c61 ServiceAccount\u3001Role\u3001ClusterRole","tags":["k8s"]},{"location":"blog/2024/01/31/k8s-resources-classifcation/#k8sk8sresourcesmanifest","title":"K8SK8SResourcesManifest","text":"\u53c2\u6570\u540d \u7c7b\u578b \u5b57\u6bb5\u8bf4\u660e apiVersion String K8S APl \u7684\u7248\u672c\uff0c\u53ef\u4ee5\u7528 kubectl api versions \u547d\u4ee4\u67e5\u8be2 kind String yam \u6587\u4ef6\u5b9a\u4e49\u7684\u8d44\u6e90\u7c7b\u578b\u548c\u89d2\u8272 metadata Object \u5143\u6570\u636e\u5bf9\u8c61\uff0c\u4e0b\u9762\u662f\u5b83\u7684\u5c5e\u6027 metadata.name String \u5143\u6570\u636e\u5bf9\u8c61\u7684\u540d\u5b57\uff0c\u6bd4\u5982 pod \u7684\u540d\u5b57 metadata.namespace String \u5143\u6570\u636e\u5bf9\u8c61\u7684\u547d\u540d\u7a7a\u95f4 Spec Object \u8be6\u7ec6\u5b9a\u4e49\u5bf9\u8c61 spec.containers[] list \u5b9a\u4e49 Spec \u5bf9\u8c61\u7684\u5bb9\u5668\u5217\u8868 spec.containers[].name String \u4e3a\u5217\u8868\u4e2d\u7684\u67d0\u4e2a\u5bb9\u5668\u5b9a\u4e49\u540d\u79f0 spec.containers[].image String \u4e3a\u5217\u8868\u4e2d\u7684\u67d0\u4e2a\u5bb9\u5668\u5b9a\u4e49\u9700\u8981\u7684\u955c\u50cf\u540d\u79f0 spec.containers[].imagePullPolicy string \u5b9a\u4e49\u955c\u50cf\u62c9\u53d6\u7b56\u7565\uff0c\u6709 Always\u3001Never\u3001IfNotPresent \u4e09\u4e2a\u503c\u53ef\u9009  - Always\uff08\u9ed8\u8ba4\uff09\uff1a\u610f\u601d\u662f\u6bcf\u6b21\u90fd\u5c1d\u8bd5\u91cd\u65b0\u62c9\u53d6\u955c\u50cf  - Never\uff1a\u8868\u793a\u4ec5\u9002\u7528\u672c\u5730\u955c\u50cf  - IfNotPresent\uff1a\u5982\u679c\u672c\u5730\u6709\u955c\u50cf\u5c31\u4f7f\u7528\u672c\u5730\u955c\u50cf\uff0c\u6ca1\u6709\u5c31\u62c9\u53d6\u5728\u7ebf\u955c\u50cf\u3002 spec.containers[].command[] list \u6307\u5b9a\u5bb9\u5668\u542f\u52a8\u547d\u4ee4\uff0c\u56e0\u4e3a\u662f\u6570\u7ec4\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\uff0c\u4e0d\u6307\u5b9a\u5219\u4f7f\u7528\u955c\u50cf\u6253\u5305\u65f6\u4f7f\u7528\u7684\u542f\u52a8\u547d\u4ee4\u3002 spec.containers[].args[] list \u6307\u5b9a\u5bb9\u5668\u542f\u52a8\u547d\u4ee4\u53c2\u6570\uff0c\u56e0\u4e3a\u662f\u6570\u7ec4\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u3002 spec.containers[].workingDir string \u6307\u5b9a\u5bb9\u5668\u7684\u5de5\u4f5c\u76ee\u5f55 spec.containers[].volumeMounts[] list \u6307\u5b9a\u5bb9\u5668\u5185\u90e8\u7684\u5b58\u50a8\u5377\u914d\u7f6e spec.containers[].volumeMounts[].name string \u6307\u5b9a\u53ef\u4ee5\u88ab\u5bb9\u5668\u6302\u8f7d\u7684\u5b58\u50a8\u5377\u7684\u540d\u79f0 spec.containers[].volumeMounts[].mountPath string \u6307\u5b9a\u53ef\u4ee5\u88ab\u5bb9\u5668\u6302\u8f7d\u7684\u5b58\u50a8\u5377\u7684\u8def\u5f84 spec.containers[].volumeMounts[].readOnly string \u8bbe\u7f6e\u5b58\u50a8\u5377\u8def\u5f84\u7684\u8bfb\u5199\u6a21\u5f0f\uff0cture \u6216\u8005 false\uff0c\u9ed8\u8ba4\u662f\u8bfb\u5199\u6a21\u5f0f spec.containers[].ports[] list \u6307\u5b9a\u5bb9\u5668\u9700\u8981\u7528\u5230\u7684\u7aef\u53e3\u5217\u8868 spec.containers[].ports[].name string \u6307\u5b9a\u7aef\u53e3\u7684\u540d\u79f0 spec.containers[].ports[].containerPort string \u6307\u5b9a\u5bb9\u5668\u9700\u8981\u76d1\u542c\u7684\u7aef\u53e3\u53f7 spec.containers[].ports[].hostPort string \u6307\u5b9a\u5bb9\u5668\u6240\u5728\u4e3b\u673a\u9700\u8981\u76d1\u542c\u7684\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u8ddf\u4e0a\u9762 containerPort \u76f8\u540c\uff0c\u6ce8\u610f\u8bbe\u7f6e\u4e86 hostPort \u540c\u4e00\u53f0\u4e3b\u673a\u65e0\u6cd5\u542f\u52a8\u8be5\u5bb9\u5668\u7684\u76f8\u540c\u526f\u672c\uff08\u56e0\u4e3a\u4e3b\u673a\u7684\u7aef\u53e3\u53f7\u4e0d\u80fd\u76f8\u540c\uff0c\u8fd9\u6837\u4f1a\u51b2\u7a81\uff09 spec.containers[].ports[].protocol string \u6307\u5b9a\u7aef\u53e3\u534f\u8bae\uff0c\u652f\u6301 TCP \u548c UDP\uff0c\u9ed8\u8ba4\u503c\u4e3a TCP spec.containers[].env[] list \u6307\u5b9a\u5bb9\u5668\u8fd0\u884c\u524d\u9700\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf\u5217\u8868 spec.containers[].env[].name string \u6307\u5b9a\u73af\u5883\u53d8\u91cf\u540d\u79f0 spec.containers[].env[].value string \u6307\u5b9a\u73af\u5883\u53d8\u91cf\u503c spec.containers[].resources Object \u6307\u5b9a\u8d44\u6e90\u9650\u5236\u548c\u8d44\u6e90\u8bf7\u6c42\u7684\u503c\uff08\u8fd9\u91cc\u5f00\u59cb\u5c31\u662f\u8bbe\u7f6e\u5bb9\u5668\u7684\u8d44\u6e90\u4e0a\u9650\uff09 spec.containers[].resources.limits Object \u6307\u5b9a\u8bbe\u7f6e\u5bb9\u5668\u8fd0\u884c\u65f6\u8d44\u6e90\u7684\u8fd0\u884c\u4e0a\u9650 spec.containers[].resources.limits.cpu string \u6307\u5b9a CPU \u7684\u9650\u5236\uff0c\u5355\u4f4d\u4e3a Core \u6570\uff0c\u5c06\u7528\u4e8e docker run \u2013cpu-shares \u53c2\u6570 spec.containers[].resources.limits.memory string \u6307\u5b9a mem \u5185\u5b58\u7684\u9650\u5236\uff0c\u5355\u4f4d\u4e3a MIB\u3001GiB spec.containers[].resources.requests Object \u6307\u5b9a\u5bb9\u5668\u542f\u52a8\u548c\u8c03\u5ea6\u65f6\u7684\u9650\u5236\u8bbe\u7f6e spec.containers[].resources.requests.cpu string CPU\u8bf7\u6c42\uff0c\u5355\u4f4d\u4e3acore\u6570\uff0c\u5bb9\u5668\u542f\u52a8\u65f6\u521d\u59cb\u5316\u53ef\u7528\u6570\u91cf spec.containers[].resources.requests.memory string \u5185\u5b58\u8bf7\u6c42\uff0c\u5355\u4f4d\u4e3aMIB\u3001GiB\uff0c\u5bb9\u5668\u542f\u52a8\u7684\u521d\u59cb\u5316\u53ef\u7528\u6570\u91cf spec.restartPolicy string \u5b9a\u4e49 pod \u7684\u91cd\u542f\u7b56\u7565\uff0c\u53ef\u9009\u503c\u4e3a Always\u3001OnFailure\u3001Never\uff0c\u9ed8\u8ba4\u503c\u4e3a Always\u3002  - Always\uff1apod \u4e00\u65e6\u7ec8\u6b62\u8fd0\u884c\uff0c\u5219\u65e0\u8bba\u5bb9\u5668\u662f\u5982\u4f55\u7ec8\u6b62\u7684\uff0ckubelet \u670d\u52a1\u90fd\u5c06\u91cd\u542f\u5b83\u3002  - OnFailure\uff1a\u53ea\u6709 pod \u4ee5\u975e\u96f6\u9000\u51fa\u7801\u7ec8\u6b62\u65f6\uff0ckubelet \u624d\u4f1a\u91cd\u542f\u8be5\u5bb9\u5668\u3002\u5982\u679c\u5bb9\u5668\u6b63\u5e38\u7ed3\u675f\uff08\u9000\u51fa\u7801\u4e3a0\uff09\uff0c\u5219 kubectl \u5c06\u4e0d\u4f1a\u91cd\u542f\u5b83\u3002  - Never\uff1aPod \u7ec8\u6b62\u540e\uff0ckubelet \u5c06\u9000\u51fa\u7801\u62a5\u544a\u7ed9 master\uff0c\u4e0d\u4f1a\u91cd\u542f\u8be5 pod spec.nodeSelector Object \u5b9a\u4e49 Node \u7684 label \u8fc7\u6ee4\u6807\u7b7e\uff0c\u4ee5 key\uff1avalue \u683c\u5f0f\u6307\u5b9a spec.imagePullSecrets Object \u5b9a\u4e49 pull \u955c\u50cf\u65f6\u4f7f\u7528 secret \u540d\u79f0\uff0c\u4ee5 name\uff1asecretkey \u683c\u5f0f\u6307\u5b9a spec.hostNetwork Boolean \u5b9a\u4e49\u662f\u5426\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u503c\u4e3a false\u3002\u8bbe\u7f6e true \u8868\u793a\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc\uff0c\u4e0d\u4f7f\u7528 docker \u7f51\u6865\uff0c\u540c\u65f6\u8bbe\u7f6e\u4e86 true\u5c06\u65e0\u6cd5\u5728\u540c\u4e00\u53f0\u5bbf\u4e3b\u673a\u4e0a\u542f\u52a8\u7b2c\u4e8c\u4e2a\u526f\u672c","tags":["k8s"]},{"location":"blog/2024/01/31/k8s-resources-classifcation/#_2","title":"\u5bf9\u8c61","text":"<p>\u4ee5\u4e0b\u5217\u4e3e\u7684\u5185\u5bb9\u90fd\u662f Kubernetes \u4e2d\u7684\u5bf9\u8c61\uff08Object\uff09\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u90fd\u53ef\u4ee5\u5728 YAML \u6587\u4ef6\u4e2d\u4f5c\u4e3a\u4e00\u79cd API \u7c7b\u578b\u6765\u914d\u7f6e\u3002</p> <ul> <li>Pod</li> <li>Node</li> <li>Namespace</li> <li>Service</li> <li>Volume</li> <li>PersistentVolume</li> <li>Deployment</li> <li>Secret</li> <li>StatefulSet</li> <li>DaemonSet</li> <li>ServiceAccount</li> <li>ReplicationController</li> <li>ReplicaSet</li> <li>Job</li> <li>CronJob</li> <li>SecurityContext</li> <li>ResourceQuota</li> <li>LimitRange</li> <li>HorizontalPodAutoscaling</li> <li>Ingress</li> <li>ConfigMap</li> <li>Label</li> <li>CustomResourceDefinition</li> <li>Role</li> <li>ClusterRole</li> </ul>","tags":["k8s"]},{"location":"blog/2024/04/26/k8s-daemonset/","title":"k8s DaemonSet","text":"","tags":["DaemonSet"]},{"location":"blog/2024/04/26/k8s-daemonset/#node","title":"\u6307\u5b9aNode\u8282\u70b9","text":"","tags":["DaemonSet"]},{"location":"blog/2024/04/26/k8s-daemonset/#nodeselector","title":"nodeSelector","text":"<p>\u5148\u4e3a Node \u6253\u4e0a\u6807\u7b7e <pre><code>kubectl label nodes k8s-node1 svc_type=microsvc\n</code></pre></p> <p>\u7136\u540e\u518d daemonset \u914d\u7f6e\u4e2d\u8bbe\u7f6e nodeSelector <pre><code>spec:\n  template:\n    spec:\n      nodeSelector:\n        svc_type: microsvc\n</code></pre></p>","tags":["DaemonSet"]},{"location":"blog/2024/04/26/k8s-daemonset/#nodeaffinity","title":"nodeAffinity","text":"<p>nodeAffinity \u76ee\u524d\u652f\u6301\u4e24\u79cd\uff1arequiredDuringSchedulingIgnoredDuringExecution \u548c preferredDuringSchedulingIgnoredDuringExecution\uff0c\u5206\u522b\u4ee3\u8868\u5fc5\u987b\u6ee1\u8db3\u6761\u4ef6\u548c\u4f18\u9009\u6761\u4ef6\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u7684\u4f8b\u5b50\u4ee3\u8868\u8c03\u5ea6\u5230\u5305\u542b\u6807\u7b7e wolfcode.cn/framework-name \u5e76\u4e14\u503c\u4e3a spring \u6216 springboot \u7684 Node \u4e0a\uff0c\u5e76\u4e14\u4f18\u9009\u8fd8\u5e26\u6709\u6807\u7b7e another-node-label-key=another-node-label-value \u7684Node\u3002</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: with-node-affinity\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: wolfcode.cn/framework-name\n            operator: In\n            values:\n            - spring\n            - springboot\n      preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: 1\n        preference:\n          matchExpressions:\n          - key: another-node-label-key\n            operator: In\n            values:\n            - another-node-label-value\n  containers:\n  - name: with-node-affinity\n    image: pauseyyf/pause\n</code></pre>","tags":["DaemonSet"]},{"location":"blog/2024/04/26/k8s-daemonset/#podaffinity","title":"podAffinity","text":"<p>podAffinity \u57fa\u4e8e Pod \u7684\u6807\u7b7e\u6765\u9009\u62e9 Node\uff0c\u4ec5\u8c03\u5ea6\u5230\u6ee1\u8db3\u6761\u4ef6Pod \u6240\u5728\u7684 Node \u4e0a\uff0c\u652f\u6301 podAffinity \u548c podAntiAffinity\u3002\u8fd9\u4e2a\u529f\u80fd\u6bd4\u8f83\u7ed5\uff0c\u4ee5\u4e0b\u9762\u7684\u4f8b\u5b50\u4e3a\u4f8b\uff1a \u5982\u679c\u4e00\u4e2a \u201cNode \u6240\u5728\u7a7a\u95f4\u4e2d\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u5e26\u6709 auth=oauth2 \u6807\u7b7e\u4e14\u8fd0\u884c\u4e2d\u7684 Pod\u201d\uff0c\u90a3\u4e48\u53ef\u4ee5\u8c03\u5ea6\u5230\u8be5 Node \u4e0d\u8c03\u5ea6\u5230 \u201c\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u5e26\u6709 auth=jwt \u6807\u7b7e\u4e14\u8fd0\u884c\u4e2d Pod\u201d\u7684 Node \u4e0a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: with-pod-affinity\nspec:\n  affinity:\n    podAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n      - labelSelector:\n          matchExpressions:\n          - key: auth\n            operator: In\n            values:\n            - oauth2\n        topologyKey: failure-domain.beta.kubernetes.io/zone\n    podAntiAffinity:\n      preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: 100\n        podAffinityTerm:\n          labelSelector:\n            matchExpressions:\n            - key: auth\n              operator: In\n              values:\n              - jwt\n          topologyKey: kubernetes.io/hostname\n  containers:\n  - name: with-pod-affinity\n    image: pauseyyf/pause\n</code></pre>","tags":["DaemonSet"]},{"location":"blog/2024/04/26/k8s-daemonset/#_1","title":"\u6eda\u52a8\u66f4\u65b0","text":"<p>\u4e0d\u5efa\u8bae\u4f7f\u7528 RollingUpdate\uff0c\u5efa\u8bae\u4f7f\u7528 OnDelete \u6a21\u5f0f\uff0c\u8fd9\u6837\u907f\u514d\u9891\u7e41\u66f4\u65b0 ds</p>","tags":["DaemonSet"]},{"location":"blog/2024/04/26/k8s-daemonset/#_2","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>apiVersion: apps/v1\nkind: DaemonSet  #\u521b\u5efadaemonset\u8d44\u6e90\nmetadata:\n  name: fluentd  #daemonset\u540d\u79f0\nspec:\n  selector:\n    matchLabels:\n      app: logging\n  template:\n    metadata:\n      labels:\n        app: logging\n        id: fluentd\n      name: fluentd  #pod \u540d\u79f0\n    spec:\n      containers:\n      - name: fluentd-es\n        image: agilestacks/fluentd-elasticsearch:v1.3.0\n        env:  #\u914d\u7f6e\u73af\u5883\u53d8\u91cf\n         - name: FLUENTD_ARGS #\u73af\u5883\u53d8\u91cf\u7684key\n           value: -qq  #\u73af\u5883\u53d8\u91cf\u7684value\n        volumeMounts:  #\u52a0\u8f7d\u6570\u636e\u5377\uff0c\u907f\u514d\u6570\u636e\u4e22\u5931\uff0c\u6302\u8f7d\u518d\u5bb9\u5668\u5185\n         - name: containers  #\u5377\u540d\n           mountPath: /var/lib/docker/containers #\u628a\u6570\u636e\u5377\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u7684\u90a3\u4e2a\u76ee\u5f55\n         - name: varlog  #\u5377\u540d\n           mountPath: /varlog   #\u628a\u6570\u636e\u5377\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u7684\u90a3\u4e2a\u76ee\u5f55\n      volumes:  #\u5b9a\u4e49\u6570\u636e\u5377\n         - hostPath: #\u6570\u636e\u5377\u7c7b\u578b\uff0c\u4e3b\u673a\u8def\u5f84\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u4e0enode\u5171\u4eab\u76ee\u5f55\n             path: /var/lib/docker/containers  #node\u4e2d\u7684\u5171\u4eab\u76ee\u5f55\n           name: containers  #\u5377\u540d\n         - hostPath:  #\u6570\u636e\u5377\u7c7b\u578b\uff0c\u4e3b\u673a\u8def\u5f84\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u4e0enode\u5171\u4eab\u76ee\u5f55\n             path: /var/log  #node\u4e2d\u7684\u5171\u4eab\u76ee\u5f55\n           name: varlog  #\u5377\u540d\n</code></pre>","tags":["DaemonSet"]},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/","title":"K8s Storage NFS Volumes","text":""},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/#nfs","title":"\u5b89\u88c5nfs","text":""},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/#nfs_1","title":"\u5b89\u88c5 nfs","text":"<pre><code>yum install nfs-utils -y\n</code></pre>"},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/#nfs_2","title":"\u542f\u52a8 nfs","text":"<pre><code>systemctl start nfs-server\n</code></pre>"},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/#nfs_3","title":"\u67e5\u770b nfs \u7248\u672c","text":"<pre><code>cat /proc/fs/nfsd/versions\n</code></pre>"},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/#_1","title":"\u521b\u5efa\u5171\u4eab\u76ee\u5f55","text":"<pre><code>mkdir -p /data/nfs\ncd /data/nfs\nmkdir rw\nmkdir ro\n</code></pre>"},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/#export","title":"\u8bbe\u7f6e\u5171\u4eab\u76ee\u5f55 export","text":"<pre><code>vim /etc/exports\n/data/nfs/rw 192.168.113.0/24(rw,sync,no_subtree_check,no_root_squash)\n/data/nfs/ro 192.168.113.0/24(ro,sync,no_subtree_check,no_root_squash)\n</code></pre>"},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/#_2","title":"\u91cd\u65b0\u52a0\u8f7d","text":"<pre><code>exportfs -f\nsystemctl reload nfs-server\n</code></pre>"},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/#nfs-utils","title":"\u5230\u5176\u4ed6\u6d4b\u8bd5\u8282\u70b9\u5b89\u88c5 nfs-utils \u5e76\u52a0\u8f7d\u6d4b\u8bd5","text":"<pre><code>mkdir -p /mnt/nfs/rw\nmount -t nfs 192.168.113.121:/data/nfs/rw /mnt/nfs/rw\n</code></pre>"},{"location":"blog/2024/04/27/k8s-storage-nfs-volumes/#_3","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-pd\nspec:\n  containers:\n  - image: nginx\n    name: test-container\n    volumeMounts:\n    - mountPath: /my-nfs-data\n      name: test-volume\n  volumes:\n  - name: test-volume\n    nfs:\n      server: my-nfs-server.example.com # \u7f51\u7edc\u5b58\u50a8\u670d\u52a1\u5730\u5740\n      path: /my-nfs-volume # \u7f51\u7edc\u5b58\u50a8\u8def\u5f84\n      readOnly: true # \u662f\u5426\u53ea\u8bfb\n</code></pre>"},{"location":"blog/2024/04/29/k8s-schedule/","title":"K8s Schedule","text":""},{"location":"blog/2024/04/29/k8s-schedule/#cronjob","title":"CronJob\u8ba1\u5212\u4efb\u52a1","text":""},{"location":"blog/2024/04/29/k8s-schedule/#cron","title":"Cron\u8868\u8fbe\u5f0f","text":"<pre><code># \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5206\u949f (0 - 59)\n# \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5c0f\u65f6 (0 - 23)\n# \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u6708\u7684\u67d0\u5929 (1 - 31)\n# \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u6708\u4efd (1 - 12)\n# \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5468\u7684\u67d0\u5929 (0 - 6)\uff08\u5468\u65e5\u5230\u5468\u4e00\uff1b\u5728\u67d0\u4e9b\u7cfb\u7edf\u4e0a\uff0c7 \u4e5f\u662f\u661f\u671f\u65e5\uff09\n# \u2502 \u2502 \u2502 \u2502 \u2502                          \u6216\u8005\u662f sun\uff0cmon\uff0ctue\uff0cweb\uff0cthu\uff0cfri\uff0csat\n# \u2502 \u2502 \u2502 \u2502 \u2502\n# \u2502 \u2502 \u2502 \u2502 \u2502\n# * * * * *\n</code></pre>"},{"location":"blog/2024/04/29/k8s-schedule/#_1","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p><pre><code>apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: hello\nspec:\n  concurrencyPolicy: Allow # \u5e76\u53d1\u8c03\u5ea6\u7b56\u7565\uff1aAllow \u5141\u8bb8\u5e76\u53d1\u8c03\u5ea6\uff0cForbid\uff1a\u4e0d\u5141\u8bb8\u5e76\u53d1\u6267\u884c\uff0cReplace\uff1a\u5982\u679c\u4e4b\u524d\u7684\u4efb\u52a1\u8fd8\u6ca1\u6267\u884c\u5b8c\uff0c\u5c31\u76f4\u63a5\u6267\u884c\u65b0\u7684\uff0c\u653e\u5f03\u4e0a\u4e00\u4e2a\u4efb\u52a1\n  failedJobsHistoryLimit: 1 # \u4fdd\u7559\u591a\u5c11\u4e2a\u5931\u8d25\u7684\u4efb\u52a1\n  successfulJobsHistoryLimit: 3 # \u4fdd\u7559\u591a\u5c11\u4e2a\u6210\u529f\u7684\u4efb\u52a1\n  suspend: false # \u662f\u5426\u6302\u8d77\u4efb\u52a1\uff0c\u82e5\u4e3a true \u5219\u8be5\u4efb\u52a1\u4e0d\u4f1a\u6267\u884c\n#  startingDeadlineSeconds: 30 # \u95f4\u9694\u591a\u957f\u65f6\u95f4\u68c0\u6d4b\u5931\u8d25\u7684\u4efb\u52a1\u5e76\u91cd\u65b0\u6267\u884c\uff0c\u65f6\u95f4\u4e0d\u80fd\u5c0f\u4e8e 10\n  schedule: \"* * * * *\" # \u8c03\u5ea6\u7b56\u7565\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          containers:\n          - name: hello\n            image: busybox:1.28\n            imagePullPolicy: IfNotPresent\n            command:\n            - /bin/sh\n            - -c\n            - date; echo Hello from the Kubernetes cluster\n          restartPolicy: OnFailure\n</code></pre> \u67e5\u770bcronjob\u4fe1\u606f\uff1a <pre><code>kubectl get cronjob\nkubectl get cj\n</code></pre> \u67e5\u770b\u65e5\u5fd7\u4fe1\u606f\uff1a <pre><code>kubectl logs -f &lt;pod-name&gt;\n</code></pre></p>"},{"location":"blog/2024/04/29/k8s-schedule/#initcontainer","title":"\u521d\u59cb\u5316\u5bb9\u5668InitContainer","text":"<pre><code>\u5728\u771f\u6b63\u7684\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\uff0c\u5148\u542f\u52a8 InitContainer\uff0c\u5728\u521d\u59cb\u5316\u5bb9\u5668\u4e2d\u5b8c\u6210\u771f\u5b9e\u5bb9\u5668\u6240\u9700\u7684\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u5b8c\u6210\u540e\u518d\u542f\u52a8\u771f\u5b9e\u7684\u5bb9\u5668\u3002\n\n\u76f8\u5bf9\u4e8e postStart \u6765\u8bf4\uff0c\u9996\u5148 InitController \u80fd\u591f\u4fdd\u8bc1\u4e00\u5b9a\u5728 EntryPoint \u4e4b\u524d\u6267\u884c\uff0c\u800c postStart \u4e0d\u80fd\uff0c\u5176\u6b21 postStart \u66f4\u9002\u5408\u53bb\u6267\u884c\u4e00\u4e9b\u547d\u4ee4\u64cd\u4f5c\uff0c\u800c InitController \u5b9e\u9645\u5c31\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u53ef\u4ee5\u5728\u5176\u4ed6\u57fa\u7840\u5bb9\u5668\u73af\u5883\u4e0b\u6267\u884c\u66f4\u590d\u6742\u7684\u521d\u59cb\u5316\u529f\u80fd\u3002\n\n\u5728 pod \u521b\u5efa\u7684\u6a21\u677f\u4e2d\u914d\u7f6e initContainers \u53c2\u6570\uff1a\nspec:\n  initContainers:\n  - image: nginx\n    imagePullPolicy: IfNotPresent\n    command: [\"sh\", \"-c\", \"echo 'inited;' &gt;&gt; ~/.init\"]\n    name: init-test\n</code></pre>"},{"location":"blog/2024/04/29/k8s-schedule/#_2","title":"\u6c61\u70b9\u548c\u5bb9\u5fcd","text":"<p>k8s \u96c6\u7fa4\u4e2d\u53ef\u80fd\u7ba1\u7406\u7740\u975e\u5e38\u5e9e\u5927\u7684\u670d\u52a1\u5668\uff0c\u8fd9\u4e9b\u670d\u52a1\u5668\u53ef\u80fd\u662f\u5404\u79cd\u5404\u6837\u4e0d\u540c\u7c7b\u578b\u7684\uff0c\u6bd4\u5982\u673a\u623f\u3001\u5730\u7406\u4f4d\u7f6e\u3001\u914d\u7f6e\u7b49\uff0c\u6709\u4e9b\u662f\u8ba1\u7b97\u578b\u8282\u70b9\uff0c\u6709\u4e9b\u662f\u5b58\u50a8\u578b\u8282\u70b9\uff0c\u6b64\u65f6\u6211\u4eec\u5e0c\u671b\u80fd\u66f4\u597d\u7684\u5c06 pod \u8c03\u5ea6\u5230\u4e0e\u4e4b\u9700\u6c42\u66f4\u5339\u914d\u7684\u8282\u70b9\u4e0a\u3002</p> <p>\u6b64\u65f6\u5c31\u9700\u8981\u7528\u5230\u6c61\u70b9\uff08Taint\uff09\u548c\u5bb9\u5fcd\uff08Toleration\uff09\uff0c\u8fd9\u4e9b\u914d\u7f6e\u90fd\u662f key: value \u7c7b\u578b\u7684\u3002</p>"},{"location":"blog/2024/04/29/k8s-schedule/#taint","title":"\u6c61\u70b9Taint","text":"<p>\u6c61\u70b9\uff1a\u662f\u6807\u6ce8\u5728\u8282\u70b9\u4e0a\u7684\uff0c\u5f53\u6211\u4eec\u5728\u4e00\u4e2a\u8282\u70b9\u4e0a\u6253\u4e0a\u6c61\u70b9\u4ee5\u540e\uff0ck8s \u4f1a\u8ba4\u4e3a\u5c3d\u91cf\u4e0d\u8981\u5c06 pod \u8c03\u5ea6\u5230\u8be5\u8282\u70b9\u4e0a\uff0c\u9664\u975e\u8be5 pod \u4e0a\u9762\u8868\u793a\u53ef\u4ee5\u5bb9\u5fcd\u8be5\u6c61\u70b9\uff0c\u4e14\u4e00\u4e2a\u8282\u70b9\u53ef\u4ee5\u6253\u591a\u4e2a\u6c61\u70b9\uff0c\u6b64\u65f6\u5219\u9700\u8981 pod \u5bb9\u5fcd\u6240\u6709\u6c61\u70b9\u624d\u4f1a\u88ab\u8c03\u5ea6\u8be5\u8282\u70b9\u3002</p> <ul> <li> <p>\u4e3a\u8282\u70b9\u6253\u4e0a\u6c61\u70b9 <code>kubectl taint node k8s-master key=value:NoSchedule</code></p> </li> <li> <p>\u79fb\u9664\u6c61\u70b9 <code>kubectl taint node k8s-master key=value:NoSchedule-</code></p> </li> <li> <p>\u67e5\u770b\u6c61\u70b9 <code>kubectl describe no k8s-master</code></p> </li> <li> <p>\u6c61\u70b9\u7684\u5f71\u54cd\uff1a NoSchedule\uff1a\u4e0d\u80fd\u5bb9\u5fcd\u7684 pod \u4e0d\u80fd\u88ab\u8c03\u5ea6\u5230\u8be5\u8282\u70b9\uff0c\u4f46\u662f\u5df2\u7ecf\u5b58\u5728\u7684\u8282\u70b9\u4e0d\u4f1a\u88ab\u9a71\u9010 NoExecute\uff1a\u4e0d\u80fd\u5bb9\u5fcd\u7684\u8282\u70b9\u4f1a\u88ab\u7acb\u5373\u6e05\u9664\uff0c\u80fd\u5bb9\u5fcd\u4e14\u6ca1\u6709\u914d\u7f6e tolerationSeconds \u5c5e\u6027\uff0c\u5219\u53ef\u4ee5\u4e00\u76f4\u8fd0\u884c\uff0c\u8bbe\u7f6e\u4e86 tolerationSeconds: 3600 \u5c5e\u6027\uff0c\u5219\u8be5 pod \u8fd8\u80fd\u7ee7\u7eed\u5728\u8be5\u8282\u70b9\u8fd0\u884c 3600 \u79d2</p> </li> </ul>"},{"location":"blog/2024/04/29/k8s-schedule/#noschedule","title":"NoSchedule","text":"<p>\u5982\u679c\u4e0d\u80fd\u5bb9\u5fcd\u8be5\u6c61\u70b9\uff0c\u90a3\u4e48 Pod \u5c31\u65e0\u6cd5\u8c03\u5ea6\u5230\u8be5\u8282\u70b9\u4e0a</p>"},{"location":"blog/2024/04/29/k8s-schedule/#noexecute","title":"NoExecute","text":"<ul> <li>\u5982\u679c Pod \u4e0d\u80fd\u5fcd\u53d7\u8fd9\u7c7b\u6c61\u70b9\uff0cPod \u4f1a\u9a6c\u4e0a\u88ab\u9a71\u9010\u3002</li> <li>\u5982\u679c Pod \u80fd\u591f\u5fcd\u53d7\u8fd9\u7c7b\u6c61\u70b9\uff0c\u4f46\u662f\u5728\u5bb9\u5fcd\u5ea6\u5b9a\u4e49\u4e2d\u6ca1\u6709\u6307\u5b9a tolerationSeconds\uff0c \u5219 Pod \u8fd8\u4f1a\u4e00\u76f4\u5728\u8fd9\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u3002</li> <li>\u5982\u679c Pod \u80fd\u591f\u5fcd\u53d7\u8fd9\u7c7b\u6c61\u70b9\uff0c\u800c\u4e14\u6307\u5b9a\u4e86 tolerationSeconds\uff0c \u5219 Pod \u8fd8\u80fd\u5728\u8fd9\u4e2a\u8282\u70b9\u4e0a\u7ee7\u7eed\u8fd0\u884c\u8fd9\u4e2a\u6307\u5b9a\u7684\u65f6\u95f4\u957f\u5ea6\u3002</li> </ul>"},{"location":"blog/2024/04/29/k8s-schedule/#toleration","title":"\u5bb9\u5fcdToleration","text":"<p>\u5bb9\u5fcd\uff1a\u662f\u6807\u6ce8\u5728 pod \u4e0a\u7684\uff0c\u5f53 pod \u88ab\u8c03\u5ea6\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u5bb9\u5fcd\uff0c\u5219\u8be5 pod \u4e0d\u4f1a\u88ab\u8c03\u5ea6\u5230\u6709\u6c61\u70b9\u7684\u8282\u70b9\u4e0a\uff0c\u53ea\u6709\u8be5 pod \u4e0a\u6807\u6ce8\u4e86\u6ee1\u8db3\u67d0\u4e2a\u8282\u70b9\u7684\u6240\u6709\u6c61\u70b9\uff0c\u5219\u4f1a\u88ab\u8c03\u5ea6\u5230\u8fd9\u4e9b\u8282\u70b9</p> <ul> <li>pod \u7684 spec \u4e0b\u9762\u914d\u7f6e\u5bb9\u5fcd <pre><code>tolerations:\n- key: \"\u6c61\u70b9\u7684 key\"\n  value: \"\u6c61\u70b9\u7684 value\"\n  offect: \"NoSchedule\" # \u6c61\u70b9\u4ea7\u751f\u7684\u5f71\u54cd\n  operator: \"Equal\" # \u8868\u662f value \u4e0e\u6c61\u70b9\u7684 value \u8981\u76f8\u7b49\uff0c\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u4e3a Exists \u8868\u793a\u5b58\u5728 key \u5373\u53ef\uff0c\u6b64\u65f6\u53ef\u4ee5\u4e0d\u7528\u914d\u7f6e value\n</code></pre></li> </ul>"},{"location":"blog/2024/04/29/k8s-schedule/#equal","title":"Equal","text":"<p>\u6bd4\u8f83\u64cd\u4f5c\u7c7b\u578b\u4e3a Equal\uff0c\u5219\u610f\u5473\u7740\u5fc5\u987b\u4e0e\u6c61\u70b9\u503c\u505a\u5339\u914d\uff0ckey/value\u90fd\u5fc5\u987b\u76f8\u540c\uff0c\u624d\u8868\u793a\u80fd\u591f\u5bb9\u5fcd\u8be5\u6c61\u70b9</p>"},{"location":"blog/2024/04/29/k8s-schedule/#exists","title":"Exists","text":"<p>\u5bb9\u5fcd\u4e0e\u6c61\u70b9\u7684\u6bd4\u8f83\u53ea\u6bd4\u8f83 key\uff0c\u4e0d\u6bd4\u8f83 value\uff0c\u4e0d\u5173\u5fc3 value \u662f\u4ec0\u4e48\u4e1c\u897f\uff0c\u53ea\u8981 key \u5b58\u5728\uff0c\u5c31\u8868\u793a\u53ef\u4ee5\u5bb9\u5fcd\u3002</p>"},{"location":"blog/2024/04/29/k8s-schedule/#affinity","title":"\u4eb2\u548c\u529bAffinity","text":""},{"location":"blog/2024/04/29/k8s-schedule/#nodeaffinity","title":"NodeAffinity","text":"<p>\u8282\u70b9\u4eb2\u548c\u529b\uff1a\u8fdb\u884c pod \u8c03\u5ea6\u65f6\uff0c\u4f18\u5148\u8c03\u5ea6\u5230\u7b26\u5408\u6761\u4ef6\u7684\u4eb2\u548c\u529b\u8282\u70b9\u4e0a</p>"},{"location":"blog/2024/04/29/k8s-schedule/#requiredduringschedulingignoreduringexecution","title":"RequiredDuringSchedulingIgnoreDuringExecution","text":""},{"location":"blog/2024/04/29/k8s-schedule/#preferredduringschedulingignoredduringexecution","title":"PreferredDuringSchedulingIgnoredDuringExecution","text":""},{"location":"blog/2024/04/29/k8s-schedule/#_3","title":"\u5e94\u7528","text":""},{"location":"blog/2024/04/29/k8s-schedule/#_4","title":"\u5339\u914d\u7c7b\u578b","text":""},{"location":"blog/2024/04/29/k8s-schedule/#in","title":"In","text":"<p>\u90e8\u7f72\u5728\u6ee1\u8db3\u6761\u4ef6\u7684\u8282\u70b9\u4e0a</p>"},{"location":"blog/2024/04/29/k8s-schedule/#notin","title":"NotIn","text":"<p>\u5339\u914d\u4e0d\u5728\u6761\u4ef6\u4e2d\u7684\u8282\u70b9\uff0c\u5b9e\u73b0\u8282\u70b9\u53cd\u4eb2\u548c\u6027</p>"},{"location":"blog/2024/04/29/k8s-schedule/#exists_1","title":"Exists","text":"<p>\u53ea\u8981\u5b58\u5728 key \u540d\u5b57\u5c31\u53ef\u4ee5\uff0c\u4e0d\u5173\u5fc3\u503c\u662f\u4ec0\u4e48</p>"},{"location":"blog/2024/04/29/k8s-schedule/#doesnotexist","title":"DoesNotExist","text":"<p>\u5339\u914d\u6307\u5b9a key \u540d\u4e0d\u5b58\u5728\u7684\u8282\u70b9\uff0c\u5b9e\u73b0\u8282\u70b9\u53cd\u4eb2\u548c\u6027</p>"},{"location":"blog/2024/04/29/k8s-schedule/#gt","title":"Gt","text":"<p>value \u4e3a\u6570\u503c\uff0c\u4e14\u8282\u70b9\u4e0a\u7684\u503c\u5c0f\u4e8e\u6307\u5b9a\u7684\u6761\u4ef6</p>"},{"location":"blog/2024/04/29/k8s-schedule/#lt","title":"Lt","text":"<p>value \u4e3a\u6570\u503c\uff0c\u4e14\u8282\u70b9\u4e0a\u7684\u503c\u5927\u4e8e\u6307\u5b9a\u6761\u4ef6</p>"},{"location":"blog/2024/04/29/k8s-schedule/#podaffinity","title":"PodAffinity","text":"<p>Pod \u4eb2\u548c\u529b\uff1a\u5c06\u4e0e\u6307\u5b9a pod \u4eb2\u548c\u529b\u76f8\u5339\u914d\u7684 pod \u90e8\u7f72\u5728\u540c\u4e00\u8282\u70b9\u3002</p>"},{"location":"blog/2024/04/29/k8s-schedule/#requiredduringschedulingignoreduringexecution_1","title":"RequiredDuringSchedulingIgnoreDuringExecution","text":"<p>\u5fc5\u987b\u5c06\u5e94\u7528\u90e8\u7f72\u5728\u4e00\u5757</p>"},{"location":"blog/2024/04/29/k8s-schedule/#preferredduringschedulingignoredduringexecution_1","title":"PreferredDuringSchedulingIgnoredDuringExecution","text":"<p>\u5c3d\u91cf\u5c06\u5e94\u7528\u90e8\u7f72\u5728\u4e00\u5757</p>"},{"location":"blog/2024/04/29/k8s-schedule/#podantiaffinity","title":"PodAntiAffinity","text":"<p>Pod \u53cd\u4eb2\u548c\u529b\uff1a\u6839\u636e\u7b56\u7565\u5c3d\u91cf\u90e8\u7f72\u6216\u4e0d\u90e8\u7f72\u5230\u4e00\u5757</p>"},{"location":"blog/2024/04/29/k8s-schedule/#requiredduringschedulingignoreduringexecution_2","title":"RequiredDuringSchedulingIgnoreDuringExecution","text":"<p>\u4e0d\u8981\u5c06\u5e94\u7528\u4e0e\u4e4b\u5339\u914d\u7684\u90e8\u7f72\u5230\u4e00\u5757 <pre><code>podAffinity:\n    requiredDuringSchedulingIgnoredDuringExecution:\n    - labelSelector:\n        matchExpressions:\n        - key: security\n        operator: In\n        values:\n        - S1\n    topologyKey: topology.kubernetes.io/zone\n</code></pre></p>"},{"location":"blog/2024/04/29/k8s-schedule/#preferredduringschedulingignoredduringexecution_2","title":"PreferredDuringSchedulingIgnoredDuringExecution","text":"<p>\u5c3d\u91cf\u4e0d\u8981\u5c06\u5e94\u7528\u90e8\u7f72\u5230\u4e00\u5757</p> <pre><code>spec:\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: kubernetes.io/os\n            operator: In\n            values:\n            - linux\n      preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: 1\n        preference:\n          matchExpressions:\n          - key: label-1\n            operator: In\n            values:\n            - key-1\n      - weight: 50\n        preference:\n          matchExpressions:\n          - key: label-2\n            operator: In\n            values:\n            - key-2\n</code></pre>"},{"location":"blog/2024/01/19/k8s-api-annotation/","title":"K8s Api Annotation","text":"","tags":["k8s","k8s-api"]},{"location":"blog/2024/01/19/k8s-api-annotation/#api","title":"API \u6982\u8ff0","text":"<p>The K8s API JSON \u548c Protobuf \u5e8f\u5217\u5316\u6a21\u5f0f\u9075\u5faa\u76f8\u540c\u7684\u6a21\u5f0f\u66f4\u6539\u539f\u5219\u3002 \u4ee5\u4e0b\u63cf\u8ff0\u6db5\u76d6\u4e86\u8fd9\u4e24\u79cd\u683c\u5f0f\u3002 API \u7248\u672c\u63a7\u5236\u548c\u8f6f\u4ef6\u7248\u672c\u63a7\u5236\u662f\u95f4\u63a5\u76f8\u5173\u7684\u3002 API \u548c\u53d1\u5e03\u7248\u672c\u63a7\u5236\u63d0\u6848\u63cf\u8ff0\u4e86 API \u7248\u672c\u63a7\u5236\u548c\u8f6f\u4ef6\u7248\u672c\u63a7\u5236\u95f4\u7684\u5173\u7cfb\u3002\u4e0d\u540c\u7684 API \u7248\u672c\u4ee3\u8868\u7740\u4e0d\u540c\u7684\u7a33\u5b9a\u6027\u548c\u652f\u6301\u7ea7\u522b\u3002 \u4f60\u53ef\u4ee5\u5728 API \u53d8\u66f4\u6587\u6863 \u4e2d\u67e5\u770b\u5230\u66f4\u591a\u7684\u4e0d\u540c\u7ea7\u522b\u7684\u5224\u5b9a\u6807\u51c6\u3002</p> <p>Here's a summary of each level: Alpha / Bate / Stable  (\u4e3b\u8981\u662f\u7528Bate\u3001Stable\u7248\u672c)</p> <pre><code>graph LR\n    A[Tree level] ----&gt; B[Alpha];\n    A[Tree level] ------&gt; C[Bate];\n    A[Tree level] --------&gt; D[Stable];</code></pre>","tags":["k8s","k8s-api"]},{"location":"blog/2024/01/19/k8s-api-annotation/#_1","title":"K8s Api Annotation","text":"","tags":["k8s","k8s-api"]},{"location":"blog/2024/01/19/k8s-api-annotation/#_2","title":"\u8bbf\u95ee\u63a7\u5236","text":"<ul> <li>authentication\uff08\u8eab\u4efd\u9a8c\u8bc1\uff09</li> <li>authorization\uff08\u6388\u6743\uff09</li> </ul>","tags":["k8s","k8s-api"]},{"location":"blog/2024/01/19/k8s-api-annotation/#api_1","title":"\u5e9f\u5f03API\u8bf4\u660e","text":"","tags":["k8s","k8s-api"]},{"location":"blog/2024/04/27/k8s-configuration/","title":"K8s Configuration","text":""},{"location":"blog/2024/04/27/k8s-configuration/#configmap","title":"ConfigMap","text":"<p>\u4e00\u822c\u7528\u4e8e\u53bb\u5b58\u50a8 Pod \u4e2d\u5e94\u7528\u6240\u9700\u7684\u4e00\u4e9b\u914d\u7f6e\u4fe1\u606f\uff0c\u6216\u8005\u73af\u5883\u53d8\u91cf\uff0c\u5c06\u914d\u7f6e\u4e8e Pod \u5206\u5f00\uff0c\u907f\u514d\u5e94\u4e3a\u4fee\u6539\u914d\u7f6e\u5bfc\u81f4\u8fd8\u9700\u8981\u91cd\u65b0\u6784\u5efa \u955c\u50cf\u4e0e\u5bb9\u5668\u3002</p>"},{"location":"blog/2024/04/27/k8s-configuration/#_1","title":"\u521b\u5efa","text":"<p>\u4f7f\u7528 <code>kubectl create configmap -h</code> \u67e5\u770b\u793a\u4f8b\uff0c\u6784\u5efa configmap \u5bf9\u8c61 Examples: <pre><code>  # Create a new config map named my-config based on folder test\n  kubectl create configmap my-config --from-file=path/to/test\n</code></pre> 1. \u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939test\uff0c\u91cc\u9762\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\uff1adb.properties,\u5185\u5bb9\u5982\u4e0b <pre><code>[root@k8s-master test]# cd ..\n[root@k8s-master config]# cd test\n[root@k8s-master test]# cat db.properties\nusername=root\npassword=admin\n</code></pre> 2. \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\"test-dir-config\"\u7684ConfigMap \uff0c\u6587\u4ef6\u6765\u6e90test/ <pre><code>kubectl create configmap test-dir-config --from-file=test/\n</code></pre> \u67e5\u770b\u521b\u5efa\u7684ConfigMap\u4fe1\u606f</p> <pre><code>kubectl get cm\nkubectl describe test-dir-config\n</code></pre>"},{"location":"blog/2024/04/27/k8s-configuration/#configmap_1","title":"\u4f7f\u7528ConfigMap","text":"<p>\u521b\u5efa\u4e00\u4e2apod yaml\u6587\u4ef6\uff0c\u8fdb\u884c\u8c03\u7528\u540d\u4e3atest-dir-config\u7684ConfigMap\u6587\u4ef6\uff08\u4e0a\u9762\u521b\u5efa\u7684cm\uff09 <pre><code>apiVersion: v1\nkind: Pod\nmetadata: \n  name: test-configfile-pod\nspec:\n  containers:\n    - name: config-test\n      image: alpine\n      command: [\"/bin/sh\",\"-c\",\"sleep 3600\"]\n      imagePullPolicy: IfNotPresent\n      env: \n      - name: JAVA_VM_OPTS\n        valueFrom:\n          configMapKeyRef:\n            name: test-env-config\n            key: JAVA_OPTS_TEST #\u8868\u793a\u4ecename\u7684ConfigMap\u4e2d\u83b7\u53d6\u540d\u5b57\u4e3akey\u7684value\uff0c\u5c06\u5176\u8d4b\u503c\u7ed9\u672c\u5730\u73af\u5883\u53d8\u91cf\uff1aJAVA_VM_OPTS\n      - name: APP\n        valueFrom:\n          configMapKeyRef:\n            name: test-env-config\n            key: APP_NAME\n      volumeMounts:\n      - name: db-config\n        mountPath: \"/usr/local/mysql/conf\" #\u60f3\u8981\u5c06\u6570\u636e\u5377\u52a0\u8f7d\u5230\u5bb9\u5668\u7684\u54ea\u4e2a\u76ee\u5f55\n        readOnly: true\n  volumes: #\u6570\u636e\u5377\u6302\u8f7d\u3002\u65b9\u5f0f\uff1aConfigMap\u3001Secret\n    - name: db-config #\u6570\u636e\u5377\u540d\u5b57\n      configMap:  #\u6570\u636e\u5377\u7c7b\u578b\u4e3aConfigMap\n        name: test-dir-config #ConfigMap\u540d\u5b57\uff0c\u5fc5\u987b\u5339\u914dConfigMap\n        items: #\u5bf9ConfigMap\u4e2d\u7684key\u8fdb\u884c\u6620\u5c04\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\uff0c\u9ed8\u8ba4\u4f1a\u5c06ConfigMap\u4e2d\u6240\u6709key\u5168\u90e8\u8f6c\u6362\u4e3a\u4e00\u4e2a\u540c\u540d\u7684\u6587\u4ef6\n          - key: \"db.properties\"  #ConfigMap\u4e2d\u7684key\n            path: \"db.properties\"  #\u5c06\u8be5key\u7684\u503c\u8f6c\u6362\u4e3a\u6587\u4ef6\n</code></pre></p> <p>\u8fdb\u5165\u8be5\u521b\u5efa\u7684pod\u4e2d\u68c0\u9a8cConfigMap\u662f\u5426\u751f\u6548 <pre><code>kubectl exec -it test-configfile-pod -- sh\n</code></pre> <pre><code>[root@k8s-master config]# kubectl exec -it test-configfile-pod -- sh\n/ # cd /usr/local/mysql/conf\n/usr/local/mysql/conf # ls\ndb.properties\n/usr/local/mysql/conf # cat db.properties \nusername=root\npassword=admin\n</code></pre></p>"},{"location":"blog/2024/04/27/k8s-configuration/#secret","title":"\u52a0\u5bc6\u6570\u636e\u914d\u7f6eSecret","text":"<p>\u4e0e ConfigMap \u7c7b\u4f3c\uff0c\u7528\u4e8e\u5b58\u50a8\u914d\u7f6e\u4fe1\u606f\uff0c\u4f46\u662f\u4e3b\u8981\u7528\u4e8e\u5b58\u50a8\u654f\u611f\u4fe1\u606f\u3001\u9700\u8981\u52a0\u5bc6\u7684\u4fe1\u606f\uff0cSecret \u53ef\u4ee5\u63d0\u4f9b\u6570\u636e\u52a0\u5bc6\u3001\u89e3\u5bc6\u529f\u80fd\u3002</p> <ul> <li>\u5e38\u89c1\u4e00\u4e2aSecret <pre><code>kubectl create secret generic &lt;secret-name&gt; --from-literal=username=admin --from-literal=password=abc123\n</code></pre></li> <li>\u67e5\u770bSecret <pre><code>kubectl describe secret/&lt;sercret-name&gt;\n</code></pre></li> </ul> <p>\u5728\u521b\u5efa Secret \u65f6\uff0c\u8981\u6ce8\u610f\u5982\u679c\u8981\u52a0\u5bc6\u7684\u5b57\u7b26\u4e2d\uff0c\u5305\u542b\u4e86\u6709\u7279\u6b8a\u5b57\u7b26\uff0c\u9700\u8981\u4f7f\u7528\u8f6c\u4e49\u7b26\u8f6c\u79fb\uff0c\u4f8b\u5982 $ \u8f6c\u79fb\u540e\u4e3a \\$\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u7279\u6b8a\u5b57\u7b26\u4f7f\u7528\u5355\u5f15\u53f7\u63cf\u8ff0\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u8f6c\u79fb\u4f8b\u5982 1$289-! \u8f6c\u6362\u4e3a '1$289-!' <pre><code>[root@k8s-master config]# echo 'YWRtaW4tLwo=' | base64 --decode\nadmin-/\n[root@k8s-master config]# echo admin-/ | base64\nYWRtaW4tLwo=\n[root@k8s-master config]# echo admin@!-/ | base64\n-bash: !-/: event not found\n[root@k8s-master config]# echo 'admin@!-/' | base64\nYWRtaW5AIS0vCg==\n[root@k8s-master config]# echo 'YWRtaW5AIS0vCg==' |base64 --decode\nadmin@!-/\n</code></pre></p>"},{"location":"blog/2024/04/27/k8s-configuration/#subpath","title":"SubPath\u7684\u4f7f\u7528","text":"<p>\u4f7f\u7528 ConfigMap \u6216 Secret \u6302\u8f7d\u5230\u76ee\u5f55\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u5bb9\u5668\u4e2d\u6e90\u76ee\u5f55\u7ed9\u8986\u76d6\u6389\uff0c\u6b64\u65f6\u6211\u4eec\u53ef\u80fd\u53ea\u60f3\u8986\u76d6\u76ee\u5f55\u4e2d\u7684\u67d0\u4e00\u4e2a\u6587\u4ef6\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u64cd\u4f5c\u4f1a\u8986\u76d6\u6574\u4e2a\u6587\u4ef6\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528\u5230 SubPath</p> <p>\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <ol> <li>\u5b9a\u4e49 volumes \u65f6\u9700\u8981\u589e\u52a0 items \u5c5e\u6027\uff0c\u914d\u7f6e key \u548c path\uff0c\u4e14 path \u7684\u503c\u4e0d\u80fd\u4ece / \u5f00\u59cb</li> <li>\u5728\u5bb9\u5668\u5185\u7684 volumeMounts \u4e2d\u589e\u52a0 subPath \u5c5e\u6027\uff0c\u8be5\u503c\u4e0e volumes \u4e2d items.path \u7684\u503c\u76f8\u540c</li> </ol> <p>containers:  ......  volumeMounts:  - mountPath: /etc/nginx/nginx.conf # \u6302\u8f7d\u5230\u54ea\u91cc   name: config-volume # \u4f7f\u7528\u54ea\u4e2a configmap \u6216 secret   subPath: etc/nginx/nginx.conf # \u4e0e volumes.[0].items.path \u76f8\u540c volumes:</p> <p>- configMap:  name: nginx-conf # configMap \u540d\u5b57  items: # subPath \u914d\u7f6e   key: nginx.conf # configMap \u4e2d\u7684\u6587\u4ef6\u540d   path: etc/nginx/nginx.conf # subPath \u8def\u5f84</p>"},{"location":"blog/2024/04/27/k8s-configuration/#_2","title":"\u914d\u7f6e\u7684\u70ed\u66f4\u65b0","text":""},{"location":"blog/2024/04/27/k8s-configuration/#editconfigmap","title":"\u901a\u8fc7edit\u547d\u4ee4\u76f4\u63a5\u4fee\u6539ConfigMap","text":""},{"location":"blog/2024/04/27/k8s-configuration/#replace","title":"\u901a\u8fc7replace\u66ff\u6362","text":"<p>\u7531\u4e8e configmap \u6211\u4eec\u521b\u5efa\u901a\u5e38\u90fd\u662f\u57fa\u4e8e\u6587\u4ef6\u521b\u5efa\uff0c\u5e76\u4e0d\u4f1a\u7f16\u5199 yaml \u914d\u7f6e\u6587\u4ef6\uff0c\u56e0\u6b64\u4fee\u6539\u65f6\u6211\u4eec\u4e5f\u662f\u76f4\u63a5\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u800c replace \u662f\u6ca1\u6709 --from-file \u53c2\u6570\u7684\uff0c\u56e0\u6b64\u65e0\u6cd5\u5b9e\u73b0\u57fa\u4e8e\u6e90\u914d\u7f6e\u6587\u4ef6\u7684\u66ff\u6362\uff0c\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u4e0b\u65b9\u7684\u547d\u4ee4\u5b9e\u73b0</p> <p>\u8be5\u547d\u4ee4\u7684\u91cd\u70b9\u5728\u4e8e --dry-run \u53c2\u6570\uff0c\u8be5\u53c2\u6570\u7684\u610f\u601d\u6253\u5370 yaml \u6587\u4ef6\uff0c\u4f46\u4e0d\u4f1a\u5c06\u8be5\u6587\u4ef6\u53d1\u9001\u7ed9 apiserver\uff0c\u518d\u7ed3\u5408 -oyaml \u8f93\u51fa yaml \u6587\u4ef6\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u914d\u7f6e\u597d\u4f46\u662f\u6ca1\u6709\u53d1\u7ed9 apiserver \u7684\u6587\u4ef6\uff0c\u7136\u540e\u518d\u7ed3\u5408 replace \u76d1\u542c\u63a7\u5236\u53f0\u8f93\u51fa\u5f97\u5230 yaml \u6570\u636e\u5373\u53ef\u5b9e\u73b0\u66ff\u6362 <pre><code>kubectl create cm --from-file=nginx.conf --dry-run -oyaml | kubectl replace -f-\n</code></pre></p>"},{"location":"blog/2024/04/27/k8s-configuration/#secretconfigmap","title":"\u4e0d\u53ef\u53d8\u7684Secret\u548cConfigMap","text":"<p>\u5bf9\u4e8e\u4e00\u4e9b\u654f\u611f\u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u7ebf\u4e0a\u6709\u65f6\u662f\u4e0d\u5141\u8bb8\u4fee\u6539\u7684\uff0c\u6b64\u65f6\u5728\u914d\u7f6e configmap \u65f6\u53ef\u4ee5\u8bbe\u7f6e immutable: true \u6765\u7981\u6b62\u4fee\u6539</p>"},{"location":"blog/2024/04/27/k8s-hpa/","title":"K8s HPA","text":""},{"location":"blog/2024/04/27/k8s-hpa/#-kubectl-top","title":"\u5f00\u542f\u670d\u52a1\u6307\u6807--kubectl top","text":"<pre><code># \u4e0b\u8f7d metrics-server \u7ec4\u4ef6\u914d\u7f6e\u6587\u4ef6\nwget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml -O metrics-server-components.yaml\n\n# \u4fee\u6539\u955c\u50cf\u5730\u5740\u4e3a\u56fd\u5185\u7684\u5730\u5740\nsed -i 's/k8s.gcr.io\\/metrics-server/registry.cn-hangzhou.aliyuncs.com\\/google_containers/g' metrics-server-components.yaml\n\n# \u4fee\u6539\u5bb9\u5668\u7684 tls \u914d\u7f6e\uff0c\u4e0d\u9a8c\u8bc1 tls\uff0c\u5728 containers \u7684 args \u53c2\u6570\u4e2d\u589e\u52a0 --kubelet-insecure-tls \u53c2\u6570\n\n# \u5b89\u88c5\u7ec4\u4ef6\nkubectl apply -f metrics-server-components.yaml\n\n# \u67e5\u770b pod \u72b6\u6001\nkubectl get pods --all-namespaces | grep metrics\n</code></pre>"},{"location":"blog/2024/04/27/k8s-hpa/#cpu","title":"cpu/\u5185\u5b58\u6307\u6807\u76d1\u63a7","text":"<ul> <li> <p>\u5b9e\u73b0 cpu \u6216\u5185\u5b58\u7684\u76d1\u63a7\uff0c\u9996\u5148\u6709\u4e2a\u524d\u63d0\u6761\u4ef6\u662f\u8be5\u5bf9\u8c61\u5fc5\u987b\u914d\u7f6e\u4e86 resources.requests.cpu \u6216 resources.requests.memory \u624d\u53ef\u4ee5\uff0c\u53ef\u4ee5\u914d\u7f6e\u5f53 cpu/memory \u8fbe\u5230\u4e0a\u8ff0\u914d\u7f6e\u7684\u767e\u5206\u6bd4\u540e\u8fdb\u884c\u6269\u5bb9\u6216\u7f29\u5bb9</p> </li> <li> <p>\u521b\u5efa\u4e00\u4e2a HPA\uff1a \u5148\u51c6\u5907\u4e00\u4e2a\u597d\u4e00\u4e2a\u6709\u505a\u8d44\u6e90\u9650\u5236\u7684 deployment \u6267\u884c\u547d\u4ee4 <pre><code>kubectl autoscale deploy nginx-deploy --cpu-percent=20 --min=2 --max=5\n</code></pre></p> </li> <li> <p>\u901a\u8fc7 kubectl get hpa \u53ef\u4ee5\u83b7\u53d6 HPA \u4fe1\u606f</p> </li> <li> <p>\u6d4b\u8bd5\uff1a\u627e\u5230\u5bf9\u5e94\u670d\u52a1\u7684 service\uff0c\u7f16\u5199\u5faa\u73af\u6d4b\u8bd5\u811a\u672c\u63d0\u5347\u5185\u5b58\u4e0e cpu \u8d1f\u8f7d <pre><code>while true; do wget -q -O- http://&lt;ip:port&gt; &gt; /dev/null ; done\n</code></pre></p> </li> <li> <p>\u53ef\u4ee5\u901a\u8fc7\u591a\u53f0\u673a\u5668\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\uff0c\u589e\u52a0\u8d1f\u8f7d\uff0c\u5f53\u8d85\u8fc7\u8d1f\u8f7d\u540e\u53ef\u4ee5\u67e5\u770b pods \u7684\u6269\u5bb9\u60c5\u51b5  <pre><code>kubectl get pods\n</code></pre></p> </li> <li> <p>\u67e5\u770b pods \u8d44\u6e90\u4f7f\u7528\u60c5\u51b5 <pre><code>kubectl top pods\n</code></pre></p> </li> <li>\u6269\u5bb9\u6d4b\u8bd5\u5b8c\u6210\u540e\uff0c\u518d\u5173\u95ed\u5faa\u73af\u6267\u884c\u7684\u6307\u4ee4\uff0c\u8ba9 cpu \u5360\u7528\u7387\u964d\u4e0b\u6765\uff0c\u7136\u540e\u8fc7 5 \u5206\u949f\u540e\u67e5\u770b\u81ea\u52a8\u7f29\u5bb9\u60c5\u51b5 ```</li> </ul>"},{"location":"blog/2024/04/27/k8s-hpa/#metrics","title":"\u81ea\u5b9a\u4e49metrics","text":"<ul> <li>\u63a7\u5236\u7ba1\u7406\u5668\u5f00\u542f\u2013horizontal-pod-autoscaler-use-rest-clients</li> <li>\u63a7\u5236\u7ba1\u7406\u5668\u7684\u2013apiserver\u6307\u5411API Server Aggregator</li> <li>\u5728API Server Aggregator\u4e2d\u6ce8\u518c\u81ea\u5b9a\u4e49\u7684metrics API</li> </ul>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/","title":"K8s Persistent Volumes","text":"<ul> <li>PV: Persistent Volumes</li> <li>PVC: Persistent Volumes Claim PV \u662f\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\u3002 PVC \u662f\u5bf9\u8fd9\u4e9b\u8d44\u6e90\u7684\u8bf7\u6c42\uff0c\u4e5f\u5145\u5f53\u5bf9\u8d44\u6e90\u7684\u58f0\u660e\u68c0\u67e5\u3002</li> </ul> <p> Lifecycle of a volume and claim  \u5377\u548c\u7533\u9886\u7684\u58f0\u660e\u5468\u671f</p>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#provisioning","title":"Provisioning \u5236\u5907","text":""},{"location":"blog/2024/04/27/k8s-persistent-volumes/#static","title":"Static","text":"<p>\u96c6\u7fa4\u7ba1\u7406\u5458\u521b\u5efa\u82e5\u5e72 PV \u5377\u3002\u8fd9\u4e9b\u5377\u5bf9\u8c61\u5e26\u6709\u771f\u5b9e\u5b58\u50a8\u7684\u7ec6\u8282\u4fe1\u606f\uff0c \u5e76\u4e14\u5bf9\u96c6\u7fa4\u7528\u6237\u53ef\u7528\uff08\u53ef\u89c1\uff09\u3002PV \u5377\u5bf9\u8c61\u5b58\u5728\u4e8e Kubernetes API \u4e2d\uff0c\u53ef\u4f9b\u7528\u6237\u6d88\u8d39\uff08\u4f7f\u7528\uff09\u3002</p>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#dynamic","title":"Dynamic","text":"<p>\u5982\u679c\u96c6\u7fa4\u4e2d\u5df2\u7ecf\u6709\u7684 PV \u65e0\u6cd5\u6ee1\u8db3 PVC \u7684\u9700\u6c42\uff0c\u90a3\u4e48\u96c6\u7fa4\u4f1a\u6839\u636e PVC \u81ea\u52a8\u6784\u5efa\u4e00\u4e2a PV\uff0c\u8be5\u64cd\u4f5c\u662f\u901a\u8fc7 StorageClass \u5b9e\u73b0\u7684\u3002</p> <p>\u60f3\u8981\u5b9e\u73b0\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u524d\u63d0\u662f PVC \u5fc5\u987b\u8bbe\u7f6e StorageClass\uff0c\u5426\u5219\u4f1a\u65e0\u6cd5\u52a8\u6001\u6784\u5efa\u8be5 PV\uff0c\u53ef\u4ee5\u901a\u8fc7\u542f\u7528 DefaultStorageClass \u6765\u5b9e\u73b0 PV \u7684\u6784\u5efa\u3002</p>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#binding","title":"Binding \u7ed1\u5b9a","text":"<p>\u5f53\u7528\u6237\u521b\u5efa\u4e00\u4e2a PVC \u5bf9\u8c61\u540e\uff0c\u4e3b\u8282\u70b9\u4f1a\u76d1\u6d4b\u65b0\u7684 PVC \u5bf9\u8c61\uff0c\u5e76\u4e14\u5bfb\u627e\u4e0e\u4e4b\u5339\u914d\u7684 PV \u5377\uff0c\u627e\u5230 PV \u5377\u540e\u5c06\u4e8c\u8005\u7ed1\u5b9a\u5728\u4e00\u8d77\u3002</p> <p>\u5982\u679c\u627e\u4e0d\u5230\u5bf9\u5e94\u7684 PV\uff0c\u5219\u9700\u8981\u770b PVC \u662f\u5426\u8bbe\u7f6e StorageClass \u6765\u51b3\u5b9a\u662f\u5426\u52a8\u6001\u521b\u5efa PV\uff0c\u82e5\u6ca1\u6709\u914d\u7f6e\uff0cPVC \u5c31\u4f1a\u4e00\u81f4\u5904\u4e8e\u672a\u7ed1\u5b9a\u72b6\u6001\uff0c\u76f4\u5230\u6709\u4e0e\u4e4b\u5339\u914d\u7684 PV \u540e\u624d\u4f1a\u7533\u9886\u7ed1\u5b9a\u5173\u7cfb\u3002</p>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#using","title":"Using  \u4f7f\u7528","text":"<p>Pod \u5c06 PVC \u5f53\u4f5c\u5b58\u50a8\u5377\u6765\u4f7f\u7528\uff0c\u96c6\u7fa4\u4f1a\u901a\u8fc7 PVC \u627e\u5230\u7ed1\u5b9a\u7684 PV\uff0c\u5e76\u4e3a Pod \u6302\u8f7d\u8be5\u5377\u3002</p> <p>Pod \u4e00\u65e6\u4f7f\u7528 PVC \u7ed1\u5b9a PV \u540e\uff0c\u4e3a\u4e86\u4fdd\u62a4\u6570\u636e\uff0c\u907f\u514d\u6570\u636e\u4e22\u5931\u95ee\u9898\uff0cPV \u5bf9\u8c61\u4f1a\u53d7\u5230\u4fdd\u62a4\uff0c\u5728\u7cfb\u7edf\u4e2d\u65e0\u6cd5\u88ab\u5220\u9664\u3002  </p>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#storage-object-in-use-protection","title":"Storage Object in Use Protection  \u4fdd\u62a4\u4f7f\u7528\u4e2d\u7684\u5b58\u50a8\u5bf9\u8c61","text":""},{"location":"blog/2024/04/27/k8s-persistent-volumes/#reclaim","title":"Reclaim \u56de\u6536\u7b56\u7565","text":""},{"location":"blog/2024/04/27/k8s-persistent-volumes/#retain","title":"Retain \u4fdd\u7559","text":"<p>\u56de\u6536\u7b56\u7565 Retain \u4f7f\u5f97\u7528\u6237\u53ef\u4ee5\u624b\u52a8\u56de\u6536\u8d44\u6e90\u3002\u5f53 PersistentVolumeClaim \u5bf9\u8c61\u88ab\u5220\u9664\u65f6\uff0cPersistentVolume \u5377\u4ecd\u7136\u5b58\u5728\uff0c\u5bf9\u5e94\u7684\u6570\u636e\u5377\u88ab\u89c6\u4e3a\"\u5df2\u91ca\u653e\uff08released\uff09\"\u3002 \u7531\u4e8e\u5377\u4e0a\u4ecd\u7136\u5b58\u5728\u8fd9\u524d\u4e00\u7533\u9886\u4eba\u7684\u6570\u636e\uff0c\u8be5\u5377\u8fd8\u4e0d\u80fd\u7528\u4e8e\u5176\u4ed6\u7533\u9886\u3002 \u7ba1\u7406\u5458\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u6b65\u9aa4\u6765\u624b\u52a8\u56de\u6536\u8be5\u5377\uff1a \u5220\u9664 PersistentVolume \u5bf9\u8c61\u3002\u4e0e\u4e4b\u76f8\u5173\u7684\u3001\u4f4d\u4e8e\u5916\u90e8\u57fa\u7840\u8bbe\u65bd\u4e2d\u7684\u5b58\u50a8\u8d44\u4ea7 \uff08\u4f8b\u5982 AWS EBS\u3001GCE PD\u3001Azure Disk \u6216 Cinder \u5377\uff09\u5728 PV \u5220\u9664\u4e4b\u540e\u4ecd\u7136\u5b58\u5728\u3002 \u6839\u636e\u60c5\u51b5\uff0c\u624b\u52a8\u6e05\u9664\u6240\u5173\u8054\u7684\u5b58\u50a8\u8d44\u4ea7\u4e0a\u7684\u6570\u636e\u3002 \u624b\u52a8\u5220\u9664\u6240\u5173\u8054\u7684\u5b58\u50a8\u8d44\u4ea7\u3002 \u5982\u679c\u4f60\u5e0c\u671b\u91cd\u7528\u8be5\u5b58\u50a8\u8d44\u4ea7\uff0c\u53ef\u4ee5\u57fa\u4e8e\u5b58\u50a8\u8d44\u4ea7\u7684\u5b9a\u4e49\u521b\u5efa\u65b0\u7684 PersistentVolume \u5377\u5bf9\u8c61\u3002</p>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#delete","title":"Delete \u5220\u9664","text":"<p>\u5bf9\u4e8e\u652f\u6301 Delete \u56de\u6536\u7b56\u7565\u7684\u5377\u63d2\u4ef6\uff0c\u5220\u9664\u52a8\u4f5c\u4f1a\u5c06 PersistentVolume \u5bf9\u8c61\u4ece Kubernetes \u4e2d\u79fb\u9664\uff0c\u540c\u65f6\u4e5f\u4f1a\u4ece\u5916\u90e8\u57fa\u7840\u8bbe\u65bd\uff08\u5982 AWS EBS\u3001GCE PD\u3001Azure Disk \u6216 Cinder \u5377\uff09\u4e2d\u79fb\u9664\u6240\u5173\u8054\u7684\u5b58\u50a8\u8d44\u4ea7\u3002 \u52a8\u6001\u5236\u5907\u7684\u5377\u4f1a\u7ee7\u627f\u5176 StorageClass \u4e2d\u8bbe\u7f6e\u7684\u56de\u6536\u7b56\u7565\uff0c \u8be5\u7b56\u7565\u9ed8\u8ba4\u4e3a Delete\u3002\u7ba1\u7406\u5458\u9700\u8981\u6839\u636e\u7528\u6237\u7684\u671f\u671b\u6765\u914d\u7f6e StorageClass\uff1b \u5426\u5219 PV \u5377\u88ab\u521b\u5efa\u4e4b\u540e\u5fc5\u987b\u8981\u88ab\u7f16\u8f91\u6216\u8005\u4fee\u8865\u3002</p>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#recycle","title":"Recycle \u56de\u6536","text":"<p>\u8b66\u544a\uff1a \u56de\u6536\u7b56\u7565 Recycle \u5df2\u88ab\u5e9f\u5f03\u3002\u53d6\u800c\u4ee3\u4e4b\u7684\u5efa\u8bae\u65b9\u6848\u662f\u4f7f\u7528\u52a8\u6001\u5236\u5907\u3002</p> <p>\u5982\u679c\u4e0b\u5c42\u7684\u5377\u63d2\u4ef6\u652f\u6301\uff0c\u56de\u6536\u7b56\u7565 Recycle \u4f1a\u5728\u5377\u4e0a\u6267\u884c\u4e00\u4e9b\u57fa\u672c\u7684\u64e6\u9664 \uff08rm -rf /thevolume/*\uff09\u64cd\u4f5c\uff0c\u4e4b\u540e\u5141\u8bb8\u8be5\u5377\u7528\u4e8e\u65b0\u7684 PVC \u7533\u9886\u3002</p>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#pv","title":"PV \u914d\u7f6e\u6587\u4ef6","text":"<pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv0001\nspec:\n  capacity:\n    storage: 5Gi # pv \u7684\u5bb9\u91cf\n  volumeMode: Filesystem # \u5b58\u50a8\u7c7b\u578b\u4e3a\u6587\u4ef6\u7cfb\u7edf\n  accessModes: # \u8bbf\u95ee\u6a21\u5f0f\uff1aReadWriteOnce\u3001ReadWriteMany\u3001ReadOnlyMany\n    - ReadWriteOnce # \u53ef\u88ab\u5355\u8282\u70b9\u72ec\u5199\n  persistentVolumeReclaimPolicy: Recycle # \u56de\u6536\u7b56\u7565\n  storageClassName: slow # \u521b\u5efa PV \u7684\u5b58\u50a8\u7c7b\u540d\uff0c\u9700\u8981\u4e0e pvc \u7684\u76f8\u540c\n  mountOptions: # \u52a0\u8f7d\u914d\u7f6e\n    - hard\n    - nfsvers=4.1\n  nfs: # \u8fde\u63a5\u5230 nfs\n    path: /data/nfs/rw/test-pv # \u5b58\u50a8\u8def\u5f84\n    server: 192.168.113.121 # nfs \u670d\u52a1\u5730\u5740\n</code></pre>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#pod-pvc","title":"Pod \u7ed1\u5b9a PVC","text":"<p>\u5728 pod \u7684\u6302\u8f7d\u5bb9\u5668\u914d\u7f6e\u4e2d\uff0c\u589e\u52a0 pvc \u6302\u8f7d <pre><code>containers:\n  ......\n  volumeMounts:\n    - mountPath: /tmp/pvc\n      name: nfs-pvc-test\nvolumes:\n  - name: nfs-pvc-test\n    persistentVolumeClaim:\n      claimName: nfs-pvc # pvc \u7684\u540d\u79f0```\n</code></pre></p>"},{"location":"blog/2024/04/27/k8s-persistent-volumes/#pvc","title":"PVC \u914d\u7f6e\u6587\u4ef6","text":"<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nfs-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce # \u6743\u9650\u9700\u8981\u4e0e\u5bf9\u5e94\u7684 pv \u76f8\u540c\n  volumeMode: Filesystem\n  resources:\n    requests:\n      storage: 8Gi # \u8d44\u6e90\u53ef\u4ee5\u5c0f\u4e8e pv \u7684\uff0c\u4f46\u662f\u4e0d\u80fd\u5927\u4e8e\uff0c\u5982\u679c\u5927\u4e8e\u5c31\u4f1a\u5339\u914d\u4e0d\u5230 pv\n  storageClassName: slow # \u540d\u5b57\u9700\u8981\u4e0e\u5bf9\u5e94\u7684 pv \u76f8\u540c\n#  selector: # \u4f7f\u7528\u9009\u62e9\u5668\u9009\u62e9\u5bf9\u5e94\u7684 pv\n#    matchLabels:\n#      release: \"stable\"\n#    matchExpressions:\n#      - {key: environment, operator: In, values: [dev]}\n</code></pre>"},{"location":"blog/2024/03/19/k8s-pod/","title":"K8s Pod","text":"<p>On the right hand are reference infomations for create kubernetes resources. resources manifast / official document.</p> <p></p>","tags":["k8s","k8s-pod"]},{"location":"blog/2024/03/19/k8s-pod/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>k8s\u8d44\u6e90\u914d\u7f6e\u6e05\u5355</li> <li>k8s\u5bb9\u5668/pod\u5206\u914d\u8d44\u6e90\u5b98\u7f51\u6587\u6863</li> </ul>","tags":["k8s","k8s-pod"]},{"location":"blog/2024/03/19/k8s-pod/#create-pod-using-yaml-file","title":"Create Pod using yaml file","text":"pod.yaml<pre><code>apiVersion: v1 # api \u6587\u6863\u7248\u672c\nkind: Pod #\u8d44\u6e90\u5bf9\u8c61\u7c7b\u578b\uff0c\u5176\u4ed6\u7684\uff1aDeployment\u3001StatefulSet \nmetadata: #Pod\u7684\u76f8\u5173\u5143\u6570\u636e\uff0c\u7528\u4e8e\u63cf\u8ff0pod\u7684\u6570\u636e\n  name: my-nginx  #pod\u7684\u540d\u79f0\n  labels: #\u5b9a\u4e49pod\u6807\u7b7e\n    type: app\n    version: 1.0.x #\u81ea\u5b9a\u4e49\n  namespace: 'default' #\u914d\u7f6e\u547d\u540d\u7a7a\u95f4\uff0c\u9ed8\u8ba4\u7684\u662fdefault\nspec:  #\u671f\u671bpod \u6309\u7167\u8fd9\u91cc\u7684\u63cf\u8ff0\u8fdb\u884c\u521b\u5efa\n  containers:\n  - name: nginx\n    image: nginx:1.26.0\n    imagePullPolicy: IfNotPresent #\u6307\u5b9a\u955c\u50cf\u62c9\u53d6\u7b56\u7565\uff0c\u5982\u679c\u672c\u5730\u6ca1\u6709\u5c31\u62c9\u53d6\u8fdc\u7a0b\n    command:\n    - nginx\n    - -g\n    - 'daemon off;' #\u610f\u4e3a\uff1anginx -g 'daemon off;'\n    workingDir: /usr/share/nginx/html #\u6307\u5b9a\u5bb9\u5668\u542f\u52a8\u540e\u7684\u5de5\u4f5c\u76ee\u5f55\n    ports:\n    - name: http #\u7aef\u53e3\u540d\u79f0\n      containerPort: 80 #\u63cf\u8ff0\u5bb9\u5668\u5185\u8981\u66b4\u9732\u7684\u7aef\u53e3\n      protocol: TCP #\u63cf\u8ff0\u8be5\u7aef\u53e3\u662f\u57fa\u4e8e\u90a3\u79cd\u534f\u8bae\u901a\u4fe1\n    env: # \u73af\u5883\u53d8\u91cf\n      - name: JVM-OPTS #\u73af\u5883\u540d\u79f0\n        value: '-Xms128m -Xmx128m' #\u73af\u5883\u53d8\u91cf\u7684\u503c\n    resources:\n      requests:\n        cpu: 100m # cpu\u4e00\u4e2a\u6838\u5fc3\u4e3a1000m\uff0c\u8fd9\u91cc\u7684100m \u4e3a\u6700\u5c110.1\u4e2a\u6838\u5fc3\n        memory: \"128Mi\" #\u6700\u5c11128\u5146\n      limits:\n        cpu: 200m # cpu\u4e00\u4e2a\u6838\u5fc3\u4e3a1000m\uff0c\u8fd9\u91cc\u7684200m \u4e3a\u6700\u591a0.2\u4e2a\u6838\u5fc3\n        memory: \"256Mi\" #\u6700\u591a256\u5146\n    #command: [\"stress\"]\n    #args: [\"--vm\", \"1\", \"--vm-bytes\", \"150M\", \"--vm-hang\", \"1\"]\n  restartPolicy: OnFailure #\u91cd\u542f\u7b56\u7565\uff1a\u53ea\u7528\u5931\u8d25\u7684\u60c5\u51b5\u624d\u4f1a\u91cd\u542f\n</code></pre>","tags":["k8s","k8s-pod"]},{"location":"blog/2024/03/19/k8s-pod/#check-the-pod","title":"check the pod","text":"<pre><code>kubectl get po\nkubectl get po -o wide\nkubectl descrbe po my-nginx\n</code></pre> Operation_result <pre><code>[root@k8s-master pods]# kubectl get pod\nNAME            READY   STATUS    RESTARTS   AGE\nmemory-demo-3   1/1     Running   0          4m50s\nmy-nginx        1/1     Running   0          3m31s\n[root@k8s-master pods]# kubectl get pod -o wide\nNAME            READY   STATUS    RESTARTS   AGE     IP              NODE        NOMINATED NODE   READINESS GATES\nmemory-demo-3   1/1     Running   0          4m55s   192.168.36.72   k8s-node1   &lt;none&gt;           &lt;none&gt;\nmy-nginx        1/1     Running   0          3m36s   192.168.36.73   k8s-node1   &lt;none&gt;           &lt;none&gt;\n[root@k8s-master pods]# kubectl describe pod my-nginx\nName:         my-nginx\nNamespace:    default\nPriority:     0\nNode:         k8s-node1/10.0.0.101\nStart Time:   Wed, 24 Apr 2024 06:49:02 -0400\nLabels:       type=app\n              version=1.0.x\nAnnotations:  cni.projectcalico.org/containerID: bb27fe44a58187928bced7bb6a76234c1717ea8a000d35e8948796a7970b548a\n              cni.projectcalico.org/podIP: 192.168.36.73/32\n              cni.projectcalico.org/podIPs: 192.168.36.73/32\nStatus:       Running\nIP:           192.168.36.73\nIPs:\n  IP:  192.168.36.73\nContainers:\n  nginx:\n    Container ID:  docker://71f60f7711b116cf0a6dfa8041381f83c51d40b35ef15f4c0c8756e12ce45c33\n    Image:         nginx:1.26.0\n    Image ID:      docker-pullable://nginx@sha256:3f28ecedbd787b3ff0a6d56cd4a1b13901acda532c717e3b7351fcc786973d79\n    Port:          80/TCP\n    Host Port:     0/TCP\n    Command:\n      nginx\n      -g\n      daemon off;\n    State:          Running\n      Started:      Wed, 24 Apr 2024 06:49:03 -0400\n    Ready:          True\n    Restart Count:  0\n    Limits:\n      cpu:     200m\n      memory:  256Mi\n    Requests:\n      cpu:     100m\n      memory:  128Mi\n    Environment:\n      JVM-OPTS:  -Xms128m -Xmx128m\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-mkwwb (ro)\nConditions:\n  Type              Status\n  Initialized       True \n  Ready             True \n  ContainersReady   True \n  PodScheduled      True \nVolumes:\n  kube-api-access-mkwwb:\n    Type:                    Projected (a volume that contains injected data from multiple sources)\n    TokenExpirationSeconds:  3607\n    ConfigMapName:           kube-root-ca.crt\n    ConfigMapOptional:       &lt;nil&gt;\n    DownwardAPI:             true\nQoS Class:                   Burstable\nNode-Selectors:              &lt;none&gt;\nTolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s\n                            node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\nEvents:\n  Type    Reason     Age    From               Message\n  ----    ------     ----   ----               -------\n  Normal  Scheduled  3m55s  default-scheduler  Successfully assigned default/my-nginx to k8s-node1\n  Normal  Pulled     3m55s  kubelet            Container image \"nginx:1.26.0\" already present on machine\n  Normal  Created    3m55s  kubelet            Created container nginx\n  Normal  Started    3m55s  kubelet            Started container nginx\n[root@k8s-master pods]# \n</code></pre>","tags":["k8s","k8s-pod"]},{"location":"blog/2024/04/24/k8s-podprobe/","title":"k8s PodProbe","text":"","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>Probe Official docs</li> </ul>","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#_2","title":"\u63a2\u9488\u4e09\u4e2a\u7c7b\u578b","text":"<p>The kubelet uses liveness probes to know when to restart a container. For example, liveness probes could catch a deadlock, where an application is running, but unable to make progress. Restarting a container in such a state can help to make the application more available despite bugs.</p>","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#1-startupprobe","title":"1. StartupProbe","text":"<p>k8s 1.16 \u7248\u672c\u65b0\u589e\u7684\u63a2\u9488\uff0c\u7528\u4e8e\u5224\u65ad\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u5df2\u7ecf\u542f\u52a8\u4e86\u3002</p> <p>\u5f53\u914d\u7f6e\u4e86 startupProbe \u540e\uff0c\u4f1a\u5148\u7981\u7528\u5176\u4ed6\u63a2\u9488\uff0c\u76f4\u5230 startupProbe \u6210\u529f\u540e\uff0c\u5176\u4ed6\u63a2\u9488\u624d\u4f1a\u7ee7\u7eed\u3002</p> <p>\u4f5c\u7528\uff1a\u7531\u4e8e\u6709\u65f6\u5019\u4e0d\u80fd\u51c6\u786e\u9884\u4f30\u5e94\u7528\u4e00\u5b9a\u662f\u591a\u957f\u65f6\u95f4\u542f\u52a8\u6210\u529f\uff0c\u56e0\u6b64\u914d\u7f6e\u53e6\u5916\u4e24\u79cd\u65b9\u5f0f\u4e0d\u65b9\u4fbf\u914d\u7f6e\u521d\u59cb\u5316\u65f6\u957f\u6765\u68c0\u6d4b\uff0c\u800c\u914d\u7f6e\u4e86 statupProbe \u540e\uff0c\u53ea\u6709\u5728\u5e94\u7528\u542f\u52a8\u6210\u529f\u4e86\uff0c\u624d\u4f1a\u6267\u884c\u53e6\u5916\u4e24\u79cd\u63a2\u9488\uff0c\u53ef\u4ee5\u66f4\u52a0\u65b9\u4fbf\u7684\u7ed3\u5408\u4f7f\u7528\u53e6\u5916\u4e24\u79cd\u63a2\u9488\u4f7f\u7528\u3002</p> <pre><code>startupProbe:\n  httpGet:\n    path: /api/startup\n    port: 80\n</code></pre>","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#2-livenessprobe","title":"2. LivenessProbe","text":"<p>\u7528\u4e8e\u63a2\u6d4b\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u662f\u5426\u8fd0\u884c\uff0c\u5982\u679c\u63a2\u6d4b\u5931\u8d25\uff0ckubelet \u4f1a\u6839\u636e\u914d\u7f6e\u7684\u91cd\u542f\u7b56\u7565\u8fdb\u884c\u91cd\u542f\uff0c\u82e5\u6ca1\u6709\u914d\u7f6e\uff0c\u9ed8\u8ba4\u5c31\u8ba4\u4e3a\u5bb9\u5668\u542f\u52a8\u6210\u529f\uff0c\u4e0d\u4f1a\u6267\u884c\u91cd\u542f\u7b56\u7565\u3002 <pre><code>livenessProbe:\n  failureThreshold: 5\n  httpGet:\n    path: /health\n    port: 8080\n    scheme: HTTP\n  initialDelaySeconds: 60\n  periodSeconds: 10\n  successThreshold: 1\n  timeoutSeconds: 5\n</code></pre></p>","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#3-readinessprobe","title":"3. ReadinessProbe","text":"<p>\u7528\u4e8e\u63a2\u6d4b\u5bb9\u5668\u5185\u7684\u7a0b\u5e8f\u662f\u5426\u5065\u5eb7\uff0c\u5b83\u7684\u8fd4\u56de\u503c\u5982\u679c\u8fd4\u56de success\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a\u8be5\u5bb9\u5668\u5df2\u7ecf\u5b8c\u5168\u542f\u52a8\uff0c\u5e76\u4e14\u8be5\u5bb9\u5668\u662f\u53ef\u4ee5\u63a5\u6536\u5916\u90e8\u6d41\u91cf\u7684\u3002 <pre><code>readinessProbe:\n  failureThreshold: 3 # \u9519\u8bef\u6b21\u6570\n  httpGet:\n    path: /ready\n    port: 8181\n    scheme: HTTP\n  periodSeconds: 10 # \u95f4\u9694\u65f6\u95f4\n  successThreshold: 1\n  timeoutSeconds: 1\n</code></pre></p>","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#_3","title":"\u63a2\u6d4b\u65b9\u6cd5","text":"","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#1-execaction","title":"1. ExecAction","text":"<p>\u5728\u5bb9\u5668\u5185\u90e8\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\uff0c\u5982\u679c\u8fd4\u56de\u503c\u4e3a 0\uff0c\u5219\u4efb\u52a1\u5bb9\u5668\u65f6\u5065\u5eb7\u7684\u3002 <pre><code>livenessProbe:\n  exec:\n    command:\n      - cat\n      - /health\n</code></pre></p>","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#2-tcpsocketaction","title":"2. TCPSocketAction","text":"<p>\u901a\u8fc7 tcp \u8fde\u63a5\u76d1\u6d4b\u5bb9\u5668\u5185\u7aef\u53e3\u662f\u5426\u5f00\u653e\uff0c\u5982\u679c\u5f00\u653e\u5219\u8bc1\u660e\u8be5\u5bb9\u5668\u5065\u5eb7 <pre><code>livenessProbe:\n  tcpSocket:\n    port: 80\n</code></pre></p>","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#3-httpgetaction","title":"3. HTTPGetAction","text":"<p>\u751f\u4ea7\u73af\u5883\u7528\u7684\u8f83\u591a\u7684\u65b9\u5f0f\uff0c\u53d1\u9001 HTTP \u8bf7\u6c42\u5230\u5bb9\u5668\u5185\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5982\u679c\u63a5\u53e3\u8fd4\u56de\u7684\u72b6\u6001\u7801\u5728 200~400 \u4e4b\u95f4\uff0c\u5219\u8ba4\u4e3a\u5bb9\u5668\u5065\u5eb7\u3002</p> <pre><code>livenessProbe:\n  failureThreshold: 5\n  httpGet:\n    path: /health\n    port: 8080\n    scheme: HTTP\n    httpHeaders:\n      - name: xxx\n        value: xxx\n</code></pre>","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-podprobe/#_4","title":"\u53c2\u6570\u914d\u7f6e","text":"<ul> <li>initialDelaySeconds: 60 # \u521d\u59cb\u5316\u65f6\u95f4</li> <li>timeoutSeconds: 2 # \u8d85\u65f6\u65f6\u95f4</li> <li>periodSeconds: 5 # \u76d1\u6d4b\u95f4\u9694\u65f6\u95f4</li> <li>successThreshold: 1 # \u68c0\u67e5 1 \u6b21\u6210\u529f\u5c31\u8868\u793a\u6210\u529f</li> <li>failureThreshold: 2 # \u76d1\u6d4b\u5931\u8d25 2 \u6b21\u5c31\u8868\u793a\u5931\u8d25</li> </ul>","tags":["k8s"]},{"location":"blog/2024/04/24/k8s-pod-lifecycle/","title":"k8s Pod Lifecycle","text":"<p>This page describes the lifecycle of a Pod. Pods follow a defined lifecycle, starting in the Pending phase, moving through Running if at least one of its primary containers starts OK, and then through either the Succeeded or Failed phases depending on whether any container in the Pod terminated in failure.</p> <p></p>","tags":["LifeCycle"]},{"location":"blog/2024/04/24/k8s-pod-lifecycle/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>Pod Lifecycle Official docs</li> </ul>","tags":["LifeCycle"]},{"location":"blog/2024/04/27/k8s-ingress/","title":"K8s Ingress","text":"<p>Ingress</p>"},{"location":"blog/2024/04/27/k8s-ingress/#ingress-nginx","title":"\u5b89\u88c5Ingress-nginx","text":"<p>Ingress-nginx official github</p>"},{"location":"blog/2024/04/27/k8s-ingress/#helm","title":"\u6dfb\u52a0helm\u4ed3\u5e93","text":"<pre><code># \u6dfb\u52a0\u4ed3\u5e93\nhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\n\n# \u67e5\u770b\u4ed3\u5e93\u5217\u8868\nhelm repo list\n\n# \u641c\u7d22 ingress-nginx\nhelm search repo ingress-nginx\n</code></pre>"},{"location":"blog/2024/04/27/k8s-ingress/#_1","title":"\u4e0b\u8f7d\u5305","text":"<pre><code># \u4e0b\u8f7d\u5b89\u88c5\u5305\nhelm pull ingress-nginx/ingress-nginx\n</code></pre>"},{"location":"blog/2024/04/27/k8s-ingress/#_2","title":"\u914d\u7f6e\u53c2\u6570","text":"<ul> <li>\u5c06\u4e0b\u8f7d\u597d\u7684\u5b89\u88c5\u5305\u89e3\u538b <pre><code>tar xf ingress-nginx-xxx.tgz\n</code></pre></li> <li>\u89e3\u538b\u540e\uff0c\u8fdb\u5165\u89e3\u538b\u5b8c\u6210\u7684\u76ee\u5f55 <pre><code>cd ingress-nginx\n</code></pre></li> <li>\u4fee\u6539 values.yaml \u955c\u50cf\u5730\u5740\uff1a\u4fee\u6539\u4e3a\u56fd\u5185\u955c\u50cf <pre><code>registry: registry.cn-hangzhou.aliyuncs.com\nimage: google_containers/nginx-ingress-controller\nimage: google_containers/kube-webhook-certgen\ntag: v1.3.0\n\nhostNetwork: true\ndnsPolicy: ClusterFirstWithHostNet\n</code></pre></li> <li>\u4fee\u6539\u90e8\u7f72\u914d\u7f6e\u7684 kind: DaemonSet <pre><code>nodeSelector:\n  ingress: \"true\" # \u589e\u52a0\u9009\u62e9\u5668\uff0c\u5982\u679c node \u4e0a\u6709 ingress=true \u5c31\u90e8\u7f72\n\u5c06 admissionWebhooks.enabled \u4fee\u6539\u4e3a false\n\u5c06 service \u4e2d\u7684 type \u7531 LoadBalancer \u4fee\u6539\u4e3a ClusterIP\uff0c\u5982\u679c\u670d\u52a1\u5668\u662f\u4e91\u5e73\u53f0\u624d\u7528 LoadBalancer\n</code></pre></li> </ul>"},{"location":"blog/2024/04/27/k8s-ingress/#namespace","title":"\u521b\u5efaNamespace","text":"<ul> <li>\u4e3a ingress \u4e13\u95e8\u521b\u5efa\u4e00\u4e2a namespace <pre><code>kubectl create ns ingress-nginx\n</code></pre></li> </ul>"},{"location":"blog/2024/04/27/k8s-ingress/#ingress","title":"\u5b89\u88c5Ingress","text":"<ul> <li>\u4e3a\u9700\u8981\u90e8\u7f72 ingress \u7684\u8282\u70b9\u4e0a\u52a0\u6807\u7b7e <pre><code>kubectl label node &lt;node-name&gt; ingress=true\n</code></pre></li> <li>\u5b89\u88c5 ingress-nginx <pre><code>helm install ingress-nginx ./ingress-nginx -n ingress-nginx\n</code></pre></li> </ul>"},{"location":"blog/2024/04/27/k8s-ingress/#_3","title":"\u57fa\u672c\u4f7f\u7528","text":""},{"location":"blog/2024/04/27/k8s-ingress/#ingress_1","title":"\u521b\u5efa\u4e00\u4e2aIngress","text":"<p>\u53c2\u8003\u94fe\u63a5</p> <ul> <li>\u5b98\u65b9\u8bf4\u660e\uff1apath type</li> </ul> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress # \u8d44\u6e90\u7c7b\u578b\u4e3a Ingress\nmetadata:\n  name: wolfcode-nginx-ingress\n  annotations:\n    kubernetes.io/ingress.class: \"nginx\"\n    nginx.ingress.kubernetes.io/rewrite-target: /\nspec:\n  rules: # ingress \u89c4\u5219\u914d\u7f6e\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\n  - host: k8s.wolfcode.cn # \u57df\u540d\u914d\u7f6e\uff0c\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26 *\n    http:\n      paths: # \u76f8\u5f53\u4e8e nginx \u7684 location \u914d\u7f6e\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\n      - pathType: Prefix # \u8def\u5f84\u7c7b\u578b\uff0c\u6309\u7167\u8def\u5f84\u7c7b\u578b\u8fdb\u884c\u5339\u914d ImplementationSpecific \u9700\u8981\u6307\u5b9a IngressClass\uff0c\u5177\u4f53\u5339\u914d\u89c4\u5219\u4ee5 IngressClass \u4e2d\u7684\u89c4\u5219\u4e3a\u51c6\u3002Exact\uff1a\u7cbe\u786e\u5339\u914d\uff0cURL\u9700\u8981\u4e0epath\u5b8c\u5168\u5339\u914d\u4e0a\uff0c\u4e14\u533a\u5206\u5927\u5c0f\u5199\u7684\u3002Prefix\uff1a\u4ee5 / \u4f5c\u4e3a\u5206\u9694\u7b26\u6765\u8fdb\u884c\u524d\u7f00\u5339\u914d\n        backend:\n          service: \n            name: nginx-svc # \u4ee3\u7406\u5230\u54ea\u4e2a service\n            port: \n              number: 80 # service \u7684\u7aef\u53e3\n        path: /api # \u7b49\u4ef7\u4e8e nginx \u4e2d\u7684 location \u7684\u8def\u5f84\u524d\u7f00\u5339\u914d\n</code></pre>"},{"location":"blog/2024/04/27/k8s-ingress/#_4","title":"\u591a\u57df\u540d\u914d\u7f6e","text":"<pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress # \u8d44\u6e90\u7c7b\u578b\u4e3a Ingress\nmetadata:\n  name: wolfcode-nginx-ingress\n  annotations:\n    kubernetes.io/ingress.class: \"nginx\"\n    nginx.ingress.kubernetes.io/rewrite-target: /\nspec:\n  rules: # ingress \u89c4\u5219\u914d\u7f6e\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\n  - host: k8s.wolfcode.cn # \u57df\u540d\u914d\u7f6e\uff0c\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26 *\n    http:\n      paths: # \u76f8\u5f53\u4e8e nginx \u7684 location \u914d\u7f6e\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\n      - pathType: Prefix # \u8def\u5f84\u7c7b\u578b\uff0c\u6309\u7167\u8def\u5f84\u7c7b\u578b\u8fdb\u884c\u5339\u914d ImplementationSpecific \u9700\u8981\u6307\u5b9a IngressClass\uff0c\u5177\u4f53\u5339\u914d\u89c4\u5219\u4ee5 IngressClass \u4e2d\u7684\u89c4\u5219\u4e3a\u51c6\u3002Exact\uff1a\u7cbe\u786e\u5339\u914d\uff0cURL\u9700\u8981\u4e0epath\u5b8c\u5168\u5339\u914d\u4e0a\uff0c\u4e14\u533a\u5206\u5927\u5c0f\u5199\u7684\u3002Prefix\uff1a\u4ee5 / \u4f5c\u4e3a\u5206\u9694\u7b26\u6765\u8fdb\u884c\u524d\u7f00\u5339\u914d\n        backend:\n          service: \n            name: nginx-svc # \u4ee3\u7406\u5230\u54ea\u4e2a service\n            port: \n              number: 80 # service \u7684\u7aef\u53e3\n        path: /api # \u7b49\u4ef7\u4e8e nginx \u4e2d\u7684 location \u7684\u8def\u5f84\u524d\u7f00\u5339\u914d\n      - pathType: Exec # \u8def\u5f84\u7c7b\u578b\uff0c\u6309\u7167\u8def\u5f84\u7c7b\u578b\u8fdb\u884c\u5339\u914d ImplementationSpecific \u9700\u8981\u6307\u5b9a IngressClass\uff0c\u5177\u4f53\u5339\u914d\u89c4\u5219\u4ee5 IngressClass \u4e2d\u7684\u89c4\u5219\u4e3a\u51c6\u3002Exact\uff1a\u7cbe\u786e\u5339\u914d&gt;\uff0cURL\u9700\u8981\u4e0epath\u5b8c\u5168\u5339\u914d\u4e0a\uff0c\u4e14\u533a\u5206\u5927\u5c0f\u5199\u7684\u3002Prefix\uff1a\u4ee5 / \u4f5c\u4e3a\u5206\u9694\u7b26\u6765\u8fdb\u884c\u524d\u7f00\u5339\u914d\n        backend:\n          service:\n            name: nginx-svc # \u4ee3\u7406\u5230\u54ea\u4e2a service\n            port:\n              number: 80 # service \u7684\u7aef\u53e3\n        path: /\n  - host: api.wolfcode.cn # \u57df\u540d\u914d\u7f6e\uff0c\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26 *\n    http:\n      paths: # \u76f8\u5f53\u4e8e nginx \u7684 location \u914d\u7f6e\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\n      - pathType: Prefix # \u8def\u5f84\u7c7b\u578b\uff0c\u6309\u7167\u8def\u5f84\u7c7b\u578b\u8fdb\u884c\u5339\u914d ImplementationSpecific \u9700\u8981\u6307\u5b9a IngressClass\uff0c\u5177\u4f53\u5339\u914d\u89c4\u5219\u4ee5 IngressClass \u4e2d\u7684\u89c4\u5219\u4e3a\u51c6\u3002Exact\uff1a\u7cbe\u786e\u5339\u914d&gt;\uff0cURL\u9700\u8981\u4e0epath\u5b8c\u5168\u5339\u914d\u4e0a\uff0c\u4e14\u533a\u5206\u5927\u5c0f\u5199\u7684\u3002Prefix\uff1a\u4ee5 / \u4f5c\u4e3a\u5206\u9694\u7b26\u6765\u8fdb\u884c\u524d\u7f00\u5339\u914d\n        backend:\n          service:\n            name: nginx-svc # \u4ee3\u7406\u5230\u54ea\u4e2a service\n            port:\n              number: 80 # service \u7684\u7aef\u53e3\n        path: /\n</code></pre>"},{"location":"blog/2024/04/27/k8s-service/","title":"K8s service","text":""},{"location":"blog/2024/04/27/k8s-service/#service","title":"Service \u5b9a\u4e49","text":"<p>  k8s Service A Service is an object (the same way that a Pod or a ConfigMap is an object). You can create, view or modify Service definitions using the Kubernetes API. Usually you use a tool such as kubectl to make those API calls for you.</p> <p></p>"},{"location":"blog/2024/04/27/k8s-service/#_1","title":"\u64cd\u4f5c\u547d\u4ee4","text":"\u914d\u7f6e\u6587\u4ef6<pre><code>apiVersion: v1\nkind: Service #\u8d44\u6e90\u7c7b\u578b\uff1aService\nmetadata:\n  name: nginx-svc #Service \u540d\u5b57\n  labels:\n    app: nginx  #Service\u81ea\u5df1\u672c\u8eab\u7684\u6807\u7b7e\nspec:\n  ports: #\u7aef\u53e3\u6620\u5c04\n  - port: 80  #Service\u81ea\u5df1\u7684\u7aef\u53e3\uff0c\u5728\u4f7f\u7528\u5185\u7f51ip\u8bbf\u95ee\u65f6\u5019\u4f7f\u7528\n    targetPort: 80  #\u76ee\u6807po\u7684\u7aef\u53e3\n    name: web #\u4e3a\u7aef\u53e3\u8d77\u7684\u540d\u5b57\n  selector:  #\u5339\u914d\u54ea\u4e9bpod\u4f1a\u88ab\u8be5Service\u4ee3\u7406\n    app: nginx-deploy #\u6240\u6709\u5339\u914d\u5230\u8be5\u6807\u7b7e\u7684pod\u90fd\u53ef\u4ee5\u901a\u8fc7\u8be5Service\u8fdb\u884c\u7f51\u7edc\u8bbf\u95ee\n  type: NodePort #1.\u968f\u673a\u542f\u52a8\u4e00\u4e2a\u7aef\u53e3\uff083000~32767\uff09\uff0c\u6620\u5c04\u5230ports\u4e2d\u7684\u7aef\u53e3,\u76f4\u63a5\u7ed1\u5b9a\u5230node\u4e0a\uff0c\u5207\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2anode\u90fd\u4f1a\u7ed1\u5b9a\u5230\u8fd9\u4e2a\u7aef\u53e3\u3002\n                #2.\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5c06\u670d\u52a1\u66b4\u9732\u7ed9\u5916\u90e8\u8bbf\u95ee\uff0c\u4f46\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e0d\u63a8\u8350\uff0c\u6548\u7387\u4f4e\uff0c\u800c\u4e14Service\u662f\u56db\u5c42\u8d1f\u8f7d\uff0c\u800c\u662f\u7528ingress\n                #\uff08\u8fd9\u4e2atype\u7c7b\u578b\u6709\uff1aNodePort\u3001ClusterIP\u3001ExternalName\u3001LoadBalancer\uff09\n</code></pre> <p>\u521b\u5efa service <pre><code>kubectl create -f nginx-svc.yaml\n</code></pre> \u67e5\u770b service \u4fe1\u606f\uff0c\u901a\u8fc7 service \u7684 cluster ip \u8fdb\u884c\u8bbf\u95ee <pre><code>kubectl get svc \n</code></pre> \u67e5\u770b pod \u4fe1\u606f\uff0c\u901a\u8fc7 pod \u7684 ip \u8fdb\u884c\u8bbf\u95ee <pre><code>kubectl get po -owide\n</code></pre> \u521b\u5efa\u5176\u4ed6 pod \u901a\u8fc7 service name \u8fdb\u884c\u8bbf\u95ee\uff08\u63a8\u8350\uff09exec\u5b98\u65b9\u89e3\u91ca <pre><code>kubectl exec -it busybox -- sh\ncurl http://nginx-svc\n\n#\u521b\u5efa\u7684\u547d\u4ee4\uff1a kubectl run -it --image busbox dns-test -- /bin/sh\n</code></pre> \u9ed8\u8ba4\u5728\u5f53\u524d namespace \u4e2d\u8bbf\u95ee\uff0c\u5982\u679c\u9700\u8981\u8de8 namespace \u8bbf\u95ee pod\uff0c\u5219\u5728 service name \u540e\u9762\u52a0\u4e0a . \u5373\u53ef <pre><code>curl http://nginx-svc.default\n</code></pre>"},{"location":"blog/2024/04/27/k8s-service/#endpoint","title":"Endpoint","text":"<pre><code>apiVersion: v1\nkind: Endpoints\nmetadata:\n  labels:\n    app: nginx # \u4e0e service \u4e00\u81f4\n  name: nginx-svc-external # \u4e0e service \u4e00\u81f4\n  namespace: default # \u4e0e service \u4e00\u81f4\nsubsets:\n- addresses:\n  - ip: 120.78.159.117 # \u76ee\u6807 ip \u5730\u5740\n  ports: # \u4e0e service \u4e00\u81f4\n  - name: web #\u4e0eservice\u4e00\u81f4\n    port: 80\n    protocol: TCP\n    ```\n\n## \u4ee3\u7406k8s\u5916\u90e8\u670d\u52a1\n```yaml\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: wolfcode-external-domain\n  name: wolfcode-external-domain\nspec:\n  type: ExternalName\n  externalName: www.wolfcode.cn\n</code></pre>"},{"location":"blog/2024/04/27/k8s-service/#_2","title":"\u53cd\u5411\u4ee3\u7406\u5916\u90e8\u57df\u540d","text":"<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: wolfcode-external-domain\n  name: wolfcode-external-domain\nspec:\n  type: ExternalName\n  externalName: www.wolfcode.cn\n</code></pre>"},{"location":"blog/2024/04/27/k8s-service/#_3","title":"\u5e38\u7528\u7c7b\u578b","text":"<ul> <li>ClusterIP</li> </ul> <p>\u53ea\u80fd\u5728\u96c6\u7fa4\u5185\u90e8\u4f7f\u7528\uff0c\u4e0d\u914d\u7f6e\u7c7b\u578b\u7684\u8bdd\u9ed8\u8ba4\u5c31\u662f ClusterIP</p> <ul> <li>ExternalName</li> </ul> <p>\u8fd4\u56de\u5b9a\u4e49\u7684 CNAME \u522b\u540d\uff0c\u53ef\u4ee5\u914d\u7f6e\u4e3a\u57df\u540d</p> <ul> <li>NodePort</li> </ul> <p>\u4f1a\u5728\u6240\u6709\u5b89\u88c5\u4e86 <code>kube-proxy</code> \u7684\u8282\u70b9\u90fd\u7ed1\u5b9a\u4e00\u4e2a\u7aef\u53e3\uff0c\u6b64\u7aef\u53e3\u53ef\u4ee5\u4ee3\u7406\u81f3\u5bf9\u5e94\u7684 Pod\uff0c\u96c6\u7fa4\u5916\u90e8\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f\u8282\u70b9 ip + NodePort \u7684\u7aef\u53e3\u53f7\u8bbf\u95ee\u5230\u96c6\u7fa4\u4e2d\u5bf9\u5e94 Pod \u4e2d\u7684\u670d\u52a1\u3002</p> <p>\u5f53\u7c7b\u578b\u8bbe\u7f6e\u4e3a NodePort \u540e\uff0c\u53ef\u4ee5\u5728 ports \u914d\u7f6e\u4e2d\u589e\u52a0 nodePort \u914d\u7f6e\u6307\u5b9a\u7aef\u53e3\uff0c\u9700\u8981\u5728\u4e0b\u65b9\u7684\u7aef\u53e3\u8303\u56f4\u5185\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u4f1a\u968f\u673a\u6307\u5b9a\u7aef\u53e3</p> <p>\u7aef\u53e3\u8303\u56f4\uff1a<code>30000~32767</code></p> <p>\u7aef\u53e3\u8303\u56f4\u914d\u7f6e\u5728 <code>/usr/lib/systemd/system/kube-apiserver.service</code> \u6587\u4ef6\u4e2d</p> <ul> <li>LoadBalancer</li> </ul> <p>\u4f7f\u7528\u4e91\u670d\u52a1\u5546\uff08\u963f\u91cc\u4e91\u3001\u817e\u8baf\u4e91\u7b49\uff09\u63d0\u4f9b\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u670d\u52a1</p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/","title":"k8s Resources Schedule","text":""},{"location":"blog/2024/04/25/k8s-resources-schedule/#_1","title":"\u76f8\u5173\u6982\u5ff5","text":"<ul> <li>Deployment: \u90e8\u7f72\u5305\u542bRS\u3001\u521b\u5efaRS\u548cpod\uff0c\u5bf9\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u6eda\u52a8\u66f4\u65b0/\u6eda\u52a8\u3001\u52a8\u6001\u6269\u7f29\u5bb9\u7b49 \uff08RS:111\uff09</li> <li>RS(ReplicaSet): \u526f\u672c\u96c6\uff0c\u7ba1\u7406Pod\u526f\u672c\u6269\u5bb9/\u7f29\u5bb9</li> <li>Selector: \u67e5\u8be2\u5668\uff0c\u76f8\u5f53\u4e8e\u67e5\u8be2\u6761\u4ef6\uff1atype=xxx,name!=xxxx</li> <li>StatefulSet : \u4e13\u95e8\u5bf9\u6709\u72b6\u6001\u670d\u52a1\u8fdb\u884c\u90e8\u7f72\u7684\u4e00\u4e2a\u63a7\u5236\u5668</li> </ul>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#labelselector-usage","title":"\u4e00. Label&amp;Selector Usage","text":""},{"location":"blog/2024/04/25/k8s-resources-schedule/#label","title":"Label","text":""},{"location":"blog/2024/04/25/k8s-resources-schedule/#_2","title":"\u4e34\u65f6\u521b\u5efa\u6807\u7b7e","text":"<pre><code>[root@k8s-master pods]# kubectl label po &lt;pod name&gt; app=hello\npod/my-nginx labeled\n</code></pre>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#pod","title":"\u67e5\u770bpod\u7684\u6807\u7b7e","text":"<pre><code>[root@k8s-master pods]# kubectl get po --show-labels\nNAME       READY   STATUS    RESTARTS   AGE     LABELS\nmy-nginx   1/1     Running   0          3m10s   app=hello,type=app,version=1.0.x\n</code></pre>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_3","title":"\u4fee\u6539\u5df2\u5b58\u5728\u7684\u6807\u7b7e","text":"<pre><code>kubectl label po &lt;pod name&gt; app=hello222\n</code></pre>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#selector","title":"Selector","text":""},{"location":"blog/2024/04/25/k8s-resources-schedule/#_4","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p>\u5728\u5404\u5bf9\u8c61\u7684\u914d\u7f6e spec.selector \u6216\u5176\u4ed6\u53ef\u4ee5\u5199 selector \u7684\u5c5e\u6027\u4e2d\u7f16\u5199</p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#kubectl","title":"kubectl","text":"<p>\u5339\u914d\u5355\u4e2a\u503c\uff0c\u67e5\u627e app=hello \u7684 pod <pre><code>kubectl get po -A -l app=hello\n</code></pre>  \u5339\u914d\u591a\u4e2a\u503c <pre><code>kubectl get po -A -l 'k8s-app in (metrics-server, kubernetes-dashboard)'\n</code></pre> \u6216\u67e5\u627e version!=1 and app=nginx \u7684 pod \u4fe1\u606f <pre><code>kubectl get po -l version!=1,app=nginx\n</code></pre> \u4e0d\u7b49\u503c + \u8bed\u53e5 <pre><code>kubectl get po -A -l version!=1,'app in (busybox, nginx)'\n</code></pre></p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#deployment-usage","title":"\u4e8c. Deployment Usage","text":""},{"location":"blog/2024/04/25/k8s-resources-schedule/#i","title":"\u2160. \u529f\u80fd","text":""},{"location":"blog/2024/04/25/k8s-resources-schedule/#_5","title":"\u521b\u5efa\u8d44\u6e90","text":"<p>\u547d\u4ee4\u884c\u521b\u5efa\u4e00\u4e2a deployment <pre><code>kubectl create deploy nginx-deploy --image=nginx:1.26.0 \n#\u4e5f\u53ef\u4ee5\u540e\u9762\u52a0 -o yaml \u4ee5yaml\u683c\u5f0f\u628a\u5185\u5bb9\u8f93\u51fa\uff0c\u5e76\u521b\u5efa\u8d44\u6e90\n#\u4e5f\u53ef\u4ee5\u540e\u9762\u52a0 -o yaml &gt; xxx.yaml \u4ee5yaml\u683c\u5f0f\u628a\u5185\u5bb9\u8f93\u51fa\u5230xxx.yaml\u6587\u4ef6\uff0c\u5e76\u521b\u5efa\u8d44\u6e90\n</code></pre> \u6216\u6267\u884c <pre><code>kubectl create -f xxx.yaml --record\n#--record \u4f1a\u5728 annotation \u4e2d\u8bb0\u5f55\u5f53\u524d\u547d\u4ee4\u521b\u5efa\u6216\u5347\u7ea7\u4e86\u8d44\u6e90\uff0c\u540e\u7eed\u53ef\u4ee5\u67e5\u770b\u505a\u8fc7\u54ea\u4e9b\u53d8\u52a8\u64cd\u4f5c\u3002\n</code></pre> \u67e5\u770b\u90e8\u7f72\u4fe1\u606f <pre><code>[root@k8s-master deployments]# kubectl get deploy\nNAME           READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deploy   1/1     1            1           2m4s\n[root@k8s-master deployments]# kubectl get replicaset\nNAME                      DESIRED   CURRENT   READY   AGE\nnginx-deploy-744cbf6b5c   1         1         1       2m8s\n[root@k8s-master deployments]# kubectl get pod\nNAME                            READY   STATUS    RESTARTS   AGE\nmy-nginx                        1/1     Running   0          71m\nnginx-deploy-744cbf6b5c-kl48m   1/1     Running   0          2m12s\n[root@k8s-master deployments]# \n</code></pre></p> Tip <p>\u901a\u8fc7\u67e5\u8be2\u6ce8\u610f\u5230\uff0c\u901a\u8fc7deployment\u521b\u5efa\u7684\u8d44\u6e90\uff0cpod name\uff0crs name \uff0cdeployment name \u4e09\u8005\u6709\u5bf9\u5e94\u7684\u5173\u7cfb\u3002</p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_6","title":"\u6eda\u52a8\u66f4\u65b0","text":"<p>\u53ea\u6709\u4fee\u6539\u4e86 k8s\u96c6\u7fa4\u7684 deployment \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 template  \u4e2d\u7684\u5c5e\u6027\u540e\uff0c\u624d\u4f1a\u89e6\u53d1\u66f4\u65b0\u64cd\u4f5c <pre><code>[root@k8s-master deployments]# kubectl get deploy\nNAME           READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deploy   1/1     1            1           29m\n[root@k8s-master deployments]# kubectl edit deploy nginx-deploy\n</code></pre></p> <p>\u4fee\u6539 nginx \u7248\u672c\u53f7 <pre><code>kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1\n\n#\u6216\u8005\u901a\u8fc7 kubectl edit deployment/nginx-deployment \u8fdb\u884c\u4fee\u6539\n</code></pre></p> <p>\u67e5\u770b\u6eda\u52a8\u66f4\u65b0\u7684\u8fc7\u7a0b <pre><code>kubectl rollout status deploy &lt;deployment_name&gt;\n</code></pre></p> <p>\u67e5\u770b\u90e8\u7f72\u63cf\u8ff0\uff0c\u6700\u540e\u5c55\u793a\u53d1\u751f\u7684\u4e8b\u4ef6\u5217\u8868\u4e5f\u53ef\u4ee5\u770b\u5230\u6eda\u52a8\u66f4\u65b0\u8fc7\u7a0b <pre><code>kubectl describe deploy &lt;deployment_name&gt;\n</code></pre></p> <ul> <li> <p>\u901a\u8fc7 kubectl get deployments \u83b7\u53d6\u90e8\u7f72\u4fe1\u606f\uff0cUP-TO-DATE \u8868\u793a\u5df2\u7ecf\u6709\u591a\u5c11\u526f\u672c\u8fbe\u5230\u4e86\u914d\u7f6e\u4e2d\u8981\u6c42\u7684\u6570\u76ee</p> </li> <li> <p>\u901a\u8fc7 kubectl get rs \u53ef\u4ee5\u770b\u5230\u589e\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684 rs</p> </li> <li> <p>\u901a\u8fc7 kubectl get pods \u53ef\u4ee5\u770b\u5230\u6240\u6709 pod \u5173\u8054\u7684 rs \u53d8\u6210\u4e86\u65b0\u7684</p> </li> </ul> <p>\u591a\u4e2a\u6eda\u52a8\u66f4\u65b0\u5e76\u884c</p> <ul> <li>\u5047\u8bbe\u5f53\u524d\u6709 5 \u4e2a nginx:1.7.9 \u7248\u672c\uff0c\u4f60\u60f3\u5c06\u7248\u672c\u66f4\u65b0\u4e3a 1.9.1\uff0c\u5f53\u66f4\u65b0\u6210\u529f\u7b2c\u4e09\u4e2a\u4ee5\u540e\uff0c\u4f60\u9a6c\u4e0a\u53c8\u5c06\u671f\u671b\u66f4\u65b0\u7684\u7248\u672c\u6539\u4e3a 1.9.2\uff0c\u90a3\u4e48\u6b64\u65f6\u4f1a\u7acb\u9a6c\u5220\u9664\u4e4b\u524d\u7684\u4e09\u4e2a\uff0c\u5e76\u4e14\u7acb\u9a6c\u5f00\u542f\u66f4\u65b0 1.9.2 \u7684\u4efb\u52a1</li> </ul>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_7","title":"\u56de\u6eda","text":"<p>\u6709\u65f6\u5019\u4f60\u53ef\u80fd\u60f3\u56de\u9000\u4e00\u4e2aDeployment\uff0c\u4f8b\u5982\uff0c\u5f53Deployment\u4e0d\u7a33\u5b9a\u65f6\uff0c\u6bd4\u5982\u4e00\u76f4crash looping\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ckubernetes\u4f1a\u5728\u7cfb\u7edf\u4e2d\u4fdd\u5b58\u524d\u4e24\u6b21\u7684Deployment\u7684rollout\u5386\u53f2\u8bb0\u5f55\uff0c\u4ee5\u4fbf\u4f60\u53ef\u4ee5\u968f\u65f6\u4f1a\u9000\uff08\u4f60\u53ef\u4ee5\u4fee\u6539revision history limit\u6765\u66f4\u6539\u4fdd\u5b58\u7684revision\u6570\uff09\u3002</p> <p>\u6848\u4f8b\uff1a \u66f4\u65b0 deployment \u65f6\u53c2\u6570\u4e0d\u5c0f\u5fc3\u5199\u9519\uff0c\u5982 nginx:1.9.1 \u5199\u6210\u4e86 nginx:1.91 <pre><code>kubectl set image deployment/nginx-deploy nginx=nginx:1.91\n</code></pre></p> <p>\u76d1\u63a7\u6eda\u52a8\u5347\u7ea7\u72b6\u6001\uff0c\u7531\u4e8e\u955c\u50cf\u540d\u79f0\u9519\u8bef\uff0c\u4e0b\u8f7d\u955c\u50cf\u5931\u8d25\uff0c\u56e0\u6b64\u66f4\u65b0\u8fc7\u7a0b\u4f1a\u5361\u4f4f <pre><code>kubectl rollout status deployments nginx-deploy\n</code></pre> \u7ed3\u675f\u76d1\u542c\u540e\uff0c\u83b7\u53d6 rs \u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u65b0\u589e\u7684 rs \u526f\u672c\u6570\u662f 2 \u4e2a <pre><code>kubectl get rs\n</code></pre> \u901a\u8fc7 kubectl get pods \u83b7\u53d6 pods \u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5173\u8054\u5230\u65b0\u7684 rs \u7684 pod\uff0c\u72b6\u6001\u5904\u4e8e ImagePullBackOff \u72b6\u6001</p> <p>\u4e3a\u4e86\u4fee\u590d\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u9700\u8981\u56de\u9000\u7684 revision \u8fdb\u884c\u56de\u9000,\u901a\u8fc7: <pre><code> kubectl rollout history deployment/nginx-deploy \n</code></pre> \u53ef\u4ee5\u83b7\u53d6 revison \u7684\u5217\u8868</p> <p>\u901a\u8fc7: <pre><code>kubectl rollout history deployment/nginx-deploy --revision=2 \n</code></pre> \u53ef\u4ee5\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f</p> <p>\u786e\u8ba4\u8981\u56de\u9000\u7684\u7248\u672c\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7: <pre><code>kubectl rollout undo deployment/nginx-deploy \n</code></pre> \u53ef\u4ee5\u56de\u9000\u5230\u4e0a\u4e00\u4e2a\u7248\u672c,\u4e5f\u53ef\u4ee5\u56de\u9000\u5230\u6307\u5b9a\u7684 revision: <pre><code>kubectl rollout undo deployment/nginx-deploy --to-revision=2\n</code></pre> \u518d\u6b21\u901a\u8fc7: <pre><code>kubectl get deployment \u548c kubectl describe deployment\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u7684\u7248\u672c\u5df2\u7ecf\u56de\u9000\u5230\u5bf9\u5e94\u7684 revison \u4e0a\u4e86</p> <p>\u901a\u8fc7\u8bbe\u7f6e .spec.revisonHistoryLimit \u6765\u6307\u5b9a deployment \u4fdd\u7559\u591a\u5c11 revison\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a 0\uff0c\u5219\u4e0d\u5141\u8bb8 deployment \u56de\u9000\u4e86\u3002</p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_8","title":"\u6269\u5bb9\u7f29\u5bb9","text":"<p>\u901a\u8fc7 kube scale \u547d\u4ee4\u53ef\u4ee5\u8fdb\u884c\u81ea\u52a8\u6269\u5bb9/\u7f29\u5bb9\uff0c\u4ee5\u53ca\u901a\u8fc7 kube edit \u7f16\u8f91 replcas \u4e5f\u53ef\u4ee5\u5b9e\u73b0\u6269\u5bb9/\u7f29\u5bb9 <pre><code>kubectl scale --replicas=3 deploy nginx-deploy\n</code></pre></p> <p>\u6269\u5bb9\u4e0e\u7f29\u5bb9\u53ea\u662f\u76f4\u63a5\u521b\u5efa\u526f\u672c\u6570\uff0c\u6ca1\u6709\u66f4\u65b0 pod template \u56e0\u6b64\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684 rs</p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_9","title":"\u6682\u505c\u4e0e\u6062\u590d","text":"<p>\u7531\u4e8e\u6bcf\u6b21\u5bf9 pod template \u4e2d\u7684\u4fe1\u606f\u53d1\u751f\u4fee\u6539\u540e\uff0c\u90fd\u4f1a\u89e6\u53d1\u66f4\u65b0 deployment \u64cd\u4f5c\uff0c\u90a3\u4e48\u6b64\u65f6\u5982\u679c\u9891\u7e41\u4fee\u6539\u4fe1\u606f\uff0c\u5c31\u4f1a\u4ea7\u751f\u591a\u6b21\u66f4\u65b0\uff0c\u800c\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u6267\u884c\u6700\u540e\u4e00\u6b21\u66f4\u65b0\u5373\u53ef\uff0c\u5f53\u51fa\u73b0\u6b64\u7c7b\u60c5\u51b5\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u6682\u505c deployment \u7684 rollout</p> <p>\u901a\u8fc7 <code>kubectl rollout pause deployment &lt;name&gt;</code> \u5c31\u53ef\u4ee5\u5b9e\u73b0\u6682\u505c\uff0c\u76f4\u5230\u4f60\u4e0b\u6b21\u6062\u590d\u540e\u624d\u4f1a\u7ee7\u7eed\u8fdb\u884c\u6eda\u52a8\u66f4\u65b0</p> <p>\u5c1d\u8bd5\u5bf9\u5bb9\u5668\u8fdb\u884c\u4fee\u6539\uff0c\u7136\u540e\u67e5\u770b\u662f\u5426\u53d1\u751f\u66f4\u65b0\u64cd\u4f5c\u4e86 kubectl set image deploy  nginx=nginx:1.17.9 kubectl get po  <p>\u901a\u8fc7\u4ee5\u4e0a\u64cd\u4f5c\u53ef\u4ee5\u770b\u5230\u5b9e\u9645\u5e76\u6ca1\u6709\u53d1\u751f\u4fee\u6539\uff0c\u6b64\u65f6\u6211\u4eec\u518d\u6b21\u8fdb\u884c\u4fee\u6539\u4e00\u4e9b\u5c5e\u6027\uff0c\u5982\u9650\u5236 nginx \u5bb9\u5668\u7684\u6700\u5927cpu\u4e3a 0.2 \u6838\uff0c\u6700\u5927\u5185\u5b58\u4e3a 128M\uff0c\u6700\u5c0f\u5185\u5b58\u4e3a 64M\uff0c\u6700\u5c0f cpu \u4e3a 0.1 \u6838 kubectl set resources deploy  -c  --limits=cpu=200m,memory=128Mi --requests=cpu100m,memory=64Mi <p>\u901a\u8fc7\u683c\u5f0f\u5316\u8f93\u51fa kubectl get deploy  -oyaml\uff0c\u53ef\u4ee5\u770b\u5230\u914d\u7f6e\u786e\u5b9e\u53d1\u751f\u4e86\u4fee\u6539\uff0c\u518d\u901a\u8fc7 kubectl get po \u53ef\u4ee5\u770b\u5230 pod \u6ca1\u6709\u88ab\u66f4\u65b0 <p>\u90a3\u4e48\u6b64\u65f6\u6211\u4eec\u518d\u6062\u590d rollout\uff0c\u901a\u8fc7\u547d\u4ee4 kubectl rollout deploy  <p>\u6062\u590d\u540e\uff0c\u6211\u4eec\u518d\u6b21\u67e5\u770b rs \u548c po \u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5c31\u5f00\u59cb\u8fdb\u884c\u6eda\u52a8\u66f4\u65b0\u64cd\u4f5c\u4e86 kubectl get rs kubectl get po</p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_10","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>apiVersion: apps/v1 # deployment api \u7248\u672c\nkind: Deployment # \u8d44\u6e90\u7c7b\u578b\u4e3a deployment\nmetadata: # \u5143\u4fe1\u606f\n  labels: # \u6807\u7b7e\n    app: nginx-deploy # \u5177\u4f53\u7684 key: value \u914d\u7f6e\u5f62\u5f0f\n  name: nginx-deploy # deployment \u7684\u540d\u5b57\n  namespace: default # \u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\nspec:\n  replicas: 1 # \u671f\u671b\u526f\u672c\u6570\n  revisionHistoryLimit: 10 # \u8fdb\u884c\u6eda\u52a8\u66f4\u65b0\u540e\uff0c\u4fdd\u7559\u7684\u5386\u53f2\u7248\u672c\u6570\n  selector: # \u9009\u62e9\u5668\uff0c\u7528\u4e8e\u627e\u5230\u5339\u914d\u7684 RS\n    matchLabels: # \u6309\u7167\u6807\u7b7e\u5339\u914d\n      app: nginx-deploy # \u5339\u914d\u7684\u6807\u7b7ekey/value\n  strategy: # \u66f4\u65b0\u7b56\u7565\n    rollingUpdate: # \u6eda\u52a8\u66f4\u65b0\u914d\u7f6e\n      maxSurge: 25% # \u8fdb\u884c\u6eda\u52a8\u66f4\u65b0\u65f6\uff0c\u66f4\u65b0\u7684\u4e2a\u6570\u6700\u591a\u53ef\u4ee5\u8d85\u8fc7\u671f\u671b\u526f\u672c\u6570\u7684\u4e2a\u6570/\u6bd4\u4f8b\n      maxUnavailable: 25% # \u8fdb\u884c\u6eda\u52a8\u66f4\u65b0\u65f6\uff0c\u6700\u5927\u4e0d\u53ef\u7528\u6bd4\u4f8b\u66f4\u65b0\u6bd4\u4f8b\uff0c\u8868\u793a\u5728\u6240\u6709\u526f\u672c\u6570\u4e2d\uff0c\u6700\u591a\u53ef\u4ee5\u6709\u591a\u5c11\u4e2a\u4e0d\u66f4\u65b0\u6210\u529f\n    type: RollingUpdate # \u66f4\u65b0\u7c7b\u578b\uff0c\u91c7\u7528\u6eda\u52a8\u66f4\u65b0\n  template: # pod \u6a21\u677f\n    metadata: # pod \u7684\u5143\u4fe1\u606f\n      labels: # pod \u7684\u6807\u7b7e\n        app: nginx-deploy\n    spec: # pod \u671f\u671b\u4fe1\u606f\n      containers: # pod \u7684\u5bb9\u5668\n      - image: nginx:1.7.9 # \u955c\u50cf\n        imagePullPolicy: IfNotPresent # \u62c9\u53d6\u7b56\u7565\n        name: nginx # \u5bb9\u5668\u540d\u79f0\n      restartPolicy: Always # \u91cd\u542f\u7b56\u7565\n      terminationGracePeriodSeconds: 30 # \u5220\u9664\u64cd\u4f5c\u6700\u591a\u5bbd\u9650\u591a\u957f\u65f6\u95f4\n</code></pre>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#statefulset","title":"\u4e09. StatefulSet","text":""},{"location":"blog/2024/04/25/k8s-resources-schedule/#_11","title":"\u529f\u80fd","text":""},{"location":"blog/2024/04/25/k8s-resources-schedule/#_12","title":"\u521b\u5efa","text":"<p><pre><code>kubectl create -f web.yaml\n\n# \u67e5\u770b service \u548c statefulset =&gt; sts\nkubectl get service nginx\nkubectl get statefulset web\n\n# \u67e5\u770b PVC \u4fe1\u606f\nkubectl get pvc\n\n# \u67e5\u770b\u521b\u5efa\u7684 pod\uff0c\u8fd9\u4e9b pod \u662f\u6709\u5e8f\u7684\nkubectl get pods -l app=nginx\n\n# \u67e5\u770b\u8fd9\u4e9b pod \u7684 dns\n# \u8fd0\u884c\u4e00\u4e2a pod\uff0c\u57fa\u7840\u955c\u50cf\u4e3a busybox \u5de5\u5177\u5305\uff0c\u5229\u7528\u91cc\u9762\u7684 nslookup \u53ef\u4ee5\u770b\u5230 dns \u4fe1\u606f\nkubectl run -i --tty --image busybox dns-test --restart=Never --rm /bin/sh\nnslookup web-0.nginx\n</code></pre> \u66f4\u65b0yaml\u914d\u7f6e\u6587\u4ef6\u540e\u53ef\u4ee5\u7528replace\u6765\u66f4\u65b0\u8d44\u6e90 <pre><code>kubectl replace sts web -f web.yaml\n</code></pre></p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_13","title":"\u8bbf\u95ee\u5bb9\u5668","text":"<p>\u50cfdocker\u4e00\u6837\u7528\u547d\u4ee4\u7b80\u5355\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff1a <pre><code>kubectl run -it --image busybox dns-test --restart=Never --rm /bin/sh\n</code></pre></p> <p>\u8bbf\u95ee\u5176\u4ed6\u5bb9\u5668\uff1a  <pre><code>[root@k8s-master statefulset]# kubectl run -it --image busybox dns-test --restart=Never --rm /bin/sh\n/ # ping web-1.nginx  #\u9a8c\u8bc1\u5bb9\u5668\u95f4\u8bbf\u95ee\nPING web-1.nginx (192.168.36.100): 56 data bytes\n64 bytes from 192.168.36.100: seq=0 ttl=62 time=0.327 ms\n64 bytes from 192.168.36.100: seq=1 ttl=62 time=0.289 ms\n...\n/ # ping web-0.nginx   #\u9a8c\u8bc1\u5bb9\u5668\u95f4\u8bbf\u95ee\nPING web-0.nginx (192.168.169.161): 56 data bytes\n64 bytes from 192.168.169.161: seq=0 ttl=63 time=0.051 ms\n64 bytes from 192.168.169.161: seq=1 ttl=63 time=0.051 ms\n</code></pre></p> <p>\u6ce8\u91ca\uff1a</p> <ul> <li>dns-test : \u5bb9\u5668\u540d\u79f0</li> <li>busybox : linux\u7684\u5e38\u7528\u5de5\u5177\u955c\u50cf</li> <li>--restart=Never: \u5f53\u63a2\u6d4b\u5230\u5bb9\u5668\u5931\u8d25\u662f\u5426\u91cd\u542f POD</li> <li>--rm : \u8fd0\u884c\u5b8c\u540e\u5220\u9664\u5bb9\u5668</li> <li>/bin/sh\uff1a \u8fdb\u5165\u5bb9\u5668\u7684\u76ee\u5f55\uff08\u6267\u884cbin\u76ee\u5f55\u4e0b\u7684sh\uff09</li> </ul>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_14","title":"\u6269\u5bb9\u7f29\u5bb9","text":"<pre><code># \u6269\u5bb9\n\n$ kubectl scale statefulset web --replicas=5\n\n# \u7f29\u5bb92\u79cd\u65b9\u6cd5\n$ kubectl scale sts web --replicas=2\n$ kubectl patch statefulset web -p '{\"spec\":{\"replicas\":3}}'\n</code></pre>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_15","title":"\u955c\u50cf\u66f4\u65b0","text":"<pre><code># \u955c\u50cf\u66f4\u65b0\uff08\u76ee\u524d\u8fd8\u4e0d\u652f\u6301\u76f4\u63a5\u66f4\u65b0 image\uff0c\u9700\u8981 patch \u6765\u95f4\u63a5\u5b9e\u73b0\uff09\nkubectl patch sts web --type='json' -p='[{\"op\": \"replace\", \"path\": \"/spec/template/spec/containers/0/image\", \"value\":\"nginx:1.9.1\"}]'\n</code></pre>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#rollingupdate","title":"RollingUpdate","text":"<p>StatefulSet  \u4e5f\u53ef\u4ee5\u91c7\u7528\u6eda\u52a8\u66f4\u65b0\u7b56\u7565\uff0c\u540c\u6837\u662f\u4fee\u6539 pod template \u5c5e\u6027\u540e\u4f1a\u89e6\u53d1\u66f4\u65b0\uff0c\u4f46\u662f\u7531\u4e8e pod \u662f\u6709\u5e8f\u7684\uff0c\u5728 StatefulSet \u4e2d\u66f4\u65b0\u65f6\u662f\u57fa\u4e8e pod \u7684\u987a\u5e8f\u5012\u5e8f\u66f4\u65b0\u7684</p> <p>\u67e5\u770brolling \u72b6\u6001 <pre><code>[root@k8s-master statefulset]# kubectl rollout status sts web\npartitioned roll out complete: 2 new pods have been updated...\n</code></pre> \u67e5\u770bstatefulset\u66f4\u65b0\u8bb0\u5f55 <pre><code>kubectl rollout history sts web\n</code></pre></p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_16","title":"\u7070\u5ea6\u53d1\u5e03(\u91d1\u4e1d\u96c0)","text":"<p>\u5229\u7528\u6eda\u52a8\u66f4\u65b0\u4e2d\u7684 partition \u5c5e\u6027\uff0c\u53ef\u4ee5\u5b9e\u73b0\u7b80\u6613\u7684\u7070\u5ea6\u53d1\u5e03\u7684\u6548\u679c</p> <p>\u4f8b\u5982\u6211\u4eec\u6709 5 \u4e2a pod\uff0c\u5982\u679c\u5f53\u524d partition \u8bbe\u7f6e\u4e3a 3\uff0c\u90a3\u4e48\u6b64\u65f6\u6eda\u52a8\u66f4\u65b0\u65f6\uff0c\u53ea\u4f1a\u66f4\u65b0\u90a3\u4e9b \u5e8f\u53f7 &gt;= 3 \u7684 pod</p> <p>\u5229\u7528\u8be5\u673a\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u63a7\u5236 partition \u7684\u503c\uff0c\u6765\u51b3\u5b9a\u53ea\u66f4\u65b0\u5176\u4e2d\u4e00\u90e8\u5206 pod\uff0c\u786e\u8ba4\u6ca1\u6709\u95ee\u9898\u540e\u518d\u4e3b\u952e\u589e\u5927\u66f4\u65b0\u7684 pod \u6570\u91cf\uff0c\u6700\u7ec8\u5b9e\u73b0\u5168\u90e8 pod \u66f4\u65b0</p> Statefulset\u7684\u6eda\u52a8\u66f4\u65b0\u662f\u5148\u5220\u9664\u518d\u521b\u5efa <p>\u4e0b\u9762\u662f\u5148\u5220\u9664\u518d\u521b\u5efa\u7684\u539f\u56e0\uff1a</p> <p>\u6570\u636e\u7684\u6301\u4e45\u6027\uff1a\u6709\u72b6\u6001\u5e94\u7528\u7a0b\u5e8f\u901a\u5e38\u4f7f\u7528\u6301\u4e45\u5377\uff08Persistent Volume\uff09\u6765\u5b58\u50a8\u6570\u636e\u3002\u5728\u8fdb\u884c\u66f4\u65b0\u65f6\uff0c\u5148\u5220\u9664\u65e7\u7684 Pod\uff0c\u53ef\u4ee5\u786e\u4fdd\u65e7 Pod \u4f7f\u7528\u7684\u6301\u4e45\u5377\u4e0d\u4f1a\u88ab\u610f\u5916\u5220\u9664\uff0c\u4ece\u800c\u4fdd\u7559\u6570\u636e\u7684\u6301\u4e45\u6027\u3002</p> <p>\u7f51\u7edc\u6807\u8bc6\u7684\u7a33\u5b9a\u6027\uff1aStatefulSet \u7684\u6bcf\u4e2a Pod \u90fd\u6709\u552f\u4e00\u7684\u6807\u8bc6\u7b26\u548c\u7a33\u5b9a\u7684\u7f51\u7edc\u6807\u8bc6\u3002\u8fd9\u4e9b\u6807\u8bc6\u7b26\u901a\u5e38\u57fa\u4e8e Pod \u7684\u540d\u79f0\u548c\u7d22\u5f15\u3002\u901a\u8fc7\u5148\u5220\u9664\u65e7\u7684 Pod\uff0c\u518d\u521b\u5efa\u65b0\u7684 Pod\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u65b0 Pod \u7684\u540d\u79f0\u548c\u7d22\u5f15\u4e0e\u65e7 Pod \u4fdd\u6301\u4e00\u81f4\uff0c\u4ece\u800c\u4fdd\u6301\u7f51\u7edc\u6807\u8bc6\u7684\u7a33\u5b9a\u6027\u3002</p> <p>\u4f9d\u8d56\u5173\u7cfb\u7684\u7ba1\u7406\uff1a\u5728\u6709\u72b6\u6001\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u53ef\u80fd\u5b58\u5728\u4f9d\u8d56\u5176\u4ed6 Pod \u7684\u60c5\u51b5\uff0c\u4f8b\u5982\u6570\u636e\u5e93\u96c6\u7fa4\u4e2d\u7684\u4e3b\u4ece\u5173\u7cfb\u3002\u901a\u8fc7\u5148\u5220\u9664\u518d\u521b\u5efa\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u786e\u4fdd\u65b0\u521b\u5efa\u7684 Pod \u5728\u4f9d\u8d56\u5173\u7cfb\u65b9\u9762\u4e0e\u65e7 Pod \u4fdd\u6301\u4e00\u81f4\uff0c\u907f\u514d\u56e0\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u5f15\u5165\u4e0d\u4e00\u81f4\u6027\u3002</p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#ondelete","title":"OnDelete","text":"<p>\u53ea\u6709\u5728 pod \u88ab\u5220\u9664\u65f6\u4f1a\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c</p>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_17","title":"\u5220\u9664","text":"<pre><code># \u5220\u9664 StatefulSet \u548c Headless Service\n# \u7ea7\u8054\u5220\u9664\uff1a\u5220\u9664 statefulset \u65f6\u4f1a\u540c\u65f6\u5220\u9664 pods\nkubectl delete statefulset web\n# \u975e\u7ea7\u8054\u5220\u9664\uff1a\u5220\u9664 statefulset \u65f6\u4e0d\u4f1a\u5220\u9664 pods\uff0c\u5220\u9664 sts \u540e\uff0cpods \u5c31\u6ca1\u4eba\u7ba1\u4e86\uff0c\u6b64\u65f6\u518d\u5220\u9664 pod \u4e0d\u4f1a\u91cd\u5efa\u7684\nkubectl deelte sts web --cascade=false\n# \u5220\u9664 service\nkubectl delete service nginx\n</code></pre>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#pvc","title":"\u5220\u9664pvc","text":"<pre><code># StatefulSet\u5220\u9664\u540ePVC\u8fd8\u4f1a\u4fdd\u7559\u7740\uff0c\u6570\u636e\u4e0d\u518d\u4f7f\u7528\u7684\u8bdd\u4e5f\u9700\u8981\u5220\u9664\n$ kubectl delete pvc www-web-0 www-web-1\n</code></pre>"},{"location":"blog/2024/04/25/k8s-resources-schedule/#_18","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>---\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx\n  labels:\n    app: nginx\nspec:\n  ports:\n  - port: 80\n    name: web\n  clusterIP: None\n  selector:\n    app: nginx\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: web\nspec:\n  serviceName: \"nginx\"  #\u4f7f\u7528\u54ea\u4e2aservice \u6765\u7ba1\u7406dns\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.9\n        ports:\n        - containerPort: 80  #\u5bb9\u5668\u5185\u90e8\u8981\u66b4\u9732\u7684\u7aef\u53e3\n          name: web  #\u8be5\u7aef\u53e3\u7684\u540d\u5b57\n        volumeMounts:\n        - name: www  #\u6307\u5b9a\u52a0\u8f7d\u54ea\u4e2a\u6570\u636e\u5377\n          mountPath: /usr/share/nginx/html  #\u52a0\u8f7d\u5230\u5bb9\u5668\u7684\u54ea\u4e2a\u76ee\u5f55\n  volumeClaimTemplates: # \u6570\u636e\u5377\u6a21\u677f\n  - metadata:  #\u6570\u636e\u5377\u63cf\u8ff0\n      name: www  #\u6570\u636e\u5377\u540d\u79f0\n      annotations:  #\u6570\u636e\u5377\u6ce8\u91ca\n        volume.alpha.kubernetes.io/storage-class: anything\n    spec:  #\u6570\u636e\u5377\u7684\u89c4\u7ea6\n      accessModes: [ \"ReadWriteOnce\" ]  #\u8bbf\u95ee\u6a21\u5f0f\n      resources:\n        requests:\n          storage: 1Gi  #\u5b58\u50a8\u5927\u5c0f\n</code></pre>"},{"location":"blog/2024/04/27/k8s-storage-volumes/","title":"K8s Storage Volumes","text":""},{"location":"blog/2024/04/27/k8s-storage-volumes/#hostpath","title":"HostPath","text":"<p>\u5c06\u8282\u70b9\u4e0a\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u6302\u8f7d\u5230 Pod \u4e0a\uff0c\u6b64\u65f6\u8be5\u76ee\u5f55\u4f1a\u53d8\u6210\u6301\u4e45\u5316\u5b58\u50a8\u76ee\u5f55\uff0c\u5373\u4f7f Pod \u88ab\u5220\u9664\u540e\u91cd\u542f\uff0c\u4e5f\u53ef\u4ee5\u91cd\u65b0\u52a0\u8f7d\u5230\u8be5\u76ee\u5f55\uff0c\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4e0d\u4f1a\u4e22\u5931</p>"},{"location":"blog/2024/04/27/k8s-storage-volumes/#_1","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-pd\nspec:\n  containers:\n  - image: nginx\n    name: nginx-volume\n    volumeMounts:\n    - mountPath: /test-pd # \u6302\u8f7d\u5230\u5bb9\u5668\u7684\u54ea\u4e2a\u76ee\u5f55\n      name: test-volume # \u6302\u8f7d\u54ea\u4e2a volume\n  volumes:\n  - name: test-volume\n    hostPath:\n      path: /data # \u8282\u70b9\u4e2d\u7684\u76ee\u5f55\n      type: Directory # \u68c0\u67e5\u7c7b\u578b\uff0c\u5728\u6302\u8f7d\u524d\u5bf9\u6302\u8f7d\u76ee\u5f55\u505a\u4ec0\u4e48\u68c0\u67e5\u64cd\u4f5c\uff0c\u6709\u591a\u79cd\u9009\u9879\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u4e0d\u505a\u4efb\u4f55\u68c0\u67e5\n\n\n\u7c7b\u578b\uff1a\n\u7a7a\u5b57\u7b26\u4e32\uff1a\u9ed8\u8ba4\u7c7b\u578b\uff0c\u4e0d\u505a\u4efb\u4f55\u68c0\u67e5\nDirectoryOrCreate\uff1a\u5982\u679c\u7ed9\u5b9a\u7684 path \u4e0d\u5b58\u5728\uff0c\u5c31\u521b\u5efa\u4e00\u4e2a 755 \u7684\u7a7a\u76ee\u5f55\nDirectory\uff1a\u8fd9\u4e2a\u76ee\u5f55\u5fc5\u987b\u5b58\u5728\nFileOrCreate\uff1a\u5982\u679c\u7ed9\u5b9a\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff0c\u6743\u9650\u4e3a 644\nFile\uff1a\u8fd9\u4e2a\u6587\u4ef6\u5fc5\u987b\u5b58\u5728\nSocket\uff1aUNIX \u5957\u63a5\u5b57\uff0c\u5fc5\u987b\u5b58\u5728\nCharDevice\uff1a\u5b57\u7b26\u8bbe\u5907\uff0c\u5fc5\u987b\u5b58\u5728\nBlockDevice\uff1a\u5757\u8bbe\u5907\uff0c\u5fc5\u987b\u5b58\u5728\n</code></pre>"},{"location":"blog/2024/04/27/k8s-storage-volumes/#emptydir","title":"EmptyDir","text":"<p>EmptyDir \u4e3b\u8981\u7528\u4e8e\u4e00\u4e2a Pod \u4e2d\u4e0d\u540c\u7684 Container \u5171\u4eab\u6570\u636e\u4f7f\u7528\u7684\uff0c\u7531\u4e8e\u53ea\u662f\u5728 Pod \u5185\u90e8\u4f7f\u7528\uff0c\u56e0\u6b64\u4e0e\u5176\u4ed6 volume \u6bd4\u8f83\u5927\u7684\u533a\u522b\u662f\uff0c\u5f53 Pod \u5982\u679c\u88ab\u5220\u9664\u4e86\uff0c\u90a3\u4e48 emptyDir \u4e5f\u4f1a\u88ab\u5220\u9664\u3002</p> <p>\u5b58\u50a8\u4ecb\u8d28\u53ef\u4ee5\u662f\u4efb\u610f\u7c7b\u578b\uff0c\u5982 SSD\u3001\u78c1\u76d8\u6216\u7f51\u7edc\u5b58\u50a8\u3002\u53ef\u4ee5\u5c06 emptyDir.medium \u8bbe\u7f6e\u4e3a Memory \u8ba9 k8s \u4f7f\u7528 tmpfs\uff08\u5185\u5b58\u652f\u6301\u6587\u4ef6\u7cfb\u7edf\uff09\uff0c\u901f\u5ea6\u6bd4\u8f83\u5feb\uff0c\u4f46\u662f\u91cd\u542f tmpfs \u8282\u70b9\u65f6\uff0c\u6570\u636e\u4f1a\u88ab\u6e05\u9664\uff0c\u4e14\u8bbe\u7f6e\u7684\u5927\u5c0f\u4f1a\u8ba1\u5165\u5230 Container \u7684\u5185\u5b58\u9650\u5236\u4e2d\u3002</p>"},{"location":"blog/2024/04/27/k8s-storage-volumes/#_2","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-pd\nspec:\n  containers:\n  - image: nginx\n    name: nginx-emptydir\n    volumeMounts:\n    - mountPath: /cache\n      name: cache-volume\n  volumes:\n  - name: cache-volume\n    emptyDir: {}\n</code></pre>"},{"location":"blog/2024/04/29/k8s-storageclass/","title":"K8s StorageClass","text":""},{"location":"blog/2024/04/29/k8s-storageclass/#storageclass","title":"StorageClass","text":"<p>k8s \u4e2d\u63d0\u4f9b\u4e86\u4e00\u5957\u81ea\u52a8\u521b\u5efa PV \u7684\u673a\u5236\uff0c\u5c31\u662f\u57fa\u4e8e StorageClass \u8fdb\u884c\u7684\uff0c\u901a\u8fc7 StorageClass \u53ef\u4ee5\u5b9e\u73b0\u4ec5\u4ec5\u914d\u7f6e PVC\uff0c\u7136\u540e\u4ea4\u7531 StorageClass \u6839\u636e PVC \u7684\u9700\u6c42\u52a8\u6001\u521b\u5efa PV\u3002</p>"},{"location":"blog/2024/04/29/k8s-storageclass/#provisioner","title":"Provisioner \u5236\u5907\u5668","text":"<p>\u6bcf\u4e2a StorageClass \u90fd\u6709\u4e00\u4e2a\u5236\u5907\u5668\uff08Provisioner\uff09\uff0c\u7528\u6765\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e2a\u5377\u63d2\u4ef6\u5236\u5907 PV\u3002</p>"},{"location":"blog/2024/04/29/k8s-storageclass/#nfs","title":"NFS \u52a8\u6001\u5236\u5907\u6848\u4f8b","text":""},{"location":"blog/2024/04/29/k8s-storageclass/#nfs-provisioner","title":"nfs-provisioner \u914d\u7f6e","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nfs-client-provisioner\n  namespace: kube-system\n  labels:\n    app: nfs-client-provisioner\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  selector:\n    matchLabels:\n      app: nfs-client-provisioner\n  template:\n    metadata:\n      labels:\n        app: nfs-client-provisioner\n    spec:\n      serviceAccountName: nfs-client-provisioner\n      containers:\n        - name: nfs-client-provisioner\n          image: quay.io/external_storage/nfs-client-provisioner:latest\n          volumeMounts:\n            - name: nfs-client-root\n              mountPath: /persistentvolumes\n          env:\n            - name: PROVISIONER_NAME\n              value: fuseim.pri/ifs\n            - name: NFS_SERVER\n              value: 192.168.113.121\n            - name: NFS_PATH\n              value: /data/nfs/rw\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            server: 192.168.113.121\n            path: /data/nfs/rw\n</code></pre>"},{"location":"blog/2024/04/29/k8s-storageclass/#storageclass_1","title":"StorageClass \u914d\u7f6e","text":"<pre><code>apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: managed-nfs-storage\n  namespace: kube-system\nprovisioner: fuseim.pri/ifs # \u5916\u90e8\u5236\u5907\u5668\u63d0\u4f9b\u8005\uff0c\u7f16\u5199\u4e3a\u63d0\u4f9b\u8005\u7684\u540d\u79f0\nparameters:\n  archiveOnDelete: \"false\" # \u662f\u5426\u5b58\u6863\uff0cfalse \u8868\u793a\u4e0d\u5b58\u6863\uff0c\u4f1a\u5220\u9664 oldPath \u4e0b\u9762\u7684\u6570\u636e\uff0ctrue \u8868\u793a\u5b58\u6863\uff0c\u4f1a\u91cd\u547d\u540d\u8def\u5f84\nreclaimPolicy: Retain # \u56de\u6536\u7b56\u7565\uff0c\u9ed8\u8ba4\u4e3a Delete \u53ef\u4ee5\u914d\u7f6e\u4e3a Retain\nvolumeBindingMode: Immediate # \u9ed8\u8ba4\u4e3a Immediate\uff0c\u8868\u793a\u521b\u5efa PVC \u7acb\u5373\u8fdb\u884c\u7ed1\u5b9a\uff0c\u53ea\u6709 azuredisk \u548c AWSelasticblockstore \u652f\u6301\u5176\u4ed6\u503c\n</code></pre>"},{"location":"blog/2024/04/29/k8s-storageclass/#rbac","title":"RBAC \u914d\u7f6e","text":"<p><pre><code>markdown_extensions:\n  - pymdownx.highlight:\n      anchor_linenums: true\n      line_spans: __span\n      pygments_lang_class: true\n  - pymdownx.inlinehilite\n  - pymdownx.snippets\n  - pymdownx.superfences\n</code></pre> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nfs-client-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: nfs-client-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"create\", \"update\", \"patch\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: run-nfs-client-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    namespace: default\nroleRef:\n  kind: ClusterRole\n  name: nfs-client-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"endpoints\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\nroleRef:\n  kind: Role\n  name: leader-locking-nfs-client-provisioner\n  apiGroup: rbac.authorization.k8s.io\n</code></pre></p>"},{"location":"blog/2024/04/29/k8s-storageclass/#pvcpending","title":"PVC\u5904\u4e8ePending\u72b6\u6001","text":"<p>\u5728 k8s 1.20 \u4e4b\u540e\uff0c\u51fa\u4e8e\u5bf9\u6027\u80fd\u548c\u7edf\u4e00 apiserver \u8c03\u7528\u65b9\u5f0f\u7684\u521d\u8877\uff0c\u79fb\u9664\u4e86\u5bf9 SelfLink \u7684\u652f\u6301\uff0c\u800c\u9ed8\u8ba4\u4e0a\u9762\u6307\u5b9a\u7684 provisioner \u7248\u672c\u9700\u8981 SelfLink \u529f\u80fd\uff0c\u56e0\u6b64 PVC \u65e0\u6cd5\u8fdb\u884c\u81ea\u52a8\u5236\u5907\u3002</p>"},{"location":"blog/2024/04/29/k8s-storageclass/#selflink","title":"\u914d\u7f6eSelfLink","text":"<p>\u4fee\u6539 apiserver \u914d\u7f6e\u6587\u4ef6 <pre><code>vim /etc/kubernetes/manifests/kube-apiserver.yaml\n\nspec:\n  containers:\n  - command:\n    - kube-apiserver\n    - --feature-gates=RemoveSelfLink=false # \u65b0\u589e\u8be5\u884c\n    ......\n</code></pre></p> <p>\u4fee\u6539\u540e\u91cd\u65b0\u5e94\u7528\u8be5\u914d\u7f6e <pre><code>kubectl apply -f /etc/kubernetes/manifests/kube-apiserver.yaml\n</code></pre></p>"},{"location":"blog/2024/04/29/k8s-storageclass/#selflinkprovisioner","title":"\u4e0d\u9700\u8981SelfLink\u7684Provisioner","text":"<p>\u5c06 provisioner \u4fee\u6539\u4e3a\u5982\u4e0b\u955c\u50cf\u4e4b\u4e00\u5373\u53ef <pre><code>gcr.io/k8s-staging-sig-storage/nfs-subdir-external-provisioner:v4.0.0\n\nregistry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0\n</code></pre></p>"},{"location":"blog/2024/04/29/k8s-storageclass/#pvc","title":"PVC \u6d4b\u8bd5\u914d\u7f6e","text":"<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: auto-pv-test-pvc\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 300Mi\n  storageClassName: managed-nfs-storage\n</code></pre>"},{"location":"blog/2024/04/26/k8s-troubleshooting-error-scale/","title":"k8s troubleshooting error scale","text":""},{"location":"blog/2024/04/26/k8s-troubleshooting-error-scale/#scale","title":"\u4e0d\u660e\u539f\u56e0scale\u6269\u5bb9\u5931\u8d25\uff0c\u5bb9\u5668\u8d77\u4e0d\u6765","text":"Problem<pre><code>[root@k8s-master ~]# kubectl get rs,po\nNAME                                      DESIRED   CURRENT   READY   AGE\nreplicaset.apps/nginx-deploy-548d7bc8bc   1         1         0       16m\nreplicaset.apps/nginx-deploy-5f44797d7f   1         1         0       13m\nreplicaset.apps/nginx-deploy-674dcdf579   2         2         2       17h\nreplicaset.apps/nginx-deploy-f7f5656c7    0         0         0       17h\n\nNAME                                READY   STATUS              RESTARTS   AGE\npod/my-nginx                        1/1     Running             0          19h\npod/nginx-deploy-548d7bc8bc-pfhmn   0/1     ContainerCreating   0          16m\npod/nginx-deploy-5f44797d7f-jtmsd   0/1     ContainerCreating   0          13m\npod/nginx-deploy-674dcdf579-5gvbw   1/1     Running             0          17h\npod/nginx-deploy-674dcdf579-l79w8   1/1     Running             0          17h\npod/nginx-deploy-674dcdf579-t979q   0/1     Terminating         0          26m\n[root@k8s-master ~]# kubectl edit deploy nginx-deploy\n</code></pre> Pod_describe-nginx-deploy-548d7bc8bc-pfhmn <pre><code>[root@k8s-master ~]# kubectl describe pod/nginx-deploy-548d7bc8bc-pfhmn\nName:           nginx-deploy-548d7bc8bc-pfhmn\nNamespace:      default\nPriority:       0\nNode:           k8s-node1/10.0.0.101\nStart Time:     Thu, 25 Apr 2024 22:10:19 -0400\nLabels:         app=nginx-deploy\n                pod-template-hash=548d7bc8bc\nAnnotations:    &lt;none&gt;\nStatus:         Pending\nIP:             \nIPs:            &lt;none&gt;\nControlled By:  ReplicaSet/nginx-deploy-548d7bc8bc\nContainers:\nnginx:\n    Container ID:   \n    Image:          nginx:1.25.5\n    Image ID:       \n    Port:           &lt;none&gt;\n    Host Port:      &lt;none&gt;\n    State:          Waiting\n    Reason:       ContainerCreating\n    Ready:          False\n    Restart Count:  0\n    Requests:\n    cpu:        100m\n    memory:     128Mi\n    Environment:  &lt;none&gt;\n    Mounts:\n    /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-v5qt4 (ro)\nConditions:\nType              Status\nInitialized       True \nReady             False \nContainersReady   False \nPodScheduled      True \nVolumes:\nkube-api-access-v5qt4:\n    Type:                    Projected (a volume that contains injected data from multiple sources)\n    TokenExpirationSeconds:  3607\n    ConfigMapName:           kube-root-ca.crt\n    ConfigMapOptional:       &lt;nil&gt;\n    DownwardAPI:             true\nQoS Class:                   Burstable\nNode-Selectors:              &lt;none&gt;\nTolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s\n                            node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\nEvents:\nType     Reason                  Age                   From               Message\n----     ------                  ----                  ----               -------\nNormal   Scheduled               24m                   default-scheduler  Successfully assigned default/nginx-deploy-548d7bc8bc-pfhmn to k8s-node1\nWarning  FailedCreatePodSandBox  24m                   kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = [failed to set up sandbox container \"d0c52072346d605a7594b91391ccd8ceb7803a629412e165a0e49f8b1fb498ba\" network for pod \"nginx-deploy-548d7bc8bc-pfhmn\": networkPlugin cni failed to set up pod \"nginx-deploy-548d7bc8bc-pfhmn_default\" network: error getting ClusterInformation: connection is unauthorized: Unauthorized, failed to clean up sandbox container \"d0c52072346d605a7594b91391ccd8ceb7803a629412e165a0e49f8b1fb498ba\" network for pod \"nginx-deploy-548d7bc8bc-pfhmn\": networkPlugin cni failed to teardown pod \"nginx-deploy-548d7bc8bc-pfhmn_default\" network: error getting ClusterInformation: connection is unauthorized: Unauthorized]\nNormal   SandboxChanged          3m58s (x97 over 24m)  kubelet            Pod sandbox changed, it will be killed and re-created.\n</code></pre> Deployment_yaml_file <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nannotations:\n    deployment.kubernetes.io/revision: \"7\"\ncreationTimestamp: \"2024-04-25T07:44:53Z\"\ngeneration: 9\nlabels:\n    app: nginx-deploy\nname: nginx-deploy\nnamespace: default\nresourceVersion: \"77441\"\nuid: 02e581e3-6bbd-4af9-9d3a-9eda5b1c790b\nspec:\nprogressDeadlineSeconds: 600\nreplicas: 3\nrevisionHistoryLimit: 10\nselector:\n    matchLabels:\n    app: nginx-deploy\nstrategy:\n    rollingUpdate:\n    maxSurge: 25%\n    maxUnavailable: 25%\n    type: RollingUpdate\ntemplate:\n    metadata:\n    creationTimestamp: null\n    labels:\n        app: nginx-deploy\n        spec:\n    containers:\n    - image: nginx:1.25.5\n        imagePullPolicy: IfNotPresent\n        name: nginx\n        resources:\n        requests:\n            cpu: 200m\n            memory: 256Mi\n        terminationMessagePath: /dev/termination-log\n        terminationMessagePolicy: File\n    dnsPolicy: ClusterFirst\n    restartPolicy: Always\n    schedulerName: default-scheduler\n    securityContext: {}\n    terminationGracePeriodSeconds: 30\nstatus:\navailableReplicas: 2\nconditions:\n- lastTransitionTime: \"2024-04-26T02:00:13Z\"\n    lastUpdateTime: \"2024-04-26T02:00:13Z\"\n    message: Deployment does not have minimum availability.\n    reason: MinimumReplicasUnavailable\n    status: \"False\"\n    type: Available\n- lastTransitionTime: \"2024-04-26T02:22:40Z\"\n    lastUpdateTime: \"2024-04-26T02:22:40Z\"\n    message: ReplicaSet \"nginx-deploy-5f44797d7f\" has timed out progressing.\n    reason: ProgressDeadlineExceeded\n    status: \"False\"\n    type: Progressing\nobservedGeneration: 9\nreadyReplicas: 2\n    replicas: 4\nunavailableReplicas: 2\nupdatedReplicas: 1\n</code></pre> <p>\u53c2\u8003\u8fd9\u4e2aissue</p> <p>\u6700\u7b80\u5355\u662f\u901a\u8fc7\u91cd\u542fMaster\u89e3\u51b3\u3002</p>"},{"location":"blog/2024/04/26/k8s-troubleshooting-ingress/","title":"k8s troubleshooting Ingress","text":""},{"location":"blog/2024/04/26/k8s-troubleshooting-ingress/#ingress","title":"\u521b\u5efaIngress\u62a5\u9519","text":"<pre><code>[root@k8s-master ingress]# kubectl create -f wolfcode-ingress.yaml \nError from server (InternalError): error when creating \"wolfcode-ingress.yaml\": Internal error occurred: failed calling webhook \"validate.nginx.ingress.kubernetes.io\": failed to call webhook: Post \"https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s\": service \"ingress-nginx-controller-admission\" not found\n</code></pre>"},{"location":"blog/2024/04/26/k8s-troubleshooting-ingress/#_1","title":"\u89e3\u51b3\u65b9\u6848","text":""},{"location":"blog/2024/04/26/k8s-troubleshooting-ingress/#_2","title":"\u6267\u884c","text":"<pre><code>[root@k8s-master ingress]# kubectl delete -A ValidatingWebhookConfiguration ingress-nginx-admission\nvalidatingwebhookconfiguration.admissionregistration.k8s.io \"ingress-nginx-admission\" deleted\n</code></pre>"},{"location":"blog/2024/04/26/k8s-troubleshooting-ingress/#ingress_1","title":"\u518d\u6b21\u521b\u5efaIngress","text":"<pre><code>[root@k8s-master ingress]# kubectl create -f wolfcode-ingress.yaml \ningress.networking.k8s.io/wolfcode-nginx-ingress created\n</code></pre>"},{"location":"blog/2024/01/19/k8s-command-line---kubectl/","title":"K8s Command Line - kubectl","text":"<p>GETTING STARTED \u547d\u4ee4\u624b\u518c</p>","tags":["k8s","kubectl"]},{"location":"blog/2024/01/19/k8s-command-line---kubectl/#kubectl","title":"\u5728\u4efb\u610f\u8282\u70b9\u4e0a\u6dfb\u52a0kubectl\u547d\u4ee4\u529f\u80fd","text":"<ol> <li> <p>\u5c06 master \u8282\u70b9\u4e2d /etc/kubernetes/admin.conf \u62f7\u8d1d\u5230\u9700\u8981\u8fd0\u884c\u7684\u670d\u52a1\u5668\u7684 /etc/kubernetes \u76ee\u5f55\u4e2d <pre><code>scp /etc/kubernetes/admin.conf root@k8s-node1:/etc/kubernetes\n</code></pre></p> </li> <li> <p>\u5728\u5bf9\u5e94\u7684\u670d\u52a1\u5668\u4e0a\u914d\u7f6e\u73af\u5883\u53d8\u91cf <pre><code>echo \"export KUBECONFIG=/etc/kubernetes/admin.conf\" &gt;&gt; ~/.bash_profile\n</code></pre></p> </li> <li>\u751f\u6548\u73af\u5883\u53d8\u91cf <pre><code>source ~/.bash_profile\n</code></pre></li> </ol>","tags":["k8s","kubectl"]},{"location":"blog/2024/01/19/k8s-command-line---kubectl/#deploymentpod","title":"\u901a\u8fc7deployment\u521b\u5efa\u4e00\u4e2apod","text":"<pre><code>kubectl create deployment nginx --image=nginx\n</code></pre>","tags":["k8s","kubectl"]},{"location":"blog/2024/01/19/k8s-command-line---kubectl/#kubectl-scale","title":"\u4f7f\u7528kubectl scale","text":"<ol> <li>\u67e5\u770b\u96c6\u7fa4\u7684namespace <pre><code>kubectl get namespace\n#\u6216\u8005 kubectl get ns\n</code></pre></li> <li>\u67e5\u770bpod <pre><code>kubectl get pods\n#\u6216\u8005 kubectl get po\n</code></pre></li> <li>\u67e5\u770bdeployment <pre><code>[root@k8s-master ~]#kubectl get deployment\n#\u6216\u8005 kubectl get deploy\n[root@k8s-master ~]# kubectl get deployment\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   1/1     1            1           5h10m\n</code></pre></li> <li>\u6269\u5c55\u5bf9\u8c61nginx <pre><code>[root@k8s-master ~]# kubectl scale deploy --replicas=3 nginux  #\u6ce8\u610f\uff1adeploy=deployment\ndeployment.apps/nginx scaled\n[root@k8s-master ~]# kubectl get deployment\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   3/3     3            3           5h15m\n[root@k8s-master ~]# kubectl get po\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-85b98978db-2h5jw   1/1     Running   0          86s\nnginx-85b98978db-hll4t   1/1     Running   0          5h8m\nnginx-85b98978db-zh9f5   1/1     Running   0          86s\n</code></pre> kubectl scale --help <pre><code>Set a new size for a deployment, replica set,replication controller,\nor stateful set.\n</code></pre></li> <li>\u67e5\u770b\u6269\u5c55\u7684pod\u88ab\u90e8\u7f72\u5728\u54ea\u4e9b\u8282\u70b9</li> </ol> <p><pre><code>[root@k8s-master ~]# kubectl get po -o wide\nNAME                     READY   STATUS    RESTARTS   AGE     IP                NODE        NOMINATED NODE   READINESS GATES\nnginx-85b98978db-2h5jw   1/1     Running   0          46m     192.168.169.132   k8s-node2   &lt;none&gt;           &lt;none&gt;\nnginx-85b98978db-hll4t   1/1     Running   0          5h54m   192.168.36.66     k8s-node1   &lt;none&gt;           &lt;none&gt;\nnginx-85b98978db-zh9f5   1/1     Running   0          46m     192.168.36.67     k8s-node1   &lt;none&gt;           &lt;none&gt;\n</code></pre> \u53ef\u4ee5\u770b\u523046\u5206\u949f\u4e4b\u524d 46m\uff0c\u4e00\u4e2a\u90e8\u7f72\u5230node2\uff0c\u4e00\u4e2a\u90e8\u7f72\u5230node1</p> <ol> <li>\u67e5\u770bdeployment \u4fe1\u606f\uff0c\u5e76\u4ee5yaml\u5f62\u5f0f\u8f93\u51fa kubectl get deploy #\u67e5\u770b\u5f53\u524ddeployment\u8d44\u6e90 kubectl get deploy -o yaml #\u4ee5yaml\u683c\u5f0f\u67e5\u770b\u5f53\u524ddeployment\u8d44\u6e90 kubectl get deploy nginx -o yaml #\u4ee5yaml\u683c\u5f0f\u67e5\u770b\u5f53\u524ddeployment\u8d44\u6e90\uff0c\u6307\u5b9adeploy \u8d44\u6e90 <pre><code>\n</code></pre></li> </ol>","tags":["k8s","kubectl"]},{"location":"blog/2024/01/19/k8s-command-line---kubectl/#nginx-pod","title":"\u51cf\u5c11\u548c\u5220\u9664nginx pod","text":"<p><pre><code>kubectl scale deploy  --replicas=1 nginx\n</code></pre> <pre><code>kubectl delete deploy nginx\n</code></pre></p>","tags":["k8s","kubectl"]},{"location":"blog/2024/01/19/k8s-command-line---kubectl/#nginx-service","title":"\u5220\u9664nginx service","text":"<pre><code>kubectl delete service nginx\n</code></pre> <p>--------------------------------\u8349\u7a3f\u7ebf--------------------------------------------------------- 1.  I'm an annotation!</p> <p>Lorem ipsum dolor sit amet, (1) consectetur adipiscing elit.</p> <ol> <li> I'm an annotation!</li> </ol> asdc <p>dasd asd</p> <p> </p> <p><pre><code>\n</code></pre> <pre><code>\n</code></pre> <pre><code>\n</code></pre></p>","tags":["k8s","kubectl"]},{"location":"categories/","title":"Hello world!","text":"<p>... a</p>"},{"location":"k8s/","title":"Kubernetes Recap","text":"Method Description notes <code>GET</code>      Fetch resource yes <code>PUT</code>  Update resource yes <code>DELETE</code>      Delete resource yes"},{"location":"k8s/kubernetes/","title":"Learning Kubernetes Basically","text":""},{"location":"k8s/kubernetes/#install-kubectl-on-windows","title":"Install kubectl on Windows","text":"<p>https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/</p>"},{"location":"k8s/kubernetes/#install-tools","title":"Install Tools","text":"<p>minikube is a tool that lets you run Kubernetes locally. minikube runs an all-in-one or a multi-node local Kubernetes cluster on your personal computer (including Windows, macOS and Linux PCs) so that you can try out Kubernetes, or for daily development work.</p> Phasellus posuere in sem ut cursus <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <p>Minikube's  describe</p>"},{"location":"k8s/kubernetes/#using-yaml-file","title":"Using yaml file","text":""},{"location":"k8s/kubernetes/#11-create-pods-with-yaml","title":"1.1 Create pods with yaml","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: myapp-pod\n  labels:\n    app: myapp\n    type: front-end\n\nspec:\n  containers:\n    - name: nginx-container\n      image: nginx\n</code></pre>"},{"location":"k8s/kubernetes/#2create-replicasets-with-yaml","title":"2.Create replicasets with yaml","text":"<pre><code>apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  name: myapp-replicaset\n  labels:\n    app: myapp-replicaset\nspec:\n  selector:\n    matchLabels:\n      app: myapp\n  replicas: 6\n  template:\n    metadata:\n      name: nginx-2\n      labels:\n        app: myapp\n    spec:\n      containers:\n        - name: nginx\n          image: nginx\n</code></pre>"},{"location":"k8s/kubernetes/#3create-replicationcontroller-with-yaml","title":"3.Create ReplicationController with yaml","text":"<pre><code>apiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: myapp-rc\n  labels:\n    type: fron-end\n    app:  myapp\nspec:\n  template:\n    metadata:\n      name: myapp-pod\n      labels:\n        app: myapp\n        type: front-end\n\n    spec:\n      containers:\n        - name: nginx-container\n          image: nginx\n\n  replicas: 3\n</code></pre> <p>2333   sdsdd * dd   * [x]    dsd     * [ ] dsdssd          * [ ] dsdssd  abc</p>"},{"location":"k8s/exp/1/","title":"Command Line","text":""},{"location":"k8s/exp/1/#kubectl","title":"Kubectl","text":"<p><pre><code>kubectl run hello-minicube\n</code></pre> <pre><code>kubectl cluster-info\n</code></pre> <pre><code>kubectl get nodes\n</code></pre></p> <pre><code>\n</code></pre>"},{"location":"k8s/exp/1/#namespce","title":"Namespce","text":"defaultprod (customized)dev (customized) <pre><code>kubectl get pods\n</code></pre> <pre><code>kubectl get pods --namespace=prod\n</code></pre> <pre><code>kubectl get pods --namespace=dev\n</code></pre>"},{"location":"k8s/exp/1/#switch-namespce","title":"Switch Namespce","text":"<pre><code>#change the default to dev\nkubectl config set-context $(kubectl config current-context) --namespace=dev\nkubectl get pods\nkubectl get pods --namespace=default\nkubectl get pods --namespace=prod\nkubectl get pods --all-namespaces\n</code></pre>"},{"location":"k8s/exp/1/#create-pods-with-yaml","title":"Create pods with YAML","text":"<p><pre><code>kind: Pod\nmetadata:\n    name: myapp-pod\n    labels:\n        app: myapp\nspec:\n    containers:\n        - name: nginx-container\n          image: nginx\n</code></pre>     kubectl create pod -f xx.yaml</p>"},{"location":"k8s/exp/2/","title":"Security context","text":""},{"location":"k8s/exp/2/#service-account","title":"Service Account","text":""},{"location":"k8s/exp/2/#configmaps","title":"ConfigMaps","text":""},{"location":"k8s/note/chapter-1/","title":"\u4e00 Kubernetes\u6982\u8ff0","text":""},{"location":"k8s/note/chapter-1/#11","title":"1.1 \u5bb9\u5668\u7f16\u6392\u5de5\u5177","text":"<ul> <li>docker \u5b98\u65b9\u7f16\u6392\u5de5\u5177</li> </ul> <pre><code>docker compose    # \u5355\u673a\u7f16\u6392\u5de5\u5177\ndocker swarm      # \u5c06\u591a\u53f0 docker \u63d0\u4f9b\u7684\u8ba1\u7b97\u8d44\u6e90\u6574\u5408\u7684\u63a5\u53e3\uff0c\u968f\u540e docker compose \u7f16\u6392\u7684\u65f6\u5019\u53ea\u9700\u8981\u9762\u5411\u8fd9\u4e2a\u6574\u5408\u7684\u63a5\u53e3\u8fdb\u884c\u7f16\u6392\u5c31\u884c\uff0c\u65e0\u8bba\u63a5\u53e3\u4e0b\u6709\u591a\u5c11\u4e2a\u4e3b\u673a\u3002\ndocker mechine    # \u5c06\u4e00\u4e2a\u4e3b\u673a\u521d\u59cb\u5316\u4e3a\u4e00\u4e2a\u80fd\u591f\u52a0\u5165 docker swarm \u96c6\u7fa4\u4e2d\u7684\u9884\u7f6e\u7a0b\u5e8f\n</code></pre> <ul> <li>mesos IDC \u64cd\u4f5c\u7cfb\u7edf</li> </ul> <pre><code>IDC \u64cd\u4f5c\u7cfb\u7edf\uff0c\u80fd\u5c06\u4e00\u4e2a IDC \u63d0\u4f9b\u7684\u786c\u4ef6\u8d44\u6e90\uff0c\u7edf\u4e00\u8c03\u5ea6\u548c\u5206\u914d\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u8d44\u6e90\u5206\u914d\u5de5\u5177\uff0c\u975e\u80fd\u591f\u76f4\u63a5\u6258\u7ba1\u5bb9\u5668\u7684\uff0c\u6240\u4ee5\u5b83\u63d0\u4f9b\u4e86\u4ee5\u4e2a\u80fd\u591f\u76f4\u63a5\u7f16\u6392\u6846\u67b6\uff0cmarathon\u3002\n</code></pre> <ul> <li>kubernetes</li> </ul> <pre><code>\u76ee\u524d\u6700\u6d41\u884c\u7684\u5bb9\u5668\u7f16\u6392\u5de5\u5177,\u5e02\u573a\u5360\u6709\u7387\u6700\u9ad8\n</code></pre>"},{"location":"k8s/note/chapter-1/#12-kubernetes","title":"1.2 kubernetes","text":"<p>kubernetes \u662f\u5e0c\u814a\u8bed\uff0c\u7ffb\u8bd1\u8fc7\u6765\u662f\uff1a\u8235\u624b\u7684\u610f\u601d\uff0c\u5b83\u7684\u539f\u578b\u662f\u8c37\u6b4c\u5185\u90e8\u4f7f\u7528 Borg \u96c6\u7fa4\u7ba1\u7406\u7cfb\u7edf\uff0c\u53ef\u4ee5\u8bf4\u662f\u96c6\u7ed3\u4e86 Borg \u8bbe\u8ba1\u601d\u60f3\u7684\u7cbe\u534e\uff0c\u5e76\u4e14\u5438\u6536\u4e86 Borg \u7cfb\u7edf\u4e2d\u7684\u7ecf\u9a8c\u548c\u6559\u8bad\u3002</p> <p>\u5b83\u7684\u76ee\u6807\u4e0d\u4ec5\u4ec5\u662f\u4e00\u4e2a\u7f16\u6392\u7cfb\u7edf\uff0c\u800c\u662f\u63d0\u4f9b\u4e00\u4e2a\u89c4\u8303\uff0c\u53ef\u4ee5\u8ba9\u4f60\u6765\u63cf\u8ff0\u96c6\u7fa4\u7684\u67b6\u6784\uff0c\u5b9a\u4e49\u670d\u52a1\u7684\u6700\u7ec8\u72b6\u6001\uff0cKubernetes\u53ef\u4ee5\u5e2e\u4f60\u5c06\u7cfb\u7edf\u81ea\u52a8\u5730\u8fbe\u5230\u548c\u7ef4\u6301\u5728\u8fd9\u4e2a\u72b6\u6001\u3002Kubernetes\u4f5c\u4e3a\u4e91\u539f\u751f\u5e94\u7528\u7684\u57fa\u77f3\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u4e91\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5176\u91cd\u8981\u6027\u4e0d\u8a00\u800c\u55bb\u3002</p> <p>kubernetes \u5728 2014 \u5e74\u53d1\u5e03\u4e86\u7b2c\u4e00\u4e2a\u7248\u672c\uff0c\u76ee\u524d\u5f00\u6e90\u5e76\u6258\u7ba1\u5728 Github \u4e0a\u3002</p> <pre><code>https://github.com/Kubernetes\n</code></pre> <p>\u76ee\u524d\uff0cAWS\u3001\u963f\u91cc\u4e91\u3001\u5fae\u8f6f\u4e91\uff0c\u76ee\u524d\u5df2\u7ecf\u539f\u751f\u652f\u6301 K8S \uff0c\u76ee\u524d\u5df2\u7ecf\u53ef\u4ee5\u8ba9\u7528\u6237\u76f4\u63a5\u90e8\u7f72\u4e91\u539f\u751f\u7684\u670d\u52a1\u3002</p> <ul> <li>\u6709\u4ec0\u4e48\u4f18\u52bf</li> </ul> <pre><code>- \u57fa\u4e8e Borg \u7cfb\u7edf\uff0c\u8bbe\u8ba1\u6210\u719f\uff0c\u5f00\u6e90\u3001\u4e14\u8f7b\u91cf\u7ea7\uff0c\u7b80\u5355\u6613\u5b66\u3001\u5bb9\u6613\u7406\u89e3\uff1b\n- \u6a21\u5757\u5316\uff0c\u53ef\u63d2\u62d4\uff0c\u652f\u6301\u94a9\u5b50\uff0c\u53ef\u4efb\u610f\u7ec4\u5408\uff0c\u4f8b\u5982\uff1a\u7f51\u7edc\u7ec4\u4ef6 flannel\uff0c\u5b58\u50a8\u63d2\u4ef6\uff1b\n- \u6545\u969c\u53d1\u73b0\uff08\u5b58\u6d3b\u6027\u63a2\u9488\uff09\u548c\u81ea\u6211\u4fee\u590d\u80fd\u529b\uff08\u526f\u672c\u6570\u91cf\uff09\u3001\u670d\u52a1\u6eda\u52a8\u5347\u7ea7\uff08\u5c31\u7eea\u63a2\u9488\uff09\u548c\u5728\u7ebf\u6269\u5bb9\uff08\u526f\u672c\u6570\u91cf\uff09\u5bc6\u94a5\u548c\u914d\u7f6e\u7ba1\u7406\uff1b\n- \u53ef\u6269\u5c55\u7684\u8d44\u6e90\u81ea\u52a8\u8c03\u5ea6\u673a\u5236\uff08\u591a\u7ef4\u5ea6\u7684\u6c34\u5e73\u81ea\u52a8\u6269\u5bb9\uff09\u3001\u591a\u7c92\u5ea6\u7684\u8d44\u6e90\u914d\u989d\u7ba1\u7406\u80fd\u529b\uff08\u8d44\u6e90\u9650\u5236\uff09\u3002\n</code></pre>"},{"location":"k8s/note/chapter-1/#13","title":"1.3 \u73af\u5883\u67b6\u6784","text":"<p>Kubernetes \u662f\u4e00\u4e2a\u96c6\u7fa4\uff0c\u6574\u5408\u591a\u53f0\u8ba1\u7b97\u673a\u7684\u8ba1\u7b97\u80fd\u529b\uff0c\u5b83\u662f\u4e00\u79cd\u6709\u4e2d\u5fc3\u8282\u70b9\u6a21\u5f0f\u7684\u96c6\u7fa4\uff0c\u5728 K8S \u96c6\u7fa4\u4e2d\u4e3b\u673a\u5206\u4e3a\u4e24\u79cd\u89d2\u8272\uff1a</p> <pre><code>Master\uff1a\u96c6\u7fa4\u7684\u7ba1\u7406\u8282\u70b9\uff0c\u6709\u4e00\u4e2a\u6216\u8005\u4e00\u7ec4\u8282\u70b9\uff0c\u4e00\u822c 3 \u4e2a\u8db3\u591f\u4e86\u3002\nnodes\uff1a\u63d0\u4f9b\u8ba1\u7b97\u8d44\u6e90\u7684\u8282\u70b9\uff0c\u5c31\u662f\u8fd0\u884c\u5bb9\u5668\u7684\u8282\u70b9\uff0c\u53ef\u4ee5\u6269\u5c55\u3002\n</code></pre> <p>\u5ba2\u6237\u7aef\u521b\u5efa\u542f\u52a8\u5bb9\u5668\u7684\u8bf7\u6c42\u4ea4\u7ed9 Master \uff0cMaster \u4e0a\u6709\u4e00\u4e2a\u8c03\u5ea6\u5668\u5b83\u80fd\u5206\u6790\u5404 nodes \u8282\u70b9\u4e0a\u7684\u8d44\u6e90\u72b6\u6001\uff0c\u627e\u4e00\u4e2a\u6700\u9002\u5408\u8fd0\u884c\u7528\u6237\u5bb9\u5668\u7684\u8282\u70b9\uff0c\u5e76\u5728\u8fd9\u4e2a\u8282\u70b9\u4e0a\u4f7f\u7528 Docker \u542f\u52a8\u8fd9\u4e2a\u5bb9\u5668\uff0cnode \u8282\u70b9\u7684 Docker \u5728\u542f\u52a8\u5bb9\u5668\u65f6\u5019\u4f1a\u9996\u5148\u68c0\u67e5\u672c\u5730\u6709\u6ca1\u6709\u955c\u50cf\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u4ece\u4ed3\u5e93\u4e2d pull \u7136\u540e\u8fd0\u884c\u3002</p> <p>\u90a3\u4e48\u4ed3\u5e93\u53ef\u4ee5\u8fd0\u884c\u4e3a\u5bb9\u5668\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u6258\u7ba1\u5728 Kubernetes \u4e4b\u4e0a\uff0c\u5176\u5b9e Kubernetes \u53ef\u4ee5\u6258\u7ba1\u81ea\u8eab\uff0c\u5373\u81ea\u6258\u7ba1\u3002</p> <ul> <li>ApiServer</li> </ul> <p>kubernetes \u63a5\u6536\u7528\u6237\u521b\u5efa\u5bb9\u5668\u7b49\u8bf7\u6c42\u7684\u662f Kubernetes Cluster\uff0c\u90a3\u4e48\u5b83\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\u63a5\u53e3\u5c31\u662f\u4e00\u4e2a API \u63a5\u53e3 \uff0c\u8fd9\u4e2a\u63a5\u53e3\u9700\u8981\u7f16\u7a0b\u6765\u8bbf\u95ee\uff0c\u6216\u8005\u901a\u8fc7\u7f16\u5199\u597d\u7684\u5ba2\u6237\u7aef\u7a0b\u5e8f\u6765\u8bbf\u95ee\uff0cKubernetes Master \u4e0a\u6709\u4e00\u4e2a\u7ec4\u4ef6\u5c31\u662f ApiServer\uff0c\u6765\u63a5\u6536\u5ba2\u7aef\u8bf7\u6c42\uff0c\u89e3\u6790\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u5176\u4e3b\u8981\u529f\u80fd\u5305\u62ec\u8ba4\u8bc1\u6388\u6743\u3001\u6570\u636e\u6821\u9a8c\u4ee5\u53ca\u96c6\u7fa4\u72b6\u6001\u53d8\u66f4\uff0c\u4ee5\u53ca\u8d1f\u8d23\u5176\u4ed6\u6a21\u5757\u76f4\u63a5\u7684\u76f8\u4e92\u901a\u8baf\u548c\u6570\u636e\u4ea4\u4e92\uff0c\u53ea\u6709api server\u624d\u80fd\u64cd\u4f5cetcd\uff0c\u5176\u4ed6\u6a21\u5757\u60f3\u8981\u83b7\u53d6\u6570\u636e\u9700\u8981\u901a\u8fc7api server\u63d0\u4f9b\u7684\u63a5\u53e3\u8fdb\u884c\u76f8\u5173\u6570\u636e\u64cd\u4f5c</p> <ul> <li>Scheduler</li> </ul> <p>scheduler watch apiserver\uff0c\u63a5\u53d7\u7cfb\u7edf\u6216\u7528\u6237\u8bf7\u6c42\u662f\u8fd0\u884c\uff0c\u5982\u4f55\u8981\u8fd0\u884c\u4e00\u4e2apod\uff0c\u90a3\u4e48 Master \u4f1a\u4f7f\u7528\u8c03\u5ea6\u5668\uff08scheduler\uff09\u6839\u636e\u8bf7\u6c42\u6765\u5206\u914d\u4e00\u4e2a\u80fd\u591f\u8fd0\u884c\u5bb9\u5668\u7684 nodes \u8282\u70b9\uff0c\u4f8b\u5982\uff1a\u6839\u636e\u7528\u6237\u5bf9\u8d44\u6e90\u8981\u6c42\uff0cCPU\u3001\u5185\u5b58\u3001\u6765\u8bc4\u4f30\u54ea\u4e2a nodes \u6700\u5408\u9002\u8fd0\u884c\u3002</p> <p>\u5927\u6982\u7684\u8fc7\u7a0b\u5c31\u662f\uff1a\u9996\u5148\u662f\u9884\u9009\uff0c\u4ece nodes \u4e2d\u6311\u9009\u51fa\u7b26\u5408\u7528\u6237\u5bb9\u5668\u8fd0\u884c\u8981\u6c42\u7684\uff0c\u7136\u540e\u5728\u8fd9\u4e9b\u9884\u9009\u7ed3\u679c\u4e2d\u8fdb\u884c\u4f18\u9009\uff0c\u9009\u51fa\u6700\u4f73\u7684\u9002\u914d node\u3002</p> <ul> <li>Controller\uff08\u63a7\u5236\u5668\uff09</li> </ul> <p>\u5982\u679c\u8fd0\u884c\u5bb9\u5668\u7684\u8282\u70b9\u5b95\u673a\u6216\u8005\u5bb9\u5668\u672c\u8eab\u8fd0\u884c\u51fa\u73b0\u95ee\u9898\uff0ckubernetes \u80fd\u591f\u5728\u5176\u4ed6\u8282\u70b9\u518d\u542f\u52a8\u4e00\u4e2a\u4e00\u6a21\u4e00\u6837\u7684\u5bb9\u5668\uff0c\u8fd9\u5c31\u662f Kubernetes \u63d0\u4f9b\u7684\u81ea\u6108\u80fd\u529b\u3002</p> <p>\u63a7\u5236\u5668\u5c31\u5b9e\u73b0\u4e86\u76d1\u63a7\u5b83\u6240\u8d1f\u8d23\u7684\u6bcf\u4e00\u4e2a\u5bb9\u5668\u7684\u5065\u5eb7\u72b6\u6001\uff0c\u4e00\u65e6\u53d1\u73b0\u4e0d\u5065\u5eb7\u4e86\uff0c\u90a3\u4e48\u63a7\u5236\u5668\u4f1a\u5411 Master \u53d1\u9001\u8bf7\u6c42\uff0cMaster \u4f1a\u518d\u6b21\u7531\u8c03\u5ea6\u5668\u6311\u9009\u51fa\u5408\u9002\u7684\u8282\u70b9\u518d\u6b21\u8fd0\u884c\u8fd9\u4e2a\u5bb9\u5668\u3002</p> <p>\u5b83\u80fd\u6301\u7eed\u6027\u63a2\u6d4b\u6240\u7ba1\u7406\u7684\u5bb9\u5668\uff0c\u4e00\u65e6\u4e0d\u5065\u5eb7\uff0c\u6216\u4e0d\u7b26\u5408\u7528\u6237\u5b9a\u4e49\u7684\u5065\u5eb7\u72b6\u6001\uff0c\u5c31\u4f1a\u7531\u5b83\u53d1\u8d77\u6765\u8bf7\u6c42\uff0c\u6765\u4fdd\u8bc1\u5bb9\u5668\u5411\u7528\u6237\u5e0c\u671b\u7684\u5065\u5eb7\u72b6\u6001\u8fc1\u5f99\u3002</p> <p>\u800c Kubernets \u652f\u6301\u4f17\u591a\u7684\u63a7\u5236\u5668\uff0c\u652f\u6301\u5bb9\u5668\u5065\u5eb7\u7684\u63a7\u5236\u5668\u53ea\u662f\u5176\u4e2d\u4e00\u79cd\u3002</p> <ul> <li>ControllerManager\uff08\u5236\u5668\u7ba1\u7406\u5668\uff09</li> </ul> <p>\u5728 Master \u5185\u7f6e\u7ec4\u4ef6\u4e2d\u6709\u4e00\u4e2a\u63a7\u5236\u5668\u7ba1\u7406\u5668\uff0c\u5b83\u8d1f\u8d23\u76d1\u89c6\u7740\u6bcf\u4e00\u4e2a\u63a7\u5236\u5668\uff0c\u5982\u679c\u63a7\u5236\u5668\u4e0d\u5065\u5eb7\u65e0\u6cd5\u5de5\u4f5c\uff0c\u90a3\u4e48\u7531\u63a7\u5236\u5668\u7ba1\u7406\u5668\u6765\u786e\u4fdd\u63a7\u5236\u5668\u7684\u5065\u5eb7\uff0c\u7531\u4e8e Master \u6709\u591a\u4e2a\uff0c\u6240\u4ee5\u5177\u6709\u5197\u4f59\u6027\u3002</p> <ul> <li>Pod\uff08\u539f\u5b50\u8c03\u5ea6\u5355\u5143\uff0c\u662f\u5bb9\u5668\u7684\u5c01\u88c5\uff09</li> </ul> <p>\u5728 Kubernetes \u4e0a\u8c03\u5ea6\u7684\u539f\u5b50\u5355\u5143\uff0cKubernetes \u4e0d\u76f4\u63a5\u8c03\u5ea6\u5bb9\u5668\uff0c\u800c\u662f Pod\uff0cPod\u53ef\u4ee5\u7406\u89e3\u4e3a\u5bb9\u5668\u7684\u4e8c\u6b21\u5c01\u88c5\uff0c\u53ef\u4ee5\u7531\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5bb9\u5668\u7ec4\u6210\uff0c\u591a\u4e2a\u5bb9\u5668\u5171\u4eab\u540c\u4e00\u4e2a\u7f51\u7edc\u540d\u79f0\u7a7a\u95f4\uff1aNET\u3001UTS\u3001IPC\u3002</p> <p>\u540c\u4e00\u4e2a POD \u91cc\u7684\u5bb9\u5668\uff0c\u8fd8\u80fd\u5171\u4eab\u540c\u4e00\u4e2a\u5b58\u50a8\u5377\uff0c\u5b58\u50a8\u5377\u53ef\u4ee5\u5c5e\u4e8e POD\u3002</p> <p>\u4e00\u822c\u4e00\u4e2a POD \u53ea\u8fd0\u884c\u4e00\u4e2a\u5bb9\u5668\uff0c\u5982\u679c\u9700\u8981\u5728POD\u653e\u591a\u4e2a\u5bb9\u5668\uff0c\u90a3\u4e48\u4e00\u822c\u6709\u4e00\u4e2a\u4e3b\u5bb9\u5668\uff0c\u5176\u4ed6\u5bb9\u5668\u662f\u4e3a\u4e3b\u5bb9\u5668\u63d0\u4f9b\u670d\u52a1\u7684\u3002</p> <ul> <li>Node\uff08\u5de5\u4f5c\u8282\u70b9\uff09</li> </ul> <p>\u63d0\u4f9b\u8ba1\u7b97\u8d44\u6e90\u7684\u8282\u70b9\uff0c\u5c31\u662f\u8fd0\u884c Pod \u7684\u4e3b\u673a\uff0cKubenetes Cluster \u7edf\u4e00\u7ba1\u7406\u6240\u6709\u7684 node \u8282\u70b9\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u5f53\u7528\u6237\u8bf7\u6c42\u521b\u5efa\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u68c0\u67e5\u76ee\u524d\u96c6\u7fa4\u8fd8\u6709\u6ca1\u6709\u8d44\u6e90\u53ef\u4ee5\u8fd0\u884c\u7528\u6237\u7684\u5bb9\u5668\uff0c\u8fd9\u5b9e\u73b0\u4e86\u7edf\u4e00\u8c03\u5ea6\u7edf\u4e00\u7ba1\u7406\u7684\u4e00\u4e2a\u5e73\u53f0\u3002</p> <ul> <li>Label\uff08\u6807\u7b7e\uff09</li> </ul> <p>\u4e00\u4e2a\u7531 <code>key = value</code> \u7ec4\u6210\u7684\u6807\u7b7e\uff0c\u53ef\u4ee5\u4e3a POD \u6253\u4e0a\u4e00\u4e2a\u6807\u7b7e\u3002</p> <ul> <li>Selecter\uff08\u6807\u7b7e\u9009\u62e9\u5668\uff09</li> </ul> <p>\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u4f17\u591a POD \uff0c\u524d\u9762\u63d0\u5230\u4e00\u4e2a\u63a7\u5236\u5668\u53ef\u4ee5\u7ba1\u7406\u82e5\u5e72\u4e2a POD \uff0c\u90a3\u4e48\u63a7\u5236\u5668\u5982\u4f55\u4ece\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u6240\u6709 POD \u4e2d\u6311\u9009\u51fa\u6765\u81ea\u5df1\u9700\u8981\u7ba1\u7406\u7684 POD \u5462?</p> <p>\u5728\u521b\u5efa\u4e00\u4e2a POD \u7684\u65f6\u5019\u4e3a POD \u6253\u4e0a\u4e00\u4e2a\u6807\u7b7e\uff0c\u8ba9\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u6807\u7b7e\u6765\u8bc6\u522b\u51fa\u6765\u8fd9\u4e2aPOD\uff0c\u8fd8\u53ef\u4ee5\u7528\u6765\u533a\u5206\u4e00\u7ec4\u76f8\u540c\u529f\u80fd\u7684POD\uff0c\u4f8b\u5982\uff1a\u521b\u5efa\u56db\u4e2anginx pod\uff0c\u53ef\u4ee5\u7ed9\u6bcf\u4e2apod\u52a0\u4e00\u4e2a K/V\u7c7b\u578b\u7684\u6807\u7b7e\u5982\uff1aapp=nginx\uff0c\u5c06\u6765\u627e\u51fa\u8fd9\u56db\u4e2a nginx pod\uff0c\u90a3\u4e48\u6761\u4ef6\u5c31\u662f\u6839\u636e \u62e5\u6709 key \u4e3a app \u7684pod \u5e76\u4e14 value \u4e3a nginx \u6765\u6311\u51fa\u8fd9\u7ec4 POD\u3002</p> <p>\u6807\u7b7e\u4e0d\u662f POD \u552f\u4e00\u5177\u6709\u7684\u673a\u5236\uff0c\u5176\u4ed6\u7684\u7ec4\u4ef6\u540c\u6837\u53ef\u4ee5\u6709\u6807\u7b7e\u3002</p>"},{"location":"k8s/note/chapter-1/#14","title":"1.4 \u67b6\u6784\u548c\u7ec4\u4ef6","text":"<ul> <li>Etcd</li> </ul> <pre><code>\u7528\u4e8e Kubernetes \u7684\u540e\u7aef\u6570\u636e\u5b58\u50a8,\u6240\u6709\u96c6\u7fa4\u6570\u636e\u90fd\u5b58\u50a8\u5728\u6b64\u5904\n</code></pre> <ul> <li>Master \u8282\u70b9\u8d1f\u8d23\u7ef4\u62a4\u96c6\u7fa4\u7684\u76ee\u6807\u72b6\u6001\uff0c\u4e0a\u9762\u8fd0\u884c\u7684\u4e3b\u63a7\u7ec4\u4ef6\u6709</li> </ul> <pre><code>kube-apiserver                 # \u5bf9\u5916\u66b4\u9732\u4e86 Kubernetes API\uff0c\u5b83\u662f\u7684 Kubernetes \u524d\u7aef\u63a7\u5236\u5c42\uff0c\u53ea\u6709 API Server \u4f1a\u4e0e etcd \u901a\u4fe1\uff0c\u5176\u5b83\u6a21\u5757\u90fd\u5fc5\u987b\u901a\u8fc7 API Server \u8bbf\u95ee\u96c6\u7fa4\u72b6\u6001\nkube-controller-manager        # \u5904\u7406\u96c6\u7fa4\u4e2d\u5e38\u89c4\u4efb\u52a1\uff0c\u5b83\u662f\u5355\u72ec\u7684\u8fdb\u7a0b\uff0c\u5185\u90e8\u5305\u542b\u591a\u4e2a\u63a7\u5236\u5668\uff0c\u4f8b\u5982\u7ef4\u62a4 POD \u6570\u91cf\nkube-scheduler                 # \u76d1\u89c6\u65b0\u521b\u5efa\u7684 Pod \u4e3a\u65b0\u521b\u5efa\u7684 POD \u5206\u914d\u5408\u9002\u7684 node \u8282\u70b9\n</code></pre> <ul> <li>Node \u8282\u70b9\u5b9e\u9645\u8d1f\u8d23\u5b9e\u65bd\uff0c\u4e5f\u5c31\u662f\u8fd0\u884c POD \u7684\u8282\u70b9\uff0c\u4e0a\u9762\u8fd0\u884c\u7684\u7ec4\u4ef6\u6709</li> </ul> <pre><code>kubelet                        # \u8282\u70b9\u81ea\u6ce8\u518c\u548c\u8282\u70b9\u72b6\u6001\u66f4\u65b0\uff0c\u5b83\u76d1\u6d4b\u5df2\u7ecf\u5206\u914d\u7ed9\u81ea\u5df1\u7684 Pod\uff0c\u4e3a POD \u51c6\u5907\u5377\uff0c\u4e0b\u8f7d POD \u6240\u9700\u7684 Secret\uff0c\u4e0b\u8f7d\u955c\u50cf\u5e76\u8fd0\u884c\uff0c\u8fdb\u884c\u751f\u547d\u5468\u671f\u63a2\u6d4b\uff0c\u4e0a\u62a5 POD \u548c\u8282\u70b9\u72b6\u6001\nkube-proxy                     # \u901a\u8fc7\u7ef4\u62a4\u4e3b\u673a\u4e0a\u7684\u7f51\u7edc\u89c4\u5219\u5e76\u6267\u884c\u8fde\u63a5\u8f6c\u53d1\uff0c\u5c06 Kubernetes \u63d0\u4f9b\u7684\u7f51\u7edc\u670d\u52a1\u4ee3\u7406\u5230\u6bcf\u4e2a\u8282\u70b9\u4e0a\uff0c\u5b9e\u73b0\u4e86Kubernetes\u670d\u52a1\u62bd\u8c61\ndocker                         # \u7528\u4e8e\u8fd0\u884c\u5bb9\u5668\n</code></pre> <ul> <li>\u63d2\u4ef6</li> </ul> <pre><code>\u63d2\u4ef6\u662f\u589e\u5f3a\u96c6\u7fa4\u529f\u80fd\u7684 Pod \u548c Service,\u63d2\u4ef6\u5bf9\u8c61\u672c\u8eab\u662f\u53d7\u547d\u540d\u7a7a\u95f4\u9650\u5236\u7684,\u88ab\u521b\u5efa\u4e8e kube-system \u547d\u540d\u7a7a\u95f4.\n</code></pre> <ul> <li>DNS</li> </ul> <pre><code>\u867d\u7136\u5176\u4ed6\u63d2\u4ef6\u5e76\u4e0d\u662f\u5fc5\u9700\u7684,\u4f46\u6240\u6709 Kubernetes \u96c6\u7fa4\u90fd\u5e94\u8be5\u5177\u6709Cluster DNS,\u8bb8\u591a\u5e94\u7528\u4f9d\u8d56\u4e8e\u5b83,\u4e3a Kubernetes \u670d\u52a1\u63d0\u4f9bDNS\u8bb0\u5f55,\u5bb9\u5668\u542f\u52a8\u8be5\u540e\u4f1a\u81ea\u52a8\u5c06 DNS \u670d\u52a1\u5668\u5305\u542b\u5728 resolv.conf \u4e2d.\n</code></pre>"},{"location":"k8s/note/chapter-10/","title":"\u5341 POD \u5b58\u50a8\u5377","text":"<p>\u5927\u90e8\u5206\u6709\u72b6\u6001\u7684\u5e94\u7528\u90fd\u6709\u6301\u4e45\u5b58\u50a8\uff0c\u5728 Docker \u4e0a\u6211\u4eec\u5c06\u5bb9\u5668\u6240\u9700\u8981\u7684\u5b58\u50a8\u5377\u653e\u5728\u5bbf\u4e3b\u673a\u4e0a\uff0c\u4f46\u662f k8s \u4e0a\u4e0d\u884c\uff0c\u56e0\u4e3a POD \u4f1a\u88ab\u5728\u4e0d\u540c\u7684 node \u8282\u70b9\u4e0a\u521b\u5efa\u5220\u9664\uff0c\u6240\u4ee5 k8s \u9700\u8981\u4e00\u5957\u53e6\u5916\u7684\u5b58\u50a8\u5377\u673a\u5236\uff0c\u5b83\u80fd\u8131\u79bb\u8282\u70b9\u4e3a\u6574\u4e2a\u96c6\u7fa4\u63d0\u4f9b\u6301\u4e45\u5b58\u50a8\u3002</p> <p>k8s \u63d0\u4f9b\u4e86\u591a\u79cd\u4e0d\u540c\u7684\u5b58\u50a8\u5377\uff0ck8s \u4e2d\u5b58\u50a8\u5377\u5c5e\u4e8e POD \u800c\u4e0d\u662f\u5bb9\u5668\uff0cPOD \u53ef\u4ee5\u6302\u8f7d\uff0cPOD \u4e3a\u4ec0\u4e48\u80fd\u6709\u5b58\u50a8\u5377\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a\u5728\u6240\u6709\u8282\u70b9\u4e0a\u8fd0\u884c\u4e86\u4e00\u4e2a Pause \u7684\u955c\u50cf\uff0c\u5b83\u662f POD \u7684\u57fa\u7840\u67b6\u6784\u5bb9\u5668\uff0c\u5b83\u62e5\u6709\u5b58\u50a8\u5377\uff0c\u540c\u4e00\u4e2a POD \u5185\u7684\u6240\u6709\u5bb9\u5668\u662f\u4e00\u4e2a\u7f51\u7edc\u540d\u79f0\u7a7a\u95f4\u7684\u3002</p>"},{"location":"k8s/note/chapter-10/#101","title":"10.1 \u5377\u7684\u7c7b\u578b","text":"<p>\u67e5\u770b POD \u652f\u6301\u7684\u5b58\u50a8\u7c7b\u578b\uff1akubectl explain pods.spec.volumes</p> <ol> <li>HostPath\uff1a\u5728\u8282\u70b9\u672c\u5730\u65b0\u5efa\u4e00\u4e2a\u8def\u5f84\uff0c\u4e0e\u5bb9\u5668\u5efa\u7acb\u5173\u8054\u5173\u7cfb\uff0c\u4f46\u8282\u70b9\u6302\u4e86\u7684\u6570\u636e\u4e5f\u4e0d\u5b58\u5728\u4e86\uff0c\u6240\u4ee5\u4e5f\u4e0d\u5177\u6709\u6301\u4e45\u6027\uff0c\u5bb9\u5668\u88ab\u8c03\u5ea6\u5230\u522b\u7684 node \u65f6\u5019\u4e0d\u80fd\u8de8\u8282\u70b9\u4f7f\u7528HostPath\u3002</li> <li>Local\uff1a\u76f4\u63a5\u4f7f\u7528\u8282\u70b9\u7684\u8bbe\u5907\u3001\u4e5f\u652f\u6301\u4e00\u4e2a\u76ee\u5f55\u7c7b\u4f3c\u4e8e HostPath\u3002</li> <li>EmptyDir\uff1a\u53ea\u5728\u8282\u70b9\u672c\u5730\u4f7f\u7528\uff0c\u4e00\u65e6 POD \u5220\u9664\uff0c\u5b58\u50a8\u5377\u4e5f\u4f1a\u5220\u9664\uff0c\u5b83\u4e0d\u5177\u6709\u6301\u4e45\u6027\uff0c\u5f53\u4e34\u65f6\u76ee\u5f55\u6216\u8005\u7f13\u5b58\u3002</li> <li>\u7f51\u7edc\u5b58\u50a8\uff1aiSCSI\u3001NFS\u3001Cifs\u3001glusterfs\u3001cephfs\u3001EBS\uff08AWS)\u3001Disk\uff08Azone\uff09</li> </ol>"},{"location":"k8s/note/chapter-10/#102","title":"10.2 \u5bb9\u5668\u6302\u8f7d\u9009\u9879","text":"<p>\u5728 K8S \u4e2d\u5377\u662f\u5c5e\u4e8e POD \u7684\uff0c\u800c\u4e0d\u662f\u5bb9\u5668\uff0c\u6240\u4ee5\u5377\u7684\u5b9a\u4e49\u5728 POD \u4e2d\uff0c\u4e00\u4e2a POD \u4e2d\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a\u5377\u3002</p> <ul> <li>\u5728 POD \u4e2d\u6302\u8f7d\u4f7f\u7528\uff0ckubectl explain pods.spec.containers.volumeMounts</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: myapp\n  namespace: default\n  labels:\n    app: myapp\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n    volumeMounts        &lt;[]Object&gt;  # \u5377\u6302\u8f7d\u5bf9\u8c61\n      mountPath         &lt;string&gt;    # \u6302\u8f7d\u8def\u5f84\n      mountPropagation  &lt;string&gt;    # \u786e\u5b9a\u6302\u8f7d\u5982\u4f55\u4ece\u4e3b\u673a\u4f20\u64ad\u5230\u5bb9\u5668\n      name              &lt;string&gt;    # \u6302\u8f7d\u54ea\u4e2a\u5377\n      readOnly          &lt;boolean&gt;   # \u662f\u5426\u53ea\u8bfb\u6302\u8f7d\n      subPath           &lt;string&gt;    # \u6302\u8f7d\u5728\u5b50\u8def\u5f84\u4e0b\n      subPathExpr       &lt;string&gt;    # \u4e0e subPath \u7c7b\u4f3c\uff0c\u6302\u8f7d\u5728\u5b50\u8def\u5f84\u4e0b\uff0c\u4e0d\u540c\u7684\u662f\u53ef\u4ee5\u4f7f\u7528 $(VAR_NAME) \u8868\u793a\u5bb9\u5668\u6269\u5c55\u8fd9\u4e2a\u53d8\u91cf\n</code></pre>"},{"location":"k8s/note/chapter-10/#103","title":"10.3 \u8282\u70b9\u5b58\u50a8","text":""},{"location":"k8s/note/chapter-10/#1031-hostpath","title":"10.3.1 hostpath\u5b58\u50a8\u5377","text":"<p>\u5728\u5bbf\u4e3b\u673a\u7684\u8def\u5f84\u6302\u8f7d\u5230 POD \u4e0a\uff0cPOD \u5220\u9664\u540e\uff0c\u5377\u6570\u636e\u662f\u4e0d\u4f1a\u968f\u4e4b\u5220\u9664\u7684\uff0c\u4f46\u5982\u679c node \u8282\u70b9\u6302\u6389\uff0c\u90a3\u4e48\u6570\u636e\u6709\u53ef\u80fd\u4e22\u5931\uff0c\u5982\u679c POD \u88ab\u8c03\u5ea6\u5230\u5176\u4ed6\u7684\u8282\u70b9\uff0c\u90a3\u4e48\u539f\u6765\u5377\u7684\u6570\u636e\u5c31\u8bbf\u95ee\u4e0d\u5230\u4e86\u3002</p> <p>https://kubernetes.io/docs/concepts/storage/volumes/#hostpath</p> <ul> <li>\u5b9a\u4e49\u53c2\u6570\uff0ckubectl explain pods.spec.volumes.hostPath</li> </ul> <pre><code>path    &lt;string&gt;  # \u4e3b\u673a\u4e0a\u76ee\u5f55\u7684\u8def\u5f84\u3002 \u5982\u679c\u8def\u5f84\u662f\u7b26\u53f7\u94fe\u63a5\uff0c\u5219\u4f1a\u8ddf\u968f\u771f\u5b9e\u8def\u5f84\u7684\u94fe\u63a5\u3002\ntype    &lt;string&gt;  # \u89c1\u4e0b\u8868\n</code></pre> \u503c \u884c\u4e3a \u7a7a\u5b57\u7b26\u4e32\uff08\u9ed8\u8ba4\uff09\u7528\u4e8e\u5411\u540e\u517c\u5bb9\uff0c\u8fd9\u610f\u5473\u7740\u5728\u5b89\u88c5hostPath\u5377\u4e4b\u524d\u4e0d\u4f1a\u6267\u884c\u4efb\u4f55\u68c0\u67e5\u3002 <code>DirectoryOrCreate</code> \u5982\u679c\u7ed9\u5b9a\u8def\u5f84\u4e2d\u4e0d\u5b58\u5728\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u5c06\u6839\u636e\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7a7a\u76ee\u5f55\uff0c\u6743\u9650\u8bbe\u7f6e\u4e3a0755\uff0c\u4e0eKubelet\u5177\u6709\u76f8\u540c\u7684\u7ec4\u548c\u6240\u6709\u6743\u3002 <code>Directory</code> \u76ee\u5f55\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u8def\u5f84\u4e2d <code>FileOrCreate</code> \u5982\u679c\u7ed9\u5b9a\u8def\u5f84\u4e2d\u4e0d\u5b58\u5728\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u4f1a\u6839\u636e\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff0c\u6743\u9650\u8bbe\u7f6e\u4e3a0644\uff0c\u4e0eKubelet\u5177\u6709\u76f8\u540c\u7684\u7ec4\u548c\u6240\u6709\u6743\u3002 <code>File</code> \u6587\u4ef6\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u8def\u5f84\u4e2d <code>Socket</code> UNIX\u5957\u63a5\u5b57\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u8def\u5f84\u4e2d <code>CharDevice</code> \u5b57\u7b26\u8bbe\u5907\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u8def\u5f84\u4e2d <code>BlockDevice</code> \u5757\u8bbe\u5907\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u8def\u5f84\u4e2d <ul> <li>\u793a\u4f8b</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: myapp\n  namespace: default\n  labels:\n    app: myapp\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n    volumeMounts:                       # \u5bb9\u5668\u6302\u8f7d\u54ea\u4e9b\u5377\n    - name: webstore                    # \u6302\u8f7d\u54ea\u4e2a\u5377\n      mountPath: /usr/share/nginx/html  # \u6302\u8f7d\u5230\u5bb9\u5668\u5185\u54ea\u4e2a\u76ee\u5f55\n      readOnly: false                   # \u662f\u5426\u53ea\u8bfb\n  volumes:                              # \u5b58\u50a8\u5377\u5c5e\u4e8ePOD\u7684\uff08\u4e0d\u5c5e\u4e8e\u5bb9\u5668)\n  - name: webstore                      # \u5b58\u50a8\u5377\u5bf9\u8c61\u540d\u5b57\n    hostPath:                           # hostpath \u7c7b\u578b\u7684\u5b58\u50a8\u5377\u5bf9\u8c61\n      path: /data/myapp                 # \u5904\u4e8e\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\n      type: DirectoryOrCreate           # \u4e0d\u5b58\u5728\u5219\u521b\u5efa\n</code></pre>"},{"location":"k8s/note/chapter-10/#1032-gitrepo","title":"10.3.2 gitRepo\u5377","text":"<p>\u5c06 git \u4ed3\u5e93\u7684\u5185\u5bb9\u5f53\u4f5c\u5b58\u50a8\u4f7f\u7528\uff0c\u5728 POD \u521b\u5efa\u65f6\u5019\u8fde\u63a5\u5230\u4ed3\u5e93\uff0c\u5e76\u62c9\u53d6\u4ed3\u5e93\uff0c\u5e76\u5c06\u5b83\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u5f53\u4f5c\u4e00\u4e2a\u5b58\u50a8\u5377\u3002</p> <p>\u5b83\u5176\u5b9e\u662f\u5efa\u7acb\u5728 emptyDir \u7684\u57fa\u7840\u4e0a\uff0c\u4f46\u662f\u5bf9\u5377\u7684\u64cd\u4f5c\u4e0d\u4f1a\u540c\u6b65\u5230 gitrepo \u4e0a\u3002</p> <p>\u6ce8\u610f\uff1a\u9700\u8981\u5728\u5404\u8fd0\u884cpod\u7684node\u8282\u70b9\u4e0a\u5b89\u88c5git\u5de5\u5177\uff0c\u7528\u4e8egit\u7684\u62c9\u53d6</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    run: gitrepo\n  name: gitrepo\nspec:\n  containers:\n  - image: nginx:latest\n    name: gitrepo\n    volumeMounts:\n      - name: gitrepo\n        mountPath: /usr/share/nginx/html\n  volumes:\n    - name: gitrepo\n      gitRepo:\n        repository: \"https://gitee.com/rocket049/mysync.git\"\n        revision: \"master\"\n</code></pre>"},{"location":"k8s/note/chapter-10/#1033-emptydir","title":"10.3.3 emptyDir\u7f13\u5b58\u5377","text":"<p>\u5b83\u4f7f\u7528\u5bbf\u4e3b\u673a\u4e00\u4e2a\u76ee\u5f55\u4f5c\u4e3a\u6302\u8f7d\u70b9\uff0c\u968f\u7740 POD \u751f\u547d\u5468\u671f\u7684\u7ed3\u675f\uff0c\u5176\u4e2d\u7684\u6570\u636e\u4e5f\u4f1a\u4e22\u5931\uff0c\u4f46\u662f\u5b83\u6709\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u4f18\u70b9\u5c31\u662f\u53ef\u4ee5\u4f7f\u7528\u5185\u5b58\u5f53\u4f5c\u5b58\u50a8\u7a7a\u95f4\u6302\u8f7d\u4f7f\u7528\u3002</p> <p>\u5b83\u53ef\u4ee5\u7528\u5728 POD \u4e2d\u4e24\u4e2a\u5bb9\u5668\u4e2d\u6709\u4e00\u4e9b\u6570\u636e\u9700\u8981\u5171\u4eab\u65f6\u5019\u9009\u7528\u3002</p> <ul> <li>\u5b9a\u4e49 emptyDir \u53c2\u6570\uff0c<code>kubectl explain pods.spec.volumes.emptyDir</code></li> </ul> <pre><code>medium      &lt;string&gt;    # \u4f7f\u7528 \"\" \u8868\u793a\u4f7f\u7528 Disk \u6765\u5b58\u50a8\uff0c\u4f7f\u7528 Memory \u8868\u793a\u4f7f\u7528\u5185\u5b58\nsizeLimit   &lt;string&gt;    # \u9650\u5236\u5b58\u50a8\u7a7a\u95f4\u7684\u5927\u5c0f\n</code></pre> <ul> <li>\u4f7f\u7528\u793a\u4f8b</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-volume-demo\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  volumes:\n    - name: html\n      emptyDir: {}      # \u4f7f\u7528\u78c1\u76d8\uff0c\u4e14\u6ca1\u6709\u5bb9\u91cf\u9650\u5236\n  containers:\n    - name: myapp\n      image: ikubernetes/myapp:v1\n      imagePullPolicy: IfNotPresent\n      volumeMounts:\n        - name: html\n          mountPath: /usr/share/nginx/html/\n      ports:\n        - name: http\n          containerPort: 80\n        - name: https\n          containerPort: 443\n    - name: busybox\n      image: busybox:latest\n      imagePullPolicy: IfNotPresent\n      volumeMounts:\n        - name: html\n          mountPath: /data/\n      command:\n        - \"/bin/sh\"\n        - \"-c\"\n        - \"while true; do date &gt;&gt; /data/index.html; sleep 10; done\"\n</code></pre> <ul> <li>\u4f7f\u7528\u793a\u4f8b</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-volume-demo\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n    - name: myapp\n      image: ikubernetes/myapp:v1\n      imagePullPolicy: IfNotPresent\n      volumeMounts:\n        - name: html\n          mountPath: /usr/share/nginx/html/\n      ports:\n        - name: http\n          containerPort: 80\n        - name: https\n          containerPort: 443\n    - name: busybox\n      image: busybox:latest\n      imagePullPolicy: IfNotPresent\n      volumeMounts:\n        - name: html\n          mountPath: /data/\n      command:\n        - \"/bin/sh\"\n        - \"-c\"\n        - \"while true; do date &gt;&gt; /data/index.html; sleep 10; done\"\n  volumes:\n    - name: html\n      emptyDir:\n        medium: \"\"\n        sizeLimit: 1536Mi\n</code></pre>"},{"location":"k8s/note/chapter-10/#104","title":"10.4 \u7f51\u7edc\u5b58\u50a8","text":"<p>\u7f51\u7edc\u5b58\u50a8\uff0c\u5c31\u662f\u8131\u79bb\u4e86\u8282\u70b9\u751f\u547d\u5468\u671f\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u5373\u4f7f pod \u88ab\u8c03\u5ea6\u5230\u522b\u7684 node \u8282\u70b9\u4e0a\uff0c\u4ecd\u7136\u53ef\u4ee5\u6302\u8f7d\u4f7f\u7528\u5176\u4e2d\u7684\u6570\u636e\u3002</p>"},{"location":"k8s/note/chapter-10/#1041-nfs","title":"10.4.1 nfs","text":"<p>nfs \u670d\u52a1\u5668\u662f\u5b58\u5728\u4e8e\u96c6\u7fa4\u4e4b\u5916\u7684\u670d\u52a1\u5668\uff0c\u5b83\u4e0d\u53d7 node \u8282\u70b9\u7684\u5f71\u54cd\uff0c\u56e0\u800c\u5728 node \u8282\u70b9\u5b95\u673a\u540e\u4ecd\u7136\u80fd\u591f\u63d0\u4f9b\u6301\u4e45\u5b58\u50a8\u7ed9\u5176\u4ed6 POD\u3002</p> <ul> <li>\u5728 k8s \u7684 node \u627e\u4e00\u4e2a\u4e3b\u673a\uff0c\u5b89\u88c5\u914d\u7f6e nfs \u670d\u52a1\u5668\u5e76\u542f\u52a8</li> </ul> <pre><code>$ yum install nfs-utils                                                     # \u5b89\u88c5 nfs \u670d\u52a1\n$ mkdir -p /data/volumes                                                    # \u521b\u5efa volume \u5377\u76ee\u5f55\necho '/data/volumes  172.16.100.0/16(rw,no_root_squash)' &gt;&gt; /etc/exports    # \u914d\u7f6e nfs \u670d\u52a1\u5668\n$ systemctl start nfs                                                       # \u542f\u52a8 nfs \u670d\u52a1\u5668\n$ ss -tnl                                                                   # \u786e\u8ba4\u76d1\u542c\u7aef\u53e3\uff0cnfs \u76d1\u542c TCP 2049 \u7aef\u53e3\n</code></pre> <ul> <li>\u5728 k8s \u96c6\u7fa4\u7684 node \u8282\u70b9\u5b89\u88c5 nfs \u9a71\u52a8\uff0c\u6d4b\u8bd5\u6302\u8f7d\u662f\u5426\u6b63\u5e38</li> </ul> <pre><code>$ yum install nfs-utils\n$ mount -t nfs 172.16.100.104:/data/volumes /mnt\n</code></pre> <ul> <li>\u5b9a\u4e49 nfs \u53c2\u6570\uff0ckubectl explain pods.spec.volumes.nfs</li> </ul> <pre><code>path      &lt;string&gt;       # nfs \u670d\u52a1\u5668\u7684\u8def\u5f84\nreadOnly  &lt;boolean&gt;      # \u662f\u5426\u53ea\u8bfb\nserver    &lt;string&gt;       # nfs \u670d\u52a1\u5668\u5730\u5740\n</code></pre> <ul> <li>\u4f7f\u7528\u793a\u4f8b</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-vol-nfs-demo\n  namespace: default\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n    volumeMounts:\n      - name: html\n        mountPath: /usr/share/nginx/html/\n  volumes:\n    - name: html\n      nfs:\n        path: /data/volumes\n        server: 172.16.100.104\n</code></pre> <p>\u6ce8\u610f\u26a0\ufe0f\uff1a\u5404\u4e2anode\u8282\u70b9\u4e5f\u9700\u8981\u5b89\u88c5<code>yum install nfs-utils</code>,\u4e0d\u8ba9\u5728\u6302\u8f7d\u7684\u65f6\u5019\u4f1a\u51fa\u73b0\u5f02\u5e38\u3002</p>"},{"location":"k8s/note/chapter-10/#105","title":"10.5 \u5206\u5e03\u5f0f\u5b58\u50a8","text":"<p>\u5206\u5e03\u5f0f\u5b58\u50a8\u80fd\u63d0\u4f9b\u8131\u79bb\u8282\u70b9\u751f\u547d\u5468\u671f\u7684\u5b58\u50a8\uff0c\u53c8\u6bd4\u7f51\u7edc\u5b58\u50a8\u66f4\u52a0\u5065\u58ee\uff0c\u5b83\u662f\u5206\u5e03\u5f0f\u7684\uff0c\u6709\u5f88\u5f3a\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u4f46\u662f\u5206\u5e03\u5f0f\u5b58\u50a8\u914d\u7f6e\u590d\u6742\uff0c\u5728\u7531 NFS \u63d0\u4f9b\u7684\u7f51\u7edc\u50a8\u5b58\u4e2d\uff0c\u7528\u6237\u9700\u8981\u77e5\u9053\u5206\u914d\u7ed9 POD \u7684 NFS \u5b58\u50a8\u7684\u5730\u5740\u624d\u80fd\u4f7f\u7528\uff0c\u800c\u5728\u7531\u5206\u5e03\u5f0f\u63d0\u4f9b\u7684\u5b58\u50a8\u80fd\u529b\u7684\u5b58\u50a8\u4e0a\uff0c\u7528\u6237\u9700\u8981\u5145\u5206\u4e86\u89e3\u8be5\u5206\u5e03\u5f0f\u5b58\u50a8\u7684\u914d\u7f6e\u53c2\u6570\uff0c\u624d\u80fd\u591f\u4f7f\u7528\u8fd9\u4e2a\u5206\u5e03\u5f0f\u5b58\u50a8\u3002</p> <p>\u7531\u6b64 K8S \u63d0\u4f9b\u4e86 PV\u3001PVC \u4e24\u79cd\u673a\u5236\uff0c\u8ba9\u666e\u901a\u7528\u6237\u65e0\u9700\u5173\u5fc3\u5e95\u5c42\u5b58\u50a8\u53c2\u6570\u7684\u914d\u7f6e\uff0c\u53ea\u9700\u8981\u8bf4\u660e\u9700\u8981\u4f7f\u7528\u591a\u5927\u7684\u6301\u4e45\u5b58\u50a8\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002 </p> <p>\u4e00\u822c PV \u4e0e PVC \u662f\u4e00\u5bf9\u7ed1\u5b9a\u7684\uff0cPV\u5c5e\u4e8e\u5168\u5c40\uff0cPVC \u5c5e\u4e8e\u67d0\u4e2a\u540d\u79f0\u7a7a\u95f4\uff0c\u5f53\u4e00\u4e2a PV \u88ab\u4e00\u4e2a PVC \u7ed1\u5b9a\uff0c\u522b\u7684\u540d\u79f0\u7a7a\u95f4 PVC \u5c31\u4e0d\u53ef\u4ee5\u518d\u7ed1\u5b9a\u4e86\u3002\u8bf7\u6c42\u7ed1\u5b9a\u67d0\u4e2a PV \u5c31\u662f\u7531 PVC \u6765\u5b8c\u6210\u7684\uff0c\u88ab PVC \u7ed1\u5b9a\u7684 PV \u79f0\u4f5c PV \u7684\u7ed1\u5b9a\u72b6\u6001\u3002</p> <p>PVC \u7ed1\u5b9a\u4e86\u4e00\u4e2a PV\uff0c\u90a3\u4e48 PVC \u6240\u5904\u540d\u79f0\u7a7a\u95f4\u5b9a\u4e49\u7684 POD \u5c31\u53ef\u4ee5\u4f7f\u7528 persistentVolumeClaim \u7c7b\u578b\u7684 volumes \u4e86\uff0c\u7136\u540e\u5bb9\u5668\u5c31\u53ef\u4ee5\u901a\u8fc7 volumeMounts \u6302\u8f7d PVC \u7c7b\u578b\u7684\u5377\u4e86\u3002</p> <p>persistentVolumeClaim \u5377\u662f\u5426\u5141\u8bb8\u591a\u8def\u8bfb\u5199\uff0c\u8fd9\u53d6\u51b3\u4e8e PV \u5b9a\u4e49\u65f6\u5019\u7684\u8bfb\u5199\u7279\u6027\uff1a\u5355\u8def\u8bfb\u5199\u3001\u591a\u8def\u8bfb\u5199\u3001\u591a\u8def\u53ea\u8bfb\u3002</p> <p>\u5982\u679c\u67d0\u4e2a POD \u4e0d\u5728\u9700\u8981\u4e86\uff0c\u6211\u4eec\u628a\u5b83\u5220\u9664\u4e86\u3001\u540c\u65f6\u4e5f\u5220\u9664\u4e86 PVC\u3001\u90a3\u4e48\u6b64\u65f6 PV \u8fd8\u53ef\u4ee5\u6709\u81ea\u5df1\u7684\u56de\u6536\u7b56\u7565\uff1a delete\u5220\u9664PV\u3001Retain\u4ec0\u4e48\u90fd\u4e0d\u505a\u3002</p>"},{"location":"k8s/note/chapter-10/#1051-persistentvolume","title":"10.5.1 PersistentVolume","text":"<p>\u7531\u7ba1\u7406\u5458\u6dfb\u52a0\u7684\u7684\u4e00\u4e2a\u5b58\u50a8\u7684\u63cf\u8ff0\uff0c\u662f\u4e00\u4e2a\u96c6\u7fa4\u7ea7\u522b\u7684\u5168\u5c40\u8d44\u6e90\uff0c\u5305\u542b\u5b58\u50a8\u7684\u7c7b\u578b\uff0c\u5b58\u50a8\u7684\u5927\u5c0f\u548c\u8bbf\u95ee\u6a21\u5f0f\u7b49\u3002\u5b83\u7684\u751f\u547d\u5468\u671f\u72ec\u7acb\u4e8ePod\uff0c\u4f8b\u5982\u5f53\u4f7f\u7528\u5b83\u7684 Pod \u9500\u6bc1\u65f6\u5bf9 PV \u6ca1\u6709\u5f71\u54cd\u3002</p> <p>\u89c1\uff1akubectl explain PersistentVolume.spec</p> <ul> <li>\u5728 nfs \u4e0a\u5b9a\u4e49\u5b58\u50a8\uff0c/etc/exports\uff0c\u5e76\u4e14\u5bfc\u51fa nfs \u5b9a\u4e49</li> </ul> <pre><code>/data/volumes/v1    172.16.100.0/16(rw,no_root_squash)\n/data/volumes/v2    172.16.100.0/16(rw,no_root_squash)\n/data/volumes/v3    172.16.100.0/16(rw,no_root_squash)\n/data/volumes/v4    172.16.100.0/16(rw,no_root_squash)\n/data/volumes/v5    172.16.100.0/16(rw,no_root_squash)\n</code></pre> <pre><code>exportfs -arv\n</code></pre> <ul> <li>\u5c06 nfs \u5728 k8s \u4e2d\u5b9a\u4e49\u4e3a PersistentVolume\uff0c\u8be6\u89c1\uff1akubectl explain PersistentVolume.spec.nfs</li> </ul> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-001\n  labels:\n    name: pv001\nspec:\n  accessModes:\n    - ReadWriteMany\n    - ReadWriteOnce\n  capacity:\n    storage: 1Gi\n  nfs:\n    path: /data/volumes/v1\n    server: 172.16.100.104\n\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-002\n  labels:\n    name: pv003\nspec:\n  accessModes:\n    - ReadWriteMany\n    - ReadWriteOnce\n  capacity:\n    storage: 2Gi\n  nfs:\n    path: /data/volumes/v2\n    server: 172.16.100.104\n\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-003\n  labels:\n    name: pv003\nspec:\n  accessModes:\n    - ReadWriteMany\n    - ReadWriteOnce\n  capacity:\n    storage: 3Gi\n  nfs:\n    path: /data/volumes/v3\n    server: 172.16.100.104\n</code></pre> <pre><code>kubectl get persistentvolume\nNAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE\npv-001   1Gi        RWO,RWX        Retain           Available                                   3m38s\npv-002   2Gi        RWO,RWX        Retain           Available                                   3m38s\npv-003   3Gi        RWO,RWX        Retain           Available                                   3m38s\n</code></pre>"},{"location":"k8s/note/chapter-10/#1052-persistentvolumeclaim","title":"10.5.2. PersistentVolumeClaim","text":"<p>\u662f Namespace \u7ea7\u522b\u7684\u8d44\u6e90\uff0c\u63cf\u8ff0\u5bf9 PV \u7684\u4e00\u4e2a\u8bf7\u6c42\u3002\u8bf7\u6c42\u4fe1\u606f\u5305\u542b\u5b58\u50a8\u5927\u5c0f\uff0c\u8bbf\u95ee\u6a21\u5f0f\u7b49\u3002</p> <ul> <li>\u5b9a\u4e49 PVC\uff0ckubectl explain PersistentVolumeClaim.spec</li> </ul> <pre><code>accessModes         &lt;[]string&gt;  # \u8bbe\u7f6e\u8bbf\u95ee\u6a21\u5f0f\n    ReadWriteOnce               # \u5355\u4e2a\u8282\u70b9\u4ee5\u8bfb\u5199\u65b9\u5f0f\u6302\u8f7d\n    ReadOnlyMany                # - \u591a\u8282\u70b9\u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6302\u8f7d\n    ReadWriteMany               # - \u591a\u8282\u70b9\u4ee5\u8bfb\u5199\u65b9\u5f0f\u6302\u8f7d\n\ndataSource          &lt;Object&gt;    # \u5982\u679c\u914d\u7f6e\u7a0b\u5e8f\u53ef\u4ee5\u652f\u6301 Volume Snapshot \u6570\u636e\u6e90\uff0c\u5b83\u5c06\u521b\u5efa\u4e00\u4e2a\u65b0\u5377\uff0c\u5e76\u4e14\u6570\u636e\u5c06\u540c\u65f6\u8fd8\u539f\u5230\u8be5\u5377\u3002 \nresources           &lt;Object&gt;    # \u8d44\u6e90\u8868\u793a PersistentVolume \u5e94\u5177\u6709\u7684\u6700\u5c0f\u8d44\u6e90\nselector            &lt;Object&gt;    # \u9009\u62e9\u54ea\u4e2a PersistentVolume\nstorageClassName    &lt;string&gt;    # \u5b58\u50a8\u7c7b\u540d\u79f0\nvolumeMode          &lt;string&gt;    # \u5b9a\u4e49\u58f0\u660e\u6240\u9700\u7684 PersistentVolume \u7c7b\u578b\u624d\u80fd\u88ab\u9009\u4e2d\nvolumeName          &lt;string&gt;    # \u540e\u7aef PersistentVolume \uff0c\u5c31\u662f\u7cbe\u786e\u9009\u62e9 PersistentVolume \uff0c\u800c\u4e0d\u662f\u4f7f\u7528 selector \u6765\u9009\u5b9a\n</code></pre> <ul> <li>\u5728 volumes \u4e2d\u4f7f\u7528 PVC\uff0ckubectl explain pods.spec.volumes.persistentVolumeClaim</li> </ul> <pre><code>persistentVolumeClaim\n    claimName    &lt;string&gt;  # \u5728\u5f53\u524d\u540d\u79f0\u7a7a\u95f4\u5df2\u7ecf\u521b\u5efa\u53f7\u7684 PVC \u540d\u79f0\n    readOnly     &lt;boolean&gt; # \u662f\u5426\u53ea\u8bfb\n</code></pre> <ul> <li>\u5b9a\u4e49 PersistentVolumeClaim\uff0c\u8be6\u89c1\uff1akubectl explain PersistentVolumeClaim.spec</li> </ul> <pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: my-pvc\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteMany        # \u8bbf\u95ee\u6a21\u5f0f\n  resources:               # \u8d44\u6e90\u6761\u4ef6\n    requests:              # \u6311\u9009 PV \u65f6\u5019\u5fc5\u987b\u6ee1\u8db3\u7684\u6761\u4ef6\uff0c\u4e0d\u6ee1\u8db3\u5219\u4e00\u76f4\u7b49\u5f85\n      storage: 2Gi         # \u5b58\u50a8\u5927\u5c0f\n</code></pre> <ul> <li>\u5728 pod \u6e05\u5355\u4e2d\u5b9a\u4e49 persistentVolumeClaim \u7c7b\u578b\u7684 volumes \uff0c\u5e76\u5728\u5bb9\u5668\u4e2d\u6302\u8f7d volumeMounts\u3002</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-vol-nfs-demo\n  namespace: default\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n    volumeMounts:\n      - name: html\n        mountPath: /usr/share/nginx/html/\n  volumes:\n    - name: html\n      persistentVolumeClaim:\n        claimName: my-pvc            # \u4f7f\u7528\u7684 PVC \u7684\u540d\u79f0\n</code></pre>"},{"location":"k8s/note/chapter-10/#1053-storageclass","title":"10.5.3 StorageClass","text":"<p>PVC \u7533\u8bf7 PV \u7684\u65f6\u5019\uff0c\u672a\u5fc5\u6709\u7b26\u5408\u6761\u4ef6\u7684 PV\uff0ck8s \u4e3a\u6211\u4eec\u51c6\u5907\u4e86 StorageClass \u53ef\u4ee5\u5728 PVC \u7533\u8bf7 PV \u7684\u65f6\u5019\u901a\u8fc7 StorageClass \u52a8\u6001\u751f\u6210 PV\u3002</p> <p>StorageClass \u53ef\u4ee5\u52a8\u6001\u7684\u5230 CephFS \u3001NFS \u7b49\u5b58\u50a8\uff08\u6216\u8005\u4e91\u7aef\u5b58\u50a8\uff09\u4ea7\u751f\u4e00\u4e2a PV\uff0c\u8981\u6c42\u5b58\u50a8\u8bbe\u5907\u5fc5\u987b\u652f\u6301 RESTfull \u98ce\u683c\u7684\u63a5\u53e3\u3002</p>"},{"location":"k8s/note/chapter-10/#106-storageclass-ceph-rbd","title":"10.6 StorageClass Ceph RBD","text":""},{"location":"k8s/note/chapter-10/#1061-ceph","title":"10.6.1 \u914d\u7f6e Ceph \u50a8\u5b58\u6c60","text":"<ul> <li>\u521b\u5efa ceph \u5b58\u50a8\u6c60</li> </ul> <pre><code>yum install -y ceph-common                                                                   # \u5728\u6240\u6709\u8282\u70b9\u5b89\u88c5 ceph-common\n</code></pre> <pre><code>ceph osd pool create kube 4096                                                               # \u521b\u5efa pool\nceph osd pool ls                                                                             # \u67e5\u770b pool\n\nceph auth get-or-create client.kube mon 'allow r' osd 'allow rwx pool=kube' -o /etc/ceph/ceph.client.kube.keyring\nceph auth list                                                                               # \u6388\u6743 client.kube \u7528\u6237\u8bbf\u95ee kube \u8fd9\u4e2a pool\n\nscp /etc/ceph/ceph.client.kube.keyring node1:/etc/ceph/                                      # \u5c06\u7528\u6237 keyring \u6587\u4ef6\u62f7\u8d1d\u5230\u5404\u4e2a ceph \u8282\u70b9\nscp /etc/ceph/ceph.client.kube.keyring node1:/etc/ceph/\n</code></pre>"},{"location":"k8s/note/chapter-10/#1062-rbd-provisioner","title":"10.6.2 \u5b89\u88c5 rbd-provisioner","text":"<ul> <li>1.12 \u7248\u672c\u540e kube-controller-manager \u4e0d\u518d\u5185\u7f6e rbd \u547d\u4ee4\uff0c\u6240\u4ee5 StorageClass \u7684 provisioner \u800c\u662f\u901a\u8fc7\u5916\u90e8\u7684\u63d2\u4ef6\u6765\u5b9e\u73b0</li> </ul> <pre><code>https://github.com/kubernetes-incubator/external-storage/tree/master/ceph/rbd/deploy/rbac    # rbd-provisioner\n</code></pre> <pre><code>$ git clone https://github.com/kubernetes-incubator/external-storage.git                     # \u4e0b\u8f7d rbd-provisioner\n$ cat &gt;&gt;external-storage/ceph/rbd/deploy/rbac/clusterrole.yaml&lt;&lt;EOF                          # \u5141\u8bb8 rbd-provisioner \u8bbf\u95ee ceph \u7684\u5bc6\u94a5\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"create\", \"get\", \"list\", \"watch\"]\nEOF\n$ kubectl apply -f external-storage/ceph/rbd/deploy/rbac/                                    # \u5b89\u88c5 rbd-provisioner\n</code></pre>"},{"location":"k8s/note/chapter-10/#1063-storageclass","title":"10.6.3 \u4f7f\u7528 StorageClass","text":"<ul> <li>\u521b\u5efa CephX \u9a8c\u8bc1 secret</li> </ul> <pre><code>https://github.com/kubernetes-incubator/external-storage/tree/master/ceph/rbd/examples       # rbd-provisioner \u4f7f\u7528 ceph rbd \u7684\u793a\u4f8b\n</code></pre> <pre><code>---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ceph-admin-secret\n  namespace: kube-system\ntype: \"kubernetes.io/rbd\"\ndata:\n  # ceph auth get-key client.admin | base64                                                  # \u4ece\u8fd9\u4e2a\u547d\u4ee4\u4e2d\u53d6\u5f97 keyring \u8ba4\u8bc1\u7684 base64 \u5bc6\u94a5\u4e32\u590d\u5236\u5230\u4e0b\u9762\n  key: QVFER3U5TmM1NXQ4SlJBQXhHMGltdXZlNFZkUXRvN2tTZ1BENGc9PQ==\n\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ceph-secret\n  namespace: kube-system\ntype: \"kubernetes.io/rbd\"\ndata:\n  # ceph auth get-key client.kube | base64                                                  # \u4ece\u8fd9\u4e2a\u547d\u4ee4\u4e2d\u53d6\u5f97 keyring \u8ba4\u8bc1\u7684 base64 \u5bc6\u94a5\u4e32\u590d\u5236\u5230\u4e0b\u9762\n  key: QVFCcUM5VmNWVDdQRlJBQWR1NUxFNzVKeThiazdUWVhOa3N2UWc9PQ==\n</code></pre> <ul> <li>\u521b\u5efa StorageClass \u6307\u5411 rbd-provisioner\uff0c</li> </ul> <pre><code>---\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: ceph-rbd\nprovisioner: ceph.com/rbd\nreclaimPolicy: Retain\nparameters:\n  monitors: 172.16.100.9:6789\n  pool: kube\n  adminId: admin\n  adminSecretName: ceph-admin-secret\n  adminSecretNamespace: kube-system\n  userId: kube\n  userSecretName: ceph-secret\n  userSecretNamespace: kube-system\n  fsType: ext4\n  imageFormat: \"2\"\n  imageFeatures: \"layering\"\n</code></pre> <ul> <li>\u521b\u5efa PersistentVolumeClaim</li> </ul> <pre><code>---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: ceph-rbd-pvc  data-kong-postgresql-0 \nspec:\n  storageClassName: ceph-rbd\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi\n</code></pre> <ul> <li>\u5728 POD \u4e2d\u4f7f\u7528 PVC\uff0c\u6700\u540e\u5728\u5bb9\u5668\u4e2d\u6302\u8f7d PVC\u3002</li> </ul> <pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: ceph-sc-pvc-demo\n  namespace: default\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n    volumeMounts:\n      - name: pvc-volume\n        mountPath: /usr/share/nginx/html/\n  volumes:\n    - name: pvc-volume\n      persistentVolumeClaim:\n        claimName: ceph-rbd-pvc\n</code></pre>"},{"location":"k8s/note/chapter-11/","title":"\u5341\u4e00 \u914d\u7f6e\u4fe1\u606f\u5bb9\u5668\u5316","text":"<p>k8s \u63d0\u4f9b\u4e86 configMap\u3001secret \u8fd9\u4e24\u79cd\u7279\u6b8a\u7c7b\u578b\u7684\u5b58\u50a8\u5377\uff0c\u591a\u6570\u60c5\u51b5\u4e0b\u4e0d\u662f\u4e3a POD \u63d0\u4f9b\u5b58\u50a8\u7a7a\u95f4\uff0c\u800c\u662f\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u4ece\u96c6\u7fa4\u5916\u90e8\u5230 POD \u5185\u90e8\u6ce8\u5165\u914d\u7f6e\u4fe1\u606f\u7684\u65b9\u5f0f\u3002</p> <ul> <li> <p>\u914d\u7f6e\u4fe1\u606f\u5bb9\u5668\u5316\u6709\u54ea\u4e9b\u65b9\u5f0f</p> </li> <li> <p>\u81ea\u5b9a\u4e49\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u4f8b\u5982\uff1acommand\u3001args\uff0c\u6839\u636e args \u4f20\u9012\u4e0d\u540c\u7684\u53c2\u6570\u6765\u5c06\u5bb9\u5668\u8fd0\u884c\u4e3a\u4e0d\u540c\u7684\u7279\u6027</p> </li> <li>\u76f4\u63a5\u628a\u914d\u7f6e\u4fe1\u606f\u5236\u4f5c\u4e3a image \u4e2d\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u975e\u5e38\u4e0d\u7075\u6d3b\uff0c\u8fd9\u4e2a\u955c\u50cf\u53ea\u80fd\u9002\u7528\u4e8e\u4e00\u79cd\u4f7f\u7528\u573a\u666f\uff0c\u8fc7\u5ea6\u8026\u5408</li> <li>\u73af\u5883\u53d8\u91cf\uff0cCloud Native \u652f\u6301\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6765\u52a0\u8f7d\u914d\u7f6e\uff0c\u6216\u8005\u4f7f\u7528 ENTRYPOINT \u811a\u672c\u6765\u9884\u5904\u7406\u73af\u5883\u53d8\u91cf\u4e3a\u914d\u7f6e\u4fe1\u606f</li> <li> <p>\u5b58\u50a8\u5377\uff0c\u5728\u5bb9\u5668\u542f\u52a8\u65f6\u5019\u6302\u8f7d\u4e00\u4e2a\u5b58\u50a8\u5377\uff0c\u6216\u8005\u4e13\u7528\u7684\u914d\u7f6e\u5b58\u50a8\u5377\uff0c\u6302\u8f7d\u5230\u5e94\u7528\u7a0b\u5e8f\u7684\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55</p> </li> <li> <p>Secret\u4e0eConfigMap\u5bf9\u6bd4</p> </li> </ul> <pre><code>\u76f8\u540c\u70b9\uff1a\n-   key / value \u7684\u5f62\u5f0f \n-   \u5c5e\u4e8e\u67d0\u4e2a\u7279\u5b9a\u7684 namespace \n-   \u53ef\u4ee5\u5bfc\u51fa\u5230\u73af\u5883\u53d8\u91cf \n-   \u53ef\u4ee5\u901a\u8fc7\u76ee\u5f55/\u6587\u4ef6\u5f62\u5f0f\u6302\u8f7d(\u652f\u6301\u6302\u8f7d\u6240\u6709key\u548c\u90e8\u5206key)\n\n\u4e0d\u540c\u70b9\uff1a\n-   Secret \u53ef\u4ee5\u88ab ServerAccount \u5173\u8054(\u4f7f\u7528) \n-   Secret \u53ef\u4ee5\u5b58\u50a8 register \u7684\u9274\u6743\u4fe1\u606f\uff0c\u7528\u5728 ImagePullSecret \u53c2\u6570\u4e2d\uff0c\u7528\u4e8e\u62c9\u53d6\u79c1\u6709\u4ed3\u5e93\u7684\u955c\u50cf \n-   Secret \u652f\u6301 Base64 \u52a0\u5bc6 \n-   Secret \u5206\u4e3a kubernetes.io/Service Account\uff0ckubernetes.io/dockerconfigjson\uff0cOpaque\u4e09\u79cd\u7c7b\u578b, Configmap \u4e0d\u533a\u5206\u7c7b\u578b \n-   Secret \u6587\u4ef6\u5b58\u50a8\u5728tmpfs\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0cPod \u5220\u9664\u540e Secret\u6587\u4ef6\u4e5f\u4f1a\u5bf9\u5e94\u7684\u5220\u9664\u3002\n</code></pre>"},{"location":"k8s/note/chapter-11/#111-pod","title":"11.1 POD \u83b7\u53d6\u73af\u5883\u53d8\u91cf","text":"<ul> <li>env\uff0c\u8be6\u89c1\uff1akubectl explain pods.spec.containers.env</li> </ul> <pre><code>name              &lt;string&gt;  # \u53d8\u91cf\u540d\u79f0\nvalue             &lt;string&gt;  # \u53d8\u91cf\u7684\u503c\nvalueFrom         &lt;Object&gt;  # \u5f15\u7528\u503c\uff0c\u5982\uff1aconfigMap \u7684\u67d0\u4e2a\u952e\u3001POD \u5b9a\u4e49\u4e2d\u7684\u5b57\u6bb5\u540d\uff0c\u5982\uff1ametadata.labels\nresourceFieldRef  &lt;Object&gt;  # \u5f15\u7528\u8d44\u6e90\u9650\u5236\u4e2d\u7684\u503c\nsecretKeyRef      &lt;Object&gt;  # \u5f15\u7528 secretKey\n</code></pre>"},{"location":"k8s/note/chapter-11/#112-configmap","title":"11.2 configMap","text":"<p>\u5047\u5982\u6211\u4eec\u73b0\u5728\u8981\u542f\u52a8\u4e00\u4e2a POD \uff0c\u8fd9\u4e2a POD \u542f\u52a8\u65f6\u5019\uff0c\u9700\u8981\u8bfb\u53d6\u4e0d\u540c\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u90a3\u4e48\u6211\u4eec\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ol> <li>\u53ef\u4ee5\u5c06 configMap \u8d44\u6e90\u5173\u8054\u5230\u5f53\u524d POD \u4e0a\uff0cPOD \u4ece configMap \u8bfb\u53d6\u4e00\u4e2a\u6570\u636e\uff0c\u4f20\u9012\u7ed9 POD \u5185\u90e8\u5bb9\u5668\u7684\u4e00\u4e2a\u53d8\u91cf\uff0c\u53d8\u91cf\u88ab\u6ce8\u5165\u540e\uff0c\u53ef\u4ee5\u91cd\u542f\u5bb9\u5668\u3002</li> <li>\u53ef\u4ee5\u5c06 configMap \u8d44\u6e90\u6302\u8f7d\u5230\u5f53\u524d POD \u4e0a\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u8def\u5f84\uff0c\u8fd9\u4e2a\u76ee\u5f55\u6b63\u597d\u662f\u5e94\u7528\u7a0b\u5e8f\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u5bb9\u5668\u5c31\u53ef\u4ee5\u8bfb\u53d6\u5230\u914d\u7f6e\u4fe1\u606f\u4e86\uff0c\u5f53 configMap \u4fee\u6539\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u901a\u77e5 POD \uff0cPOD \u53ef\u4ee5\u8fdb\u884c\u91cd\u8f7d\u914d\u7f6e\u3002</li> </ol> <p>\u5728\u6bcf\u4e2a configMap \u4e2d\u6240\u6709\u7684\u914d\u7f6e\u4fe1\u606f\u90fd\u4fdd\u5b58\u4e3a\u952e\u503c\u7684\u914d\u7f6e\u5f62\u5f0f\u3002</p> <ul> <li>\u6e05\u5355\u683c\u5f0f\uff0c\u8be6\u89c1\uff1akubectl explain configMap</li> </ul> <pre><code>apiVersion  &lt;string&gt;              # \u7248\u672c\u53f7\nbinaryData  &lt;map[string]string&gt;   # \u4e8c\u8fdb\u5236\u7684\u6570\u636e\ndata        &lt;map[string]string&gt;   # \u952e\u503c\u5bf9\u7684\u6570\u636e\nkind        &lt;string&gt;              # \u5bf9\u8c61\u7c7b\u578b\nmetadata    &lt;Object&gt;              # \u5bf9\u8c61\u5143\u6570\u636e\n</code></pre> <ul> <li>\u547d\u4ee4\u884c\u65b9\u5f0f\u521b\u5efa</li> </ul> <pre><code># \u521b\u5efa\u540d\u4e3a my-config \u7684 configMap\uff0c\u5b83\u7684\u6570\u636e\u6765\u81ea\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\uff0c\u952e\u4e3a\u6587\u4ef6\u540d\uff0c\u503c\u4e3a\u6587\u4ef6\u5185\u5bb9\nkubectl create configmap my-config --from-file=path/to/dir\n\n# \u521b\u5efa\u540d\u4e3a my-config \u7684 configMap\uff0c\u5b83\u7684\u6570\u636e\u6765\u81ea\u6587\u4ef6\u4e2d\u7684\u952e\u503c\u5bf9\nkubectl create configmap my-config --from-file=path/to/file\n\n# \u521b\u5efa\u540d\u4e3a my-config \u7684 configMap\uff0c\u4e5f\u53ef\u4ee5\u624b\u52a8\u6307\u5b9a\u952e\u7684\u540d\u79f0\nkubectl create configmap my-config --from-file=key1=/path/to/bar/file1.txt --from-file=key2=/path/to/bar/file2.txt\n\n# \u4ece\u5b57\u9762\u91cf\u4e2d\u521b\u5efa\nkubectl create configmap my-config --from-literal=key1=config1 --from-literal=key2=config2\n\n# \u4eceenv\u6587\u4ef6\u4e2d\u547d\u540d my-config\nkubectl create configmap my-config --from-env-file=path/to/bar.env\n</code></pre>"},{"location":"k8s/note/chapter-11/#1121-pod-env","title":"11.2.1 \u6ce8\u5165 POD ENV","text":"<ul> <li>\u521b\u5efa ConfigMap \u5e76\u5728 POD ENV \u4e2d\u4f7f\u7528</li> </ul> <pre><code>apiVersion: v1\nkind: ConfigMap                                        # \u521b\u5efa ConfigMap \u5bf9\u8c61\nmetadata:\n  name: nginx-config\n  namespace: default\ndata:\n  server_name: myapp.kaliarch.com                       # \u952e\u503c\u5bf9\u6570\u636e\n  nginx_port: |                                        # \u952e\u503c\u5bf9\u6570\u636e\uff0c\u6b64\u5904\u4e3a nginx \u914d\u7f6e\u6587\u4ef6\uff0c\u9700\u8981\u6ce8\u610f\u6362\u884c\u7684\u5199\u6cd5\n    server {\n        server_name  myapp.kaliarch.com;\n        listen  80;\n        root  /data/web/html;\n    }\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-configmap-demo\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\n  annotations:\n    kaliarch.com/created-by: \"cluster amdin\"\nspec:\n  containers:\n    - name: myapp\n      image: ikubernetes/myapp:v1\n      ports:\n        - name: http\n          containerPort: 80\n      env:\n        - name: NGINX_SERVER_PORT          # \u5b9a\u4e49\u5bb9\u5668\u5185\u53d8\u91cf\u7684\u540d\u5b57\uff0c\u5bb9\u5668\u9700\u8981\u5728\u542f\u52a8\u7684\u65f6\u5019\u4f7f\u7528 ENTRYPOINT \u811a\u672c\u5c06\u73af\u5883\u53d8\u91cf\u8f6c\u6362\u4e3a\u5e94\u7528\u7684\u914d\u7f6e\u6587\u4ef6\n          valueFrom:                       # \u503c\u6765\u81ea\u4e8e configMap \u5bf9\u8c61\u4e2d\n            configMapKeyRef:               # \u5f15\u7528 configMap \u5bf9\u8c61\n              name: nginx-config           # configMap \u5bf9\u8c61\u7684\u540d\u5b57\n              key: nginx_port              # \u5f15\u7528 configMap \u4e2d\u7684\u54ea\u4e2a key\n              optional: true               # \u76f8\u5bf9 POD \u542f\u52a8\u662f\u5426\u4e3a\u53ef\u9009\uff0c\u5982\u679c configMap \u4e2d\u4e0d\u5b58\u5728\u8fd9\u4e2a\u503c\uff0ctrue \u5219\u4e0d\u963b\u585e POD \u542f\u52a8\n        - name: NGINX_SERVER_NAME          # \u5b9a\u4e49\u5bb9\u5668\u5185\u53d8\u91cf\u7684\u540d\u5b57\uff0c\u4f7f\u7528 exec \u8fdb\u5165\u5bb9\u5668\u4f1a\u53d1\u73b0\u53d8\u91cf\u5df2\u7ecf\u5728\u542f\u52a8\u5bb9\u5668\u524d\u6ce8\u5165\u5bb9\u5668\u5185\u90e8\u4e86\u3002\n          valueFrom:\n            configMapKeyRef:\n              name: nginx-config\n              key: server_name\n</code></pre>"},{"location":"k8s/note/chapter-11/#1122-pod","title":"11.2.2 \u6302\u8f7d\u4e3a POD \u5377","text":"<ul> <li>configMap \u4e2d\u7684\u6570\u636e\u53ef\u4ee5\u5728\u5bb9\u5668\u5185\u6302\u8f7d\u4e3a\u6587\u4ef6\uff0c\u5e76\u4e14\u5f53 configMap \u4e2d\u7684\u6570\u636e\u53d1\u751f\u53d8\u52a8\u7684\u65f6\u5019\uff0c\u5bb9\u5668\u5185\u7684\u6587\u4ef6\u76f8\u5e94\u4e5f\u4f1a\u53d1\u751f\u53d8\u52a8\uff0c\u4f46\u4e0d\u4f1a\u91cd\u8f7d\u5bb9\u5668\u5185\u7684\u8fdb\u7a0b\u3002</li> </ul> <pre><code>apiVersion: v1\nkind: ConfigMap                                     # \u521b\u5efa ConfigMap\nmetadata:\n  name: nginx-config-volumes\n  namespace: default\ndata:                                               # ConfigMap \u4e2d\u4fdd\u5b58\u4e86\u4e24\u4e2a\u6570\u636e\uff0c\n  index: |                                          # \u6570\u636e1\uff0c\u5b83\u53ef\u4ee5\u5728 container \u4e2d\u4f7f\u7528 ENV \u6ce8\u5165\u73af\u5883\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5728 container \u4e2d\u4f7f\u7528 volumeMounts \u6302\u8f7d\u6210\u4e3a\u6587\u4ef6\n    &lt;h1&gt;this is a test page&lt;h1&gt;\n  vhost: |                                          # \u6570\u636e2\uff0c\u5b83\u53ef\u4ee5\u5728 container \u4e2d\u4f7f\u7528 ENV \u6ce8\u5165\u73af\u5883\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5728 container \u4e2d\u4f7f\u7528 volumeMounts \u6302\u8f7d\u6210\u4e3a\u6587\u4ef6\n    server {                                                                                                                                  \n        listen       80;                                                                                                                      \n        server_name  localhost;                                                                                                               \n\n        location / {                                                                                                                          \n            root   /usr/share/nginx/html;                                                                                                     \n            index  index.html index.htm;                                                                                                      \n        }                                                                                                                                     \n\n        error_page   500 502 503 504  /50x.html;                                                                                              \n        location = /50x.html {                                                                                                                \n            root   /usr/share/nginx/html;                                                                                                     \n        }                                                                                                                                     \n\n        location = /hostname.html {                                                                                                           \n            alias /etc/hostname;                                                                                                              \n        }                                                                                                                                     \n    } \n    server {\n        server_name  myapp.kaliarch.com;\n        listen  80;\n        root  /data/web/html;\n    }\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-configmap-volumes-demo\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\n  annotations:\n    kaliarch.com/created-by: \"cluster amdin\"\nspec:\n  containers:\n    - name: myapp\n      image: ikubernetes/myapp:v1\n      ports:\n        - name: http\n          containerPort: 80\n      volumeMounts:\n        - name: nginx-conf\n          mountPath: /etc/nginx/conf.d\n          readOnly: true\n        - name: nginx-page\n          mountPath: /data/web/html/\n          readOnly: true\n  volumes:                                               # \u5b9a\u4e49\u5377\n    - name: nginx-conf                                   # \u5b9a\u4e49\u5377\u7684\u540d\u5b57\n      configMap:                                         # \u8be5\u5377\u7684\u7c7b\u578b\u4e3a configMap\n        name: nginx-config-volumes                       # \u4ece\u547d\u540d\u7a7a\u95f4\u4e2d\u8bfb\u53d6\u54ea\u4e2a\u540d\u5b57\u7684 configMap\n        items:                                           # \u5b9a\u4e49 configMap \u6570\u636e\u5230\u6587\u4ef6\u7684\u6620\u5c04\uff0c\u5982\u679c\u4e0d\u5b9a\u4e49\u5219\u4f7f\u7528 configMap \u4e2d\u7684\u952e\u4e3a\u6587\u4ef6\u540d\u79f0\uff0c\u503c\u4e3a\u6587\u4ef6\u5185\u5bb9\n          - key: vhost                                   # \u4f7f\u7528 configMap \u54ea\u4e2a\u952e\n            path: www.conf                               # \u5c06 configMap \u4e2d\u7684\u6570\u636e\uff0c\u6620\u5c04\u4e3a\u5bb9\u5668\u5185\u54ea\u4e2a\u6587\u4ef6\u540d\u79f0\n            mode: 644                                    # \u6307\u660e\u6587\u4ef6\u7684\u6743\u9650\n    - name: nginx-page\n      configMap:\n        name: nginx-config-volumes\n        items:\n          - key: index\n            path: index.html\n            mode: 644\n</code></pre> <ul> <li>\u542f\u52a8\u540e\u8fdb\u5165\u5bb9\u5668\u67e5\u770b\u6587\u4ef6\u662f\u5426\u6b63\u5e38\u6302\u8f7d</li> </ul> <pre><code>kubectl exec -it pod-configmap-volumes-demo -c myapp -- /bin/sh\n</code></pre> <ul> <li>\u4f7f\u7528 curl \u547d\u4ee4\u9a8c\u8bc1\uff0c\u662f\u5426\u80fd\u591f\u6b63\u5e38\u4f7f\u7528</li> </ul> <pre><code>$ curl 10.244.2.104\nHello MyApp | Version: v1 | &lt;a href=\"hostname.html\"&gt;Pod Name&lt;/a&gt;\n\n$ curl -H \"Host:myapp.kaliarch.com\" 10.244.2.104\n&lt;h1&gt;this is a test page&lt;h1&gt;\n</code></pre>"},{"location":"k8s/note/chapter-11/#113-secret","title":"11.3 secret","text":"<p>configMap \u662f\u660e\u6587\u5b58\u50a8\u6570\u636e\u7684\uff0c\u5982\u679c\u9700\u8981\u5b58\u50a8\u654f\u611f\u6570\u636e\uff0c\u5219\u9700\u8981\u4f7f\u7528 secret \uff0csecret \u4e0e configMap \u7684\u4f5c\u7528\u57fa\u672c\u4e00\u81f4\uff0c\u4e14 secret \u4e2d\u7684\u6570\u636e\u4e0d\u662f\u660e\u6587\u5b58\u653e\u7684\uff0c\u800c\u662f base64 \u7f16\u7801\u4fdd\u5b58\u7684\u3002</p> <ul> <li>secret \u7c7b\u578b</li> </ul> <pre><code>docker-registry    # \u521b\u5efa\u4e00\u4e2a Docker registry \u4f7f\u7528\u7684 secret\ngeneric            # \u4ece\u672c\u5730\u6587\u4ef6\uff0c\u76ee\u5f55\u6216\u5b57\u9762\u503c\u521b\u5efa\u4e00\u4e2a secret\ntls                # \u521b\u5efa\u4e00\u4e2a TLS  secret\n</code></pre> <ul> <li>\u6e05\u5355\u683c\u5f0f\uff0c\u8be6\u89c1\uff1akubectl explain secret</li> </ul> <pre><code>apiVersion  &lt;string&gt;               # API \u7248\u672c\ndata        &lt;map[string]string&gt;    # \u4ee5\u952e\u503c\u5bf9\u5217\u51fa\u6570\u636e\uff0c\u503c\u9700\u8981\u7ecf\u8fc7 base64 \u52a0\u5bc6\nkind        &lt;string&gt;               # \u5bf9\u8c61\u7c7b\u578b\nmetadata    &lt;Object&gt;               # \u5143\u6570\u636e\nstringData  &lt;map[string]string&gt;    # \u660e\u6587\u7684\u6570\u636e\ntype        &lt;string&gt;               # \u6570\u636e\u7c7b\u578b\n</code></pre>"},{"location":"k8s/note/chapter-11/#1131-1","title":"11.3.1 \u79c1\u6709\u4ed3\u5e93\u8ba4\u8bc11","text":"<ul> <li>\u9996\u5148\u901a\u8fc7\u547d\u4ee4\u884c\u521b\u5efa\u51fa\u6765 secret</li> </ul> <pre><code>kubectl create secret docker-registry regsecret --docker-server=registry-vpc.cn-hangzhou.aliyuncs.com --docker-username=admin --docker-password=123456 --docker-email=420123641@qq.com\n</code></pre> <ul> <li>\u5982\u679c\u60f3\u4fdd\u5b58\u4e3a\u6587\u4ef6\u53ef\u4ee5</li> </ul> <pre><code>kubectl get secret regsecret -o yaml\n</code></pre> <ul> <li>POD \u521b\u5efa\u65f6\u5019\uff0c\u4ece docker hub \u62c9\u53d6\u955c\u50cf\u4f7f\u7528\u7684\u7528\u6237\u540d\u5bc6\u7801\uff0ckubectl explain pods.spec \u7684 imagePullSecrets \u5b57\u6bb5</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: secret-file-pod\nspec:\n  containers:\n  - name: mypod\n    image: redis\n  imagePullSecrets:                         # \u83b7\u53d6\u955c\u50cf\u9700\u8981\u7684\u7528\u6237\u540d\u5bc6\u7801\n   - name: regsecret                        # secret \u5bf9\u8c61\n</code></pre>"},{"location":"k8s/note/chapter-11/#1132-2","title":"11.3.2 \u79c1\u6709\u4ed3\u5e93\u8ba4\u8bc12","text":"<ul> <li>\u9996\u5148\u901a\u8fc7\u547d\u4ee4\u884c\u521b\u5efa\u51fa\u6765 secret</li> </ul> <pre><code>kubectl create secret docker-registry regsecret --docker-server=registry-vpc.cn-hangzhou.aliyuncs.com --docker-username=admin --docker-password=123456 --docker-email=420123641@qq.com\n</code></pre> <ul> <li>\u521b\u5efa\u81ea\u5b9a\u4e49\u7684 serviceaccount \u5bf9\u8c61\uff0c\u5728 serviceaccount \u5bf9\u8c61\u4e0a\u5b9a\u4e49 image pull secrets</li> </ul> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin\n  namespace: default\nimagePullSecrets:\n- name: regsecret                       # \u6307\u5b9a secret\n</code></pre> <ul> <li>\u521b\u5efa POD \u4f7f\u7528\u6307\u5b9a\u7684 serviceaccount \u5bf9\u8c61</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-serviceaccount-demo\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n    - name: nginx\n      image: ikubernetes/myapp:v1\n      ports:\n        - name: http\n          containerPort: 80\n  serviceAccountName: admin                          # \u4f7f\u7528 serviceaccount \u8fdb\u884c\u62c9\u53d6\u955c\u50cf\u7684\u8ba4\u8bc1\uff0c\u8fd9\u6837\u66f4\u52a0\u5b89\u5168\n</code></pre>"},{"location":"k8s/note/chapter-11/#1133-tls","title":"11.3.3 \u521b\u5efa TLS \u8bc1\u4e66","text":"<ul> <li>\u9996\u5148\u901a\u8fc7\u547d\u4ee4\u884c\u521b\u5efa\u51fa\u6765</li> </ul> <pre><code>kubectl create secret tls nginx-secret --cert=tls.crt --key=tls.key\n</code></pre> <ul> <li>secret \u4e2d\u7684\u6570\u636e\u53ef\u4ee5\u5728\u5bb9\u5668\u5185\u6302\u8f7d\u4e3a\u6587\u4ef6\uff0c\u7136\u540e\u5728 nginx \u5bb9\u5668\u5185\u4f7f\u7528\u8bc1\u4e66\u6587\u4ef6</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-configmap-volumes-demo\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\n  annotations:\n    kaliarch.com/created-by: \"cluster amdin\"\nspec:\n  containers:\n    - name: myapp\n      image: ikubernetes/myapp:v1\n      ports:\n        - name: http\n          containerPort: 80\n      volumeMounts:\n        - name: nginx-conf\n          mountPath: /etc/nginx/secret\n          readOnly: true\n  volumes:                                               # \u5b9a\u4e49\u5377\n    - name: nginx-conf                                   # \u5b9a\u4e49\u5377\u7684\u540d\u5b57\n      configMap:                                         # \u8be5\u5377\u7684\u7c7b\u578b\u4e3a secret\n        name: nginx-secret                               # \u4ece\u547d\u540d\u7a7a\u95f4\u4e2d\u8bfb\u53d6\u54ea\u4e2a\u540d\u5b57\u7684 secret\n        items:                                           # \u5b9a\u4e49 secret \u6570\u636e\u5230\u6587\u4ef6\u7684\u6620\u5c04\uff0c\u5982\u679c\u4e0d\u5b9a\u4e49\u5219\u4f7f\u7528 secret \u4e2d\u7684\u952e\u4e3a\u6587\u4ef6\u540d\u79f0\uff0c\u503c\u4e3a\u6587\u4ef6\u5185\u5bb9\n          - key: tls.key                                 # \u4f7f\u7528 secret \u54ea\u4e2a\u952e\n            path: www.conf                               # \u5c06 secret \u4e2d\u7684\u6570\u636e\uff0c\u6620\u5c04\u4e3a\u5bb9\u5668\u5185\u54ea\u4e2a\u6587\u4ef6\u540d\u79f0\n            mode: 644                                    # \u6307\u660e\u6587\u4ef6\u7684\u6743\u9650\n          - key: tls.crt\n            path: index.html\n            mode: 644\n</code></pre>"},{"location":"k8s/note/chapter-12/","title":"\u5341\u4e8c StatefulSet \u63a7\u5236\u5668","text":"<p>StatefulSet \u9002\u7528\u4e8e\u6709\u72b6\u6001\u7684\u5e94\u7528\uff0c\u4e00\u822c\u5b83\u7ba1\u7406\u7684\u5177\u6709\u4e00\u4e0b\u7279\u70b9\u7684 POD \u8d44\u6e90</p> <ol> <li>\u7a33\u5b9a\u4e14\u552f\u4e00\u7684\u7f51\u7edc\u6807\u8bc6\u7b26</li> <li>\u7a33\u5b9a\u4e14\u6301\u4e45\u7684\u5b58\u50a8</li> <li>\u6709\u5e8f\u3001\u5e73\u6ed1\u7684\u90e8\u7f72\u548c\u6269\u5c55</li> <li>\u6709\u5e8f\u3001\u5e73\u6ed1\u7684\u7ec8\u6b62\u548c\u5220\u9664</li> <li>\u6709\u5e8f\u7684\u6eda\u52a8\u66f4\u65b0</li> </ol> <p>\u4e00\u4e2a\u5178\u578b\u7684 StatefulSet \u5e94\u7528\u4e00\u822c\u5305\u542b\u4e09\u4e2a\u7ec4\u4ef6\uff1a</p> <ol> <li>headless service \uff08\u65e0\u5934 service\uff09</li> <li>StatefulSet \uff08\u63a7\u5236\u5668\uff09</li> <li>volumeClaimTemplate\uff08\u5b58\u50a8\u5377\u7533\u8bf7\u6a21\u677f\uff09</li> </ol> <p>\u5404\u4e2a POD \u7528\u5230\u7684\u5b58\u50a8\u5377\u5fc5\u987b\u4f7f\u7528\u7531 StorageClass \u52a8\u6001\u4f9b\u7ed9\u6216\u8005\u7531\u7ba1\u7406\u5458\u4e8b\u5148\u521b\u5efa\u597d\u7684 PV\u3002</p> <p>\u5220\u9664 StatefulSet \u6216\u8005\u7f29\u51cf\u5176\u89c4\u6a21\u5bfc\u81f4 POD \u88ab\u5220\u9664\u65f6\u4e0d\u4f1a\u81ea\u52a8\u5220\u9664\u5176\u5b58\u50a8\u5377\u4ee5\u786e\u4fdd\u6570\u636e\u5b89\u5168\u3002</p> <p>StatefulSet \u63a7\u5236\u5668\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u4e8b\u5148\u5b58\u5728\u7684 headless Service \u5bf9\u8c61\u5b9e\u73b0 POD \u5bf9\u8c61\u7684\u6301\u4e45\u3001\u552f\u4e00\u7684\u6807\u8bc6\u7b26\u914d\u7f6e\uff1b\u6b64 headless Service \u9700\u8981\u7531\u7528\u6237\u624b\u52a8\u914d\u7f6e\uff0c\u5b83\u80fd\u5b9e\u73b0\u5728 POD \u51fa\u73b0\u6545\u969c\u88ab\u91cd\u6784\u65f6\u5019\uff0c\u4f9d\u7136\u80fd\u591f\u4f7f\u7528\u4e4b\u524d\u7684\u4e3b\u673a\u540d\u3002</p>"},{"location":"k8s/note/chapter-12/#121","title":"12.1 \u6e05\u5355\u683c\u5f0f","text":"<pre><code>podManagementPolicy    &lt;string&gt;      # \u63a7\u5236\u6269\u5c55\u65f6\u5019\u7684\u987a\u5e8f\u7b56\u7565\nreplicas               &lt;integer&gt;     # \u6a21\u677f\u8fd0\u884c\u7684\u526f\u672c\u6570\nrevisionHistoryLimit   &lt;integer&gt;     # \u66f4\u65b0\u5386\u53f2\u6700\u5927\u4fdd\u5b58\u6570\u91cf\nselector               &lt;Object&gt;      # \u6807\u7b7e\u9009\u62e9\u5668\nserviceName            &lt;string&gt;      # headless service \u7684\u540d\u79f0\uff0c\u57fa\u4e8e\u8fd9\u4e2a service \u4e3a POD \u5206\u914d\u6807\u8bc6\u7b26\ntemplate               &lt;Object&gt;      # POD \u5bf9\u8c61\u6a21\u677f\uff0c\u9700\u8981\u914d\u7f6e\u6302\u8f7d\u5b58\u50a8\u5377\uff0c\u5e94\u8be5\u4f7f\u7528 PCV \u7c7b\u578b\nupdateStrategy         &lt;Object&gt;      # StatefulSet \u66f4\u65b0\u7b56\u7565\nvolumeClaimTemplates   &lt;[]Object&gt;    # pvs \u7684\u5217\u8868\n</code></pre> <ul> <li>POD \u5173\u8054\u4f7f\u7528 PVC \u903b\u8f91</li> </ul> <p>\u6bcf\u4e2a POD \u4e2d\u5e94\u8be5\u5b9a\u4e49\u4e00\u4e2a PVC \u7c7b\u578b\u7684 volume \uff0c\u8fd9\u4e2a PVC \u7c7b\u578b\u7684 volume \u5e94\u8be5\u5173\u8054\u5230\u4e00\u4e2a\u5f53\u524d\u540c\u4e00\u4e2a\u540d\u79f0\u7a7a\u95f4\u7684 PVC\uff0c\u8fd9\u4e2a PVC \u5e94\u8be5\u5173\u8054\u5230\u96c6\u7fa4\u7ea7\u522b\u7684 PV \u4e0a\u3002</p> <p>statefullset \u4f1a\u4e3a POD \u81ea\u52a8\u521b\u5efa PVC \u7c7b\u578b\u7684 Volume \uff0c\u5e76\u4e14\u5728 POD \u6240\u5728\u7684\u540d\u79f0\u7a7a\u95f4\u4e2d\u81ea\u52a8\u521b\u5efa PVC\u3002</p> <p>\u5728 StatefulSet \u4e2d\uff0c\u6bcf\u4e00\u4e2a POD \u7684\u540d\u5b57\u662f\u56fa\u5b9a\u4e14\u552f\u4e00\u7684\uff0c\u5373\u6709\u5e8f\u7684\u6570\u5b57\u6765\u6807\u8bc6\uff0c\u4f8b\u5982\uff1aweb-0 \u6302\u4e86\uff0c\u91cd\u5efa\u7684 POD \u8fd8\u53eb\u505a web-0\u3002</p> <p>\u8bbf\u95ee Service \u65f6\u5019\u7684\u683c\u5f0f\uff1a$(servicename).$(namespace).svc.cluster.local\uff0c\u8fd9\u4e2a\u65e0\u5934 Service \u540d\u5b57\u5728\u89e3\u6790\u65f6\uff0c\u89e3\u6790\u4e3a POD \u540d\u79f0\u7684\u522b\u540d\u3002</p> <p>headless \u80fd\u4fdd\u8bc1\uff0c\u5bf9 service \u7684\u8bbf\u95ee\u80fd\u591f\u89e3\u6790\u4e3a POD IP\uff0c\u4f46\u662f\u73b0\u5728\u9700\u8981\u6807\u8bc6\u7684\u662f\u6bcf\u4e2a POD \u7684\u540d\u5b57\uff0c\u6240\u4ee5\uff0c\u53ea\u9700\u8981\u5728 Service \u524d\u52a0\u4e0a POD \u7684\u540d\u79f0\u5373\u53ef\u3002</p> <p>\u4f8b\u5982\uff1apod \u540d\u79f0\u4e3a web-0\uff0c\u670d\u52a1\u540d\u4e3a\uff1amyapp\uff0c\u90a3\u4e48\u8bbf\u95ee\u8fd9\u4e2a POD \u5c31\u4f7f\u7528</p> <pre><code>web-0.myapp.default.svc.cluster.local\n</code></pre>"},{"location":"k8s/note/chapter-12/#122-nfs-pv","title":"12.2 \u521b\u5efa NFS PV","text":"<pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-001\n  labels:\n    name: pv001\nspec:\n  accessModes:\n    - ReadWriteMany\n    - ReadWriteOnce\n  capacity:\n    storage: 5Gi\n  nfs:\n    path: /data/volumes/v1\n    server: 172.16.100.104\n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-002\n  labels:\n    name: pv003\nspec:\n  accessModes:\n    - ReadWriteMany\n    - ReadWriteOnce\n  capacity:\n    storage: 5Gi\n  nfs:\n    path: /data/volumes/v2\n    server: 172.16.100.104\n\n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-003\n  labels:\n    name: pv003\nspec:\n  accessModes:\n    - ReadWriteMany\n    - ReadWriteOnce\n  capacity:\n    storage: 5Gi\n  nfs:\n    path: /data/volumes/v3\n    server: 172.16.100.104\n\n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-004\n  labels:\n    name: pv004\nspec:\n  accessModes:\n    - ReadWriteMany\n    - ReadWriteOnce\n  capacity:\n    storage: 10Gi\n  nfs:\n    path: /data/volumes/v4\n    server: 172.16.100.104\n\n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-005\n  labels:\n    name: pv005\nspec:\n  accessModes:\n    - ReadWriteMany\n    - ReadWriteOnce\n  capacity:\n    storage: 10Gi\n  nfs:\n    path: /data/volumes/v5\n    server: 172.16.100.104\n</code></pre>"},{"location":"k8s/note/chapter-12/#123-statefulset","title":"12.3 \u521b\u5efa statefulSet","text":"<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: myapp\n  labels:\n    app: myapp\nspec:\n  ports:\n    - port: 80\n      name: web\n  clusterIP: None\n  selector:\n    app: myapp-pod\n\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: myapp\nspec:\n  serviceName: myapp\n  replicas: 3\n  selector:\n    matchLabels:\n      app: myapp-pod\n  template:\n    metadata:\n      labels:\n        app: myapp-pod\n    spec:\n      containers:\n        - name: myapp\n          image: ikubernetes/myapp:v1\n          ports:\n            - containerPort: 80\n              name: web\n          volumeMounts:\n            - name: myappdata\n              mountPath: /usr/share/nginx/html\n  volumeClaimTemplates:\n    - metadata:\n        name: myappdata\n      spec:\n        accessModes:\n          - ReadWriteOnce\n        resources:\n          requests:\n            storage: 5Gi\n</code></pre> <ul> <li>\u8bbf\u95ee pod</li> </ul> <pre><code>pod_name.service_name.ns_name.svc.cluster.local\n</code></pre>"},{"location":"k8s/note/chapter-12/#124","title":"12.4 \u6269\u5bb9\u548c\u5347\u7ea7","text":"<ul> <li>\u6269\u5bb9\u548c\u7f29\u5bb9</li> </ul> <pre><code>kubectl scale sts myapp --replicas=5\n</code></pre> <ul> <li>\u5347\u7ea7\u7b56\u7565\uff0ckubectl explain sts.spec.updateStrategy.rollingUpdate.partition</li> </ul> <pre><code>\u53ef\u4ee5\u5b9e\u73b0\u91d1\u4e1d\u96c0\u53d1\u5e03\uff0c\u9996\u5148\u4ec5\u4ec5\u66f4\u65b0\u5927\u4e8e\u7b49\u4e8e\u591a\u5c11\u7684\u90e8\u5206\uff0c\u7136\u540e\u66f4\u65b0\u5927\u4e8e 0 \u7684\uff0c\u5c31\u53ef\u4ee5\u5168\u90e8\u66f4\u65b0\u4e86\nkubectl patch sta myapp -p '{\"spec\":{\"updateStrategy\":{\"rollingUpdate\":{\"partition\":4}}}}'\n</code></pre> <pre><code>kubectl set image statefulset/myapp myapp=ikubernetes/myapp:v2kubectl \n</code></pre> <pre><code> kubectl patch sta myapp -p '{\"spec\":{\"updateStrategy\":{\"rollingUpdate\":{\"partition\":0}}}}'\n</code></pre>"},{"location":"k8s/note/chapter-13/","title":"\u5341\u4e09 \u7528\u6237\u8ba4\u8bc1\u7cfb\u7edf","text":"<p>apiserver \u662f\u6240\u6709\u8bf7\u6c42\u8bbf\u95ee\u7684\u7f51\u5173\u63a5\u53e3\uff0c\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\uff0c\u8ba4\u8bc1\u7528\u4e8e\u5b9e\u73b0\u8eab\u4efd\u8bc6\u522b\uff0c\u6388\u6743\u7528\u4e8e\u5b9e\u73b0\u6743\u9650\u68c0\u67e5\uff0c\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u4f7f\u7528\u547d\u4ee4\u884c\uff1akubectl apply -f ment.yaml\uff0c\u5b9e\u9645\u4e0a\u662f\u8f6c\u6362\u4e3a HTTP \u534f\u8bae\u5411 apiserver \u53d1\u8d77\u8bf7\u6c42\u7684\uff0c\u800c\u8ba4\u8bc1\u662f\u4fe1\u606f\u7531 ~/.kube/config \u8fd9\u4e2a\u6587\u4ef6\u63d0\u4f9b\u7684\uff0c\u8fd9\u4e2a\u6587\u4ef6\u8bb0\u5f55\u4e86\u7ba1\u7406\u5458\u6743\u9650\u7684\u7528\u6237\u4fe1\u606f\u3002</p> <ul> <li>k8s \u7684 API \u662f RESTfull \u98ce\u683c\u7684\uff0c\u6240\u4ee5\u8d44\u6e90\u662f\u7531\u8def\u5f84\u6807\u660e\u7684\uff0c\u5728 k8s \u4e2d\uff0c\u8d44\u6e90\u53ea\u80fd\u5c5e\u4e8e\u4e24\u4e2a\u5730\u65b9\uff1a\u5c5e\u4e8e\u96c6\u7fa4 \u6216 \u5c5e\u4e8e\u540d\u79f0\u7a7a\u95f4\u3002</li> </ul> <pre><code>\u96c6\u7fa4\u7ea7\u522b\uff1anamespace\u3001pv\n\u540d\u79f0\u7a7a\u95f4\uff1aPOD\u3001deployment\u3001daemonSet\u3001 service\u3001PCV\n</code></pre> <p>\u4f8b\u5982\uff1a\u8bf7\u6c42 delfault \u540d\u79f0\u7a7a\u95f4\u4e0b\u7684 myapp-deploy \u63a7\u5236\u5668\uff0c\u5c31\u662f\u4e0b\u9762\u7684\u5199\u6cd5</p> <pre><code>http://172.16.100.100/apis/apps/v1/namespaces/default/deployments/myapp-deploy\n</code></pre> <p>\u4e0a\u9762\u8868\u793a\uff1ahttp://172.16.100.100:6443 \u96c6\u7fa4\u7684 apis \u4e0b\u7684 apps \u7ec4\u7684 v1 \u7248\u672c\u7684 namespaces \u4e0b\u5bfb\u627e default \u4e0b\u7684 myapp-deploy \u63a7\u5236\u5668</p>"},{"location":"k8s/note/chapter-13/#131","title":"13.1 \u7528\u6237\u7684\u7c7b\u578b","text":"<p>\u6211\u4eec\u4f7f\u7528 kubectl \u8fde\u63a5 k8s \u96c6\u7fa4\u8fdb\u884c\u63a7\u5236\uff0c\u5b9e\u9645\u4e0a\u662f\u4f7f\u7528\u7528\u6237\u5bb6\u76ee\u5f55\u4e0b .kube/config \u8fd9\u4e2a\u6587\u4ef6\u4e2d\u7684\u7528\u6237\u8fde\u63a5\u5230 apiserver \u5b9e\u73b0\u8ba4\u8bc1\u7684\uff0c\u800c\u6709\u4e9b POD \uff08\u5982\uff1aCoreDNS\uff09\u4e5f\u9700\u8981\u83b7\u53d6\u96c6\u7fa4\u7684\u4fe1\u606f\uff0c\u5b83\u4eec\u4e5f\u9700\u8981\u8fde\u63a5\u5230 k8s \u96c6\u7fa4\u4e2d\uff0c\u6240\u4ee5 k8s \u4e2d\u7528\u6237\u7684\u7c7b\u578b\u6709\u4e24\u79cd\uff1a</p> <ol> <li>\u4eba\u7c7b\u4f7f\u7528\u7684\u7528\u6237\uff1auseraccount\uff0c\u5904\u4e8e\u7528\u6237\u5bb6\u76ee\u5f55 .kube/config \u6587\u4ef6\u4e2d\uff0c\u53ef\u4f7f\u7528 kubectl config --help \u83b7\u53d6\u5e2e\u52a9\u521b\u5efa</li> <li>POD \u4f7f\u7528\u7684\u7528\u6237\uff1aserviceaccunt\uff0c\u662f\u4e00\u79cd k8s \u5bf9\u8c61\uff0c\u5b83\u53ef\u4ee5\u4f7f\u7528 kubectl create serviceaccount --help \u83b7\u53d6\u5e2e\u52a9\u521b\u5efa</li> </ol>"},{"location":"k8s/note/chapter-13/#132-pod","title":"13.2 POD\u5982\u4f55\u8fde\u63a5\u96c6\u7fa4","text":"<p>POD \u9700\u8981\u4f7f\u7528 serviceaccount \u8fde\u63a5\u5e76\u8ba4\u8bc1\u5230\u96c6\u7fa4\uff0cPOD \u4e4b\u6240\u4ee5\u80fd\u591f\u8fde\u63a5\u5230\u96c6\u7fa4\u662f\u56e0\u4e3a\u6709\u4e00\u4e2a\u5185\u7f6e\u7684 service \u5c06 POD \u7684\u8bf7\u6c42\u4ee3\u7406\u81f3 apiserver \u7684\u5730\u5740\u4e86\u3002</p> <ul> <li>\u540d\u5b57\u4e3a kubernetes \u7684 servie \u4e3a POD \u8fde\u63a5\u5230 apiserver \u63d0\u4f9b\u4e86\u901a\u4fe1</li> </ul> <pre><code>$ kubectl describe service kubernetes                            # \u96c6\u7fa4\u5185\u90e8\u7684 POD \u4e0e apiserver \u901a\u4fe1\u4f7f\u7528\u7684 service \uff0c\u4f46\u662f\u6ce8\u610f apiserver \u9700\u8981\u8ba4\u8bc1\u7684\n\nName:              kubernetes\nNamespace:         default\nLabels:            component=apiserver\n                   provider=kubernetes\nAnnotations:       &lt;none&gt;\nSelector:          &lt;none&gt;\nType:              ClusterIP\nIP:                10.96.0.1                                     # \u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee apiserver \u7684\u7f51\u5173\nPort:              https  443/TCP\nTargetPort:        6443/TCP\nEndpoints:         172.16.100.101:6443                           # apiserver \u5de5\u4f5c\u7684\u5730\u5740\nSession Affinity:  None\nEvents:            &lt;none&gt;\n</code></pre>"},{"location":"k8s/note/chapter-13/#133-serviceaccount","title":"13.3 serviceaccount \u5bf9\u8c61","text":"<p>k8s \u7684\u8ba4\u8bc1\u6709\u4e24\u79cd\u4e00\u79cd\u662f\uff1ahuman user\u3001\u4e00\u79cd\u662f serviceaccount\uff0c\u4e0b\u9762\u5c31\u662f\u521b\u5efa serviceaccount \u5b83\u662f POD \u8bbf\u95ee apiserver \u6240\u7528\u7684\u4e00\u79cd\u5bf9\u8c61\uff0c\u800c human user\uff0c\u5373\u4f7f kubectl \u547d\u4ee4\u884c\u901a\u8fc7\u8bfb\u53d6 config \u4e2d\u7684\u7528\u6237\u800c\u8ba4\u8bc1\u5230 apiserver \u7684\u3002</p> <ul> <li>\u521b\u5efa\u4e00\u4e2a serviceaccount \u5bf9\u8c61\uff0c\u5b83\u4f1a\u81ea\u52a8\u521b\u5efa\u5e76\u5173\u8054\u4e00\u4e2a secret\uff0c\u8fd9\u4e2a serviceaccount \u53ef\u4ee5\u5230 apiserver \u4e0a\u8fdb\u884c\u8ba4\u8bc1\uff0c\u4f46\u662f\u8ba4\u8bc1\u4e0d\u4ee3\u8868\u6709\u6743\u9650\uff0c\u6240\u4ee5\u9700\u8981\u6388\u6743</li> </ul> <pre><code>$ kubectl create serviceaccount admin\n$ kubectl get secret\n</code></pre> <ul> <li>\u521b\u5efa POD \u4f7f\u7528\u6307\u5b9a\u7684 serviceaccount \u5bf9\u8c61</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-serviceaccount-demo\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n    - name: nginx\n      image: ikubernetes/myapp:v1\n      ports:\n        - name: http\n          containerPort: 80\n  serviceAccountName: admin\n</code></pre>"},{"location":"k8s/note/chapter-13/#1331-pod-serviceaccount","title":"13.3.1 \u5728 POD \u4e2d\u4f7f\u7528 serviceaccount","text":"<ul> <li>POD \u8fde\u63a5 apiserver \u65f6\u5019\uff0c\u9700\u8981\u5728\u6e05\u5355\u4e2d\u6307\u5b9a serviceAccountName \u8fd9\u4e2a\u5b57\u6bb5\uff0c\u8be6\u89c1\uff1akubectl explain pods.spec</li> </ul> <p>\u6bcf\u4e2a POD \u9ed8\u8ba4\u81ea\u5e26\u4e00\u4e2a volumes\uff0c\u8fd9\u662f\u4e00\u4e2a secret\uff0c\u8fd9\u4e2a\u5b58\u50a8\u5377\u4fdd\u5b58\u7740 default-token-bq2gn \u7528\u6765\u8bbf\u95ee apiserver \uff0c\u800c\u8fd9\u4e2a secret \u6743\u9650\u4ec5\u4ec5\u80fd\u901a\u8fc7 api \u8bbf\u95ee\u5f53\u524d POD \u81ea\u8eab\u7684\u4fe1\u606f\uff0c\u5982\u679c\u60f3\u8981\u4e00\u4e2a POD \u62e5\u6709\u7ba1\u7406\u96c6\u7fa4\u7684\u6743\u9650\uff0c\u90a3\u4e48\u53ef\u4ee5\u624b\u52a8\u521b\u5efa\u4e00\u4e2a secret \u5e76\u901a\u8fc7 volumes \u6302\u8f7d\u5230 POD \u4e0a\u3002</p> <p>serviceaccout \u4e5f\u5c5e\u4e8e\u6807\u51c6\u7684 k8s \u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u63d0\u4f9b\u4e86\u8d26\u53f7\u4fe1\u606f\uff0c\u4f46\u662f\u8d26\u53f7\u7531\u6ca1\u6709\u6743\u9650\u9700\u8981 rbac \u673a\u5236\u6765\u51b3\u5b9a\u3002</p>"},{"location":"k8s/note/chapter-13/#134-kubectl","title":"13.4 kubectl \u914d\u7f6e\u6587\u4ef6","text":"<ul> <li>kubectl \u914d\u7f6e\u6587\u4ef6\u89e3\u6790\uff0c\u8be6\u89c1\uff1akubectl config view</li> </ul> <pre><code>apiVersion: v1\nkind: Config\nclusters:                                             # \u96c6\u7fa4\u5217\u8868\n- cluster:                                            # \u5217\u8868\u4e2d\u7684\u4e00\u4e2a\u96c6\u7fa4\u5bf9\u8c61\n    certificate-authority-data: DATA+OMITTED          # \u670d\u52a1\u5668\u8ba4\u8bc1\u65b9\u5f0f\n    server: https://172.16.100.101:6443               # \u96c6\u7fa4\u7684 apiserver \u5730\u5740\n  name: kubernetes                                    # \u96c6\u7fa4\u540d\u79f0\nusers:                                                # \u7528\u6237\u5217\u8868\n- name: kubernetes-admin                              # \u5217\u8868\u4e2d\u7684\u4e00\u4e2a\u7528\u6237\u5bf9\u8c61\n  user:                                               # \n    client-certificate-data: REDACTED                 # \u5ba2\u6237\u7aef\u8bc1\u4e66\n    client-key-data: REDACTED                         # \u5ba2\u6237\u7aef\u79c1\u94a5\ncontexts:                                             # \u4e0a\u4e0b\u6587\u5217\u8868\n- context:                                            # \u5217\u8868\u4e2d\u7684\u4e00\u4e2a\u4e0a\u4e0b\u6587\u5bf9\u8c61\n    cluster: kubernetes                               # \u96c6\u7fa4\u540d\u79f0\n    user: kubernetes-admin                            # \u7528\u6237\u540d\u79f0\n  name: kubernetes-admin@kubernetes                   # \u4e0a\u4e0b\u6587\u540d\u79f0\ncurrent-context: kubernetes-admin@kubernetes          # \u5f53\u524d\u4e0a\u4e0b\u6587\npreferences: {}\n</code></pre> <ul> <li>\u914d\u7f6e\u6587\u4ef6\u4fdd\u5b58\u4e86\uff1a\u591a\u4e2a\u96c6\u7fa4\u3001\u591a\u7528\u6237\u7684\u914d\u7f6e\uff0ckubectl \u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u7528\u6237\u8bbf\u95ee\u4e0d\u540c\u7684\u96c6\u7fa4\u3002</li> </ul> <pre><code>\u96c6\u7fa4\u5217\u8868\uff1a\u96c6\u7fa4\u5bf9\u8c61\u5217\u8868\n\u7528\u6237\u5217\u8868\uff1a\u7528\u6237\u5bf9\u8c61\u5217\u8868\n\u4e0a\u4e0b\u6587\uff1a\u662f\u63cf\u8ff0\u96c6\u7fa4\u4e0e\u7528\u6237\u7684\u5173\u7cfb\u5217\u8868\u3002\n\u5f53\u524d\u4e0a\u4e0b\u6587\uff1a\u8868\u793a\u5f53\u524d\u4f7f\u7528\u54ea\u4e2a\u7528\u6237\u8bbf\u95ee\u54ea\u4e2a\u96c6\u7fa4\n</code></pre> <pre><code>\u81ea\u5b9a\u4e49\u914d\u7f6e\u4fe1\u606f\uff1a\u8be6\u89c1\uff1akubectl config  --help\nca \u548c\u8bc1\u4e66\u4fdd\u5b58\u8def\u5f84\uff1a/etc/kubernetes \u4fdd\u5b58\u4e86\u6240\u6709\u7684 ca \u548c\u7b7e\u53d1\u7684\u8bc1\u4e66\u4fe1\u606f\u3002\n</code></pre>"},{"location":"k8s/note/chapter-13/#135-config","title":"13.5 \u6dfb\u52a0\u8bc1\u4e66\u7528\u6237\u5230 config","text":"<p>k8s apiserver \u8ba4\u8bc1\u65b9\u5f0f\u6709\u4e24\u79cd\uff1assl\u8bc1\u4e66 \u548c token \u8ba4\u8bc1\uff0c\u672c\u6b21\u4f7f\u7528 ssl \u8bc1\u4e66\u521b\u5efa\u7528\u6237</p>"},{"location":"k8s/note/chapter-13/#1351-ssl","title":"13.5.1 \u521b\u5efaSSL\u8bc1\u4e66\u7528\u6237","text":"<ul> <li>\u521b\u5efa\u8fde\u63a5 apiserver \u7684\u7528\u6237\u8bc1\u4e66</li> </ul> <pre><code># \u521b\u5efa\u79c1\u94a5\n(umask 077; openssl genrsa -out kaliarch.key 2048)\n\n# \u751f\u6210\u8bc1\u4e66\u7b7e\u7f72\u8bf7\u6c42\uff0cO \u662f\u7ec4\uff0cCN \u5c31\u662f\u8d26\u53f7\uff0c\u8fd9\u4e2a\u8d26\u53f7\u88ab k8s \u7528\u6765\u8bc6\u522b\u8eab\u4efd\uff0c\u6388\u6743\u4e5f\u9700\u8981\u6388\u6743\u8fd9\u4e2a\u8d26\u53f7\nopenssl req -new -key kaliarch.key -out kaliarch.csr -subj \"/CN=kaliarch\"\n#penssl req -new -key kaliarch.key -out kaliarch.csr -subj \"O=system:masters/CN=kaliarch/\"\n\n# \u4f7f\u7528 CA \u7b7e\u7f72\u8bc1\u4e66\uff0c\u5e76\u4e14\u5728 1800 \u5929\u5185\u6709\u6548\nopenssl x509 -req -in kaliarch.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out kaliarch.crt -days 1800\n\n# \u67e5\u770b\u8bc1\u4e66\nopenssl x509 -in kaliarch.crt -text -noout\n</code></pre>"},{"location":"k8s/note/chapter-13/#1352-sslconfig","title":"13.5.2 \u6dfb\u52a0SSL\u8bc1\u4e66\u7528\u6237\u5230config","text":"<ul> <li>\u5c06 kaliarch \u7528\u6237\u6dfb\u52a0\u5230 k8s \u7684 config \u4e2d\uff0c\u8bbe\u7f6e\u5ba2\u6237\u7aef\u8bc1\u4e66\u4e3a kaliarch.crt\uff0c\u8bbe\u7f6e\u5ba2\u6237\u7aef\u79c1\u94a5\u4e3a\uff1akaliarch.key\uff0c\u4f7f\u7528 --embed-certs=true \u6765\u9690\u85cf\u8fd9\u4e9b\u673a\u5bc6\u4fe1\u606f</li> </ul> <pre><code>kubectl config set-credentials kaliarch --client-certificate=./kaliarch.crt --client-key=./kaliarch.key --embed-certs=true\n</code></pre>"},{"location":"k8s/note/chapter-13/#1353","title":"13.5.3 \u521b\u5efa\u5207\u6362\u4e0a\u4e0b\u6587","text":"<ul> <li>\u521b\u5efa\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u6388\u6743 kaliarch \u7528\u6237\u8bbf\u95ee\u540d\u79f0\u4e3a kubernetes \u7684\u96c6\u7fa4</li> </ul> <pre><code>kubectl config set-context kaliarch@kubernetes --cluster=kubernetes --user=kaliarch\n</code></pre> <ul> <li>\u5207\u6362\u5f53\u524d\u4f7f\u7528\u7684\u4e0a\u4e0b\u6587\uff0c\u5230\u6388\u6743 kaliarch \u5230 kubernetes \u7684\u4e0a\u4e0b\u6587\u4e0a</li> </ul> <pre><code>kubectl config use-context kaliarch@kubernetes\n</code></pre> <ul> <li>\u7531\u4e8e\u8fd9\u4e2a\u7528\u6237\u6ca1\u6709\u6388\u6743\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7528\u6237\u662f\u65e0\u6cd5 get \u5230\u4fe1\u606f\u7684\uff0c\u53ef\u4ee5\u518d\u5207\u6362\u56de\u6765</li> </ul> <pre><code>$ kubectl get pods\n$ kubectl config use-context kubernetes-admin@kubernetes\n</code></pre>"},{"location":"k8s/note/chapter-13/#136-config","title":"13.6 \u521b\u5efa\u65b0 config \u6587\u4ef6","text":"<p>\u4f7f\u7528 kubectl config set-cluster \u521b\u5efa\u4e00\u4e2a\u65b0\u7684 config \u6587\u4ef6\uff0c\u60f3\u8981\u8bbe\u5b9a\u8fd9\u4e2a\u65b0\u521b\u5efa\u7684 config \u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528 --kubeconfig=/tmp/test.conf \u6307\u660e\u3002</p> <ul> <li>\u8bbe\u7f6e\u96c6\u7fa4\u7684\u8fde\u63a5\u7684 ca \u673a\u6784\u8bc1\u4e66\uff0c--kubeconfig \u53ef\u4ee5\u6307\u5b9a kubectl \u4f7f\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u4e3a\u7528\u6237\u5bb6\u76ee\u5f55 .kube \u76ee\u5f55\u4e2d\u7684 config</li> </ul> <pre><code>kubectl config set-cluster k8s-cluster --server=https://172.16.100.101:6443 --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=true --kubeconfig=/tmp/test.conf \n</code></pre> <ul> <li>\u5c06 kaliarch \u7528\u6237\u6dfb\u52a0\u5230 k8s \u7684 config \u4e2d\uff0c\u8bbe\u7f6e\u5ba2\u6237\u7aef\u8bc1\u4e66\u4e3a kaliarch.crt\uff0c\u8bbe\u7f6e\u5ba2\u6237\u7aef\u79c1\u94a5\u4e3a\uff1akaliarch.key\uff0c\u4f7f\u7528 --embed-certs=true \u6765\u9690\u85cf\u8fd9\u4e9b\u673a\u5bc6\u4fe1\u606f</li> </ul> <pre><code>kubectl config set-credentials kaliarch --client-certificate=./kaliarch.crt --client-key=./kaliarch.key --embed-certs=true\n</code></pre> <ul> <li>\u521b\u5efa\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u6388\u6743 kaliarch \u7528\u6237\u8bbf\u95ee\u540d\u79f0\u4e3a kubernetes \u7684\u96c6\u7fa4</li> </ul> <pre><code>kubectl config set-context def-ns-admin@k8s-cluster --cluster=k8s-cluster --user=def-ns-admin --kubeconfig=/tmp/test.conf\n</code></pre> <ul> <li>\u5207\u6362\u5f53\u524d\u4f7f\u7528\u7684\u4e0a\u4e0b\u6587\uff0c\u5230\u6388\u6743 kaliarch \u5230 kubernetes \u7684\u4e0a\u4e0b\u6587\u4e0a</li> </ul> <pre><code>kubectl config use-context def-ns-admin@k8s-cluster --kubeconfig=/tmp/test.con\n</code></pre>"},{"location":"k8s/note/chapter-13/#137-token","title":"13.7 \u57fa\u4e8e token \u8ba4\u8bc1","text":""},{"location":"k8s/note/chapter-13/#1371-serviceaccount","title":"13.7.1 \u521b\u5efa serviceaccount","text":"<ul> <li>\u4e3a POD \u521b\u5efa\u4e00\u4e2a serviceaccount \u5bf9\u8c61\uff0c\u5b83\u662f POD \u8bbf\u95ee apiserver \u7684\u51ed\u8bc1</li> </ul> <pre><code>kubectl create serviceaccount dashborad-admin -n kube-system\n</code></pre>"},{"location":"k8s/note/chapter-13/#1372","title":"13.7.2 \u7ed1\u5b9a\u96c6\u7fa4\u7ba1\u7406\u5458\u89d2\u8272","text":"<ul> <li>\u521b\u5efa clusterrolebinding \u5c06\u7528\u6237\u7ed1\u5b9a\u81f3 cluster-admin \u96c6\u7fa4\u7ba1\u7406\u5458\uff08\u6700\u9ad8\u6743\u9650\uff09</li> </ul> <pre><code>kubectl create clusterrolebinding dashborad-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashborad-admin\n</code></pre>"},{"location":"k8s/note/chapter-13/#1373-serviceaccount-token","title":"13.7.3 \u901a\u8fc7 serviceaccount \u5f97\u5230 Token","text":"<ul> <li>\u627e\u5230\u521a\u624d\u521b\u5efa\u7684 serviceaccount \u5bf9\u8c61</li> </ul> <pre><code>kubectl get secret -n kube-system\n</code></pre> <ul> <li>\u5f97\u5230 serviceaccount \u5bf9\u8c61\u4e2d\u7684 Token</li> </ul> <pre><code>kubectl describe secret -n kube-system dashborad-admin-token-skz95\n</code></pre>"},{"location":"k8s/note/chapter-14/","title":"\u5341\u56db \u7528\u6237\u6743\u9650\u7cfb\u7edf","text":"<p>\u5728 k8s \u4e2d\u7684\u7528\u6237\u6743\u9650\u7cfb\u7edf\u662f\u4f7f\u7528 RBAC \u6a21\u5f0f\u7684\uff0cRBAC \u662f Role-Based AC \u7684\u7f29\u5199\uff0c\u5168\u79f0\uff1a\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u8ba9\u4e00\u4e2a\u7528\u6237\u626e\u6f14\u4e00\u4e2a\u89d2\u8272\uff0c\u800c\u8fd9\u4e2a\u89d2\u8272\u62e5\u6709\u6743\u9650\uff0c\u800c\u8fd9\u4e2a\u7528\u6237\u5c31\u62e5\u6709\u4e86\u8fd9\u4e2a\u6743\u9650\uff0c\u6240\u4ee5\u5728 RBAC \u4e2d\uff0c\u7528\u6237\u6388\u6743\u5c31\u662f\u6388\u6743\u67d0\u4e2a\u89d2\u8272\u3002</p> <pre><code>\u7528\u6237\uff08user\uff09\uff1a\u7528\u6237\u53ef\u4ee5\u62e5\u6709\u67d0\u4e2a\u89d2\u8272\u3002\n\n\u89d2\u8272\uff08role\uff09\uff1a\u89d2\u8272\u53ef\u4ee5\u62e5\u6709\u67d0\u4e9b\u8bb8\u53ef\u3002\n    1. \u64cd\u4f5c\n    2. \u5bf9\u8c61\n\n\u8bb8\u53ef\uff08permission\uff09\uff1a \u5728\u4e00\u4e2a\u5bf9\u8c61\u4e0a\u80fd\u65bd\u52a0\u7684\u64cd\u4f5c\u7ec4\u5408\u8d77\u6765\uff0c\u79f0\u4e4b\u4e3a\u4e00\u4e2a\u8bb8\u53ef\u6743\u9650\u3002\n</code></pre> <ul> <li>\u7528\u6237\u7c7b\u578b</li> </ul> <pre><code>Human User\uff1a              # \u7528\u6237\u8d26\u53f7\nPod Service Account\uff1a     # \u670d\u52a1\u8d26\u53f7\n</code></pre> <ul> <li>\u89d2\u8272\u7c7b\u578b</li> </ul> <pre><code>- role\uff08\u89d2\u8272\uff09\u3001rolebinding\uff08\u89d2\u8272\u7ed1\u5b9a\uff09\n- clusterrole\uff08\u96c6\u7fa4\u89d2\u8272\uff09\u3001clusterrolebinding\uff08\u96c6\u7fa4\u89d2\u8272\u7ed1\u5b9a\uff09\n</code></pre> <ul> <li>\u6388\u6743\u7c7b\u578b</li> </ul> <pre><code>- \u7528\u6237\u901a\u8fc7 rolebinding \u53bb bind rule\uff0crolebinding \u53ea\u80fd\u662f\u5f53\u524d\u547d\u540d\u7a7a\u95f4\u4e2d\n- \u901a\u8fc7 clusterrolebinding \u53bb bind clausterrole\uff0cclusterrolebinding\u4f1a\u5728\u6240\u6709\u540d\u79f0\u7a7a\u95f4\u751f\u6548\n- \u901a\u8fc7 rolebinding \u53bb bind clausterrole\uff0c\u7531\u4e8e rolebinding \u53ea\u5728\u5f53\u524d\u540d\u79f0\u7a7a\u95f4\uff0c\u6240\u4ee5 clusterrole \u6743\u9650\u88ab\u9650\u5236\u4e3a\u5f53\u524d\u540d\u79f0\u7a7a\u95f4\n</code></pre> <ul> <li>\u901a\u8fc7 rolebinding \u53bb bind clusterrole \u7684\u597d\u5904</li> </ul> <pre><code>\u5982\u679c\u6709\u5f88\u591a\u540d\u79f0\u7a7a\u95f4\u3001\u5982\u679c\u7528 rolebinding \u7ed1\u5b9a role\uff0c\u90a3\u4e48\u5219\u9700\u8981\u5728\u6bcf\u4e2a\u540d\u79f0\u7a7a\u95f4\u90fd\u5b9a\u4e49 role\n\u5982\u679c\u4f7f\u7528 rolebinding \u7ed1\u5b9a\u4e00\u4e2a clausterrole \uff0c\u7531\u4e8e clusterrole \u62e5\u6709\u6240\u6709\u540d\u79f0\u7a7a\u95f4\u7684\u6743\u9650\uff0c\u800c rolebinding  \u53ea\u80fd\u7ed1\u5b9a\u5f53\u524d\u540d\u79f0\u7a7a\u95f4\uff0c\u90a3\u4e48\u5c31\u7701\u53bb\u4e3a\u6bcf\u4e2a\u540d\u79f0\u7a7a\u95f4\u90fd\u65b0\u5efa\u4e00\u4e2a role \u7684\u8fc7\u7a0b\u4e86\u3002\n</code></pre>"},{"location":"k8s/note/chapter-14/#141","title":"14.1 \u6743\u9650\u5217\u8868","text":"<pre><code>kubectl get clusterrole admin -o yaml\n</code></pre>"},{"location":"k8s/note/chapter-14/#142-role","title":"14.2 \u521b\u5efa Role","text":"<ul> <li>\u547d\u4ee4\u884c\u5b9a\u4e49</li> </ul> <pre><code>kubectl create role pods-reader --verb=get,list,watch --resource=pods\n</code></pre> <ul> <li>\u4f7f\u7528\u6e05\u5355\u65b9\u5f0f\u5b9a\u4e49</li> </ul> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: pods-reder\n  namespace: default\nrules:\n- apiGroups:                           # \u5bf9\u54ea\u4e9b api \u7fa4\u7ec4\u5185\u7684\u8d44\u6e90\u8fdb\u884c\u64cd\u4f5c\n  - \"\"\n  resources:                           # \u5bf9\u54ea\u4e9b\u8d44\u6e90\u6388\u6743\n  - pods\n  verbs:                               # \u6388\u6743\u505a\u54ea\u4e9b\u64cd\u4f5c\n  - get\n  - list\n  - watch\n</code></pre>"},{"location":"k8s/note/chapter-14/#143-rolebinding","title":"14.3 \u521b\u5efa rolebinding","text":"<ul> <li>\u4f7f\u7528 rolebinding \u5bf9\u8c61\u521b\u5efa\uff0c\u7528\u6237\u4e0e role \u7684\u7ed1\u5b9a</li> </ul> <pre><code>kubectl create rolebinding kaliarch-read-pods --role=pods-reader --user=kaliarch\n</code></pre> <ul> <li>\u4f7f\u7528\u6e05\u5355\u65b9\u5f0f\u5b9a\u4e49</li> </ul> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: kaliarch-read-pods\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: pods-reader\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: User\n  name: kaliarch\n</code></pre> <ul> <li>\u5207\u6362\u7528\u6237\u548c\u73af\u5883\u4e0a\u4e0b\u6587</li> </ul> <pre><code>$ kubectl config use-context kaliarch@kubernetes\n</code></pre> <ul> <li>\u6d4b\u8bd5\u7528\u6237\u662f\u5426\u62e5\u6709 get \u6743\u9650</li> </ul> <pre><code>kubectl get pods\n</code></pre>"},{"location":"k8s/note/chapter-14/#144-clusterrole","title":"14.4 \u521b\u5efa clusterrole","text":"<ul> <li>\u547d\u4ee4\u884c\u5b9a\u4e49</li> </ul> <pre><code>kubectl create clusterrole cluster-reader --verb=get,list,watch --resource=pods\n</code></pre> <ul> <li>\u4f7f\u7528\u6e05\u5355\u65b9\u5f0f\u5b9a\u4e49</li> </ul> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: cluster-reader\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  verbs:\n  - get\n  - list\n  - watch\n</code></pre> <ul> <li>\u7cfb\u7edf\u5185\u7f6e\u6709\u975e\u5e38\u591a\u7684 clusterrole\uff0c\u8be6\u89c1\uff1akubectl get clusterrole</li> </ul> <pre><code>NAME                                                                   AGE\nadmin                                                                  5d16h\ncluster-admin                                                          5d16h\ncluster-reader                                                         4m32s\nedit                                                                   5d16h\nflannel                                                                5d6h\nsystem:aggregate-to-admin                                              5d16h\nsystem:aggregate-to-edit                                               5d16h\nsystem:aggregate-to-view                                               5d16h\nsystem:auth-delegator                                                  5d16h\nsystem:aws-cloud-provider                                              5d16h\nsystem:basic-user                                                      5d16h\nsystem:certificates.k8s.io:certificatesigningrequests:nodeclient       5d16h\nsystem:certificates.k8s.io:certificatesigningrequests:selfnodeclient   5d16h\nsystem:controller:attachdetach-controller                              5d16h\nsystem:controller:certificate-controller                               5d16h\nsystem:controller:clusterrole-aggregation-controller                   5d16h\nsystem:controller:cronjob-controller                                   5d16h\nsystem:controller:daemon-set-controller                                5d16h\n</code></pre>"},{"location":"k8s/note/chapter-14/#145-clusterrolebinding","title":"14.5 \u521b\u5efa clusterrolebinding","text":"<ul> <li>\u547d\u4ee4\u884c\u5b9a\u4e49</li> </ul> <pre><code>kubectl create clusterrolebinding kaliarch-read-all-pods --clusterrole=cluster-reader --user=kaliarch\n</code></pre> <ul> <li>\u6e05\u5355\u5b9a\u4e49</li> </ul> <pre><code>apiVersion: rbac.authorization.k8s.io/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kaliarch-read-all-pods\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-reader\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: User\n  name: kaliarch\n</code></pre> <ul> <li>\u5207\u6362\u7528\u6237\u548c\u73af\u5883\u4e0a\u4e0b\u6587</li> </ul> <pre><code>$ kubectl config use-context kaliarch@kubernetes\n</code></pre> <ul> <li>\u6d4b\u8bd5\u7528\u6237\u662f\u5426\u62e5\u6709 get \u6743\u9650</li> </ul> <pre><code>$ kubectl get pods -n kube-system\n$ kubectl config use-context kubernetes-admin@kubernetes\n</code></pre>"},{"location":"k8s/note/chapter-14/#146-rolebinding-clusterrole","title":"14.6 rolebinding \u4e0e clusterrole","text":"<p>\u5982\u679c\u4f7f\u7528 rolebinding \u7ed1\u5b9a\u4e00\u4e2a clusterrole \uff0c\u7531\u4e8e clusterrole \u62e5\u6709\u6240\u6709\u540d\u79f0\u7a7a\u95f4\u7684\u6743\u9650\uff0c\u800c rolebinding  \u53ea\u80fd\u7ed1\u5b9a\u5f53\u524d\u540d\u79f0\u7a7a\u95f4\uff0c\u90a3\u4e48\u5c31\u7701\u53bb\u4e3a\u6bcf\u4e2a\u540d\u79f0\u7a7a\u95f4\u90fd\u65b0\u5efa\u4e00\u4e2a role \u7684\u8fc7\u7a0b\u4e86\u3002</p> <ul> <li>\u547d\u4ee4\u5b9a\u4e49</li> </ul> <pre><code>$ kubectl create rolebinding kaliarch-cluster-reader --clusterrole=cluster-reader --user=kaliarch\n</code></pre> <ul> <li>\u6e05\u5355\u5b9a\u4e49</li> </ul> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: kaliarch-admin\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: admin\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: User\n  name: kaliarch\n</code></pre> <ul> <li>\u5207\u6362\u7528\u6237\u548c\u73af\u5883\u4e0a\u4e0b\u6587</li> </ul> <pre><code>$ kubectl config use-context kaliarch@kubernetes\n</code></pre> <ul> <li>\u6d4b\u8bd5\u7528\u6237\u662f\u5426\u62e5\u6709 get \u6743\u9650\uff0c\u7531\u4e8e\u4f7f\u7528\u4e86 rolebinding \uff0c\u6240\u4ee5 cluster-reader \u88ab\u9650\u5236\u5230\u5f53\u524d\u547d\u540d\u7a7a\u95f4</li> </ul> <pre><code>$ kubectl get pods -n kube-system\n$ kubectl config use-context kubernetes-admin@kubernetes\n</code></pre>"},{"location":"k8s/note/chapter-14/#147-rbac","title":"14.7 RBAC\u6388\u6743","text":"<p>\u5728 bind \u6388\u6743\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u7ed1\u5b9a\u7684\u7528\u6237\u4e3b\u4f53\u6709\uff1auser\u3001group</p> <ul> <li>\u4f7f\u7528 rolebinding \u548c clusterrolebinding \u7ed1\u5b9a</li> </ul> <pre><code>\u7ed1\u5b9a\u5230 user\uff1a\u8868\u793a\u53ea\u6709\u8fd9\u4e00\u4e2a\u7528\u6237\u62e5\u6709 role \u6216\u8005 clusterrole \u7684\u6743\u9650\n\u7ed1\u5b9a\u5230 group\uff1a\u8868\u793a\u8fd9\u4e2a\u7ec4\u5185\u7684\u6240\u6709\u7528\u6237\u90fd\u5177\u6709\u4e86 role \u6216\u8005 clusterrole \u7684\u6743\u9650\n</code></pre> <ul> <li>\u521b\u5efa\u7528\u6237\u65f6\u5019\u52a0\u5165\u7ec4\uff0c\u52a0\u5165\u7ec4\u540e\u8d26\u6237\u81ea\u52a8\u96c6\u6210\u8be5\u7ec4\u7684\u6743\u9650</li> </ul> <pre><code># \u521b\u5efa\u79c1\u94a5\n(umask 077; openssl genrsa -out kaliarch.key 2048)\n\n# \u751f\u6210\u8bc1\u4e66\u7b7e\u7f72\u8bf7\u6c42\uff0cO \u662f\u7ec4\uff0cCN \u5c31\u662f\u8d26\u53f7\uff0c\u8fd9\u4e2a\u8d26\u53f7\u88ab k8s \u7528\u6765\u8bc6\u522b\u8eab\u4efd\uff0c\u6388\u6743\u4e5f\u9700\u8981\u6388\u6743\u8fd9\u4e2a\u8d26\u53f7\nopenssl req -new -key kaliarch.key -out kaliarch.csr -subj \"O=system:masters/CN=kaliarch/\"\n\n# \u4f7f\u7528 CA \u7b7e\u7f72\u8bc1\u4e66\uff0c\u5e76\u4e14\u5728 1800 \u5929\u5185\u6709\u6548\nopenssl x509 -req -in kaliarch.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out kaliarch.crt -days 1800\n\n# \u67e5\u770b\u8bc1\u4e66\nopenssl x509 -in kaliarch.crt -text -noout\n</code></pre>"},{"location":"k8s/note/chapter-15/","title":"\u5341\u4e94 dashboard","text":"<p>\u5b83\u4f5c\u4e3a k8s \u96c6\u7fa4\u7684\u9644\u4ef6\u5b58\u5728\uff0c\u662f kubernetes \u5b98\u65b9\u7684\u9879\u76ee\u4e4b\u4e00\uff0c\u8be6\u89c1\uff1ahttps://github.com/kubernetes/dashboard</p>"},{"location":"k8s/note/chapter-15/#151","title":"15.1 \u90e8\u7f72\u6d41\u7a0b","text":"<ul> <li>\u4e3a dashboard \u63d0\u4f9b ssl \u8bc1\u4e66</li> </ul> <pre><code># \u751f\u6210\u79c1\u94a5\n(umask 077; openssl genrsa -out dashboard.key 2048)\n\n# \u751f\u6210\u4e00\u4e2a\u81ea\u7b7e\u8bc1\u4e66\uff0c\u6ce8\u610f CN \u7684\u503c\u5fc5\u987b\u8981\u4e0e\u81ea\u5df1\u7684\u57df\u540d\u5b8c\u5168\u4e00\u81f4\nopenssl req -new -x509 -key dashboard.key -out dashboard.crt -subj \"/O=dashboard/CN=k8s.dashboard.com\"\n\n# \u67e5\u770b\u8bc1\u4e66\nopenssl x509 -in dashboard.crt -text -noout\n</code></pre> <ul> <li>\u4e0b\u8f7d dashboard \u7684\u6e05\u5355\u6587\u4ef6</li> </ul> <pre><code>wget https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml\n</code></pre> <ul> <li>\u4e3a dashboard \u521b\u5efa secret \u5bf9\u8c61</li> </ul> <pre><code>kubectl -n kube-system create secret generic kubernetes-dashboard-certs --from-file=dashboard.crt=./dashboard.crt --from-file=dashboard.key=./dashboard.key\n</code></pre> <ul> <li>\u4fee\u6539 dashboard \u6e05\u5355\u4e2d service \u7684\u5de5\u4f5c\u6a21\u5f0f\u4e3a nodeport</li> </ul> <pre><code>sed -i '/targetPort: 8443/a\\ \\ type: NodePort' kubernetes-dashboard.yaml\n</code></pre> <ul> <li>\u6ce8\u91ca\u6389 kubernetes-dashboard.yaml \u6e05\u5355\u6587\u4ef6\u4e2d\u7684 Dashboard Secret \u8fd9\u4e2a\u8bc1\u4e66\u7684\u6e05\u5355\u5b9a\u4e49</li> </ul> <pre><code># ------------------- Dashboard Secret ------------------- #\n\n#apiVersion: v1\n#kind: Secret\n#metadata:\n#  labels:\n#    k8s-app: kubernetes-dashboard\n#  name: kubernetes-dashboard-certs\n#  namespace: kube-system\n#type: Opaque\n\n#---\n</code></pre> <ul> <li>\u90e8\u7f72 dashboard \u6e05\u5355</li> </ul> <pre><code>kubectl apply -f kubernetes-dashboard.yaml\n</code></pre> <ul> <li>\u53d6\u5f97 service \u8fd0\u884c\u7684\u7aef\u53e3</li> </ul> <pre><code>kubectl get service -n kube-system\n</code></pre> <ul> <li>\u4f7f\u7528 chrome \u8bbf\u95ee dashboard</li> </ul> <pre><code>https://172.16.100.102:31097/\n</code></pre>"},{"location":"k8s/note/chapter-15/#152","title":"15.2 \u4f7f\u7528\u4ee4\u724c\u767b\u5f55","text":"<ul> <li>\u4e3a POD \u521b\u5efa\u4e00\u4e2a serviceaccount \u5bf9\u8c61\uff0c\u5b83\u662f POD \u8bbf\u95ee apiserver \u7684\u51ed\u8bc1</li> </ul> <pre><code>kubectl create serviceaccount dashborad-admin -n kube-system\n</code></pre> <ul> <li>\u521b\u5efa clusterrolebinding \u5c06\u7528\u6237\u7ed1\u5b9a\u81f3 cluster-admin \u96c6\u7fa4\u7ba1\u7406\u5458\uff08\u6700\u9ad8\u6743\u9650\uff09</li> </ul> <pre><code>kubectl create clusterrolebinding dashborad-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashborad-admin\n</code></pre> <ul> <li>\u627e\u5230\u521a\u624d\u521b\u5efa\u7684 serviceaccount \u5bf9\u8c61</li> </ul> <pre><code>kubectl get secret -n kube-system\n</code></pre> <ul> <li>\u5f97\u5230 serviceaccount \u5bf9\u8c61\u4e2d\u7684 Token</li> </ul> <pre><code>kubectl describe secret -n kube-system dashborad-admin\n</code></pre>"},{"location":"k8s/note/chapter-15/#153","title":"15.3 \u5206\u7ea7\u7ba1\u7406","text":"<p>\u73b0\u5728\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u53ea\u80fd\u7ba1\u7406 default \u540d\u79f0\u7a7a\u95f4\u7684\u7528\u6237\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528 rolebinding \u53bb\u7ed1\u5b9a admin \u8fd9\u4e2a clusterrolue \u5bf9\u8c61\uff0c\u90a3\u4e48\u5c31\u83b7\u5f97\u4e86\u5f53\u524d\u540d\u79f0\u7a7a\u95f4\u7684\u7ba1\u7406\u5458\u6743\u9650\u4e86\u3002</p> <ul> <li>\u521b\u5efa serviceaccount \u767b\u5f55</li> </ul> <pre><code>kubectl create serviceaccount def-ns-admin -n default\n</code></pre> <ul> <li>\u4f7f\u7528 rolebinding \u5bf9\u8c61\uff0c\u5c06 default \u540d\u79f0\u7a7a\u95f4\u7684 def-ns-admin \u8fd9\u4e2a serviceaccunt \u4e0e admin \u8fd9\u4e2a clusterrole \u7ed1\u5b9a </li> </ul> <pre><code>kubectl create rolebinding def-ns-admin --clusterrole=admin --serviceaccount=default:def-ns-admin\n</code></pre> <ul> <li>\u627e\u5230\u521a\u624d\u521b\u5efa\u7684 serviceaccount \u5bf9\u8c61</li> </ul> <pre><code>kubectl get secret -n kube-system\n</code></pre> <ul> <li>\u5f97\u5230 serviceaccount \u5bf9\u8c61\u4e2d\u7684 Token</li> </ul> <pre><code>kubectl describe secret def-ns-admin\n</code></pre>"},{"location":"k8s/note/chapter-15/#154","title":"15.4 \u914d\u7f6e\u6587\u4ef6\u8ba4\u8bc1","text":"<p>\u4e0e\u4e4b\u524d\u57fa\u4e8e SSL \u8bc1\u4e66\u7684 config \u6587\u4ef6\u4e0d\u540c\uff0c\u8fd9\u6b21\u4f7f\u7528\u662f\u57fa\u4e8e Token \u7684 config \u6587\u4ef6\uff0c\u53ef\u4ee5\u4e0d\u7528\u521b\u5efa\u8bc1\u4e66\u4e86\uff0c\u4f7f\u7528\u5df2\u6709\u7684 serviceaccount \u5bf9\u8c61\u7684 token\u3002</p> <ul> <li>\u8bbe\u7f6e\u96c6\u7fa4\u7684\u8fde\u63a5\u7684 ca \u673a\u6784\u8bc1\u4e66\uff0c--kubeconfig \u53ef\u4ee5\u6307\u5b9a kubectl \u4f7f\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u4e3a\u7528\u6237\u5bb6\u76ee\u5f55 .kube \u76ee\u5f55\u4e2d\u7684 config</li> </ul> <pre><code>kubectl config set-cluster k8s-cluster --server=https://172.16.100.101:6443 --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=true --kubeconfig=/tmp/test.conf \n</code></pre> <ul> <li>\u53d6\u5f97\u4e00\u4e2a\u5df2\u7ecf\u7ed1\u5b9a\u89d2\u8272\u7684 serviceaccount \u5bf9\u8c61\u7684 Token</li> </ul> <pre><code>kubectl describe secret def-ns-admin\n</code></pre> <ul> <li>\u4f7f\u7528 Token \u6765\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u7528\u6237</li> </ul> <pre><code>kubectl config set-credentials def-ns-admin --token=&lt;TOKEN&gt; --kubeconfig=/tmp/test.conf\n</code></pre> <ul> <li>\u521b\u5efa\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u6388\u6743 kaliarch \u7528\u6237\u8bbf\u95ee\u540d\u79f0\u4e3a kubernetes \u7684\u96c6\u7fa4</li> </ul> <pre><code>kubectl config set-context def-ns-admin@k8s-cluster --cluster=k8s-cluster --user=def-ns-admin --kubeconfig=/tmp/test.conf\n</code></pre> <ul> <li>\u5207\u6362\u5f53\u524d\u4f7f\u7528\u7684\u4e0a\u4e0b\u6587\uff0c\u5230\u6388\u6743 kaliarch \u5230 kubernetes \u7684\u4e0a\u4e0b\u6587\u4e0a</li> </ul> <pre><code>kubectl config use-context def-ns-admin@k8s-cluster --kubeconfig=/tmp/test.conf\n</code></pre> <ul> <li>\u590d\u5236 /tmp/test.conf \u8fd9\u4e2a\u6587\u4ef6\u5230 dashboard \u4e2d\u5c31\u53ef\u4ee5\u767b\u5f55\u4e86</li> </ul>"},{"location":"k8s/note/chapter-16/","title":"\u5341\u516d \u7f51\u7edc\u901a\u4fe1","text":"<p>K8S \u7684\u7f51\u7edc\u901a\u4fe1\u5b8c\u5168\u7531 CNI \u63a5\u53e3\u4e0a\u7684\u63d2\u4ef6\u6765\u5b9e\u73b0\uff0c\u63d2\u4ef6\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u96c6\u4e2d\u901a\u4fe1\u6a21\u578b\u3002</p> <p>\u76ee\u524d\u6bd4\u8f83\u6d41\u884c\u7684\u63d2\u4ef6\u6709\uff1aflannel\u3001calico\u3001canel\u3001kube-router ...</p> <ul> <li>\u5982\u4f55\u52a0\u8f7d\u63d2\u4ef6</li> </ul> <p>k8s \u5728\u542f\u52a8\u7684\u65f6\u5019\u4f1a\u53bb\uff1a/etc/cni/net.d/ \u76ee\u5f55\u4e0b\u5bfb\u627e\u7f51\u7edc\u63d2\u4ef6\u7684\u914d\u7f6e\u6587\u4ef6\uff0cPOD \u5728\u521b\u5efa\u65f6\u5019 k8s \u8c03\u7528\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u7531\u63d2\u4ef6\u6839\u636e\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u521b\u5efa\u7f51\u7edc\u3002</p>"},{"location":"k8s/note/chapter-16/#161","title":"16.1 \u901a\u4fe1\u6a21\u578b","text":"<ol> <li>\u5bb9\u5668\u95f4\u901a\u4fe1\uff1a\u540c\u4e00\u4e2a POD \u5185\u591a\u4e2a\u5bb9\u5668\u95f4\u7684\u901a\u4fe1\uff0c\u4f7f\u7528 lo \u7f51\u5361\u901a\u4fe1</li> <li>POD\u95f4\u901a\u4fe1\uff1aPOD IP \u76f4\u63a5\u4e0e POD IP \u901a\u4fe1</li> <li>POD \u4e0e Service\uff1aPOD IP \u76f4\u63a5\u4e0e Cluster IP</li> <li>Service \u4e0e\u96c6\u7fa4\u5916\u90e8\u5ba2\u6237\u7aef\u7684\u901a\u4fe1\uff0cingress\u3001NodePort\u3001Loadbacer</li> </ol>"},{"location":"k8s/note/chapter-16/#162","title":"16.2 \u901a\u4fe1\u6a21\u578b\u5e95\u5c42","text":"<p>\u65e0\u8bba\u54ea\u4e00\u79cd\u7f51\u7edc\u63d2\u4ef6\uff0c\u5b83\u4eec\u7528\u5230\u7684\u5e95\u5c42\u65b9\u6848\u90fd\u662f\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ol> <li>\u865a\u62df\u7f51\u6865\uff1abrg\uff0c\u7528\u7eaf\u8f6f\u4ef6\u5b9e\u73b0\u4e00\u4e2a\u865a\u62df\u7f51\u5361\uff0c\u4e00\u7aef\u5728POD\u4e0a\uff0c\u4e00\u7aef\u5728\u5bbf\u4e3b\u673a\u4e0a\u63a5\u5165\u5230\u7f51\u6865\u6216\u7269\u7406\u63a5\u53e3\u6865\u4e0a\uff0c\u79f0\u4e3a\u96a7\u9053\u7f51\u7edc\u3002</li> <li>\u591a\u8def\u590d\u7528\uff1aMacVLAN\uff0c\u57fa\u4e8e MAC \u7684\u65b9\u5f0f\u521b\u5efa VLAN \uff0c\u4e3a\u6bcf\u4e2a\u865a\u62df\u63a5\u53e3\u914d\u7f6e\u4e00\u4e2a\u72ec\u7acb\u7684 MAC \u5730\u5740\uff0c\u4f7f\u5f97\u4e00\u4e2a\u7269\u7406\u7f51\u5361\u627f\u8f7d\u591a\u4e2a\u5bb9\u5668\u4f7f\u7528\uff0c\u8fd9\u6837\u5bb9\u5668\u76f4\u63a5\u4f7f\u7528\u7269\u7406\u7f51\u5361\uff0c\u57fa\u4e8e MacVLAN \u8fdb\u884c\u8de8\u8282\u70b9\u901a\u4fe1\u3002</li> <li>\u786c\u4ef6\u4ea4\u6362\uff1a\u7f51\u5361\u652f\u6301\u786c\u4ef6\u4ea4\u6362\uff0cSR-IOV \uff08\u5355\u6839-IO\u865a\u62df\u5316\uff09 \u65b9\u5f0f\uff0c\u8fd9\u79cd\u7f51\u5361\u652f\u6301\u76f4\u63a5\u5728\u7269\u7406\u7ea7\u522b\u865a\u62df\u51fa\u591a\u4e2a\u63a5\u53e3\uff0c\u9ad8\u6027\u80fd\u3002</li> </ol>"},{"location":"k8s/note/chapter-16/#163-k8s","title":"16.3 K8S \u540d\u79f0\u7a7a\u95f4","text":"<p>K8S \u540d\u79f0\u7a7a\u95f4\u4e0e POD \u7f51\u7edc\u540d\u79f0\u7a7a\u95f4\u4e0d\u5728\u4e00\u4e2a\u7ef4\u5ea6\uff0c\u6240\u4ee5\u5373\u4f7f\u5728\u4e0d\u540c\u7684 K8S \u96c6\u7fa4\u540d\u79f0\u7a7a\u95f4\u5185\u521b\u5efa\u7684\u4e0d\u540c POD\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7f51\u7edc\u76f4\u63a5\u901a\u4fe1\u3002</p> <p>\u800c\u76ee\u524d\u5e94\u7528\u6700\u5e7f\u7684 flannel \u7f51\u7edc\u63d2\u4ef6\uff0c\u662f\u4e0d\u652f\u6301\u8fd9\u79cd\u4e0d\u540c\u96c6\u7fa4\u547d\u540d\u7a7a\u95f4\u7684\u7f51\u7edc\u9694\u79bb\u7b56\u7565\u7684\u3002</p> <p>calico \u652f\u6301\u5730\u5740\u5206\u914d\uff0c\u4e5f\u652f\u6301\u4e0d\u540c\u96c6\u7fa4\u547d\u540d\u7a7a\u95f4\u7684\u7f51\u7edc\u9694\u79bb\u7b56\u7565\uff0c\u4f46\u662f\u5b83\u4f7f\u7528\u8f83\u4e3a\u590d\u6742\uff0c\u652f\u6301 BGP \u4e09\u5c42\u7f51\u7edc\u8f6c\u53d1\uff0c\u6027\u80fd\u6bd4 flannel \u5f3a\u3002</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 flannel \u6765\u505a\u7f51\u7edc\u7ba1\u7406\uff0c\u518d\u5b89\u88c5 calico \u4ec5\u4ec5\u505a\u96c6\u7fa4\u547d\u540d\u7a7a\u95f4\u7f51\u8def\u9694\u79bb\u7b56\u7565\uff0c\u8fd9\u79cd\u642d\u914d\u65b9\u6848\u3002</p>"},{"location":"k8s/note/chapter-16/#164-k8s","title":"16.4 K8S\u7f51\u7edc\u62d3\u6251","text":"<p>\u6240\u6709 POD \u8fde\u63a5\u5230\uff0c\u672c\u673a cni0 \u63a5\u53e3\u8fd9\u4e2a\u7f51\u7edc\uff0ccni0 \u63a5\u53e3\u53d1\u51fa\u7684\u62a5\u6587\u5230\u8fbe flannel.1 \u8fd9\u4e2a\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u5c06\u62a5\u6587\u5c01\u88c5\u4e3a\u96a7\u9053\u534f\u8bae\uff0c\u901a\u8fc7\u672c\u673a\u7684\u771f\u5b9e\u7684\u7269\u7406\u7f51\u5361\u53d1\u51fa\u3002</p> <ul> <li>\u67e5\u770b\u672c\u673a\u7684\u63a5\u53e3</li> </ul> <pre><code>1: lo:                       # \u672c\u5730\u56de\u73af\n2: ens33:                    # \u4e3b\u673a\u7269\u7406\u7f51\u5361\n3: docker0:                  # docker \u9ed8\u8ba4\u7684\u6865\u63a5\u7f51\u7edc\uff0c\u5728 k8s \u4e2d\u65e0\u7528\u53ef\u4ee5\u5220\u9664\n4: dummy0:                   # \n5: kube-ipvs0:               # \n6: flannel.1:                # flannel \u865a\u62df\u7f51\u5361\uff0c\u5c01\u88c5\u96a7\u9053\u62a5\u6587\n7: cni0:                     # \u6240\u6709\u5bb9\u5668\u5904\u4e8e\u8fd9\u4e2a\u7f51\u6865\n8: veth0c014b8b@if3:         # \u5bb9\u5668\u7684\u7f51\u5361\u8fde\u63a5\u5230 cni0\n9: veth97c048e5@if3:         # \u5bb9\u5668\u7684\u7f51\u5361\u8fde\u63a5\u5230 cni0\n11: vethd2f0bf2b@if3:        # \u5bb9\u5668\u7684\u7f51\u5361\u8fde\u63a5\u5230 cni0\n12: veth648a500f@if3:        # \u5bb9\u5668\u7684\u7f51\u5361\u8fde\u63a5\u5230 cni0\n</code></pre> <ul> <li>\u4e0b\u8f7d bridge-utils \u5305\u4f7f\u7528\u547d\u4ee4 brctl show cni0 \u67e5\u770b cni0 \u63a5\u53e3</li> </ul> <pre><code>bridge    name    bridge id           STP    enabled    interfaces\ncni0              8000.9a6ec95f8285   no                veth0c014b8b\n                                                        veth648a500f\n                                                        veth7a3f56b7\n                                                        veth97c048e5\n                                                        vethd2f0bf2b\n</code></pre>"},{"location":"k8s/note/chapter-16/#165-flannel","title":"16.5 flannel","text":"<p>flannel \u662f\u4e00\u4e2a\u4e13\u4e3a kubernetes \u5b9a\u5236\u7684\u4e09\u5c42\u7f51\u7edc\u89e3\u51b3\u65b9\u6848\uff0c\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u5bb9\u5668\u7684\u8de8\u4e3b\u673a\u901a\u4fe1\u95ee\u9898\u3002</p>"},{"location":"k8s/note/chapter-16/#1651-flannel","title":"16.5.1 flannel \u5de5\u4f5c\u6a21\u5f0f","text":"<ul> <li>flannel.1 \u8fd9\u4e2a\u865a\u62df\u7f51\u5361\u652f\u6301\u591a\u79cd\u4f20\u8f93\u6a21\u5f0f\uff1aVxLAN\u3001host-gw\u3001Directrouting\u3001udp </li> </ul> \u6a21\u5f0f \u4ecb\u7ecd VXLAN \u4f7f\u7528 VxLAN \u4f5c\u4e3a\u96a7\u9053\u5c01\u88c5\u62a5\u6587 host-gw \u4e0d\u4f7f\u7528\u53e0\u52a0\u7f51\u7edc\uff0c\u800c\u662f\u5728\u4e3b\u673a\u7684\u8def\u7531\u8868\u4e2d\u521b\u5efa\u5230\u5176\u4ed6\u4e3b\u673a subnet \u7684\u8def\u7531\u6761\u76ee\uff0c\u6027\u80fd\u8f83\u597d\uff0c\u7f3a\u9677\u662f\uff1a\u6240\u6709 node \u8282\u70b9\u5fc5\u987b\u5904\u4e8e\u540c\u4e00\u4e2a\u4e8c\u5c42\u7f51\u7edc\u4e2d\u3002 DirectRouting \u5f53\u4e3b\u673a\u4f4d\u4e8e\u540c\u4e00\u5b50\u7f51\u65f6\u542f\u7528\u76f4\u63a5\u8def\u7531\uff0c\u4e0d\u5728\u56de\u9000\u5230 VxLAN\u3002 UDP \u76f4\u63a5\u4f7f\u7528 UDP \u534f\u8bae\uff0c\u6027\u80fd\u5dee"},{"location":"k8s/note/chapter-16/#1652-vxlan","title":"16.5.2 VXLAN \u901a\u4fe1\u8fc7\u7a0b","text":"<p>Flannel VXLAN \u5b9e\u8d28\u4e0a\u662f\u4e00\u79cd \u201c\u8986\u76d6\u7f51\u7edc(overlay network)\u201d \uff0c\u4e5f\u5c31\u662f\u5c06TCP\u6570\u636e\u5305\u88c5\u5728\u53e6\u4e00\u79cd\u7f51\u7edc\u5305\u91cc\u9762\u8fdb\u884c\u8def\u7531\u8f6c\u53d1\u548c\u901a\u4fe1\uff0c\u76ee\u524d\u5df2\u7ecf\u652f\u6301UDP\u3001VxLAN\u3001AWS VPC\u548cGCE\u8def\u7531\u7b49\u6570\u636e\u8f6c\u53d1\u65b9\u5f0f\u3002</p> <ul> <li>flannel VXLAN \u901a\u4fe1\u8fc7\u7a0b</li> </ul> <p>\u5728 K8S \u4e0a POD \u4e0e POD \u662f\u76f4\u63a5\u901a\u8fc7\u5bf9\u65b9\u7684 IP \u5730\u5740\u8fdb\u884c\u901a\u4fe1\u7684\uff0cPOD \u53d1\u51fa\u7684\u62a5\u6587\u7ecf\u8fc7 cni0 \u7f51\u6865\u5230\u8fbe flannel \uff0cflannel \u5c06\u62a5\u6587\u5c01\u88c5\u4e0a\u4e00\u5c42 VxLAN \u7684\u9996\u90e8\uff0c\u5916\u5c42\u53c8\u88ab\u5c01\u88c5\u4e00\u5c42 UDP \u534f\u8bae\u7684\u9996\u90e8\uff0c\u53d1\u9001\u7ed9\u672c\u673a\u7269\u7406\u7f51\u5361\uff0c\u672c\u673a\u7269\u7406\u7f51\u5361\u53c8\u5c06 flannel \u53d1\u8fc7\u6765\u7684\u62a5\u6587\u5916\u5c42\u5c01\u88c5\u4e0a IP \u9996\u90e8\u548c\u4ee5\u592a\u7f51\u5e27\u9996\u90e8\uff08MAC\uff09\u7531\u7f51\u5361\u53d1\u51fa\uff0c\u53e6\u5916\u4e00\u4e2a node \u8282\u70b9\u6536\u5230\u62a5\u6587\uff0c\u5185\u6838\u53d1\u73b0\u662f\u4e00\u4e2a VxLAN \u7684\u5305\uff0c\u62c6\u6389 IP \u9996\u90e8\u9001\u7ed9 flannel \u5e94\u7528\u7a0b\u5e8f\uff0cflannel \u62c6\u6389 VxLAN \u9996\u90e8\u5e76\u5c06\u5185\u90e8\u7684\u6570\u636e\u53d1\u9001\u7ed9\uff0ccni0 \u7f51\u6865\uff0ccni0 \u6536\u5230\u540e\u8f6c\u53d1\u7ed9 POD\u3002</p> <pre><code>|                                               |                                   |\n|&lt;------------------ VxLAN\u5c01\u88c5 -----------------&gt;|&lt;----------- \u539f\u59cb\u62a5\u6587 -------------&gt;|\n+-----------+-----------+-----------+-----------+-----------+-----------+-----------+\n|  node \u7f51\u7edc |  node\u7f51\u7edc  | node \u7f51\u7edc |  VxLan    |   POD MAC |  POD IP   |    data   |\n|  \u5e27\u9996\u90e8MAC |   IP\u9996\u90e8   | UDP \u9996\u90e8  |   \u9996\u90e8     |    \u9996\u90e8    |   \u9996\u90e8    |  Payload  |\n+-----------+-----------+-----------+-----------+-----------+-----------+-----------+\n</code></pre>"},{"location":"k8s/note/chapter-16/#1653-flannel","title":"16.5.3 flannel \u90e8\u7f72\u65b9\u5f0f","text":"<ol> <li>\u5728 k8s \u96c6\u7fa4\u542f\u52a8\u524d\uff0cflannel \u76f4\u63a5\u90e8\u7f72\u5230\u8282\u70b9\u4e0a\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\u8fd0\u884c\u3002</li> </ol> <pre><code>\u4efb\u4f55\u4e00\u4e2a\u90e8\u7f72\u4e86 kubelet \u7684\u8282\u70b9\u90fd\u5e94\u8be5\u90e8\u7f72 flannel \uff0c\u56e0\u4e3a kubelet \u8981\u501f\u52a9 flannel \u4e3a POD \u8bbe\u7f6e\u7f51\u7edc\u63a5\u53e3\n</code></pre> <ol> <li>\u4f7f\u7528 kube-admin \u76f4\u63a5\u5c06 k8s \u81ea\u5df1\u7684\u7ec4\u4ef6\u5305\u62ec flannel \u8fd0\u884c\u5728 k8s \u4e4b\u4e0a\u7684\u9759\u6001 POD\u3002</li> </ol> <pre><code>\u5fc5\u987b\u914d\u7f6e\u4e3a\u5171\u4eab node \u8282\u70b9\u7f51\u7edc\u540d\u79f0\u7a7a\u95f4\u7684 POD\uff0c\u6240\u4ee5 flannel POD \u63a7\u5236\u5668\u4e3a DaemonSet\u3002\n</code></pre>"},{"location":"k8s/note/chapter-16/#1654flannel","title":"16.5.4flannel \u914d\u7f6e\u6587\u4ef6","text":"<ul> <li>\u914d\u7f6e\u6587\u4ef6\u9009\u9879\u542b\u4e49</li> </ul> <pre><code>{\n    \"Network\": \"10.244.0.0/16\",     // flannel \u4f7f\u7528\u7684 CIDR \u683c\u5f0f\u7684\u7f51\u7edc\u5730\u5740\uff0c\u7528\u4e8e\u4e3a POD \u914d\u7f6e\u7f51\u7edc\u529f\u80fd\n    \"SubnetLen\": 24,                // \u628a Network \u5207\u5206\u4e3a\u5b50\u7f51\u4f9b\u5404 node \u8282\u70b9\u4f7f\u7528\u65f6\uff0c\u4f7f\u7528\u591a\u957f\u7684\u63a9\u7801\u5207\u5206\uff0c\u9ed8\u8ba4\u4e3a 24\n    \"SubnetMin\": \"10.244.10.0/24\",  // \u7528\u4e8e\u5206\u914d\u7ed9 node \u7684\u5b50\u7f51\u8d77\u59cb\u5730\u5740\uff0c\u4ece\u8fd9\u4e2a\u7f51\u7edc\u5f00\u59cb\u5206\u914d\u7f51\u7edc\n    \"SubnetMax\": \"10.244.255.0/24\"  // \u7528\u4e8e\u5206\u914d\u7ed9 nide \u7684\u5b50\u7f51\u7ed3\u675f\u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u662f\u6700\u5927\u5206\u914d\u7684\u7f51\u8def  \n    \"Backend\": {                    // \u6307\u660e POD \u4e0e POD \u8de8\u8282\u70b9\u901a\u4fe1\u65f6\u5019\u4f7f\u7528\u7684 flannel \u5de5\u4f5c\u6a21\u5f0f\n        \"Type\": \"vxlan\",            // \u5de5\u4f5c\u6a21\u5f0f\n        \"Directrouting\": true       // \u662f\u5426\u4f7f\u7528\u76f4\u63a5\u8def\u7531\u6a21\u5f0f\n    }\n}\n</code></pre> <ul> <li>flannel \u6258\u7ba1\u5230 k8s \u4e0a\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5904\u4e8e kube-flannel-cfg \u8fd9\u4e2a configmap \u4e2d\u3002</li> </ul> <pre><code>kubectl get configmap kube-flannel-cfg -n kube-system -o json\n</code></pre>"},{"location":"k8s/note/chapter-16/#1655","title":"16.5.5 \u4fee\u6539\u5de5\u4f5c\u6a21\u5f0f","text":"<ul> <li>\u4fee\u6539 flannel \u5de5\u4f5c\u6a21\u5f0f\uff0c\u6dfb\u52a0 Directrouting\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u5e94\u8be5\u5728\u521a\u521a\u90e8\u7f72\u5b8c k8s \u96c6\u7fa4\u65f6\u5019\u4fee\u6539\uff0c\u63a8\u8350\u4fee\u6539</li> </ul> <pre><code>kubectl edit configmap kube-flannel-cfg -n kube-system\n</code></pre> <pre><code>\"Backend\": {\n    \"Type\": \"vxlan\",\n    \"Directrouting\": true\n}\n</code></pre> <ul> <li>\u67e5\u770b\u672c\u673a\u8def\u7531\u8868</li> </ul> <pre><code>ip route show\n</code></pre> <pre><code>default via 172.16.100.254 dev ens33 proto static metric 100 \n10.244.1.0/24 via 10.244.1.0 dev ens33             # \u5fc5\u987b\u4e3a dev \u7269\u7406\u7f51\u5361\u63a5\u53e3\uff0c\u5426\u5219 Directrouting \u6ca1\u6709\u8bbe\u7f6e\u6210\u529f\n10.244.2.0/24 via 10.244.2.0 dev ens33             # \u5fc5\u987b\u4e3a dev \u7269\u7406\u7f51\u5361\u63a5\u53e3\uff0c\u5426\u5219 Directrouting \u6ca1\u6709\u8bbe\u7f6e\u6210\u529f\n172.16.100.0/24 dev ens33 proto kernel scope link src 172.16.100.101 metric 100 \n172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 \n</code></pre>"},{"location":"k8s/note/chapter-16/#166-calico","title":"16.6 Calico","text":"<p>Calico \u521b\u5efa\u548c\u7ba1\u7406\u2f00\u4e2a\u6241\u5e73\u7684\u4e09\u5c42\u7f51\u7edc(\u4e0d\u9700\u8981 overlay)\uff0c\u6bcf\u4e2a\u5bb9\u5668\u4f1a\u5206\u914d\u4e00\u4e2a\u53ef\u8def\u7531\u7684 ip\u3002\u7531\u4e8e\u901a\u4fe1\u65f6\u4e0d\u9700\u8981\u89e3\u5305\u548c\u5c01\u5305\uff0c\u7f51\u7edc\u6027\u80fd\u635f\u8017\u5c0f\uff0c\u6613\u4e8e\u6392\u67e5\uff0c\u4e14\u6613\u4e8e\u6c34\u5e73\u6269\u5c55\u3002</p> <p>\u5c0f\u89c4\u6a21\u90e8\u7f72\u65f6\u53ef\u4ee5\u901a\u8fc7 bgp client \u76f4\u63a5\u4e92\u8054\uff0c\u5927\u89c4\u6a21\u4e0b\u53ef\u901a\u8fc7\u6307\u5b9a\u7684 BGP route reflector \u6765\u5b8c\u6210\uff0c\u8fd9\u6837\u4fdd\u8bc1\u6240\u6709\u7684\u6570\u636e\u6d41\u91cf\u90fd\u662f\u901a\u8fc7 IP \u8def\u7531\u7684\u65b9\u5f0f\u5b8c\u6210\u4e92\u8054\u7684\u3002 </p> <p>Calico \u57fa\u4e8e iptables \u8fd8\u63d0\u4f9b\u4e86\u4e30\u5bcc\u800c\u7075\u6d3b\u7684\u7f51\u7edc Policy\uff0c\u4fdd\u8bc1\u901a\u8fc7\u5404\u4e2a\u8282\u70b9\u4e0a\u7684 ACLs \u6765\u63d0\u4f9b Workload \u7684\u591a\u79df\u6237\u9694\u79bb\u3001\u5b89\u5168\u7ec4\u4ee5\u53ca\u5176\u4ed6\u53ef\u8fbe\u6027\u9650\u5236\u7b49\u529f\u80fd\u3002</p> <p>\u6709\u4e2a\u65b0\u7684\u9879\u76ee\uff1acanel\uff0c\u5b83\u96c6\u5408\u4e86 flannel \u548c calico \u7684\u4f18\u70b9\u3002</p> <ul> <li>\u6ce8\u610f</li> </ul> <p>Calico \u76ee\u524d\u4e0d\u652f\u6301\u5de5\u4f5c\u5728 iptables \u4e0b\u7684 kube-proxy\uff0c\u4e0b\u9762\u4ecb\u7ecd canal \u7f51\u7edc\u7b56\u7565\u7684\u4f7f\u7528</p>"},{"location":"k8s/note/chapter-16/#1661-canal","title":"16.6.1 \u5b89\u88c5 canal","text":"<ul> <li>\u4e0b\u8f7d\u6e05\u5355\u6587\u4ef6\uff0c\u9700\u8981\u7ffb\u5899</li> </ul> <pre><code>kubectl apply -f https://docs.projectcalico.org/v3.6/getting-started/kubernetes/installation/hosted/canal/canal.yaml\n</code></pre>"},{"location":"k8s/note/chapter-16/#1662","title":"16.6.2 \u6e05\u5355\u5b9a\u4e49","text":"<ul> <li>\u6e05\u5355\u683c\u5f0f\uff0c\u8be6\u89c1\uff1akubectl explain networkpolicy</li> </ul> <pre><code>egress                  &lt;[]Object&gt;    # \u51fa\u7ad9\u89c4\u5219\u7684\u5bf9\u8c61\u5217\u8868\n  ports                 &lt;[]Object&gt;    # \u76ee\u6807\u7aef\u53e3\u7684\u5bf9\u8c61\u5217\u8868\n    port                &lt;string&gt;      # \u6570\u5b57\u5f62\u5f0f\u6216\u8005\u662f\u547d\u540d\u7684\u7aef\u53e3\n    protocol                          # \u534f\u8bae TCP\u3001UDP\n  to                    &lt;[]Object&gt;    # \u76ee\u6807\u5730\u5740\u5bf9\u8c61\u5217\u8868\n    ipBlock             &lt;Object&gt;      # \u4e00\u7ec4 IP \u5730\u5740\n      cidr              &lt;string&gt;      # CIDR \u8868\u793a\u7684 IP \u8303\u56f4\n      except            &lt;[]string&gt;    # \u6392\u9664 CIDR \u4e2d\u7684\u67d0\u4e9b\u5730\u5740\n    namespaceSelector   &lt;Object&gt;      # \u540d\u79f0\u7a7a\u95f4\u9009\u62e9\u5668\n    podSelector         &lt;Object&gt;      # POD \u9009\u62e9\u5668\uff0c\u76ee\u6807\u5730\u5740\u53ef\u4ee5\u4e5f\u662f\u4e00\u7ec4 POD\ningress                 &lt;[]Object&gt;    # \u5165\u7ad9\u89c4\u5219\u7684\u5bf9\u8c61\u5217\u8868\n  from                  &lt;[]Object&gt;    # \u6e90\u5730\u5740\u5bf9\u8c61\u5217\u8868\n    ipBlock             &lt;Object&gt;      # \u4e00\u7ec4 IP \u5730\u5740\n      cidr              &lt;string&gt;      # CIDR \u8868\u793a\u7684 IP \u8303\u56f4\n      except            &lt;[]string&gt;    # \u6392\u9664 CIDR \u4e2d\u7684\u67d0\u4e9b\u5730\u5740\n    namespaceSelector   &lt;Object&gt;      # \u540d\u79f0\u7a7a\u95f4\u9009\u62e9\u5668\n    podSelector         &lt;Object&gt;      # POD \u9009\u62e9\u5668\uff0c\u6e90\u5730\u5740\u4e5f\u53ef\u4ee5\u662f\u4e00\u7ec4 POD\n  ports                 &lt;[]Object&gt;    # POD \u81ea\u5df1\u7684\u7aef\u53e3\uff0c\u8868\u793a\u63a7\u5236\u81ea\u5df1\u7684\u7aef\u53e3\u662f\u5426\u53ef\u4ee5\u88ab\u8bbf\u95ee\uff0c\u7684\u5bf9\u8c61\u5217\u8868\n    port                              # \u6570\u5b57\u5f62\u5f0f\u6216\u8005\u662f\u547d\u540d\u7684\u7aef\u53e3\n    protocol                          # \u534f\u8bae TCP\u3001UDP\npodSelector             &lt;Object&gt;      # POD \u9009\u62e9\u5668\u51b3\u5b9a\u89c4\u5219\u5e94\u7528\u5728\u54ea\u4e9b POD \u4e0a\npolicyTypes             &lt;[]string&gt;    # \u53ef\u4ee5\u662f \"Ingress\", \"Egress\", \u6216\u8005 \"Ingress,Egress\" \uff0c\u8868\u793a\u653e\u884c\u6ee1\u8db3\u8fd9\u4e9b\u89c4\u5219\u8bbf\u95ee\n</code></pre>"},{"location":"k8s/note/chapter-16/#1663-policytypes","title":"16.6.3 policyTypes","text":"<ul> <li>\u9996\u5148\u5b9a\u4e49 \u540d\u79f0\u7a7a\u95f4</li> </ul> <pre><code>kubectl create namespace dev\nkubectl create namespace prod\n</code></pre> <ul> <li>\u5728\u4e24\u4e2a\u547d\u540d\u7a7a\u95f4\u5206\u522b\u521b\u5efa\u4e00\u4e2a POD</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod1\n  namespace: dev\n  labels:\n    app: myapp\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod1\n  namespace: prod\n  labels:\n    app: myapp\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n</code></pre> <pre><code>kubectl apply -f pod-a.yaml -n dev\n</code></pre> <ul> <li>\u62d2\u7edd\u6240\u6709 dev \u7a7a\u95f4\u7684\u62a5\u6587</li> </ul> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: deny-all-ingress\n  namespace: dev\nspec:\n  podSelector: {}            # {} \u7a7a\u7684\u9009\u62e9\u5668\u8868\u793a\u9009\u62e9\u5168\u90e8\n  policyTypes:\n  - Ingress                  # \u6307\u660e Ingress \u89c4\u5219\u751f\u6548\uff0c\u5339\u914d Ingress \u5c06\u88ab\u653e\u884c\uff0c\u5982\u679c\u6ca1\u5b9a\u4e49 Ingress \u5219\u4e0d\u80fd\u5339\u914d\u6240\u6709\uff0c\u4f1a\u62d2\u7edd\u5168\u90e8\n                             # policyTypes \u6ca1\u6709 Egress \u8868\u793a\u4e0d\u63a7\u5236 Egress \uff0c\u9ed8\u8ba4\u4e3a\u5141\u8bb8\n</code></pre> <ul> <li>\u5728\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\u5e94\u7528\u89c4\u5219\u6587\u4ef6</li> </ul> <pre><code>kubectl apply -f deny-all-ingress.yaml -n dev\n</code></pre> <ul> <li>\u67e5\u770b\u89c4\u5219</li> </ul> <pre><code>kubectl get networkpolicy -n dev\n</code></pre> <ul> <li>\u67e5\u770b dev \u7a7a\u95f4\u4e2d\u7684 POD \u5730\u5740\u5e76\u8bbf\u95ee\uff0c\u7ed3\u679c\u662f\u4e0d\u80fd\u8bbf\u95ee\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u62d2\u7edd\u5916\u90e8\u8bbf\u95ee</li> </ul> <pre><code>kubectl get pods -n dev -o wide\n</code></pre> <pre><code>curl 10.244.1.2\n</code></pre> <ul> <li>\u67e5\u770b prod \u7a7a\u95f4\u4e2d\u7684 POD \u5730\u5740\u5e76\u8bbf\u95ee\uff0c\u7ed3\u679c\u53ef\u4ee5\u8bbf\u95ee\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u6ca1\u6709\u5b9a\u4e49\u89c4\u5219</li> </ul> <pre><code>kubectl get pods -n dev -o wide\n</code></pre> <pre><code>curl 10.244.2.2\n</code></pre> <ul> <li>\u5141\u8bb8\u6307\u5b9a\u7f51\u6bb5\u7684 POD \u8bbf\u95ee\u672c POD \u7684 80 \u7aef\u53e3</li> </ul> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-80-ingress\n  namespace: dev\nspec:\n  podSelector:\n    matchLabels:\n      app: myapp\n  ingress:\n  - from:\n    - ipBlock:                   # \u6307\u5b9a\u6e90\u5730\u5740\u4e3a IP \u5730\u5740\u5757 \n        cidr: 10.244.0.0/16    # \u63a9\u7801\u5f62\u5f0f\u6307\u51fa\u6e90\u5730\u5740 IP \u5730\u5740\u8303\u56f4\n        except:                  # \u6392\u9664 cidr \u8303\u56f4\u5185\u7684\u67d0\u4e2a\u5730\u5740\n        - 10.244.1.2/32\n    ports:\n    - port: 80                   # \u5165\u6808\u4e14\u76ee\u6807\u7aef\u53e3\u4e3a 80 \u7684\u5219\u5339\u914d\n      protocol: TCP\n    - port: 443\n      protocol: TCP\n  policyTypes:\n  - Ingress                  # \u6307\u660e Ingress \u89c4\u5219\u751f\u6548\uff0c\u5339\u914d Ingress \u5c06\u88ab\u653e\u884c\uff0c\u5982\u679c\u6ca1\u5b9a\u4e49 Ingress \u5219\u4e0d\u80fd\u5339\u914d\u6240\u6709\uff0c\u62d2\u7edd\u5168\u90e8\n                             # policyTypes \u6ca1\u6709 Egress \u8868\u793a\u4e0d\u63a7\u5236 Egress \uff0c\u9ed8\u8ba4\u4e3a\u5141\u8bb8\n</code></pre> <ul> <li>\u67e5\u770b\u89c4\u5219</li> </ul> <pre><code>kubectl get networkpolicy -n dev\n</code></pre> <ul> <li>\u62d2\u7edd\u51fa\u6808\u7684\u6240\u6709\u8bf7\u6c42</li> </ul> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: deny-all-egress\n  namespace: prod\nspec:\n  podSelector: {}            # {} \u7a7a\u7684\u9009\u62e9\u5668\u8868\u793a\u9009\u62e9\u5168\u90e8\n  policyTypes:\n  - Egress                   # \u6307\u660e Egress \u89c4\u5219\u751f\u6548\uff0c\u5339\u914d Egress \u5c06\u88ab\u653e\u884c\uff0c\u5982\u679c\u6ca1\u5b9a\u4e49 Egress \u5219\u4e0d\u80fd\u5339\u914d\u6240\u6709\uff0c\u62d2\u7edd\u5168\u90e8\n                             # policyTypes \u6ca1\u6709 Ingress \u8868\u793a\u4e0d\u63a7\u5236 Egress \uff0c\u9ed8\u8ba4\u4e3a\u5141\u8bb8\n</code></pre>"},{"location":"k8s/note/chapter-17/","title":"\u5341\u4e03 \u8c03\u5ea6\u7b56\u7565","text":"<p>Master \u4e3b\u8981\u662f\u8fd0\u884c\u96c6\u7fa4\u7684\u63a7\u5236\u5e73\u9762\u7ec4\u4ef6\u7684\uff0capiserver\u3001scheduler\u3001controlermanager\uff0cMaster \u8fd8\u4f9d\u8d56\u4e0e etcd \u8fd9\u6837\u7684\u5b58\u50a8\u8282\u70b9\u3002</p> <p>kubeadm \u90e8\u7f72\u7684\u96c6\u7fa4\u4f1a\u5c06 Master \u7684\u63a7\u5236\u7ec4\u4ef6\u90fd\u8fd0\u884c\u4e3a\u9759\u6001 POD \u4e86\uff0c\u4ece\u672c\u8d28\u6765\u8bb2\uff0c\u8fd9\u4e9b\u7ec4\u4ef6\u5c31\u662f\u8fd0\u884c\u5728 Master \u8282\u70b9\u4e13\u4e3a\u96c6\u7fa4\u63d0\u4f9b\u670d\u52a1\u7684\u8fdb\u7a0b\uff0cMaster \u662f\u4e0d\u8d1f\u8d23\u8fd0\u884c\u5de5\u4f5c\u8d1f\u8f7d\u7684\u3002</p> <p>node \u8282\u70b9\u662f\u8d1f\u8d23\u8fd0\u884c\u5de5\u4f5c\u8d1f\u8f7d POD \u7684\u76f8\u5173\u8282\u70b9\uff0c\u7528\u6237\u53ea\u9700\u8981\u5c06\u8fd0\u884c\u4efb\u52a1\u63d0\u4ea4\u7ed9 Master \u5c31\u53ef\u4ee5\u4e86\uff0c\u7528\u6237\u65e0\u9700\u5173\u5fc3\u8fd0\u884c\u5728\u54ea\u4e2a node \u8282\u70b9\u4e0a\uff0cMaster \u6574\u5408\u4e86\u6240\u6709 node \u4e3a\u4e00\u4e2a\u865a\u62df\u7684\u8d44\u6e90\u6c60\u3002</p>"},{"location":"k8s/note/chapter-17/#171-pod","title":"17.1 POD\u521b\u5efa\u6d41\u7a0b","text":"<p>\u7528\u6237\u521b\u5efa\u7684\u4efb\u52a1\u6700\u7ec8\u5e94\u8be5\u8fd0\u884c\u5728\u54ea\u4e2a node \u8282\u70b9\u4e0a\uff0c\u662f\u7531 Master \u8282\u70b9\u4e0a\u7684 scheduler \u51b3\u5b9a\u7684\uff0c\u800c scheduler \u4e5f\u662f\u5141\u8bb8\u7528\u6237\u5b9a\u4e49\u5b83\u7684\u5de5\u4f5c\u7279\u6027\u7684\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u6ca1\u6709\u5b9a\u4e49\u5b83\uff0c\u5176\u5b9e\u662f\u4f7f\u7528\u7684\u9ed8\u8ba4\u7684 scheduler \u8c03\u5ea6\u5668\u3002</p> <p>\u5f53\u6211\u4eec\u4f7f\u7528 kubectl describe pods myapp \u67e5\u770b POD \u4fe1\u606f\u65f6\u5019\uff0c\u4f1a\u6709\u4e00\u4e2a Events \u5b57\u6bb5\u4e2d\uff0c\u6709\u5173\u4e8e\u8c03\u5ea6\u7ed3\u679c\u7684\u76f8\u5173\u4fe1\u606f\u3002</p> <p>Scheduler \u4f1a\u4ece\u4f17\u591a\u7684 node \u8282\u70b9\u4e2d\u6311\u9009\u51fa\u7b26\u5408 POD \u8fd0\u884c\u8981\u6c42\u7684\u8282\u70b9\uff0c\u7136\u540e\u5c06\u9009\u5b9a\u7684 node \u8282\u70b9\u4fe1\u606f\u8bb0\u5f55\u5728 etcd \u4e2d\uff0ckubelet \u59cb\u7ec8 waitch \u7740 apiserver \u4e0a\u7684\u5173\u4e8e\u672c\u8282\u70b9\u7684\u4fe1\u606f\u53d8\u5316\uff0ckubelet \u5c31\u4f1a\u53bb apiserver \u83b7\u53d6\u5173\u4e8e\u53d8\u5316\u4fe1\u606f\u7684\u914d\u7f6e\u6e05\u5355\uff0c\u6839\u636e\u914d\u7f6e\u6e05\u5355\u7684\u5b9a\u4e49\u53bb\u521b\u5efa POD\u3002</p>"},{"location":"k8s/note/chapter-17/#172-service","title":"17.2 Service\u521b\u5efa\u8fc7\u7a0b","text":"<p>\u5f53\u7528\u6237\u521b\u5efa\u4e00\u4e2a service \u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u4f1a\u63d0\u4ea4\u7ed9 apiserver\uff0capiserver \u5c06\u6e05\u5355\u6587\u4ef6\u5199\u5165 etcd \u4e2d\uff0c\u7136\u540e\u6bcf\u4e2a node \u8282\u70b9\u4e0a\u7684 kube-proxy \u4f1a waitch apiserver \u5173\u4e8e service \u8d44\u6e90\u7684\u76f8\u5173\u53d8\u52a8\uff0c\u53d1\u751f\u53d8\u5316\u65f6\u5019\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684 kube-proxy \u4f1a\u5c06 service \u521b\u5efa\u4e3a iptables/ipvs \u89c4\u5219\u3002</p> <p>\u4ece\u901a\u4fe1\u89d2\u5ea6\u6765\u8bb2\uff1akubectl\u3001kubelet\u3001kube-proxy \u90fd\u662f apiserver \u7684\u5ba2\u6237\u7aef\uff0c\u8fd9\u4e9b\u7ec4\u4ef6\u4e0e apiserver \u8fdb\u884c\u4ea4\u4e92\u65f6\u5019\uff0c\u6570\u636e\u683c\u5f0f\u4e3a json\uff0c\u5185\u90e8\u7684\u6570\u636e\u5e8f\u5217\u5316\u65b9\u5f0f\u4e3a protocolbuff\u3002</p>"},{"location":"k8s/note/chapter-17/#173","title":"17.3 \u8d44\u6e90\u9650\u5236\u7ef4\u5ea6","text":"<ol> <li>\u8d44\u6e90\u9700\u6c42\uff1a\u8fd0\u884c POD \u9700\u8981\u7684\u6700\u4f4e\u8d44\u6e90\u9700\u6c42</li> <li>\u8d44\u6e90\u9650\u5236\uff1aPOD \u53ef\u4ee5\u5360\u7528\u7684\u6700\u9ad8\u8d44\u6e90\u9650\u989d</li> </ol>"},{"location":"k8s/note/chapter-17/#174-scheduler","title":"17.4 Scheduler \u8c03\u5ea6\u8fc7\u7a0b","text":"<ol> <li>\u9884\u9009\u9636\u6bb5\uff1a\u6392\u9664\u5b8c\u5168\u4e0d\u7b26\u5408\u8fd0\u884c\u8fd9\u4e2a POD \u7684\u8282\u70b9\u3001\u4f8b\u5982\u8d44\u6e90\u6700\u4f4e\u8981\u6c42\u3001\u8d44\u6e90\u6700\u9ad8\u9650\u989d\u3001\u7aef\u53e3\u662f\u5426\u88ab\u5360\u7528</li> <li>\u4f18\u9009\u9636\u6bb5\uff1a\u57fa\u4e8e\u4e00\u7cfb\u5217\u7684\u7b97\u6cd5\u51fd\u6570\u8ba1\u7b97\u51fa\u6bcf\u4e2a\u8282\u70b9\u7684\u4f18\u5148\u7ea7\uff0c\u6309\u7167\u4f18\u5148\u7ea7\u6392\u5e8f\uff0c\u53d6\u5f97\u5206\u6700\u9ad8\u7684 node</li> <li> <p>\u9009\u4e2d\u9636\u6bb5\uff1a\u5982\u679c\u4f18\u9009\u9636\u6bb5\u4ea7\u751f\u591a\u4e2a\u7ed3\u679c\uff0c\u90a3\u4e48\u968f\u673a\u6311\u9009\u4e00\u4e2a\u8282\u70b9</p> </li> <li> <p>POD \u4e2d\u5f71\u54cd\u8c03\u5ea6\u7684\u5b57\u6bb5\uff0c\u5728 kubectl explain pods.spec \u4e2d</p> </li> </ol> <pre><code>nodeName          # \u76f4\u63a5\u6307\u5b9a POD \u7684\u8fd0\u884c\u8282\u70b9\nnodeSelector      # \u6839\u636e node \u4e0a\u7684\u6807\u7b7e\u6765\u5bf9 node \u8fdb\u884c\u9884\u9009\uff0c\u8fd9\u5c31\u662f\u8282\u70b9\u7684\u4eb2\u548c\u6027\n</code></pre> <ul> <li>\u5176\u4ed6\u5f71\u54cd\u8c03\u5ea6\u7684\u56e0\u7d20</li> </ul> <p>\u8282\u70b9\u4eb2\u548c\u6027\u8c03\u5ea6\uff1a\u8868\u73b0\u4e3a nodeSelector \u5b57\u6bb5</p> <p>POD \u95f4\u4eb2\u548c\u6027\uff1aPOD \u66f4\u503e\u5411\u548c\u67d0\u4e9b POD \u8fd0\u884c\u5728\u4e00\u8d77\uff0c\u4f8b\u5982\u540c\u4e00\u4e2a\u673a\u623f\u3001\u540c\u4e00\u4e2a\u673a\u5668</p> <p>POD \u95f4\u53cd\u4eb2\u548c\u6027\uff1aPOD \u548c\u67d0 POD \u66f4\u503e\u5411\u4e0d\u80fd\u8fd0\u884c\u5728\u4e00\u8d77\uff0c\u8fd9\u53eb\u53cd\u4eb2\u548c\u6027\uff0c\u4f8b\u5982\uff1a\u76d1\u542c\u540c\u4e00\u4e2a nodeport\uff0c\u6709\u673a\u5bc6\u6570\u636e\u7684</p> <p>Taints\uff08\u6c61\u70b9\uff09\uff1a\u7ed9\u67d0\u4e9b node \u6253\u4e0a\u6c61\u70b9\uff0c</p> <p>Tolerations\uff08\u6c61\u70b9\u5bb9\u5fcd\uff09\uff1a\u4e00\u4e2a POD \u80fd\u591f\u5bb9\u5fcd node \u4e0a\u7684\u6c61\u70b9\uff0c\u5982\u679c\u8fd0\u884c\u8fc7\u7a0b\u4e2d node \u51fa\u73b0\u65b0\u7684\u6c61\u70b9\uff0c\u90a3\u4e48 POD \u53ef\u4ee5</p> <p>\u9a71\u9010POD\uff1anode \u7ed9\u4e00\u4e2a\u9650\u5b9a\u7684\u65f6\u95f4\uff0c\u8ba9 POD \u79bb\u5f00\u8fd9\u4e2a\u8282\u70b9\u3002</p>"},{"location":"k8s/note/chapter-17/#174","title":"17.4 \u9884\u9009\u56e0\u7d20","text":"<p>\u4e0b\u9762\u7684\u9884\u9009\u6761\u4ef6\u9700\u8981\u6ee1\u8db3\u6240\u6709\u7684\u9884\u9009\u6761\u4ef6\u624d\u53ef\u4ee5\u901a\u8fc7\u9884\u9009</p> <ol> <li>CheckNodeConditionPred</li> </ol> <pre><code>\u68c0\u67e5\u8282\u70b9\u662f\u5426\u6b63\u5e38\n</code></pre> <ol> <li>GeneralPredicates</li> </ol> \u5b50\u7b56\u7565 \u4f5c\u7528 HostName \u68c0\u67e5\u4e3b\u673a\u540d\u79f0\u662f\u4e0d\u662f pod.spec.hostname \u6307\u5b9a\u7684 NodeName PodFitsHostPorts \u68c0\u67e5 Pod \u5185\u6bcf\u4e00\u4e2a\u5bb9\u5668 pods.spec.containers.ports.hostPort \u6e05\u5355\u662f\u5426\u5df2\u88ab\u5176\u5b83\u5bb9\u5668\u5360\u7528\uff0c\u5982\u679c\u6709\u6240\u9700\u7684 HostPort \u4e0d\u6ee1\u8db3\u9700\u6c42\uff0c\u90a3\u4e48 Pod \u4e0d\u80fd\u8c03\u5ea6\u5230\u8fd9\u4e2a\u4e3b\u673a\u4e0a MatchNodeSelector \u68c0\u67e5 POD \u5bb9\u5668\u4e0a\u5b9a\u4e49\u4e86 pods.spec.nodeSelector \u67e5\u770b node \u6807\u7b7e\u662f\u5426\u80fd\u591f\u5339\u914d PodFitsResources \u68c0\u67e5 node \u662f\u5426\u6709\u8db3\u591f\u7684\u8d44\u6e90\u8fd0\u884c\u6b64 POD \u7684\u57fa\u672c\u8981\u6c42 <ol> <li>NoDiskConflict\uff08\u9ed8\u8ba4\u6ca1\u6709\u542f\u7528\uff09</li> </ol> <pre><code>\u68c0\u67e5 pod \u5b9a\u4e49\u7684\u5b58\u50a8\u662f\u5426\u5728 node \u8282\u70b9\u4e0a\u4f7f\u7528\u3002\n</code></pre> <ol> <li>PodToleratesNodeTaints</li> </ol> <pre><code>\u68c0\u67e5\u8282\u70b9\u7684\u6c61\u70b9 nodes.spec.taints \u662f\u5426\u662f POD \u6c61\u70b9\u5bb9\u5fcd\u6e05\u5355\u4e2d pods.spec.tolerations \u7684\u5b50\u96c6\n</code></pre> <ol> <li>PodToleratesNodeNoExecuteTaints</li> </ol> <pre><code>\u68c0\u67e5 pod \u662f\u5426\u5bb9\u5fcd\u8282\u70b9\u4e0a\u6709 NoExecute \u6c61\u70b9\u3002NoExecute \u8fd9\u4e2a\u6c61\u70b9\u662f\u5565\u610f\u601d\u5462\u3002\u5982\u679c\u4e00\u4e2a pod \u4e0a\u8fd0\u884c\u5728\u4e00\u4e2a\u6ca1\u6709\u6c61\u70b9\u7684\u8282\u70b9\u4e0a\u540e\uff0c\u8fd9\u4e2a\u8282\u70b9\u53c8\u7ed9\u52a0\u4e0a\u6c61\u70b9\u4e86\uff0c\u90a3\u4e48 NoExecute \u8868\u793a\u8fd9\u4e2a\u65b0\u52a0\u6c61\u70b9\u7684\u8282\u70b9\u4f1a\u9a71\u9010\u5176\u4e0a\u6b63\u5728\u8fd0\u884c\u7684 pod\uff1b\u4e0d\u52a0 NoExecute \u4e0d\u4f1a\u9a71\u9010\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 pod\uff0c\u8868\u793a\u63a5\u53d7\u65e2\u6210\u4e8b\u5b9e\uff0c\u8fd9\u662f\u9ed8\u8ba4\u7b56\u7565\u3002\n</code></pre> <ol> <li>CheckNodeLabelPresence\uff08\u9ed8\u8ba4\u6ca1\u6709\u542f\u7528\uff09</li> </ol> <pre><code>\u68c0\u67e5\u8282\u70b9\u4e0a\u6307\u5b9a\u6807\u7b7e\u7684\u5b58\u5728\u6027\uff0c\u5982\u679c\u8282\u70b9\u6709pod\u6307\u5b9a\u7684\u6807\u7b7e\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8282\u70b9\u5c31\u88ab\u9009\u4e2d\u3002\n</code></pre> <ol> <li>CheckServiceAffinity\uff08\u9ed8\u8ba4\u6ca1\u6709\u542f\u7528\uff09</li> </ol> <pre><code>\u4e00\u4e2a Service \u4e0b\u53ef\u4ee5\u6709\u591a\u4e2a POD\uff0c\u6bd4\u5982\u8fd9\u4e9b POD \u90fd\u8fd0\u884c\u5728 1\u30012\u30013 \u673a\u5668\u4e0a\uff0c\u800c\u6ca1\u6709\u8fd0\u884c\u5728 4\u30015\u30016 \u673a\u5668\u4e0a\uff0c\u90a3\u4e48CheckServiceAffinity \u5c31\u8868\u793a\u65b0\u52a0\u5165\u7684 POD \u90fd\u96c6\u4e2d\u8fd0\u884c\u5728 1\u30012\u30013 \u673a\u5668\u4e0a\uff0c\u8fd9\u6837\u96c6\u4e2d\u597d\u5904\u662f\u4e00\u4e2a Service \u4e0b POD \u4e4b\u95f4\u5185\u90e8\u901a\u4fe1\u7684\u6548\u7387\u53d8\u9ad8\u4e86\u3002 \n</code></pre> <ol> <li>MaxEBSVolumeCount</li> </ol> <pre><code>\u786e\u4fdd\u5df2\u6302\u8f7d\u7684\u4e9a\u9a6c\u900a EBS \u5b58\u50a8\u5377\u4e0d\u8d85\u8fc7\u8bbe\u7f6e\u7684\u6700\u5927\u503c\uff0c\u9ed8\u8ba439\n</code></pre> <ol> <li>MaxGCEPDVolumeCount</li> </ol> <pre><code>\u786e\u4fdd\u5df2\u6302\u8f7d\u7684GCE\u5b58\u50a8\u5377\u4e0d\u8d85\u8fc7\u8bbe\u7f6e\u7684\u6700\u5927\u503c\uff0c\u9ed8\u8ba416\n</code></pre> <p>10 MaxAzureDiskVolumeCount</p> <pre><code>\u786e\u4fdd\u5df2\u6302\u8f7d\u7684Azure\u5b58\u50a8\u5377\u4e0d\u8d85\u8fc7\u8bbe\u7f6e\u7684\u6700\u5927\u503c\uff0c\u9ed8\u8ba416\n</code></pre> <ol> <li>CheckVolumeBinding</li> </ol> <pre><code>\u68c0\u67e5\u8282\u70b9\u4e0a\u7684 PVC \u662f\u5426\u88ab\u522b\u7684 POD \u7ed1\u5b9a\u4e86 \n</code></pre> <ol> <li>NoVolumeZoneConflict</li> </ol> <pre><code>\u68c0\u67e5\u7ed9\u5b9a\u7684 zone (\u673a\u623f) \u9650\u5236\u524d\u63d0\u4e0b\uff0c\u68c0\u67e5\u5982\u679c\u5728\u6b64\u4e3b\u673a\u4e0a\u90e8\u7f72 POD \u662f\u5426\u5b58\u5728\u5377\u51b2\u7a81\n</code></pre> <ol> <li>CheckNodeMemoryPressure</li> </ol> <pre><code>\u68c0\u67e5 node \u8282\u70b9\u4e0a\u5185\u5b58\u662f\u5426\u5b58\u5728\u538b\u529b\n</code></pre> <ol> <li>CheckNodeDiskPressure</li> </ol> <pre><code>\u68c0\u67e5\u78c1\u76d8 IO \u662f\u5426\u538b\u529b\u8fc7\u5927\n</code></pre> <ol> <li>CheckNodePIDPressure</li> </ol> <pre><code>\u68c0\u67e5 node \u8282\u70b9\u4e0a PID \u8d44\u6e90\u662f\u5426\u5b58\u5728\u538b\u529b\n</code></pre> <ol> <li>MatchInterPodAffinity</li> </ol> <pre><code>\u68c0\u67e5 Pod \u662f\u5426\u6ee1\u8db3\u4eb2\u548c\u6027\u6216\u8005\u53cd\u4eb2\u548c\u6027\n</code></pre>"},{"location":"k8s/note/chapter-17/#175","title":"17.5 \u4f18\u9009\u51fd\u6570","text":"<p>\u5728\u6bcf\u4e2a\u8282\u70b9\u6267\u884c\u4f18\u9009\u51fd\u6570\uff0c\u5c06\u7ed3\u679c\u6bcf\u4e2a\u4f18\u9009\u51fd\u6570\u76f8\u52a0\uff0c\u5f97\u5206\u6700\u9ad8\u7684\u80dc\u51fa\u3002</p> <ol> <li>least_requested.go</li> </ol> <pre><code>\u9009\u62e9\u6d88\u8017\u6700\u5c0f\u7684\u8282\u70b9\uff08\u6839\u636e\u7a7a\u95f2\u6bd4\u7387\u8bc4\u4f30 cpu(\u603b\u5bb9\u91cf-sum(\u5df2\u4f7f\u7528)*10/\u603b\u5bb9\u91cf)\uff09\n</code></pre> <ol> <li>balanced_resource_allocation.go</li> </ol> <pre><code>\u5747\u8861\u8d44\u6e90\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u8868\u793a\u4ee5 cpu \u548c\u5185\u5b58\u5360\u7528\u7387\u7684\u76f8\u8fd1\u7a0b\u5ea6\u4f5c\u4e3a\u8bc4\u4f30\u6807\u51c6\uff0c\u4e8c\u8005\u5360\u7528\u8d8a\u63a5\u8fd1\uff0c\u5f97\u5206\u5c31\u8d8a\u9ad8\uff0c\u5f97\u5206\u9ad8\u7684\u80dc\u51fa\u3002\n</code></pre> <ol> <li>node_prefer_avoid_pods.go</li> </ol> <pre><code>\u770b\u8282\u70b9\u662f\u5426\u6709\u6ce8\u89e3\u4fe1\u606f \"scheduler.alpha.kubernetes.io/preferAvoidPods\" \u3002\u6ca1\u6709\u8fd9\u4e2a\u6ce8\u89e3\u4fe1\u606f\uff0c\u8bf4\u660e\u8fd9\u4e2a\u8282\u70b9\u662f\u9002\u5408\u8fd0\u884c\u8fd9\u4e2a POD \u7684\u3002\n</code></pre> <ol> <li>taint_toleration.go</li> </ol> <pre><code>\u5c06 pods.spec.tolerations \u4e0e nodes.spec.taints \u5217\u8868\u9879\u8fdb\u884c\u5339\u914d\u5ea6\u68c0\u67e5\uff0c\u5339\u914d\u7684\u6761\u76ee\u8d8a\u591a\uff0c\u5f97\u5206\u8d8a\u4f4e\u3002\n</code></pre> <ol> <li>selector_spreading.go</li> </ol> <pre><code>\u67e5\u627e\u5f53\u524d POD \u5bf9\u8c61\u5bf9\u5e94\u7684 service\u3001statefulset\u3001replicatset \u7b49\u6240\u5339\u914d\u7684\u6807\u7b7e\u9009\u62e9\u5668\uff0c\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u5e26\u6709\u8fd9\u6837\u6807\u7b7e\u7684 POD \u8d8a\u5c11\u5f97\u5206\u8d8a\u9ad8\uff0c\u8fd9\u6837\u7684 POD \u4f18\u9009\u88ab\u9009\u51fa\u3002 \u8fd9\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u628a\u540c\u4e00\u4e2a\u6807\u7b7e\u9009\u62e9\u5668\u4e0b\u8fd0\u884c\u7684 POD \u6563\u5f00(spreading)\u5230\u591a\u4e2a\u8282\u70b9\u4e0a\u3002\n</code></pre> <ol> <li>interpod_affinity_test.go</li> </ol> <pre><code>\u904d\u5386 POD \u5bf9\u8c61\u4eb2\u548c\u6027\u7684\u6761\u76ee\uff0c\u5e76\u5c06\u90a3\u4e9b\u80fd\u591f\u5339\u914d\u5230\u8282\u70b9\u6743\u91cd\u76f8\u52a0\uff0c\u503c\u8d8a\u5927\u7684\u5f97\u5206\u8d8a\u9ad8\uff0c\u5f97\u5206\u9ad8\u7684\u80dc\u51fa\u3002\n</code></pre> <ol> <li>most_requested.go</li> </ol> <pre><code>\u8868\u793a\u5c3d\u53ef\u80fd\u7684\u628a\u4e00\u4e2a\u8282\u70b9\u7684\u8d44\u6e90\u5148\u7528\u5b8c\uff0c\u8fd9\u4e2a\u548c least_requested \u76f8\u53cd\uff0c\u4e8c\u8005\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u3002\n</code></pre> <ol> <li>node_label.go</li> </ol> <pre><code>\u6839\u636e\u8282\u70b9\u662f\u5426\u62e5\u6709\u6807\u7b7e\uff0c\u4e0d\u5173\u5fc3\u6807\u7b7e\u662f\u4ec0\u4e48\uff0c\u6765\u8bc4\u4f30\u5206\u6570\u3002\n</code></pre> <ol> <li>image_locality.go</li> </ol> <pre><code>\u8868\u793a\u6839\u636e\u6ee1\u8db3\u5f53\u524d POD \u5bf9\u8c61\u9700\u6c42\u7684\u5df2\u6709\u955c\u7684\u4f53\u79ef\u5927\u5c0f\u4e4b\u548c\u6765\u9009\u62e9\u8282\u70b9\u7684\u3002\n</code></pre> <ol> <li>node_affinity.go</li> </ol> <pre><code>\u6839\u636e POD \u5bf9\u8c61\u4e2d\u7684 nodeselector\uff0c\u5bf9\u8282\u70b9\u8fdb\u884c\u5339\u914d\u5ea6\u68c0\u67e5\uff0c\u80fd\u591f\u6210\u529f\u5339\u914d\u7684\u6570\u91cf\u8d8a\u591a\uff0c\u5f97\u5206\u5c31\u8d8a\u9ad8\u3002\n</code></pre>"},{"location":"k8s/note/chapter-17/#176","title":"17.6 \u9009\u62e9\u51fd\u6570","text":"<p>\u5f53\u901a\u8fc7\u4f18\u9009\u7684\u8282\u70b9\u6709\u591a\u4e2a\uff0c\u90a3\u4e48\u4ece\u4e2d\u968f\u673a\u9009\u62e9\u4e00\u53f0</p>"},{"location":"k8s/note/chapter-18/","title":"\u5341\u516b \u9ad8\u7ea7\u8c03\u5ea6\u8bbe\u7f6e","text":"<p>\u8282\u70b9\u9009\u62e9\u5668\uff1anodeselector\u3001nodeName</p> <p>\u8282\u70b9\u4eb2\u548c\u8c03\u5ea6\uff1anodeAffinity</p>"},{"location":"k8s/note/chapter-18/#181","title":"18.1 \u8282\u70b9\u9009\u62e9\u5668","text":"<ul> <li>\u4f7f\u7528 nodeselector \u6765\u5c06\u9884\u9009\u8303\u56f4\u7f29\u5c0f\uff0c\u6ca1\u6709\u88ab nodeselector \u9009\u4e2d\u7684\u8282\u70b9\u5c06\u88ab\u9884\u9009\u9636\u6bb5\u6dd8\u6c70</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-schedule-demo\n  namespace: default\n  labels:\n    app: myapp\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n  nodeSelector:\n    gpu: ok\n</code></pre> <ul> <li>\u6b64\u65f6\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u6709 gpu \u8fd9\u4e2a\u6807\u7b7e\uff0c\u90a3\u4e48\u8fd9\u4e2a POD \u7684\u8c03\u5ea6\u5c06\u4f1a\u88ab\u6302\u8d77\uff0cPending \u72b6\u6001\uff0c\u76f4\u5230\u6ee1\u8db3\u6761\u4ef6</li> </ul> <pre><code>kubectl label nodes node2 gpu=ok --overwrite\n</code></pre> <ul> <li>\u67e5\u770b POD \u88ab\u8c03\u5ea6\u7684\u8282\u70b9\uff0cPOD \u5df2\u7ecf\u88ab\u8c03\u5ea6\u5230 node2 \u8282\u70b9\u4e86</li> </ul> <pre><code>kubectl get pods -o wide\n</code></pre>"},{"location":"k8s/note/chapter-18/#182","title":"18.2 \u5bf9\u8282\u70b9\u7684\u4eb2\u548c\u6027","text":"<p>\u4eb2\u548c\u6027\u5b9a\u4e49\uff0c\u8be6\u89c1\uff1akubectl explain pods.spec.affinity.nodeAffinity</p> <ul> <li>POD \u5bf9\u8282\u70b9\u4eb2\u548c\u6027\u5b9a\u4e49</li> </ul> <pre><code>nodeAffinity             &lt;Object&gt;                                # POD \u5bf9 node \u8282\u70b9\u7684\u4eb2\u548c\u6027\n  preferredDuringSchedulingIgnoredDuringExecution  &lt;[]Object&gt;    # \u8f6f\u4eb2\u548c\u6027\u8981\u6c42\uff0c\u5c3d\u91cf\u6ee1\u8db3\u4eb2\u548c\u6027\n    preference           &lt;Object&gt;                                # \u4eb2\u548c\u7684\u8282\u70b9\u5bf9\u8c61\n      matchExpressions   &lt;[]Object&gt;                              # \u67e5\u627e\u8868\u8fbe\u5f0f\n        key              &lt;string&gt;                                # \u6807\u7b7e\n        operator         &lt;string&gt;                                # \u64cd\u4f5c\uff1a\u6bd4\u8f83\n        values           &lt;[]string&gt;                              # \u503c\n      matchFields        &lt;[]Object&gt;                              # \u67e5\u627e\u5b57\u6bb5\n        key              &lt;string&gt;                                # \u6807\u7b7e\n        operator         &lt;string&gt;                                # \u64cd\u4f5c\uff1a\u6bd4\u8f83\n        values           &lt;[]string&gt;                              # \u503c\n    weight               &lt;integer&gt;                               # \u6743\u91cd 1 - 100\n  requiredDuringSchedulingIgnoredDuringExecution   &lt;Object&gt;      # \u786c\u4eb2\u548c\u6027\u8981\u6c42\uff0c\u4e0d\u6ee1\u8db3\u5219 Pending\n    nodeSelectorTerms    &lt;[]Object&gt;                              # \u9009\u62e9\u5668\u5bf9\u8c61\u5217\u8868\n      matchExpressions   &lt;[]Object&gt;                              # \u9009\u62e9\u5668\u5bf9\u8c61\u5217\u8868\n        key              &lt;string&gt;                                # \u6807\u7b7e\n        operator         &lt;string&gt;                                # \u64cd\u4f5c\uff1a\u6bd4\u8f83\n        values           &lt;[]string&gt;                              # \u503c\n      matchFields        &lt;[]Object&gt;                              # \u67e5\u627e\u5b57\u6bb5\n        key              &lt;string&gt;                                # \u6807\u7b7e\n        operator         &lt;string&gt;                                # \u64cd\u4f5c\uff1a\u6bd4\u8f83\n        values           &lt;[]string&gt;                              # \u503c\n</code></pre> <ul> <li>\u793a\u4f8b\u914d\u7f6e</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeaffinity1-demo\n  namespace: default\n  labels:\n    app: myapp\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:        # \u786c\u4eb2\u548c\u6027\u8981\u6c42\uff0c\u4e0d\u6ee1\u8db3\u5c31 Pending\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: zone\n            operator: In\n            values:\n            - foo\n            - bar\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeaffinity2-demo\n  namespace: default\n  labels:\n    app: myapp\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n  affinity:\n    nodeAffinity:\n      preferredDuringSchedulingIgnoredDuringExecution:     # \u8f6f\u4eb2\u548c\u6027\u8981\u6c42\uff0c\u4e0d\u6ee1\u8db3\u4e5f\u53ef\u4ee5\u5bf9\u51d1\n      - preference:\n          matchExpressions:\n          - key: zone\n            operator: In\n            values:\n            - foo\n            - bar\n        weight: 50\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c\uff0ckubectl get pods</li> </ul> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE\npod-nodeaffinity1-demo   0/1     Pending   0          6m16s  # \u786c\u4eb2\u548c\u6027\u8981\u6c42\uff0c\u6ca1\u6709\u5c31\u7b49\u5f85\npod-nodeaffinity2-demo   1/1     Running   0          7s     # \u8f6f\u4eb2\u548c\u6027\u8981\u6c42\uff0c\u6ca1\u6709\u5408\u9002\u4e3b\u673a\u4e5f\u53ef\u4ee5\u51d1\u548c\n</code></pre>"},{"location":"k8s/note/chapter-18/#183-pod","title":"18.3 \u5bf9 POD \u7684\u4eb2\u548c\u6027","text":"<p>POD \u548c POD \u51fa\u4e8e\u9ad8\u6548\u7684\u901a\u4fe1\u8fd9\u79cd\u9700\u6c42\uff0c\u6240\u4ee5\u9700\u8981\u5c06 POD \u548c POD \u7ec4\u7ec7\u5728\u540c\u4e00\u53f0\u673a\u5668\uff0c\u540c\u4e00\u4e2a\u673a\u623f\uff0c\u4f8b\u5982\uff1aLNMT \u5982\u679c\u80fd\u8fd0\u884c\u5728\u540c\u4e00\u4e2a\u4e3b\u673a\u4e0a\u66f4\u597d\u3002</p> <ol> <li> <p>\u60f3\u628a\u4e00\u7ec4 POD \u8fd0\u884c\u5728\u4e00\u8d77\uff0c\u4f7f\u7528\u8282\u70b9\u4eb2\u548c\u6027\u5c31\u53ef\u4ee5\u5b9e\u73b0\uff0c\u4e3a\u4e86\u8fbe\u6210\u8fd9\u4e2a\u76ee\u7684\uff0c\u6211\u4eec\u9700\u8981\uff1a\u628a\u8282\u70b9\u6807\u7b7e\u7cbe\u5fc3\u7f16\u6392\uff0c\u5e0c\u671b\u5728\u4e00\u8d77\u8fd0\u884c\u7684 POD\uff0c\u5c31\u4f7f\u7528\u540c\u4e00\u7ec4\u6807\u7b7e\u9009\u62e9\u5668\u6765\u9009\u62e9\u8282\u70b9\uff0c\u8fd9\u79cd\u65b9\u5f0f\u9700\u8981\u7ba1\u7406\u8282\u70b9\u6807\u7b7e\u548c POD \u4eb2\u548c\u6027\u624d\u80fd\u505a\u5230\u3002</p> </li> <li> <p>\u60f3\u628a\u4e00\u7ec4 POD \u8fd0\u884c\u5728\u4e00\u8d77\uff0c\u4f7f\u7528 POD \u4eb2\u548c\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e POD \u5bf9\u67d0\u4e2a POD \u7684\u4eb2\u548c\u6027\uff0c\u90a3\u4e48\u6bd4\u5982\uff1aLNMT\uff0c\u90a3\u4e48 MySQL \u548c Tomcat \u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u66f4\u52a0\u4eb2\u548c Ngninx \u6240\u5728\u7684\u4e3b\u673a\u6216\u673a\u67dc\uff0c\u6240\u4ee5\u5fc5\u987b\u6709\u4e2a\u524d\u63d0\u5c31\u662f POD \u548c POD \u600e\u4e48\u624d\u662f\u6700\u8fd1\u7684\uff0c\u8fd9\u4e2a\u6807\u51c6\u662f\u4ec0\u4e48\uff0c\u4e5f\u5c31\u662f\u4ec0\u4e48\u662f\u540c\u4e00\u4f4d\u7f6e\uff0c\u600e\u4e48\u624d\u80fd\u77e5\u9053 node \u548c node \u662f\u5728\u4e00\u4e2a\u673a\u67dc\u3002</p> <p>\u6240\u4ee5\u53ef\u4ee5\u4e3a\u540c\u4e00\u4e2a\u673a\u67dc\u7684 node \u8282\u70b9\u6253\u4e0a\u76f8\u540c\u7684\u6807\u7b7e\u3002</p> </li> <li> <p>MySQL \u548c Tomcat \u4e00\u5b9a\u4e0d\u80fd\u548c Nginx \u8fd0\u884c\u5728\u4e00\u8d77\uff0c\u8fd9\u5c31\u662f\u53cd\u4eb2\u548c\u6027\u3002</p> </li> <li> <p>POD \u5bf9\u5176\u4ed6 POD \u7684\u4eb2\u548c\u6027\uff0c\u8be6\u89c1\uff1akubectl explain pods.spec.affinity.podAffinity</p> </li> </ol> <pre><code>podAffinity                &lt;Object&gt;                              # POD \u5bf9\u5176\u4ed6 POD \u7684\u4eb2\u548c\u6027\n  preferredDuringSchedulingIgnoredDuringExecution  &lt;[]Object&gt;    # \u8f6f\u6027\u4eb2\u548c\u6027\uff0c\u5c3d\u91cf\u6ee1\u8db3\u4eb2\u548c\u6027\n    podAffinityTerm        &lt;Object&gt;                              # \u4eb2\u548c\u7684 POD \u5bf9\u8c61\n      labelSelector        &lt;Object&gt;                              # \u6807\u7b7e\u9009\u62e9\u5668\u5bf9\u8c61\u5217\u8868\n        matchExpressions   &lt;[]Object&gt;                            # \u6807\u7b7e\u9009\u62e9\u5668\u5bf9\u8c61\uff0c\u9009 POD \u6807\u7b7e\n          key              &lt;string&gt;                              # \u6807\u7b7e\n          operator         &lt;string&gt;                              # \u64cd\u4f5c\uff1a\u6bd4\u8f83\n          values           &lt;[]string&gt;                            # \u503c\n        matchLabels        &lt;map[string]string&gt;                   # \u96c6\u5408\u6807\u7b7e\u9009\u62e9\u5668\n      namespaces           &lt;[]string&gt;                            # \u540d\u79f0\u7a7a\u95f4\u7684\u5217\u8868\n      topologyKey          &lt;string&gt;                              # \u4eb2\u548c\u5224\u65ad\u6761\u4ef6\n    weight                 &lt;integer&gt;                             # \u6743\u91cd 1 - 100\n  requiredDuringSchedulingIgnoredDuringExecution   &lt;[]Object&gt;    # \u786c\u6027\u4eb2\u548c\u6027\uff0c\u4e0d\u6ee1\u8db3\u5219 Pending\n    labelSelector          &lt;Object&gt;                              # \u6807\u7b7e\u9009\u62e9\u5668\u5bf9\u8c61\u5217\u8868\n      matchExpressions   &lt;[]Object&gt;                              # \u6807\u7b7e\u9009\u62e9\u5668\u5bf9\u8c61\uff0c\u9009 POD \u6807\u7b7e\n        key              &lt;string&gt;                                # \u6807\u7b7e\n        operator         &lt;string&gt;                                # \u64cd\u4f5c\uff1a\u6bd4\u8f83\n        values           &lt;[]string&gt;                              # \u503c\n      matchLabels        &lt;map[string]string&gt;                     # \u96c6\u5408\u6807\u7b7e\u9009\u62e9\u5668\n    namespaces             &lt;[]string&gt;                            # \u540d\u79f0\u7a7a\u95f4\u7684\u5217\u8868\n    topologyKey            &lt;string&gt;                              # \u4eb2\u548c\u5224\u65ad\u6761\u4ef6\n</code></pre> <ul> <li>\u793a\u4f8b\u914d\u7f6e</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod1\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod2\n  namespace: default\n  labels:\n    app: db\n    tier: db\nspec:\n  containers:\n  - name: busybox\n    image: busybox:latest\n    imagePullPolicy: IfNotPresent\n    command:\n    - \"sh\"\n    - \"-c\"\n    - \"sleep 3600\"\n  affinity:\n    podAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:   # \u786c\u4eb2\u548c\u6027\u8981\u6c42\uff0c\u4e0d\u6ee1\u8db3\u7684 Pending\n      - labelSelector:\n          matchExpressions:\n          - key: app\n            operator: In\n            values:\n            - myapp\n        topologyKey: kubernetes.io/hostname             # \u4eb2\u548c\u6027\u7684\u4f9d\u636e\u4e3a\u540c\u4e00\u4e2a\u4e3b\u673a\u540d\u5219\u4eb2\u548c\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c\uff0ckubectl get pods -o wide</li> </ul> <pre><code>NAME   READY   STATUS    RESTARTS   AGE     IP           NODE    NOMINATED NODE   READINESS GATES\npod1   1/1     Running   0          3m33s   10.244.2.4   node3   &lt;none&gt;           &lt;none&gt;\npod2   1/1     Running   0          3m33s   10.244.2.5   node3   &lt;none&gt;           &lt;none&gt;\n</code></pre>"},{"location":"k8s/note/chapter-18/#184-pod","title":"18.4 \u5bf9 POD \u7684\u53cd\u4eb2\u548c\u6027","text":"<ul> <li>POD \u5bf9\u5176\u4ed6 POD \u7684\u53cd\u4eb2\u548c\u6027\uff0c\u8be6\u89c1\uff1akubectl explain pods.spec.affinity.podAntiAffinity</li> </ul> <pre><code>podAntiAffinity              &lt;Object&gt;                            # POD \u5bf9\u5176\u4ed6 POD \u7684\u53cd\u4eb2\u548c\u6027\n  preferredDuringSchedulingIgnoredDuringExecution  &lt;[]Object&gt;    # \u8f6f\u6027\u53cd\u4eb2\u548c\u6027\uff0c\u5c3d\u91cf\u6ee1\u8db3\u4eb2\u548c\u6027\n    podAffinityTerm        &lt;Object&gt;                              # \u53cd\u4eb2\u548c\u7684 POD \u5bf9\u8c61\n      labelSelector        &lt;Object&gt;                              # \u6807\u7b7e\u9009\u62e9\u5668\u5bf9\u8c61\u5217\u8868\n        matchExpressions   &lt;[]Object&gt;                            # \u6807\u7b7e\u9009\u62e9\u5668\u5bf9\u8c61\uff0c\u9009 POD \u6807\u7b7e\n          key              &lt;string&gt;                              # \u6807\u7b7e\n          operator         &lt;string&gt;                              # \u64cd\u4f5c\uff1a\u6bd4\u8f83\n          values           &lt;[]string&gt;                            # \u503c\n        matchLabels        &lt;map[string]string&gt;                   # \u96c6\u5408\u6807\u7b7e\u9009\u62e9\u5668\n      namespaces           &lt;[]string&gt;                            # \u540d\u79f0\u7a7a\u95f4\u7684\u5217\u8868\n      topologyKey          &lt;string&gt;                              # \u4eb2\u548c\u5224\u65ad\u6761\u4ef6\n    weight                 &lt;integer&gt;                             # \u6743\u91cd 1 - 100\n  requiredDuringSchedulingIgnoredDuringExecution   &lt;[]Object&gt;    # \u786c\u6027\u53cd\u4eb2\u548c\u6027\uff0c\u4e0d\u6ee1\u8db3\u5219 Pending\n    labelSelector          &lt;Object&gt;                              # \u6807\u7b7e\u9009\u62e9\u5668\u5bf9\u8c61\u5217\u8868\n      matchExpressions   &lt;[]Object&gt;                              # \u6807\u7b7e\u9009\u62e9\u5668\u5bf9\u8c61\uff0c\u9009 POD \u6807\u7b7e\n        key              &lt;string&gt;                                # \u6807\u7b7e\n        operator         &lt;string&gt;                                # \u64cd\u4f5c\uff1a\u6bd4\u8f83\n        values           &lt;[]string&gt;                              # \u503c\n      matchLabels        &lt;map[string]string&gt;                     # \u96c6\u5408\u6807\u7b7e\u9009\u62e9\u5668\n    namespaces             &lt;[]string&gt;                            # \u540d\u79f0\u7a7a\u95f4\u7684\u5217\u8868\n    topologyKey            &lt;string&gt;                              # \u4eb2\u548c\u5224\u65ad\u6761\u4ef6\n</code></pre> <ul> <li>\u914d\u7f6e\u6e05\u5355</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod3\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod4\n  namespace: default\n  labels:\n    app: db\n    tier: db\nspec:\n  containers:\n  - name: busybox\n    image: busybox:latest\n    imagePullPolicy: IfNotPresent\n    command:\n    - \"sh\"\n    - \"-c\"\n    - \"sleep 3600\"\n  affinity:\n    podAntiAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:   # \u786c\u4eb2\u548c\u6027\u8981\u6c42\uff0c\u4e0d\u6ee1\u8db3\u7684 Pending\n      - labelSelector:\n          matchExpressions:\n          - key: app\n            operator: In\n            values:\n            - myapp\n        topologyKey: kubernetes.io/hostname             # \u53cd\u4eb2\u548c\u6027\u7684\u4f9d\u636e\u4e3a\u540c\u4e00\u4e2a\u4e3b\u673a\u540d\n</code></pre>"},{"location":"k8s/note/chapter-18/#185-node","title":"18.5 node \u6c61\u70b9","text":"<p>\u6c61\u70b9\u53ea\u7528\u5728 node \u4e0a\u7684\u952e\u503c\u5c5e\u6027\uff08nodes.spec.taints\uff09\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u62d2\u7edd\u4e0d\u80fd\u5bb9\u5fcd\u8fd9\u4e9b\u6c61\u70b9\u7684 POD \u8fd0\u884c\u7684\uff0c\u56e0\u6b64\u9700\u8981\u5728 POD \u4e0a\u5b9a\u4e49\u5bb9\u5fcd\u5ea6\uff08pods.spec.tolerations\uff09\uff0c\u5b83\u4e5f\u662f\u952e\u503c\u6570\u636e\uff0c\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u8868\u793a POD \u53ef\u4ee5\u5bb9\u5fcd\u7684\u6c61\u70b9\u5217\u8868\u3002</p> <p>\u4e00\u4e2a POD \u80fd\u4e0d\u80fd\u8fd0\u884c\u5728\u4e00\u4e2a\u8282\u70b9\u4e0a\uff0c\u5c31\u662f pods.spec.tolerations \u5217\u8868\u4e2d\u662f\u5426\u5305\u62ec\u4e86 nodes.spec.taints \u4e2d\u7684\u6570\u636e\u3002</p> <ul> <li>node \u6c61\u70b9\u6e05\u5355\u683c\u5f0f\uff0c\u8be6\u89c1\uff1akubectl explain node.spec.taints</li> </ul> <pre><code>taints          &lt;[]Object&gt;     # \u6c61\u70b9\u5bf9\u8c61\u5217\u8868\n  effect        &lt;string&gt;       # \u5f53 POD \u4e0d\u80fd\u5bb9\u5fcd\u8fd9\u4e2a\u6c61\u70b9\u7684\u65f6\u5019\uff0c\u8981\u91c7\u53d6\u7684\u884c\u4e3a\uff0c\u4e5f\u5c31\u662f\u6392\u65a5\u4e0d\u5bb9\u5fcd\u6c61\u70b9\u7684 POD\n    NoSchedule                 # \u5f71\u54cd\u8c03\u5ea6\u8fc7\u7a0b\uff0c\u4f46\u662f\u5df2\u7ecf\u8c03\u5ea6\u5b8c\u6210 POD \u65e0\u5f71\u54cd\n    PreferNoSchedule           # \u5f71\u54cd\u8c03\u5ea6\u8fc7\u7a0b\uff0c\u5c1d\u8bd5\u9a71\u9010\u8c03\u5ea6\u5df2\u7ecf\u5b8c\u6210\u7684\u4f46\u4e0d\u5bb9\u5fcd\u65b0\u6c61\u70b9\u7684 POD\n    NoExecute                  # \u65b0\u589e\u7684\u6c61\u70b9\uff0c\u5f71\u54cd\u65b0\u7684\u8c03\u5ea6\u8fc7\u7a0b\uff0c\u4e14\u5f3a\u529b\u9a71\u9010\u8c03\u5ea6\u5df2\u7ecf\u5b8c\u6210\u7684\u4f46\u4e0d\u5bb9\u5fcd\u65b0\u6c61\u70b9\u7684 POD\n  key           &lt;string&gt;       # \u952e\n  timeAdded     &lt;string&gt;       # \n  value         &lt;string&gt;       # \u503c\n</code></pre> <ul> <li>\u7ed9 node \u6253\u4e0a\u6c61\u70b9\uff0c\u952e\u4e3a node-type \u503c\u4e3a production\uff0c\u6c61\u70b9\u52a8\u4f5c</li> </ul> <pre><code>kubectl taint node node2 node-type=production:NoSchedule\n</code></pre> <ul> <li>\u5220\u9664 node \u4e0a\u7684\u4e00\u4e2a\u6c61\u70b9</li> </ul> <pre><code>kubectl taint node node2 node-type-\n</code></pre> <ul> <li>\u6d4b\u8bd5\u6e05\u5355</li> </ul> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp-deploy\n  namespace: default\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: myapp\n      release: canary\n  template:\n    metadata:\n      labels:\n        app: myapp\n        release: canary\n    spec:\n      containers:\n        - name: myapp\n          image: ikubernetes/myapp:v2\n          ports:\n            - name: http\n              containerPort: 80\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c\uff0ckubectl get pods -o wide\uff0c\u56e0\u4e3a POD \u6ca1\u6709\u5b9a\u4e49\u5bb9\u5fcd node2 \u7684\u6c61\u70b9</li> </ul> <pre><code>NAME                            READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES\nmyapp-deploy-675558bfc5-4x5cf   1/1     Running   0          9s    10.244.2.13   node3   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-675558bfc5-58f2s   1/1     Running   0          9s    10.244.2.10   node3   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-675558bfc5-gz4kv   1/1     Running   0          9s    10.244.2.12   node3   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-675558bfc5-hlxdd   1/1     Running   0          9s    10.244.2.11   node3   &lt;none&gt;           &lt;none&gt;\n</code></pre> <ul> <li>\u6b64\u65f6\u7ed9 node3 \u4e5f\u6253\u4e0a\u6c61\u70b9\uff0c\u5e76\u9a71\u9010\u539f\u6709\u7684 POD</li> </ul> <pre><code>kubectl taint node node3 node-type=dev:NoExecute\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c\uff0ckubectl get pods -o wide\uff0c\u56e0\u4e3a node3 \u65b0\u589e\u7684\u6c61\u70b9\u9a71\u9010\u4e86\u4e0d\u80fd\u5bb9\u5fcd\u6c61\u70b9\u7684 POD \uff0c\u6240\u4ee5 POD \u88ab\u6302\u8d77</li> </ul> <pre><code>NAME                            READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED NODE   READINESS GATES\nmyapp-deploy-675558bfc5-22wpj   0/1     Pending   0          10s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-675558bfc5-lctv5   0/1     Pending   0          14s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-675558bfc5-m5qdh   0/1     Pending   0          15s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-675558bfc5-z8c4q   0/1     Pending   0          14s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\n</code></pre>"},{"location":"k8s/note/chapter-18/#186-pod","title":"18.6 POD \u6c61\u70b9\u5bb9\u5fcd","text":"<ul> <li>POD \u5bb9\u5fcd\u5ea6\uff0c\u8be6\u89c1\uff1akubectl explain pods.spec.tolerations</li> </ul> <pre><code>tolerations            &lt;[]Object&gt;    # \u5bb9\u5fcd\u5ea6\u5bf9\u8c61\n  effect               &lt;string&gt;      # \u80fd\u5426\u5bb9\u5fcd node \u4e0a\u7684\u6c61\u70b9\u9a71\u9010\u7b56\u7565\uff0c\u4e3a\u7a7a\u8868\u793a\u5bb9\u5fcd\u4efb\u4f55\u9a71\u9010\u7b56\u7565\n    NoSchedule                       # \u80fd\u5bb9\u5fcd node \u6c61\u70b9\u7684 NoSchedule\n    PreferNoSchedule                 # \u80fd\u5bb9\u5fcd node \u6c61\u70b9\u7684 PreferNoSchedule\n    NoExecute                        # \u80fd\u5bb9\u5fcd node \u6c61\u70b9\u7684 NoExecute\n  key                  &lt;string&gt;      # \u6c61\u70b9\u7684\u952e\n  operator             &lt;string&gt;      # Exists \u6c61\u70b9\u5b58\u5728\u4e0d\u7ba1\u4ec0\u4e48\u503c\uff0cEqual \u6c61\u70b9\u7684\u503c\u5fc5\u987b\u7b49\u503c\n  tolerationSeconds    &lt;integer&gt;     # \u5bb9\u5fcd\u65f6\u95f4\uff0c\u5373\u5982\u679c\u88ab\u9a71\u9010\uff0c\u53ef\u4ee5\u7b49\u591a\u4e45\u518d\u8d70\uff0c\u9ed8\u8ba4 0 \u79d2\uff0cNoExecute \u4f7f\u7528\n  value                &lt;string&gt;      # \u6c61\u70b9\u7684\u503c\n</code></pre> <ul> <li>\u7ed9 node2 \u3001node3 \u5206\u522b\u6253\u6c61\u70b9</li> </ul> <pre><code>kubectl taint node node2 node-type=production:NoSchedule\nkubectl taint node node3 node-type=dev:NoExecute\n</code></pre> <ul> <li>\u5b9a\u4e49 POD \u6e05\u5355\u6587\u4ef6\uff0c\u5bb9\u5fcd node \u4e0a\u5b58\u5728 node-type \u503c\u4e3a dev \u7684\u6c61\u70b9\u3001\u63a5\u53d7\u88ab\u9a71\u9010\u3002</li> </ul> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp-deploy\n  namespace: default\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: myapp\n      release: canary\n  template:\n    metadata:\n      labels:\n        app: myapp\n        release: canary\n    spec:\n      containers:\n        - name: myapp\n          image: ikubernetes/myapp:v2\n          ports:\n            - name: http\n              containerPort: 80\n      tolerations:\n      - key: node-type\n        operator: Equal\n        value: dev\n        effect: NoExecute\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c\uff0ckubectl get pods -o wide\uff0c\u8fd0\u884c\u5728\u81ea\u5df1\u5bb9\u5fcd\u7684\u6c61\u70b9\u7684\u8282\u70b9\u4e0a\u4e86</li> </ul> <pre><code>NAME                           READY   STATUS    RESTARTS   AGE     IP            NODE    NOMINATED NODE   READINESS GATES\nmyapp-deploy-97578cf74-5v2r6   1/1     Running   0          6m22s   10.244.2.16   node3   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-97578cf74-gbfj7   1/1     Running   0          6m22s   10.244.2.14   node3   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-97578cf74-l4lbv   1/1     Running   0          6m22s   10.244.2.15   node3   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-97578cf74-zvn8f   1/1     Running   0          6m20s   10.244.2.17   node3   &lt;none&gt;           &lt;none&gt;\n</code></pre> <ul> <li>\u4e3a\u8282\u70b9\u589e\u52a0\u65b0\u7684\u6c61\u70b9\uff0c\u8bbe\u7f6e\u9a71\u79bb POD</li> </ul> <pre><code>kubectl taint node node3 disk=hdd:NoExecute --overwrite\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c\uff0ckubectl get pods -o wide\uff0cPOD \u4e0d\u80fd\u5bb9\u5fcd\u65b0\u7684\u6c61\u70b9\uff0c\u7ed3\u679c\u88ab\u9a71\u9010</li> </ul> <pre><code>NAME                           READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED NODE   READINESS GATES\nmyapp-deploy-97578cf74-84bfz   0/1     Pending   0          6s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-97578cf74-fxk2d   0/1     Pending   0          5s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-97578cf74-jp99j   0/1     Pending   0          6s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\nmyapp-deploy-97578cf74-vdkbx   0/1     Pending   0          6s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\n</code></pre>"},{"location":"k8s/note/chapter-19/","title":"\u5341\u4e5d \u5bb9\u5668\u8d44\u6e90\u9650\u5236","text":"<p>\u8d77\u59cb\u503c requests \u6700\u4f4e\u4fdd\u969c</p> <p>\u7ec8\u7ed3\u503c limits \u786c\u9650\u5236</p> <ul> <li>CPU</li> </ul> <pre><code>1 \u9897 CPU = 1000 millicores\n0.5 \u9897 CPU = 500 m\n</code></pre> <ul> <li>\u5185\u5b58</li> </ul> <pre><code>Ei\u3001Pi\u3001Ti\u3001Gi\u3001Mi\u3001Ki\n</code></pre>"},{"location":"k8s/note/chapter-19/#191","title":"19.1 \u8d44\u6e90\u9650\u5236","text":"<ul> <li>\u6e05\u5355\u683c\u5f0f\uff0c\u8be6\u89c1\uff1akubectl explain pods.spec.containers.resources</li> </ul> <pre><code>resources      &lt;Object&gt;               # \u8d44\u6e90\u9650\u5236\n  limits       &lt;map[string]string&gt;    # \u8d44\u6e90\u6700\u9ad8\u9650\u5236\n    cpu        &lt;string&gt;               # \u5355\u4f4d m\n    memory     &lt;string&gt;               # \u5355\u4f4d Gi\u3001Mi\n  requests     &lt;map[string]string&gt;    # \u8d44\u6e90\u6700\u4f4e\u8981\u6c42\n    cpu        &lt;string&gt;               # \u5355\u4f4d m\n    memory     &lt;string&gt;               # \u5355\u4f4d Gi\u3001Mi\n</code></pre> <ul> <li>\u6e05\u5355\u793a\u4f8b\uff0cnode \u8282\u70b9\u7684 CPU \u4e3a 12 \u6838\u5fc3\uff0ccpu limits \u8bbe\u7f6e\u4e3a 1000m \u4e5f\u5c31\u662f\u5141\u8bb8</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-resources-demo\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n  - name: nginx\n    image: ikubernetes/stress-ng\n    command:\n    - \"/usr/bin/stress-ng\"\n    #- \"-m 1\"                       # \u4ee5\u5355\u7ebf\u7a0b\u538b\u6d4b\u5185\u5b58\n    - \"-c 1\"                        # \u4ee5\u5355\u7ebf\u7a0b\u538b\u6d4bCPU\n    - \"--metrics-brief\"\n    ports:\n    - name: http\n      containerPort: 80\n    - name: https\n      containerPort: 443\n    resources:\n      requests:\n        cpu: 1000m                 # \u5b83\u51b3\u5b9a\u5728\u9884\u9009\u9636\u6bb5\u6dd8\u6c70\u54ea\u4e9b\u4e3b\u673a\n        memory: 512Mi\n      limits:\n        cpu: 1000m                 # \u8868\u793a\u9650\u5236\u5bb9\u5668\u4f7f\u7528 node \u8282\u70b9\u7684\u4e00\u9897 CPU\uff0c\u65e0\u8bba\u591a\u5c11\u8fdb\u7a0b\uff0c\u5b83\u4eec\u6700\u591a\u53ea\u80fd\u5360\u7528 node \u8282\u70b9\u7684\u53ef CPU\n        memory: 512Mi\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c</li> </ul> <pre><code>Mem: 855392K used, 139916K free, 10188K shrd, 796K buff, 350368K cached\nCPU0:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU1: 100% usr   0% sys   0% nic   0% idle   0% io   0% irq   0% sirq         # \u5360\u6ee1\u4e86\u4e00\u9897 CPU\nCPU2:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU3:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU4:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU5:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU6:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU7:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU8:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU9:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU10:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nCPU11:   0% usr   0% sys   0% nic  99% idle   0% io   0% irq   0% sirq\nLoad average: 0.84 0.50 0.40 3/485 11\n  PID  PPID USER     STAT   VSZ %VSZ CPU %CPU COMMAND\n    6     1 root     R     6888   1%   1   8% {stress-ng-cpu} /usr/bin/stress-ng -c 1 --metrics-brief\n    1     0 root     S     6244   1%  10   0% /usr/bin/stress-ng -c 1 --metrics-brief\n    7     0 root     R     1504   0%  11   0% top\n</code></pre>"},{"location":"k8s/note/chapter-19/#192-qos","title":"19.2 qos \u8d28\u91cf\u7ba1\u7406","text":"<ul> <li>GuranteedW</li> </ul> <pre><code>\u6bcf\u4e2a\u5bb9\u5668\u540c\u65f6\u8bbe\u7f6e\u4e86 CPU \u548c\u5185\u5b58\u7684 requests \u548c limits\uff0c\u800c\u4e14\n    cpu.limits = cpu.requests\n    memory.limits = memory.requests\n\u90a3\u4e48\u5b83\u5c06\u4f18\u5148\u88ab\u8c03\u5ea6\n</code></pre> <ul> <li>Burstable</li> </ul> <pre><code>\u81f3\u5c11\u6709\u4e00\u4e2a\u5bb9\u5668\u8bbe\u7f6e CPU \u6216\u5185\u5b58\u8d44\u6e90\u7684 requests \u5c5e\u6027\n\n\u90a3\u4e48\u5b83\u5c06\u5177\u6709\u4e2d\u7b49\u4f18\u5148\u7ea7\n</code></pre> <ul> <li>BestEffort</li> </ul> <pre><code>\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u5bb9\u5668\u8bbe\u7f6e\u4e86 requests \u6216 limits \u5c5e\u6027\n\n\u90a3\u4e48\u5b83\u5c06\u53ea\u6709\u6700\u4f4e\u4f18\u5148\u7ea7\uff0c\u5f53\u8d44\u6e90\u4e0d\u591f\u7528\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u5bb9\u5668\u53ef\u80fd\u6700\u5148\u88ab\u7ec8\u6b62\uff0c\u4ee5\u817e\u51fa\u8d44\u6e90\u6765\uff0c\u4e3a Burstable \u548c Guranteed\n</code></pre> <ul> <li>oom \u7b56\u7565</li> </ul> <pre><code>\u6700\u5148\u6740\u6b7b\u5360\u7528\u91cf\u548c\u9700\u6c42\u91cf\u7684\u6bd4\u4f8b\u5927\u7684\n</code></pre>"},{"location":"k8s/note/chapter-2/","title":"\u4e8c \u6838\u5fc3\u7ec4\u4ef6/\u9644\u4ef6","text":""},{"location":"k8s/note/chapter-2/#21-controller","title":"2.1 Controller","text":"<p>\u8fd9\u4e9b\u63a7\u5236\u5668\u5206\u522b\u7528\u4e8e\u786e\u4fdd\u4e0d\u540c\u7c7b\u578b\u7684 POD \u8d44\u6e90\u8fd0\u884c\u4e8e\u7b26\u5408\u7528\u6237\u6240\u671f\u671b\u7684\u72b6\u6001\u3002</p> <ul> <li>RelicationController</li> </ul> <p>\u63a7\u5236\u540c\u4e00\u7c7b POD \u5bf9\u8c61\u7684\u526f\u672c\u6570\u91cf\uff0c\u5b9e\u73b0\u7a0b\u5e8f\u7684\u6eda\u52a8\u66f4\u65b0\uff0c\u6216\u8005\u56de\u6eda\u7684\u64cd\u4f5c\u3002</p> <p>\u5728\u6eda\u52a8\u66f4\u65b0\u65f6\u5019\uff0c\u5141\u8bb8\u4e34\u65f6\u8d85\u51fa\u89c4\u5b9a\u7684\u526f\u672c\u6570\u91cf\uff0c</p> <ul> <li>RelicaSet</li> </ul> <p>\u526f\u672c\u96c6\u63a7\u5236\u5668\uff0c\u5b83\u4e0d\u76f4\u63a5\u4f7f\u7528\uff0c\u5b83\u6709\u4e00\u4e2a\u58f0\u660e\u5f0f\u4e2d\u5fc3\u63a7\u5236\u5668 Deployment</p> <ul> <li>Deployment</li> </ul> <p>\u5b83\u53ea\u80fd\u7ba1\u7406\u65e0\u72b6\u6001\u7684\u5e94\u7528\uff0c\u8fd9\u4e2a\u63a7\u5236\u5668\uff0c\u652f\u6301\u4e8c\u7ea7\u63a7\u5236\u5668\uff0c\u4f8b\u5982\uff1aHPA\uff08Horizontal Pod Autoscaler\uff0c\u6c34\u5e73 POD \u81ea\u52a8\u4f38\u7f29\u63a7\u5236\u5668\uff09\uff0c\u5f53\u8d1f\u8f7d\u9ad8\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u542f\u52a8\u66f4\u591a\u7684 POD\u3002</p> <ul> <li>StatefulSet</li> </ul> <p>\u7ba1\u7406\u6709\u72b6\u6001\u7684\u5e94\u7528</p> <ul> <li>DaemonSet</li> </ul> <p>\u5982\u679c\u9700\u8981\u5728\u6bcf\u4e00\u4e2a node \u4e0a\u8fd0\u884c\u4e00\u4e2a\u526f\u672c\uff0c\u800c\u4e0d\u662f\u968f\u610f\u8fd0\u884c</p> <ul> <li>Job</li> </ul> <p>\u8fd0\u884c\u4e00\u6b21\u6027\u4f5c\u4e1a\uff0c\u65f6\u95f4\u4e0d\u56fa\u5b9a\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a\u5907\u4efd\u3001\u6e05\u7406\uff0c\u4e34\u65f6\u542f\u52a8\u4e00\u4e2a POD \u6765\u8fdb\u884c\u5907\u4efd\u7684\u4efb\u52a1\uff0c\u8fd0\u884c\u5b8c\u6210\u5c31\u7ed3\u675f\u4e86\u3002</p> <p>\u5982\u679c\u8fd0\u884c\u65f6\u5019 JOB \u6302\u4e86\uff0c\u90a3\u4e48\u9700\u8981\u91cd\u65b0\u542f\u52a8\u8d77\u6765\uff0c\u5982\u679c\u8fd0\u884c\u5b8c\u6210\u4e86\u5219\u4e0d\u9700\u8981\u518d\u542f\u52a8\u4e86\u3002</p> <ul> <li>Cronjob</li> </ul> <p>\u8fd0\u884c\u5468\u671f\u6027\u4f5c\u4e1a</p>"},{"location":"k8s/note/chapter-2/#22-service","title":"2.2 Service","text":"<p>\u4e3a\u5ba2\u6237\u7aef\u63d0\u4f9b\u4e00\u4e2a\u7a33\u5b9a\u7684\u8bbf\u95ee\u5165\u53e3\uff0cService \u9760\u6807\u7b7e\u9009\u62e9\u5668\u6765\u5173\u8054 POD \u7684\uff0c\u53ea\u8981 POD \u4e0a\u6709\u76f8\u5173\u7684\u6807\u7b7e\uff0c\u90a3\u4e48\u5c31\u4f1a\u88ab Service \u9009\u4e2d\uff0c\u4f5c\u4e3a Service \u7684\u540e\u7aef\uff0cService \u5173\u8054 POD \u540e\u4f1a\u52a8\u6001\u63a2\u6d4b\u8fd9\u4e2a POD \u7684 IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u5e76\u4f5c\u4e3a\u81ea\u5df1\u8c03\u5ea6\u7684\u540e\u7aef\u3002</p> <p>\u603b\u7684\u6765\u8bf4\u5ba2\u6237\u7aef\u8bf7\u6c42 Service \u7531 Service \u4ee3\u7406\u81f3\u540e\u7aef\u7684 POD\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u770b\u5230\u7684\u59cb\u7ec8\u662f Service \u7684\u5730\u5740\u3002</p> <p>K8S \u4e0a\u7684 Service \u4e0d\u662f\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u4e5f\u4e0d\u662f\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5b83\u662f\u4e00\u4e2a iptables dnat \u89c4\u5219\uff0c\u6216\u8005 ipvs \u89c4\u5219\uff0cService \u53ea\u662f\u89c4\u5219\uff0c\u6240\u4ee5\u662f ping \u4e0d\u901a\u7684\uff0c\u7531\u4e8e\u662fdnat\u89c4\u5219\u6216\u662fipvs\u89c4\u5219\uff0c\u53ef\u4ee5\u4f7f\u7528\u5229\u7528\u7aef\u53e3\u8fdb\u884c\u6d4b\u8bd5</p> <p>Service \u4f5c\u4e3a k8s \u7684\u5bf9\u8c61\u6765\u8bf4\uff0c\u662f\u6709\u540d\u79f0\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 Service \u7684\u540d\u79f0\u89e3\u6790\u4e3a Service \u7684 IP \u5730\u5740</p> <p>\u4e00\u822c\u683c\u5f0f: <code>svcname.namespace.svc.cluster.local</code>, \u5982\u679c\u5728\u540c\u4e00\u4e2a namespace \u4e2d\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 svcname , \u5982\u679c\u4e0d\u5728\u540c\u4e00\u4e2a namespace \u4e2d, \u9700\u8981\u5199\u5b8c\u6574\u7684FQDN\u57df\u540d\u3002</p> <ul> <li>AddOns</li> </ul> <p>\u89e3\u6790\u57df\u540d\u662f\u7531 DNS \u6765\u89e3\u6790\u7684\uff0c\u4e3a k8s \u4e2d\u63d0\u4f9b\u57df\u540d\u89e3\u6790\u8fd9\u79cd\u57fa\u7840\u670d\u52a1\uff0c\u79f0\u4e4b\u4e3a\u57fa\u7840\u67b6\u6784 POD \u4e5f\u79f0\u4e3a k8s \u9644\u4ef6\uff0c\u6240\u4ee5\u57df\u540d\u89e3\u6790\u7684 POD \u5c31\u662f k8s \u4e2d\u7684\u4e00\u79cd AddOns\u3002</p> <p>\u800c k8s \u4e2d\u7684 dns \u9644\u4ef6\uff0c\u662f\u52a8\u6001\u7684\uff0c\u4f8b\u5982\uff1aservice \u540d\u79f0\u53d1\u751f\u66f4\u6539\uff0c\u5c31\u4f1a\u81ea\u52a8\u89e6\u53d1 dns \u4e2d\u7684\u89e3\u6790\u8bb0\u5f55\u7684\u6539\u53d8\uff0c\u5982\u679c\u624b\u52a8\u4fee\u6539 service \u7684\u5730\u5740\uff0c\u4e5f\u4f1a\u81ea\u52a8\u89e6\u53d1 DNS \u89e3\u6790\u8bb0\u5f55\u7684\u6539\u53d8\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u670d\u52a1\u7684\u540d\u79f0\u3002</p>"},{"location":"k8s/note/chapter-2/#23","title":"2.3 \u7f51\u7edc\u6a21\u578b","text":"<p>k8s \u6709\u4e09\u79cd\u7f51\u7edc\uff1aPOD\u7f51\u7edc\u3001\u96c6\u7fa4\u7f51\u7edc\u3001\u8282\u70b9\u7f51\u7edc</p> <pre><code>POD\u7f51\u7edc\uff1a\u6240\u6709 POD \u5904\u4e8e\u540c\u4e00\u4e2a\u7f51\u7edc\u4e2d\uff0c\u53e0\u52a0\u7f51\u7edc\n\u96c6\u7fa4\u7f51\u7edc\uff1aService \u662f\u4e00\u4e2a\u53e6\u5916\u4e00\u4e2a\u7f51\u7edc\n\u8282\u70b9\u7f51\u7edc\uff1anode \u8282\u70b9\u4e5f\u662f\u53e6\u5916\u4e00\u4e2a\u7f51\u7edc\uff0c\u5bbf\u4e3b\u673a\u7684\u5185\u7f51\u7f51\u7edc\n</code></pre> <p>\u6240\u4ee5\uff0c\u63a5\u5165\u5916\u90e8\u8bbf\u95ee\u65f6\u5019\uff0c\u8bf7\u6c42\u9996\u5148\u5230\u8fbe node \u7f51\u7edc\uff0c\u7136\u540e node \u7f51\u7edc\u4ee3\u7406\u81f3 service \u7f51\u7edc\uff0cservice \u6839\u636e iptables/ipvs \u89c4\u5219\u6765\u8f6c\u53d1\u5230 pod \u7f51\u7edc\u4e2d\u7684 pod \u4e0a\u3002 <pre><code>NODE \u7f51\u7edc -&gt; SVC \u7f51\u7edc -&gt; POD \u7f51\u7edc\n</code></pre></p> <p>k8s \u6709\u4e09\u79cd\u901a\u4fe1\uff1a</p> <ul> <li> <p>\u540c\u4e00\u4e2a POD \u5185\u7684\u591a\u4e2a\u5bb9\u5668\u95f4\u7684\u901a\u4fe1\uff0c\u53ef\u4ee5\u901a\u8fc7 lo \u901a\u4fe1\u76f4\u63a5\u901a\u8baf\u3002</p> </li> <li> <p>POD \u4e0e POD \u901a\u4fe1\uff0c\u5982\u679c\u4f7f\u7528 flannel \u6240\u6709 POD \u90fd\u5904\u4e8e\u4e00\u4e2a\u7f51\u7edc\uff0c\u53ef\u4ee5\u8de8 node \u4e0e\u53e6\u5916\u7684 POD \u76f4\u63a5\u901a\u4fe1\uff0c\u56e0\u4e3a\u4f7f\u7528\u4e86\u53e0\u52a0\u7f51\u7edc\u3002</p> </li> <li> <p>POD \u4e0e Service \u901a\u4fe1\u3002</p> </li> </ul>"},{"location":"k8s/note/chapter-2/#24-kube-proxy","title":"2.4 kube-proxy","text":"<p>\u5728 node \u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\uff0c\u5b83\u8d1f\u8d23\u968f\u65f6\u4e0e apiserver \u8fdb\u884c\u901a\u4fe1\uff0c\u56e0\u4e3a\u6bcf\u4e2a pod \u53d1\u751f\u53d8\u5316\u540e\u9700\u8981\u4fdd\u5b58\u5728 apiserver \u4e2d\uff0c\u800c apiserver \u53d1\u751f\u6539\u53d8\u540e\u4f1a\u751f\u6210\u4e00\u4e2a\u901a\u77e5\u4e8b\u4ef6\uff0c\u8fd9\u4e2a\u4e8b\u4ef6\u53ef\u4ee5\u88ab\u4efb\u4f55\u5173\u8054\u7684\u7ec4\u4ef6\u63a5\u6536\u5230\uff0c\u4f8b\u5982\u88ab kube-proxy \u4e00\u65e6\u53d1\u73b0\u67d0\u4e2a service \u540e\u7aef\u7684 pod \u5730\u5740\u53d1\u751f\u6539\u53d8\uff0c\u90a3\u4e48\u5c31\u7531 kube-proxy \u8d1f\u8d23\u5728\u672c\u5730\u5c06\u5730\u5740\u5199\u5165 iptables \u6216\u8005 ipvs \u89c4\u5219\u4e2d\u3002</p> <p>\u6240\u4ee5 service \u7684\u7ba1\u7406\u662f\u9760 kube-proxy \u6765\u5b9e\u73b0\u7684\uff0c\u5f53\u4f60\u521b\u5efa\u4e00\u4e2a service \uff0c\u90a3\u4e48\u5c31\u9760 kube-proxy \u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u521b\u5efa\u4e3a iptables \u6216\u8005 ipvs \u89c4\u5219\uff0c\u6bcf\u4e2a service \u7684\u53d8\u52a8\u4e5f\u9700\u8981 kube-proxy \u53cd\u5e94\u5230\u89c4\u5219\u4e0a\u3002</p> <p>apiserver \u9700\u8981\u4fdd\u5b58\u5404\u4e2a node \u4fe1\u606f\uff0c\u5b83\u9700\u8981\u4fdd\u5b58\u5728 etcd \u4e2d\u3002</p>"},{"location":"k8s/note/chapter-2/#25-etcd","title":"2.5 etcd","text":"<p>\u662f\u4e00\u4e2a\u952e\u503c\u5b58\u50a8\u7684\u7cfb\u7edf\uff0c\u4e0e redis \u5f88\u50cf\uff0c\u4f46\u662f etcd \u8fd8\u6709\u4e00\u4e9b\u534f\u8c03\u529f\u80fd\u662f redis \u6240\u4e0d\u5177\u5907\u7684\uff0c\u5b83\u8fd8\u6709\u8282\u70b9\u9009\u4e3e\u7b49\u529f\u80fd\uff0c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bb2 etcd \u66f4\u50cf zookeeper\u3002</p> <p>\u7531\u4e8e\u6574\u4e2a\u96c6\u7fa4\u7684\u6240\u6709\u4fe1\u606f\u90fd\u4fdd\u5b58\u5728 etcd\uff0c\u6240\u4ee5 etcd \u5982\u679c\u5b95\u673a\uff0c\u90a3\u4e48\u6574\u4e2a\u96c6\u7fa4\u5c31\u6302\u4e86\uff0c\u56e0\u800c etcd \u9700\u8981\u505a\u9ad8\u53ef\u7528\u3002</p>"},{"location":"k8s/note/chapter-2/#26-flanel","title":"2.6 flanel","text":"<p>\u6258\u7ba1\u4e3a k8s \u7684\u9644\u4ef6\u8fd0\u884c, \u5728 k8s \u4e2d\u6709\u5f88\u591a\u5176\u4ed6\u7684\u5f00\u6e90\u7f51\u7edc\u63d2\u4ef6\uff0c\u4f8b\u5982\u9ad8\u6027\u80fd\u7684 calico \u4e09\u5c42\u7f51\u7edc\u63d2\u4ef6,\u6027\u80fd\u5f88\u597d\uff0c\u652f\u6301\u8bbf\u95ee\u63a7\u5236</p> <p>node \u7f51\u7edc\uff1a\u7269\u7406\u5404\u8282\u70b9\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1</p> <p>POD \u7f51\u7edc\uff1a\u6240\u6709 node\u4e0a\u7684 POD \u5f7c\u6b64\u4e4b\u95f4\u901a\u8fc7\u53e0\u52a0\uff0c\u6216\u8005\u76f4\u63a5\u8def\u7531\u65b9\u5f0f\u901a\u4fe1</p> <p>service \u7f51\u7edc\uff1a\u7531 kube-proxy \u8d1f\u8d23\u7ba1\u63a7\u548c\u751f\u6210</p>"},{"location":"k8s/note/chapter-2/#_2","title":"\u77e5\u8bc6\u5c0f\u7ed3","text":"<ul> <li>Master</li> </ul> <pre><code>kube-scheduler             # \u8c03\u5ea6 pod\nkuber-controller-manager   # \u7ba1\u7406 pod\nkube-apiserver             # \u63a5\u6536\u8bf7\u6c42\netcd                       # \u96c6\u7fa4\u72b6\u6001\u5b58\u50a8\uff0c\u96c6\u7fa4\u6240\u6709\u7684\u7ec4\u4ef6\u7684\u72b6\u6001\u90fd\u4fdd\u5b58\u5728\u8fd9\u91cc\n</code></pre> <ul> <li>node</li> </ul> <pre><code>kubelet                    # \u8282\u70b9/pod\u7ba1\u7406\nkube-proxy                 # watch apiserver\u7ba1\u7406service\ndocker                     # \u5bb9\u5668\u8fd0\u884c\u65f6\n</code></pre>"},{"location":"k8s/note/chapter-20/","title":"\u4e8c\u5341 HeapSter\u76d1\u63a7\uff08\u5e9f\u5f03\u4e2d\uff09","text":"<p>kubectl top \u662f k8s \u5185\u7f6e\u67e5\u770b POD \u76d1\u63a7\u4fe1\u606f\u7684\u547d\u4ee4\uff0c\u5b83\u662f\u4ece HeapSter \u4e2d\u53d6\u5f97\u6570\u636e\uff0c\u800c HeapSter \u662f\u8fd0\u884c\u5728 K8S \u96c6\u7fa4\u7ea7\u522b\u7684\u76d1\u63a7\u8f6f\u4ef6\u3002</p> <p>kubectl \u6709\u4e00\u4e2a\u5185\u7f6e\u63d2\u4ef6\uff0c\u53eb cAdvisor \u5b83\u7528\u6765\u6536\u96c6 node \u8282\u70b9\u548c\u8282\u70b9\u4e0a\u7684 POD \u4e0a\u7684\u8d44\u6e90\u4f7f\u7528\u91cf\uff0cHeapSter \u53ef\u4ee5\u6536\u96c6 cAdvisor \u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u91c7\u96c6\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u60f3\u8981\u6301\u7eed\u5b58\u50a8\uff0c\u90a3\u4e48\u5c31\u5fc5\u987b\u5c06\u6570\u636e\u653e\u5728 influx DB \u7684\u6570\u636e\u5e93\u4e2d\uff0c\u7136\u540e\u53ef\u4ee5\u4f7f\u7528 Grafana \u914d\u7f6e influx DB \u4e3a\u6570\u636e\u6e90\uff0c\u7136\u540e\u5c55\u793a\u3002</p> <ul> <li>heapster \u5b98\u65b9\u9879\u76ee</li> </ul> <pre><code>https://github.com/kubernetes-retired/heapster\n</code></pre>"},{"location":"k8s/note/chapter-20/#201-influx-db","title":"20.1 \u5b89\u88c5 influx DB","text":"<p>influx DB \u662f\u4e00\u4e2a\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u5b83\u9700\u8981\u4e00\u4e2a\u6301\u4e45\u5b58\u50a8\u6765\u4fdd\u5b58\u6570\u636e\uff0c\u6240\u4ee5\u8981\u6ce8\u610f\u7684\u662f\u5728\u5b83\u7684\u6e05\u5355\u6587\u4ef6\u4e2d\u5e94\u8be5\u5c06\u5b98\u65b9\u9ed8\u8ba4\u7684 emptyDir \u4fee\u6539\u4e3a\u5177\u6709\u6301\u4e45\u5b58\u50a8\u80fd\u529b\u7684\u5b58\u50a8\u5377\u3002</p> <ul> <li>heapster/deploy/kube-config/influxdb/influxdb.yaml</li> </ul> <pre><code>apiVersion: apps/v1                     # \u6b64\u5904\u4fee\u6539\u4e3a apps/v1\uff0c\u7531\u4e8e\u4fee\u6539\u4e86\u6b64\u5904\u6240\u4ee5\u8fd8\u9700\u8981\u4fee\u6539\u6807\u7b7e\u9009\u62e9\u5668\nkind: Deployment\nmetadata:\n  name: monitoring-influxdb\n  namespace: kube-system\nspec:\n  replicas: 1\n  selector:                             # \u6dfb\u52a0\u6807\u7b7e\n    matchLables:                        # \u6dfb\u52a0\u6807\u7b7e\n      task: monitoring                  # \u6dfb\u52a0\u6807\u7b7e\n      k8s-app: influxdb                 # \u6dfb\u52a0\u6807\u7b7e\n  template:\n    metadata:\n      labels:\n        task: monitoring\n        k8s-app: influxdb\n    spec:\n      containers:\n      - name: influxdb\n        image: k8s.gcr.io/heapster-influxdb-amd64:v1.5.2\n        volumeMounts:\n        - mountPath: /data\n          name: influxdb-storage\n      volumes:\n      - name: influxdb-storage\n        emptyDir: {}                    # \u6b64\u5904\u5e94\u8be5\u4fee\u6539\u4e3a\u5177\u6709\u6301\u4e45\u5b58\u50a8\u80fd\u529b\u7684\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    task: monitoring\n    # For use as a Cluster add-on (https://github.com/kubernetes/kubernetes/tree/master/cluster/addons)\n    # If you are NOT using this as an addon, you should comment out this line.\n    kubernetes.io/cluster-service: 'true'\n    kubernetes.io/name: monitoring-influxdb\n  name: monitoring-influxdb\n  namespace: kube-system\nspec:\n  ports:\n  - port: 8086\n    targetPort: 8086\n  selector:\n    k8s-app: influxdb\n</code></pre> <ul> <li>\u67e5\u770b service \u548c pod</li> </ul> <pre><code>$ kubectl get svc -n kube-system\nNAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                  AGE\nkube-dns               ClusterIP   10.96.0.10       &lt;none&gt;        53/UDP,53/TCP,9153/TCP   9d\nkubernetes-dashboard   NodePort    10.109.5.194     &lt;none&gt;        443:30894/TCP            3d14h\nmonitoring-influxdb    ClusterIP   10.104.173.236   &lt;none&gt;        8086/TCP                 18s\n\n$ kubectl get pod -n kube-system\nNAME                                    READY   STATUS    RESTARTS   AGE\n.....\nmonitoring-influxdb-866db5f944-d7rkd    1/1     Running   0          69s\n</code></pre>"},{"location":"k8s/note/chapter-20/#202-heapster","title":"20.2 \u5b89\u88c5 HeapSter","text":"<ul> <li>\u9996\u5148\u5b89\u88c5 rbac \u7684\u7528\u6237\uff0cheapster/deploy/kube-config/rbac/heapster-rbac.yaml</li> </ul> <pre><code>kind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: heapster\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:heapster\nsubjects:\n- kind: ServiceAccount\n  name: heapster\n  namespace: kube-system\n</code></pre> <ul> <li>\u5b89\u88c5 heapster\uff0cheapster/deploy/kube-config/influxdb/heapster.yaml</li> </ul> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: heapster\n  namespace: kube-system\n---\napiVersion: apps/v1                    # \u4fee\u6539\u6b64\u5904\u7684\u4e3a apps/v1\uff0c\u4fee\u6539\u6b64\u5904\u4ee5\u540e\u8fd8\u9700\u8981\u6dfb\u52a0 selector \nkind: Deployment\nmetadata:\n  name: heapster\n  namespace: kube-system\nspec:\n  replicas: 1\n  selector:                           # \u56e0\u4e3a\u4fee\u6539 api \u7248\u672c\u6240\u4ee5\u9700\u8981\u6dfb\u52a0\n    matchLabels:                      # \u6dfb\u52a0\n      task: monitoring                # \u6dfb\u52a0\n      k8s-app: heapster               # \u6dfb\u52a0\n  template:\n    metadata:\n      labels:\n        task: monitoring\n        k8s-app: heapster\n    spec:\n      serviceAccountName: heapster\n      containers:\n      - name: heapster\n        image: k8s.gcr.io/heapster-amd64:v1.5.4\n        imagePullPolicy: IfNotPresent\n        command:\n        - /heapster\n        - --source=kubernetes:https://kubernetes.default\n        - --sink=influxdb:http://monitoring-influxdb.kube-system.svc:8086\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    task: monitoring\n    kubernetes.io/cluster-service: 'true'\n    kubernetes.io/name: Heapster\n  name: heapster\n  namespace: kube-system\nspec:\n  ports:\n  - port: 80\n    targetPort: 8082\n  selector:\n    k8s-app: heapster\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c\uff0ckubectl get pods -n kube-system</li> </ul> <pre><code>NAME                                    READY   STATUS    RESTARTS   AGE\n...\nheapster-5d4bf58946-6dmgf               1/1     Running   0          113s\nmonitoring-influxdb-866db5f944-d7rkd    1/1     Running   0          23m\n</code></pre>"},{"location":"k8s/note/chapter-20/#203-grafana","title":"20.3 \u5b89\u88c5 Grafana","text":"<ul> <li>\u5b89\u88c5 Grafana \u6e05\u5355\uff1aheapster/deploy/kube-config/influxdb/grafana.yaml</li> </ul> <pre><code>apiVersion: apps/v1                # \u4fee\u6539\u6b64\u5904\u4e3a apps/v1\nkind: Deployment\nmetadata:\n  name: monitoring-grafana\n  namespace: kube-system\nspec:\n  replicas: 1\n  selector:                        # \u7531\u4e8e\u4fee\u6539\u4e86 api \u7248\u672c\uff0c\u6240\u4ee5\u589e\u52a0\u6b64\u5904\n    matchLabels:                   # \u6807\u7b7e\u9009\u62e9\u5668\n      task: monitoring             # \u6807\u7b7e\u9009\u62e9\u5668\n      k8s-app: grafana             # \u6807\u7b7e\u9009\u62e9\u5668\n  template:\n    metadata:\n      labels:\n        task: monitoring\n        k8s-app: grafana\n    spec:\n      containers:\n      - name: grafana\n        image: k8s.gcr.io/heapster-grafana-amd64:v5.0.4\n        ports:\n        - containerPort: 3000\n          protocol: TCP\n        volumeMounts:\n        - mountPath: /etc/ssl/certs\n          name: ca-certificates\n          readOnly: true\n        - mountPath: /var\n          name: grafana-storage\n        env:\n        - name: INFLUXDB_HOST\n          value: monitoring-influxdb\n        - name: GF_SERVER_HTTP_PORT\n          value: \"3000\"\n        - name: GF_AUTH_BASIC_ENABLED\n          value: \"false\"\n        - name: GF_AUTH_ANONYMOUS_ENABLED\n          value: \"true\"\n        - name: GF_AUTH_ANONYMOUS_ORG_ROLE\n          value: Admin\n        - name: GF_SERVER_ROOT_URL\n          value: /\n      volumes:\n      - name: ca-certificates\n        hostPath:\n          path: /etc/ssl/certs              # \u6ce8\u610f\u914d\u7f6e ssl \u8bc1\u4e66\n      - name: grafana-storage\n        emptyDir: {}                       # \u6ce8\u610f\u914d\u7f6e\u6301\u4e45\u5b58\u50a8\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    kubernetes.io/cluster-service: 'true'\n    kubernetes.io/name: monitoring-grafana\n  name: monitoring-grafana\n  namespace: kube-system\nspec:\n  type: NodePort                         # \u5982\u679c\u9700\u8981\u901a\u8fc7\u5916\u90e8\u8bbf\u95ee\u53ef\u4ee5\u6253\u5f00\uff0c\u53ef\u4ee5\u5173\u95ed heapster \u7684\u6b64\u9879\n  ports:\n  - port: 80\n    targetPort: 3000\n  selector:\n    k8s-app: grafana\n</code></pre>"},{"location":"k8s/note/chapter-21/","title":"\u4e8c\u5341\u4e00 \u65b0\u4e00\u4ee3\u76d1\u63a7\u67b6\u6784","text":""},{"location":"k8s/note/chapter-21/#211","title":"21.1 \u6838\u5fc3\u6307\u6807\u6d41\u6c34\u7ebf","text":"<p>\u7531 kubelet\u3001metrics-server \u4ee5\u53ca\u7531 apiserver \u63d0\u4f9b\u7684 api \u7ec4\u6210\uff1b\u4e3b\u8981 CPU\u7d2f\u8ba1\u4f7f\u7528\u7387\u3001\u5185\u5b58\u5b9e\u65f6\u4f7f\u7528\u7387\u3001POD \u8d44\u6e90\u5360\u7528\u7387\u53ca\u5bb9\u5668\u7684\u78c1\u76d8\u5360\u7528\u7387\u3002</p> <ul> <li>metrics-server\uff08\u65b0\u4e00\u4ee3\u7684\u8d44\u6e90\u6307\u6807\u83b7\u53d6\u65b9\u5f0f\uff09</li> </ul> <p>\u5b83\u662f\u4e00\u4e2a apiserver \uff0c\u5b83\u4ec5\u4ec5\u7528\u4e8e\u670d\u52a1\u4e8e\u6838\u5fc3\u6307\u6807\u670d\u52a1\u7684\uff0c\u5b83\u4e0d\u662f k8s \u7684\u7ec4\u6210\u90e8\u5206\uff0c\u4ec5\u4ec5\u662f\u6258\u7ba1\u5728 k8s \u4e4b\u4e0a POD\u3002</p> <p>k8s \u7684 apiserver \u548c metrics-server \u7684 apiserver \u524d\u7aef\u5e94\u8be5\u52a0\u4e00\u4e2a\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u5b83\u5c31\u662f\u4e00\u4e2a\u805a\u5408\u5668\uff0c\u628a\u6765\u81ea\u591a\u4e2a\u4e0d\u540c\u7684 apiserver \u805a\u5408\u6210\u4e00\u4e2a\u3002\u5b83\u5c31\u662f kube-aggregator\uff0c\u7ecf\u8fc7\u5b83\u805a\u5408\u540e\u7684 api \u6211\u4e48\u5c06\u901a\u8fc7 /apis/metrics.k8s.io/v1/beta1 \u6765\u83b7\u53d6\u3002</p>"},{"location":"k8s/note/chapter-21/#212","title":"21.2\u76d1\u63a7\u6d41\u6c34\u7ebf","text":"<p>\u7528\u4e8e\u4ece\u7cfb\u7edf\u6536\u96c6\u5404\u79cd\u6307\u6807\u6570\u636e\u5e76\u63d0\u4f9b\u7ec8\u7aef\u7528\u6237\u3001\u5b58\u50a8\u7cfb\u7edf\u4ee5\u53ca HPA\uff0c\u5b83\u5305\u542b\u6838\u5fc3\u6307\u6807\u548c\u975e\u6838\u5fc3\u6307\u6807\uff0c\u975e\u6838\u5fc3\u6307\u6807\u4e0d\u80fd\u88ab k8s \u6240\u7406\u89e3\uff0ck8s-prometheus-adapter \u5c31\u662f\u8f6c\u6362\u4e3a k8s \u6240\u7406\u89e3\u683c\u5f0f\u7684\u4e00\u4e2a\u63d2\u4ef6</p> <ul> <li>prometheus</li> </ul> <p>CNCF\u4e0b\u7684\u7b2c\u4e8c\u5927\u9879\u76ee\uff0c\u6536\u96c6\u5404\u79cd\u7ef4\u5ea6\u7684\u6307\u6807\uff0c</p> <p>\u5b83\u6536\u96c6\u7684\u4fe1\u606f\uff0c\u6765\u51b3\u5b9a\u662f\u5426\u8fdb\u884c HPA\uff08\u81ea\u52a8\u4f38\u7f29\uff09 \u7684\u4e00\u4e2a\u6807\u51c6</p> <p>prometheus \u65e2\u4f5c\u4e3a\u76d1\u63a7\u7cfb\u7edf\u4f7f\u7528\uff0c\u4e5f\u4f5c\u4e3a\u7279\u6b8a\u6307\u6807\u7684\u63d0\u4f9b\u8005\u6765\u4f7f\u7528\uff0c\u4f46\u662f\u5982\u679c\u60f3\u8981\u4f5c\u4e3a\u7279\u6b8a\u6307\u6807\u63d0\u4f9b\u7ed9 HPA \u8fd9\u6837\u7684\u673a\u5236\u4f7f\u7528\uff0c\u9700\u8981\u8f6c\u6362\u683c\u5f0f\uff0c\u800c\u8fd9\u4e2a\u8f6c\u6362\u4e3a\u7279\u6b8a\u6307\u6807\u7684\u4e00\u4e2a\u63d2\u4ef6\u53eb\uff1ak8s-prometheus-adapter\u3002</p>"},{"location":"k8s/note/chapter-21/#213-metrics-server","title":"21.3 \u5b89\u88c5 metrics-server","text":"<ul> <li>\u5b98\u65b9\u4ed3\u5e93\uff0c\u8fd9\u91cc\u6211\u4f7f\u7528\u7b2c\u4e00\u4e2a</li> </ul> <pre><code>https://github.com/kubernetes-incubator/metrics-server/tree/master/deploy/1.8%2B      # \u63d2\u4ef6\u5b98\u65b9\u5730\u5740\nhttps://github.com/kubernetes/kubernetes/tree/master/cluster/addons/metrics-server    # k8s \u5b98\u65b9\u63d2\u4ef6\u793a\u4f8b\n</code></pre> <ul> <li>\u5b89\u88c5\u90e8\u7f72\u76f8\u5173\u7684\u6587\u4ef6\uff1a/tree/master/deploy/\uff0c\u4fee\u6539 metrics-server-deployment.yaml \u6587\u4ef6</li> </ul> <pre><code>      containers:\n      - name: metrics-server\n        image: k8s.gcr.io/metrics-server-amd64:v0.3.1\n        imagePullPolicy: Always\n        args:                                               # \u6dfb\u52a0\u53c2\u6570\n        - '--kubelet-preferred-address-types=InternalIP'    # \u4e0d\u4f7f\u7528\u4e3b\u673a\u540d\uff0c\u4f7f\u7528 IP\n        - '--kubelet-insecure-tls'                          # \u4e0d\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\n        volumeMounts:\n        - name: tmp-dir\n          mountPath: /tmp\n</code></pre> <pre><code>$ kubectl apply -f ./\n</code></pre> <ul> <li>\u67e5\u770b POD \u548c Service \u7684\u542f\u52a8\u60c5\u51b5</li> </ul> <pre><code>$ kubectl get pods -n kube-system\n$ kubectl get svc -n kube-system\n</code></pre> <ul> <li>\u67e5\u770b API \u4e2d\u662f\u5426\u5b58\u5728\uff0cmetrics.k8s.io/v1beta1</li> </ul> <pre><code>$ kubectl api-versions\n</code></pre> <ul> <li>\u901a\u8fc7\u6d4b\u8bd5\u63a5\u53e3\u83b7\u53d6\u76d1\u63a7\u6570\u636e\uff0ckubectl proxy --port 8080\uff0ckubectl top \u4e5f\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u4e86</li> </ul> <pre><code>$ curl http://127.0.0.1:8080/apis/metrics.k8s.io/v1beta1\n$ kubectl top nodes\n</code></pre>"},{"location":"k8s/note/chapter-21/#214-prometheus","title":"21.4 \u5b89\u88c5 prometheus","text":"<ul> <li>\u5de5\u4f5c\u539f\u7406</li> </ul> <pre><code>-   prometheus \u901a\u8fc7 pull metrilcs \u6307\u4ee4\u4ece\u6bcf\u4e2a Jobs/exporters \u62c9\u53d6\u6570\u636e\n-   \u5176\u4ed6\u7684 short-lived jobs \u4e5f\u53ef\u4ee5\u901a\u8fc7\u5411 pushgateway \u4e3b\u52a8\u53d1\u9001\u6570\u636e\uff0c\u7531 prometheus \u88ab\u52a8\u63a5\u6536\n-   prometheus \u81ea\u8eab\u5b9e\u73b0\u4e86\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5e93\uff0c\u4f1a\u5c06\u5f97\u5230\u7684\u6570\u636e\u5b58\u50a8\u5230\u5176\u4e2d\n-   \u5728 k8s \u9700\u8981\u4f7f\u7528 service discovery \u6765\u53d1\u73b0\u670d\u52a1\u53d6\u5f97\u9700\u8981\u76d1\u63a7\u7684\u76ee\u6807\n-   \u53ef\u4ee5\u4f7f\u7528 apiclient\u3001webui\u3001Grafana\u3001\u6765\u5c06 prometheus \u4e2d\u7684\u6570\u636e\u5c55\u793a\u51fa\u6765\n-   \u5f53\u9700\u8981\u62a5\u8b66\u7684\u65f6\u5019\u8fd8\u4f1a\u63a8\u9001\u7ed9 alertmanager \u8fd9\u4e2a\u7ec4\u4ef6\u7531\u8fd9\u4e2a\u7ec4\u4ef6\u6765\u53d1\u9001\u62a5\u8b66\n</code></pre> <ul> <li>\u90e8\u7f72\u6587\u4ef6</li> </ul> <pre><code>https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/prometheus\nhttps://github.com/iKubernetes/k8s-prom\n</code></pre>"},{"location":"k8s/note/chapter-21/#215-hpa","title":"21.5 HPA\u547d\u4ee4\u884c\u65b9\u5f0f","text":"<ul> <li>\u521b\u5efa POD \u548c service</li> </ul> <pre><code>kubectl run myapp --image=ikubernetes/myapp:v1 --replicas=1 --requests='cpu=50m',memory='256Mi' --limits='cpu=50m,memory=256Mi' --labels='app=myapp' --expose --port=80\n</code></pre> <ul> <li>\u521b\u5efa HPA \u63a7\u5236\u5668</li> </ul> <pre><code>kubectl autoscale deployment myapp --min=1 --max=8 --cpu-percent=60\n</code></pre> <ul> <li>\u67e5\u770b HPA \u63a7\u5236\u5668\uff0ckubectl get hpa</li> </ul> <pre><code>NAME    REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\nmyapp   Deployment/myapp   0%/60%    1         8         1          17s\n</code></pre> <ul> <li>\u5f00\u59cb\u538b\u529b\u6d4b\u8bd5</li> </ul> <pre><code>ab -c 100 -n 5000000 http://172.16.100.102:32749/index.html\n</code></pre> <ul> <li>\u6d4b\u8bd5\u7ed3\u679c\uff0c\u81ea\u52a8\u6269\u5bb9\u751f\u6548</li> </ul> <pre><code>$ kubectl get hpa -w\nNAME    REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\nmyapp   Deployment/myapp   0%/60%    1         8         1          7m35s\nmyapp   Deployment/myapp   34%/60%   1         8         1          9m58s\nmyapp   Deployment/myapp   102%/60%   1         8         1          11m\nmyapp   Deployment/myapp   102%/60%   1         8         2          11m\nmyapp   Deployment/myapp   96%/60%    1         8         2          12m\nmyapp   Deployment/myapp   96%/60%    1         8         4          12m\nmyapp   Deployment/myapp   31%/60%    1         8         4          13m\nmyapp   Deployment/myapp   26%/60%    1         8         4          14m\nmyapp   Deployment/myapp   0%/60%     1         8         4          15m\nmyapp   Deployment/myapp   0%/60%     1         8         4          17m\nmyapp   Deployment/myapp   0%/60%     1         8         3          18m\n\n$ kubectl get pods\nNAME                     READY   STATUS        RESTARTS   AGE\nmyapp-64bf6764c5-45qwj   0/1     Terminating   0          7m1s\nmyapp-64bf6764c5-72crv   1/1     Running       0          20m\nmyapp-64bf6764c5-gmz6c   1/1     Running       0          8m1s\n</code></pre>"},{"location":"k8s/note/chapter-21/#216-hpa","title":"21.6 HPA\u6e05\u5355","text":"<ul> <li>\u6e05\u5355\u5b9a\u4e49\u8be6\u89c1\uff1akubectl explain hpa.spec</li> </ul> <pre><code>maxReplicas                       &lt;integer&gt;         # \u81ea\u52a8\u4f38\u7f29\u7684 POD \u6570\u91cf\u4e0a\u9650\nminReplicas                       &lt;integer&gt;         # \u81ea\u52a8\u4f38\u7f29\u7684 POD \u6570\u91cf\u4e0b\u9650\nscaleTargetRef                    &lt;Object&gt;          # \u5176\u4ed6\u7684\u4f38\u7f29\u6307\u6807\n  apiVersion                      &lt;string&gt;          # \u6307\u6807 api \u7248\u672c\n  kind                            &lt;string&gt;          # \u6307\u6807\u7c7b\u578b\n  name                            &lt;string&gt;          # \u53ef\u7528\u6307\u6807\ntargetCPUUtilizationPercentage    &lt;integer&gt;         # \u6839\u636e\u76ee\u6807 \u5e73\u5747 CPU \u5229\u7528\u7387\u9608\u503c\u8bc4\u4f30\u81ea\u52a8\u4f38\u7f29\n</code></pre> <ul> <li>\u793a\u4f8b\u6e05\u5355\uff0c\u5b83\u5b9e\u73b0\u4e86\u5bf9 myapp \u8fd9\u4e2a deployment \u63a7\u5236\u5668\u4e0b\u7684 POD \u8fdb\u884c\u81ea\u52a8\u6269\u5bb9</li> </ul> <pre><code>apiVersion: autoscaling/v2beta1\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: myapp-hpa-v2\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: myapp\n  minReplicas: 1\n  maxReplicas: 10\n  metrics:\n  - type: Resource\n    resource:\n      name: cpu\n      targetAverageUtilization: 55\n  - type: Resource\n    resource:\n      name: memory\n      targetAverageValue: 50Mi\n</code></pre>"},{"location":"k8s/note/chapter-22/","title":"\u4e8c\u5341\u4e8c K8S\u5305\u7ba1\u7406\u5668","text":"<p>Helm \u662f Deis \u5f00\u53d1\u7684\u4e00\u4e2a\u7528\u4e8e Kubernetes \u5e94\u7528\u7684\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u4e3b\u8981\u7528\u6765\u7ba1\u7406 Charts\u3002\u6709\u70b9\u7c7b\u4f3c\u4e8e Ubuntu \u4e2d\u7684 APT \u6216 CentOS \u4e2d\u7684 YUM\u3002</p> <p>Helm Chart \u662f\u7528\u6765\u5c01\u88c5 Kubernetes \u539f\u751f\u5e94\u7528\u7a0b\u5e8f\u7684\u4e00\u7cfb\u5217 YAML \u6587\u4ef6\u3002\u53ef\u4ee5\u5728\u4f60\u90e8\u7f72\u5e94\u7528\u7684\u65f6\u5019\u81ea\u5b9a\u4e49\u5e94\u7528\u7a0b\u5e8f\u7684\u4e00\u4e9b Metadata\uff0c\u4ee5\u4fbf\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684\u5206\u53d1\u3002</p> <p>\u5bf9\u4e8e\u5e94\u7528\u53d1\u5e03\u8005\u800c\u8a00\uff0c\u53ef\u4ee5\u901a\u8fc7 Helm \u6253\u5305\u5e94\u7528\u3001\u7ba1\u7406\u5e94\u7528\u4f9d\u8d56\u5173\u7cfb\u3001\u7ba1\u7406\u5e94\u7528\u7248\u672c\u5e76\u53d1\u5e03\u5e94\u7528\u5230\u8f6f\u4ef6\u4ed3\u5e93\u3002</p> <p>\u5bf9\u4e8e\u4f7f\u7528\u8005\u800c\u8a00\uff0c\u4f7f\u7528 Helm \u540e\u4e0d\u7528\u9700\u8981\u7f16\u5199\u590d\u6742\u7684\u5e94\u7528\u90e8\u7f72\u6587\u4ef6\uff0c\u53ef\u4ee5\u4ee5\u7b80\u5355\u7684\u65b9\u5f0f\u5728 Kubernetes \u4e0a\u67e5\u627e\u3001\u5b89\u88c5\u3001\u5347\u7ea7\u3001\u56de\u6eda\u3001\u5378\u8f7d\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"k8s/note/chapter-22/#221","title":"22.1 \u57fa\u7840\u6982\u5ff5","text":"<ul> <li>Helm</li> </ul> <p>Helm \u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u4e0b\u7684\u5ba2\u6237\u7aef\u5de5\u5177\u3002\u4e3b\u8981\u7528\u4e8e Kubernetes \u5e94\u7528\u7a0b\u5e8f Chart \u7684\u521b\u5efa\u3001\u6253\u5305\u3001\u53d1\u5e03\u4ee5\u53ca\u521b\u5efa\u548c\u7ba1\u7406\u672c\u5730\u548c\u8fdc\u7a0b\u7684 Chart \u4ed3\u5e93\u3002</p> <ul> <li>Tiller</li> </ul> <p>Tiller \u662f Helm \u7684\u670d\u52a1\u7aef\uff0c\u90e8\u7f72\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u3002Tiller \u7528\u4e8e\u63a5\u6536 Helm \u7684\u8bf7\u6c42\uff0c\u5e76\u6839\u636e Chart \u751f\u6210 Kubernetes \u7684\u90e8\u7f72\u6587\u4ef6\uff08Helm \u79f0\u4e3a Release\uff09\uff0c\u7136\u540e\u63d0\u4ea4\u7ed9 Kubernetes \u521b\u5efa\u5e94\u7528\u3002Tiller \u8fd8\u63d0\u4f9b\u4e86 Release \u7684\u5347\u7ea7\u3001\u5220\u9664\u3001\u56de\u6eda\u7b49\u4e00\u7cfb\u5217\u529f\u80fd\u3002</p> <ul> <li>Chart</li> </ul> <p>Helm \u7684\u8f6f\u4ef6\u5305\uff0c\u91c7\u7528 TAR \u683c\u5f0f\u3002\u7c7b\u4f3c\u4e8e APT \u7684 DEB \u5305\u6216\u8005 YUM \u7684 RPM \u5305\uff0c\u5176\u5305\u542b\u4e86\u4e00\u7ec4\u5b9a\u4e49 Kubernetes \u8d44\u6e90\u76f8\u5173\u7684 YAML \u6587\u4ef6\u3002</p> <ul> <li>Repoistory</li> </ul> <p>Helm \u7684\u8f6f\u4ef6\u4ed3\u5e93\uff0cRepository \u672c\u8d28\u4e0a\u662f\u4e00\u4e2a Web \u670d\u52a1\u5668\uff0c\u8be5\u670d\u52a1\u5668\u4fdd\u5b58\u4e86\u4e00\u7cfb\u5217\u7684 Chart \u8f6f\u4ef6\u5305\u4ee5\u4f9b\u7528\u6237\u4e0b\u8f7d\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8be5 Repository \u7684 Chart \u5305\u7684\u6e05\u5355\u6587\u4ef6\u4ee5\u4f9b\u67e5\u8be2\uff0cHelm \u53ef\u4ee5\u540c\u65f6\u7ba1\u7406\u591a\u4e2a\u4e0d\u540c\u7684 Repository\u3002</p> <ul> <li>Release</li> </ul> <p>\u4f7f\u7528 helm install \u547d\u4ee4\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u90e8\u7f72\u7684 Chart \u79f0\u4e3a Release\u3002Chart \u4e0e Release \u7684\u5173\u7cfb\u7c7b\u4f3c\u4e8e\u9762\u5411\u5bf9\u8c61\u4e2d\u7684\u7c7b\u4e0e\u5b9e\u4f8b\u7684\u5173\u7cfb\u3002</p>"},{"location":"k8s/note/chapter-22/#222-helm","title":"22.2 Helm \u5de5\u4f5c\u539f\u7406","text":"<ul> <li>Chart Install \u8fc7\u7a0b</li> </ul> <pre><code>1. Helm \u4ece\u6307\u5b9a\u7684\u76ee\u5f55\u6216\u8005 TAR \u6587\u4ef6\u4e2d\u89e3\u6790\u51fa Chart \u7ed3\u6784\u4fe1\u606f\u3002\n2. Helm \u5c06\u6307\u5b9a\u7684 Chart \u7ed3\u6784\u548c Values \u4fe1\u606f\u901a\u8fc7 gRPC \u4f20\u9012\u7ed9 Tiller\u3002\n3. Tiller \u6839\u636e Chart \u548c Values \u751f\u6210\u4e00\u4e2a Release\u3002\n4. Tiller \u5c06 Release \u53d1\u9001\u7ed9 Kubernetes \u7528\u4e8e\u751f\u6210 Release\u3002\n</code></pre> <ul> <li>Chart Update \u8fc7\u7a0b</li> </ul> <pre><code>1. Helm \u4ece\u6307\u5b9a\u7684\u76ee\u5f55\u6216\u8005 TAR \u6587\u4ef6\u4e2d\u89e3\u6790\u51fa Chart \u7ed3\u6784\u4fe1\u606f\u3002\n2. Helm \u5c06\u9700\u8981\u66f4\u65b0\u7684 Release \u7684\u540d\u79f0\u3001Chart \u7ed3\u6784\u548c Values \u4fe1\u606f\u4f20\u9012\u7ed9 Tiller\u3002\n3. Tiller \u751f\u6210 Release \u5e76\u66f4\u65b0\u6307\u5b9a\u540d\u79f0\u7684 Release \u7684 History\u3002\n4. Tiller \u5c06 Release \u53d1\u9001\u7ed9 Kubernetes \u7528\u4e8e\u66f4\u65b0 Release\u3002\n</code></pre> <ul> <li>Chart Rollback \u8fc7\u7a0b</li> </ul> <pre><code>1. Helm \u5c06\u8981\u56de\u6eda\u7684 Release \u7684\u540d\u79f0\u4f20\u9012\u7ed9 Tiller\u3002\n2. Tiller \u6839\u636e Release \u7684\u540d\u79f0\u67e5\u627e History\u3002\n3. Tiller \u4ece History \u4e2d\u83b7\u53d6\u4e0a\u4e00\u4e2a Release\u3002\n4. Tiller \u5c06\u4e0a\u4e00\u4e2a Release \u53d1\u9001\u7ed9 Kubernetes \u7528\u4e8e\u66ff\u6362\u5f53\u524d Release\u3002\n</code></pre> <ul> <li>Chart \u5904\u7406\u4f9d\u8d56\u8bf4\u660e</li> </ul> <pre><code>Tiller \u5728\u5904\u7406 Chart \u65f6\uff0c\u76f4\u63a5\u5c06 Chart \u4ee5\u53ca\u5176\u4f9d\u8d56\u7684\u6240\u6709 Charts \u5408\u5e76\u4e3a\u4e00\u4e2a Release\uff0c\u540c\u65f6\u4f20\u9012\u7ed9 Kubernetes\u3002\n\u56e0\u6b64 Tiller \u5e76\u4e0d\u8d1f\u8d23\u7ba1\u7406\u4f9d\u8d56\u4e4b\u95f4\u7684\u542f\u52a8\u987a\u5e8f\u3002Chart \u4e2d\u7684\u5e94\u7528\u9700\u8981\u80fd\u591f\u81ea\u884c\u5904\u7406\u4f9d\u8d56\u5173\u7cfb\u3002\n</code></pre>"},{"location":"k8s/note/chapter-22/#223-helm","title":"22.3 \u90e8\u7f72 Helm","text":"<p>\u5b98\u65b9 github \u5730\u5740\uff1ahttps://github.com/helm/helm</p> <ul> <li>\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u7248\u672c\uff0c\u89e3\u538b\u5e76\u5b89\u88c5 helm</li> </ul> <pre><code>$ wget https://storage.googleapis.com/kubernetes-helm/helm-v2.13.1-linux-amd64.tar.gz\n$ tar xf helm-v2.13.1-linux-amd64.tar.gz\n$ mv helm /usr/local/bin/\n</code></pre> <ul> <li>\u521d\u59cb\u5316 tiller \u65f6\u5019\u4f1a\u81ea\u52a8\u8bfb\u53d6 ~/.kube \u76ee\u5f55\uff0c\u6240\u4ee5\u9700\u8981\u786e\u4fdd config \u6587\u4ef6\u5b58\u5728\u5e76\u8ba4\u8bc1\u6210\u529f</li> <li>tiller \u914d\u7f6e rbac\uff0c\u65b0\u5efa rbac-config.yaml\uff0c\u5e76\u5e94\u7528</li> </ul> <pre><code>https://github.com/helm/helm/blob/master/docs/rbac.md    # \u5728\u8fd9\u4e2a\u9875\u9762\u4e2d\u627e\u5230 rbac-config.yaml \n</code></pre> <pre><code>$ kubectl apply -f tiller-rbac.yaml\n</code></pre> <ul> <li>\u521d\u59cb\u5316 tiller \u65f6\u5019\u4f1a\u81ea\u52a8\u8bfb\u53d6 ~/.kube \u76ee\u5f55\uff0c\u6240\u4ee5\u9700\u8981\u786e\u4fdd config \u6587\u4ef6\u5b58\u5728\u5e76\u8ba4\u8bc1\u6210\u529f</li> </ul> <pre><code>$ helm init --service-account tiller\n</code></pre> <ul> <li>\u6dfb\u52a0 incubator \u6e90</li> </ul> <pre><code>$ helm repo add incubator https://aliacs-app-catalog.oss-cn-hangzhou.aliyuncs.com/charts-incubator/\n$ helm repo update\n</code></pre> <ul> <li>\u5b89\u88c5\u5b8c\u6210\uff0c\u67e5\u770b\u7248\u672c</li> </ul> <pre><code>$ helm version\n</code></pre> <pre><code>Client: &amp;version.Version{SemVer:\"v2.13.1\", GitCommit:\"618447cbf203d147601b4b9bd7f8c37a5d39fbb4\", GitTreeState:\"clean\"}\nServer: &amp;version.Version{SemVer:\"v2.9.1\", GitCommit:\"20adb27c7c5868466912eebdf6664e7390ebe710\", GitTreeState:\"clean\"}\n</code></pre> <ul> <li>helm \u5b98\u65b9\u53ef\u7528\u7684 chart \u4ed3\u5e93</li> </ul> <pre><code>http://hub.kubeapps.com/\n</code></pre> <ul> <li>\u547d\u4ee4\u57fa\u672c\u4f7f\u7528</li> </ul> <pre><code>completion  # \u4e3a\u6307\u5b9a\u7684shell\u751f\u6210\u81ea\u52a8\u5b8c\u6210\u811a\u672c\uff08bash\u6216zsh\uff09\ncreate      # \u521b\u5efa\u4e00\u4e2a\u5177\u6709\u7ed9\u5b9a\u540d\u79f0\u7684\u65b0 chart\ndelete      # \u4ece Kubernetes \u5220\u9664\u6307\u5b9a\u540d\u79f0\u7684 release\ndependency  # \u7ba1\u7406 chart \u7684\u4f9d\u8d56\u5173\u7cfb\nfetch       # \u4ece\u5b58\u50a8\u5e93\u4e0b\u8f7d chart \u5e76\uff08\u53ef\u9009\uff09\u5c06\u5176\u89e3\u538b\u7f29\u5230\u672c\u5730\u76ee\u5f55\u4e2d\nget         # \u4e0b\u8f7d\u4e00\u4e2a\u547d\u540d release\nhelp        # \u5217\u51fa\u6240\u6709\u5e2e\u52a9\u4fe1\u606f\nhistory     # \u83b7\u53d6 release \u5386\u53f2\nhome        # \u663e\u793a HELM_HOME \u7684\u4f4d\u7f6e\ninit        # \u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e0a\u521d\u59cb\u5316Helm\ninspect     # \u68c0\u67e5 chart \u8be6\u7ec6\u4fe1\u606f\ninstall     # \u5b89\u88c5 chart \u5b58\u6863\nlint        # \u5bf9 chart \u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\nlist        # releases \u5217\u8868\npackage     # \u5c06 chart \u76ee\u5f55\u6253\u5305\u6210 chart \u6863\u6848\nplugin      # \u6dfb\u52a0\u5217\u8868\u6216\u5220\u9664 helm \u63d2\u4ef6\nrepo        # \u6dfb\u52a0\u5217\u8868\u5220\u9664\u66f4\u65b0\u548c\u7d22\u5f15 chart \u5b58\u50a8\u5e93\nreset       # \u4ece\u96c6\u7fa4\u4e2d\u5378\u8f7d Tiller\nrollback    # \u5c06\u7248\u672c\u56de\u6eda\u5230\u4ee5\u524d\u7684\u7248\u672c\nsearch      # \u5728 chart \u5b58\u50a8\u5e93\u4e2d\u641c\u7d22\u5173\u952e\u5b57\nserve       # \u542f\u52a8\u672c\u5730http\u7f51\u7edc\u670d\u52a1\u5668\nstatus      # \u663e\u793a\u6307\u5b9a release \u7684\u72b6\u6001\ntemplate    # \u672c\u5730\u6e32\u67d3\u6a21\u677f\ntest        # \u6d4b\u8bd5\u4e00\u4e2a release\nupgrade     # \u5347\u7ea7\u4e00\u4e2a release\nverify      # \u9a8c\u8bc1\u7ed9\u5b9a\u8def\u5f84\u4e0a\u7684 chart \u662f\u5426\u5df2\u7b7e\u540d\u4e14\u6709\u6548\nversion     # \u6253\u5370\u5ba2\u6237\u7aef/\u670d\u52a1\u5668\u7248\u672c\u4fe1\u606f\ndep         # \u5206\u6790 Chart \u5e76\u4e0b\u8f7d\u4f9d\u8d56\n</code></pre> <ul> <li>\u6307\u5b9a values.yaml \u90e8\u7f72\u4e00\u4e2a chart</li> </ul> <pre><code>helm install --name els1 -f values.yaml stable/elasticsearch\n</code></pre> <ul> <li>\u5347\u7ea7\u4e00\u4e2a chart</li> </ul> <pre><code>helm upgrade --set mysqlRootPassword=passwd db-mysql stable/mysql\n</code></pre> <ul> <li>\u56de\u6eda\u4e00\u4e2a chart</li> </ul> <pre><code>helm rollback db-mysql 1\n</code></pre> <ul> <li>\u5220\u9664\u4e00\u4e2a release</li> </ul> <pre><code>helm delete --purge db-mysql\n</code></pre> <ul> <li>\u53ea\u5bf9\u6a21\u677f\u8fdb\u884c\u6e32\u67d3\u7136\u540e\u8f93\u51fa\uff0c\u4e0d\u8fdb\u884c\u5b89\u88c5</li> </ul> <pre><code>helm install/upgrade xxx --dry-run --debug\n</code></pre>"},{"location":"k8s/note/chapter-22/#224-chart","title":"22.4 Chart\u6587\u4ef6\u7ec4\u7ec7","text":"<pre><code>myapp/                               # Chart \u76ee\u5f55\n\u251c\u2500\u2500 charts                           # \u8fd9\u4e2a charts \u4f9d\u8d56\u7684\u5176\u4ed6 charts\uff0c\u59cb\u7ec8\u88ab\u5b89\u88c5\n\u251c\u2500\u2500 Chart.yaml                       # \u63cf\u8ff0\u8fd9\u4e2a Chart \u7684\u76f8\u5173\u4fe1\u606f\u3001\u5305\u62ec\u540d\u5b57\u3001\u63cf\u8ff0\u4fe1\u606f\u3001\u7248\u672c\u7b49\n\u251c\u2500\u2500 templates                        # \u6a21\u677f\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 deployment.yaml              # deployment \u63a7\u5236\u5668\u7684 Go \u6a21\u677f\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 _helpers.tpl                 # \u4ee5 _ \u5f00\u5934\u7684\u6587\u4ef6\u4e0d\u4f1a\u90e8\u7f72\u5230 k8s \u4e0a\uff0c\u53ef\u7528\u4e8e\u5b9a\u5236\u901a\u7528\u4fe1\u606f\n\u2502   \u251c\u2500\u2500 ingress.yaml                 # ingress \u7684\u6a21\u677f\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 NOTES.txt                    # Chart \u90e8\u7f72\u5230\u96c6\u7fa4\u540e\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u4f8b\u5982\uff1a\u5982\u4f55\u4f7f\u7528\u3001\u5217\u51fa\u7f3a\u7701\u503c\n\u2502   \u251c\u2500\u2500 service.yaml                 # service \u7684 Go \u6a21\u677f\u6587\u4ef6\n\u2502   \u2514\u2500\u2500 tests\n\u2502       \u2514\u2500\u2500 test-connection.yaml\n\u2514\u2500\u2500 values.yaml                      # \u6a21\u677f\u7684\u503c\u6587\u4ef6\uff0c\u8fd9\u4e9b\u503c\u4f1a\u5728\u5b89\u88c5\u65f6\u5e94\u7528\u5230 GO \u6a21\u677f\u751f\u6210\u90e8\u7f72\u6587\u4ef6\n</code></pre>"},{"location":"k8s/note/chapter-22/#225-helm-ceph-efk","title":"22.5 \u4f7f\u7528 Helm + Ceph \u90e8\u7f72 EFK","text":"<p>\u672c\u6587\u4f7f\u7528 K8S \u96c6\u7fa4\u4e0a\u8fd0\u884c EFK\uff0c\u4f7f\u7528 Ceph \u96c6\u7fa4\u4f5c\u4e3a ElasticSearch \u96c6\u7fa4\u7684\u6301\u4e45\u5b58\u50a8\u3002</p> <p>\u7528\u5230\u77e5\u8bc6\u6709\uff1aStorage Class\u3001PVC\u3001Helm\uff0c\u53e6\u5916\uff0c\u5f88\u591a\u670d\u52a1\u955c\u50cf\u9700\u8981\u7ffb\u5899\u3002</p> <p>helm install \u963b\u585e\u8fc7\u7a0b\u4f1a\u4e0b\u8f7d\u955c\u50cf\u53ef\u80fd\u4f1a\u6bd4\u8f83\u6162\u3002</p> <p>helm \u91cc\u9762\u6709\u5f88\u591a\u53ef\u4ee5\u5b9a\u5236\u7684\u9879\u76ee\uff0c\u8fd9\u91cc\u6211\u5c31\u4e0d\u5b9a\u5236\u4e86\uff0c\u53cd\u6b63\u6211\u7684\u8d44\u6e90\u4e5f\u591f\u7528\uff0c\u61d2\u5f97\u8c03\u4e86\u3002</p>"},{"location":"k8s/note/chapter-22/#226-storage-class","title":"22.6 Storage Class","text":"<pre><code>---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ceph-admin-secret\n  namespace: kube-system\ntype: \"kubernetes.io/rbd\"\ndata:\n  # ceph auth get-key client.admin | base64\n  key: QVFER3U5TmMQNXQ4SlJBAAhHMGltdXZlNFZkUXAvN2tTZ1BENGc9PQ==\n\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ceph-secret\n  namespace: kube-system\ntype: \"kubernetes.io/rbd\"\ndata:\n  # ceph auth get-key client.kube | base64\n  key: QVFCcUM5VmNWVDdQCCCCWR1NUxFNfVKeTAiazdUWVhOa3N2UWc9PQ==\n\n\n---\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: ceph-rbd\nprovisioner: ceph.com/rbd\nreclaimPolicy: Retain\nparameters:\n  monitors: 172.16.100.9:6789\n  pool: kube\n  adminId: admin\n  adminSecretName: ceph-admin-secret\n  adminSecretNamespace: kube-system\n  userId: kube\n  userSecretName: ceph-secret\n  userSecretNamespace: kube-system\n  fsType: ext4\n  imageFormat: \"2\"\n  imageFeatures: \"layering\"\n</code></pre>"},{"location":"k8s/note/chapter-22/#227-helm-elasticsearch","title":"22.7 Helm Elasticsearch","text":"<ul> <li>\u4e0b\u8f7d elasticsearch \u7684 StatfullSet \u7684 chart</li> </ul> <pre><code>helm fetch stable/elasticsearch\n</code></pre> <ul> <li>\u7f16\u8f91 values.yaml\uff0c\u4fee\u6539 storageClass \u6307\u5411\u4e0a\u9762\u521b\u5efa\u7684 storageClass</li> </ul> <pre><code>storageClass: \"ceph-rbd\"\n</code></pre> <ul> <li>\u4f7f\u7528 helm \u6307\u5b9a values.yaml \u90e8\u7f72 elasticsearch</li> </ul> <pre><code>helm install --name els1 -f values.yaml stable/elasticsearch\n</code></pre> <ul> <li>\u5b89\u88c5\u540e\u67e5\u770b\uff0c\u8c03\u8bd5\u76f4\u5230\u5168\u90e8\u5904\u4e8e READY \u72b6\u6001</li> </ul> <pre><code>$ kubectl get pods\nNAME                                         READY   STATUS    RESTARTS   AGE\nels1-elasticsearch-client-55696f5bdd-qczbf   1/1     Running   1          78m\nels1-elasticsearch-client-55696f5bdd-tdwdc   1/1     Running   1          78m\nels1-elasticsearch-data-0                    1/1     Running   1          78m\nels1-elasticsearch-data-1                    1/1     Running   1          56m\nels1-elasticsearch-master-0                  1/1     Running   1          78m\nels1-elasticsearch-master-1                  1/1     Running   1          53m\nels1-elasticsearch-master-2                  1/1     Running   1          52m\nrbd-provisioner-9b8ffbcc-nxdjd               1/1     Running   2          81m\n</code></pre> <ul> <li>\u4e5f\u53ef\u4ee5\u4f7f\u7528 helm \u547d\u4ee4\u67e5\u770b</li> </ul> <pre><code>$ helm status els1\n\nLAST DEPLOYED: Sun May 12 16:28:56 2019\nNAMESPACE: default\nSTATUS: DEPLOYED\n\nRESOURCES:\n==&gt; v1/ConfigMap\nNAME                     DATA  AGE\nels1-elasticsearch       4     88m\nels1-elasticsearch-test  1     88m\n\n==&gt; v1/Pod(related)\nNAME                                        READY  STATUS   RESTARTS  AGE\nels1-elasticsearch-client-55696f5bdd-qczbf  1/1    Running  1         88m\nels1-elasticsearch-client-55696f5bdd-tdwdc  1/1    Running  1         88m\nels1-elasticsearch-data-0                   1/1    Running  1         88m\nels1-elasticsearch-data-1                   1/1    Running  1         66m\nels1-elasticsearch-master-0                 1/1    Running  1         88m\nels1-elasticsearch-master-1                 1/1    Running  1         63m\nels1-elasticsearch-master-2                 1/1    Running  1         62m\n\n==&gt; v1/Service\nNAME                          TYPE       CLUSTER-IP     EXTERNAL-IP  PORT(S)   AGE\nels1-elasticsearch-client     ClusterIP  10.98.197.185  &lt;none&gt;       9200/TCP  88m\nels1-elasticsearch-discovery  ClusterIP  None           &lt;none&gt;       9300/TCP  88m\n\n==&gt; v1/ServiceAccount\nNAME                       SECRETS  AGE\nels1-elasticsearch-client  1        88m\nels1-elasticsearch-data    1        88m\nels1-elasticsearch-master  1        88m\n\n==&gt; v1beta1/Deployment\nNAME                       READY  UP-TO-DATE  AVAILABLE  AGE\nels1-elasticsearch-client  2/2    2           2          88m\n\n==&gt; v1beta1/StatefulSet\nNAME                       READY  AGE\nels1-elasticsearch-data    2/2    88m\nels1-elasticsearch-master  3/3    88m\n\n\nNOTES:\nThe elasticsearch cluster has been installed.\n\nElasticsearch can be accessed:\n\n  * Within your cluster, at the following DNS name at port 9200:\n\n    els1-elasticsearch-client.default.svc\n\n  * From outside the cluster, run these commands in the same shell:\n\n    export POD_NAME=$(kubectl get pods --namespace default -l \"app=elasticsearch,component=client,release=els1\" -o jsonpath=\"{.items[0].metadata.name}\")\n    echo \"Visit http://127.0.0.1:9200 to use Elasticsearch\"\n    kubectl port-forward --namespace default $POD_NAME 9200:9200\n</code></pre> <ul> <li>\u542f\u52a8\u4e00\u4e2a\u4e34\u65f6\u7684\u5bb9\u5668\uff0c\u89e3\u6790\u96c6\u7fa4\u5730\u5740\uff0c\u6d4b\u8bd5\u96c6\u7fa4\u4fe1\u606f\uff0c\u67e5\u770b\u96c6\u7fa4\u8282\u70b9</li> </ul> <pre><code>$ kubectl run cirros1 --rm -it --image=cirros -- /bin/sh\n\n/ # nslookup els1-elasticsearch-client.default.svc\nServer:    10.96.0.10\nAddress 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local\n\nName:      els1-elasticsearch-client.default.svc\nAddress 1: 10.98.197.185 els1-elasticsearch-client.default.svc.cluster.local\n/ # curl els1-elasticsearch-client.default.svc.cluster.local:9200/_cat/nodes\n10.244.2.28  7 96 2 0.85 0.26 0.16 di - els1-elasticsearch-data-0\n10.244.1.37  7 83 1 0.04 0.06 0.11 di - els1-elasticsearch-data-1\n10.244.2.25 19 96 2 0.85 0.26 0.16 i  - els1-elasticsearch-client-55696f5bdd-tdwdc\n10.244.2.27 28 96 2 0.85 0.26 0.16 mi * els1-elasticsearch-master-2\n10.244.1.39 19 83 1 0.04 0.06 0.11 i  - els1-elasticsearch-client-55696f5bdd-qczbf\n10.244.2.29 21 96 2 0.85 0.26 0.16 mi - els1-elasticsearch-master-1\n10.244.1.38 23 83 1 0.04 0.06 0.11 mi - els1-elasticsearch-master-0\n</code></pre>"},{"location":"k8s/note/chapter-22/#228-helm-fluentd-elasticsearch","title":"22.8 Helm fluentd-elasticsearch","text":"<ul> <li>\u5b89\u88c5 kiwigrid \u6e90</li> </ul> <pre><code>helm repo add kiwigrid https://kiwigrid.github.io\n</code></pre> <ul> <li>\u4e0b\u8f7d fluentd-elasticsearch</li> </ul> <pre><code>helm fetch kiwigrid/fluentd-elasticsearch\n</code></pre> <ul> <li>\u83b7\u53d6\u96c6\u7fa4\u5730\u5740</li> </ul> <pre><code>els1-elasticsearch-client.default.svc.cluster.local:9200\n</code></pre> <ul> <li>\u7f16\u8f91\u4fee\u6539 values.yaml\uff0c\u6307\u5b9a elasticsearch \u96c6\u7fa4\u7684\u4f4d\u7f6e</li> </ul> <pre><code>elasticsearch:\n  host: 'els1-elasticsearch-client.default.svc.cluster.local'\n  port: 9200\n</code></pre> <ul> <li>\u4fee\u6539\u5bf9\u6c61\u70b9\u7684\u5bb9\u5fcd\u7a0b\u5ea6\uff0c\u4f7f\u5176\u5bb9\u5fcd Master \u8282\u70b9\u7684\u6c61\u70b9\uff0c\u4e5f\u8fd0\u884c\u5728 Master \u8282\u70b9\u4e0a\u6536\u96c6\u4fe1\u606f</li> </ul> <pre><code>tolerations: \n  - key: node-role.kubernetes.io/master\n    operator: Exists\n    effect: NoSchedule\n</code></pre> <ul> <li>\u5982\u679c\u4f7f\u7528 prometheus \u76d1\u63a7\u5e94\u8be5\u6253\u5f00 prometheusRole \u89c4\u5219</li> </ul> <pre><code>podAnnotations:\n  prometheus.io/scrape: \"true\"\n  prometheus.io/port: \"24231\"\n\nservice:\n  type: ClusterIP\n  ports:\n    - name: \"monitor-agent\"\n      port: 24231\n</code></pre> <ul> <li>\u4f7f\u7528 helm \u6307\u5b9a values.yaml \u90e8\u7f72 fluentd-elasticsearch</li> </ul> <pre><code>helm install --name flu1 -f values.yaml kiwigrid/fluentd-elasticsearch\n</code></pre> <ul> <li>\u67e5\u770b\u72b6\u6001 flu1 \u8fd9\u4e2a helm \u670d\u52a1\u7684\u8fd0\u884c\u72b6\u6001</li> </ul> <pre><code>[root@master fluentd-elasticsearch]# helm status flu1\nLAST DEPLOYED: Sun May 12 18:13:12 2019\nNAMESPACE: default\nSTATUS: DEPLOYED\n\nRESOURCES:\n==&gt; v1/ClusterRole\nNAME                        AGE\nflu1-fluentd-elasticsearch  17m\n\n==&gt; v1/ClusterRoleBinding\nNAME                        AGE\nflu1-fluentd-elasticsearch  17m\n\n==&gt; v1/ConfigMap\nNAME                        DATA  AGE\nflu1-fluentd-elasticsearch  6     17m\n\n==&gt; v1/DaemonSet\nNAME                        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE  NODE SELECTOR  AGE\nflu1-fluentd-elasticsearch  3        3        3      3           3          &lt;none&gt;         17m\n\n==&gt; v1/Pod(related)\nNAME                              READY  STATUS   RESTARTS  AGE\nflu1-fluentd-elasticsearch-p49fc  1/1    Running  1         17m\nflu1-fluentd-elasticsearch-q5b9k  1/1    Running  0         17m\nflu1-fluentd-elasticsearch-swfvt  1/1    Running  0         17m\n\n==&gt; v1/Service\nNAME                        TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)    AGE\nflu1-fluentd-elasticsearch  ClusterIP  10.106.106.209  &lt;none&gt;       24231/TCP  17m\n\n==&gt; v1/ServiceAccount\nNAME                        SECRETS  AGE\nflu1-fluentd-elasticsearch  1        17m\n\n\nNOTES:\n1. To verify that Fluentd has started, run:\n\n  kubectl --namespace=default get pods -l \"app.kubernetes.io/name=fluentd-elasticsearch,app.kubernetes.io/instance=flu1\"\n\nTHIS APPLICATION CAPTURES ALL CONSOLE OUTPUT AND FORWARDS IT TO elasticsearch . Anything that might be identifying,\nincluding things like IP addresses, container images, and object names will NOT be anonymized.\n2. Get the application URL by running these commands:\n  export POD_NAME=$(kubectl get pods --namespace default -l \"app.kubernetes.io/name=fluentd-elasticsearch,app.kubernetes.io/instance=flu1\" -o jsonpath=\"{.items[0].metadata.name}\")\n  echo \"Visit http://127.0.0.1:8080 to use your application\"\n  kubectl port-forward $POD_NAME 8080:80\n</code></pre> <ul> <li>\u662f\u5426\u751f\u6210\u4e86\u7d22\u5f15\uff0c\u76f4\u63a5\u4f7f\u7528\u8bbf\u95ee elasticsearch \u7684 RESTfull API \u63a5\u53e3\u3002</li> </ul> <pre><code>$ kubectl run cirros1 --rm -it --image=cirros -- /bin/sh\n/ # curl els1-elasticsearch-client.default.svc.cluster.local:9200/_cat/indices\ngreen open logstash-2019.05.10 a2b-GyKsSLOZPqGKbCpyJw 5 1   158 0 84.2kb   460b\ngreen open logstash-2019.05.09 CwYylNhdRf-A5UELhrzHow 5 1 71418 0 34.3mb 17.4mb\ngreen open logstash-2019.05.12 5qRFpV46RGG_bWC4xbsyVA 5 1 34496 0 26.1mb 13.2mb\n</code></pre>"},{"location":"k8s/note/chapter-22/#229-helm-kibana","title":"22.9 Helm kibana","text":"<ul> <li>\u4e0b\u8f7d stable/kibana</li> </ul> <pre><code>helm fetch stable/kibana\n</code></pre> <ul> <li>\u7f16\u8f91 values.yaml\uff0c\u4fee\u6539 elasticsearch \u6307\u5411 elasticsearch \u96c6\u7fa4\u7684\u5730\u5740</li> </ul> <pre><code>elasticsearch.hosts: http://els1-elasticsearch-client.default.svc.cluster.local:920\n</code></pre> <ul> <li>\u4fee\u6539 service \u7684\u5de5\u4f5c\u6a21\u5f0f\uff0c\u4f7f\u5f97\u53ef\u4ee5\u4ece\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee</li> </ul> <pre><code>service:\n  type: NodePort\n</code></pre> <ul> <li>\u4f7f\u7528 helm \u6307\u5b9a values.yaml \u90e8\u7f72 kibana</li> </ul> <pre><code>helm install --name kib1 -f values.yaml stable/kibana\n</code></pre> <ul> <li>\u83b7\u53d6 service \u7aef\u53e3</li> </ul> <pre><code>$ kubectl get svc\nNAME                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE\nels1-elasticsearch-client      ClusterIP   10.98.197.185   &lt;none&gt;        9200/TCP        4h51m\nels1-elasticsearch-discovery   ClusterIP   None            &lt;none&gt;        9300/TCP        4h51m\nflu1-fluentd-elasticsearch     ClusterIP   10.101.97.11    &lt;none&gt;        24231/TCP       157m\nkib1-kibana                    NodePort    10.103.7.215    &lt;none&gt;        443:31537/TCP   6m50s\nkubernetes                     ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP         3d4h\n</code></pre> <ul> <li>\u7531\u4e8e service \u5de5\u4f5c\u5728 NodePort \u6a21\u5f0f\u4e0b\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee\u4e86</li> </ul> <pre><code>172.16.100.6:31537\n</code></pre>"},{"location":"k8s/note/chapter-23/","title":"\u4e8c\u5341\u4e09 ETCD\u8be6\u89e3","text":""},{"location":"k8s/note/chapter-23/#231-etcd","title":"23.1 ETCD\u6982\u8ff0","text":"<p>Etcd \u662f \u4f5c\u4e3aK8S\u5fc5\u4e0d\u53ef\u5c11\u7684\u952e\u503c\u5143\u5b58\u50a8\u7cfb\u7edf\uff0c\u9700\u8981\u8fdb\u884c\u7cfb\u7edf\u7684\u5b66\u4e60\u6765\u66f4\u597d\u7684\u4e86\u89e3K8S\uff0c</p>"},{"location":"k8s/note/chapter-23/#2311-etcd","title":"23.1.1 ETCD\u7b80\u4ecb","text":"<p>etcd\u662fCoreOS\u56e2\u961f\u4e8e2013\u5e746\u6708\u53d1\u8d77\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u5b83\u7684\u76ee\u6807\u662f\u6784\u5efa\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684\u5206\u5e03\u5f0f\u952e\u503c(key-value)\u6570\u636e\u5e93\u3002etcd\u5185\u90e8\u91c7\u7528<code>raft</code>\u534f\u8bae\u4f5c\u4e3a\u4e00\u81f4\u6027\u7b97\u6cd5\uff0cetcd\u57fa\u4e8eGo\u8bed\u8a00\u5b9e\u73b0\u3002</p>"},{"location":"k8s/note/chapter-23/#2312","title":"23.1.2 \u53d1\u5c55\u5386\u53f2","text":""},{"location":"k8s/note/chapter-23/#2313-etcd","title":"23.1.3 ETCD\u7279\u70b9","text":"<ul> <li>\u7b80\u5355\uff1a\u5b89\u88c5\u914d\u7f6e\u7b80\u5355\uff0c\u800c\u4e14\u63d0\u4f9b\u4e86HTTP API\u8fdb\u884c\u4ea4\u4e92\uff0c\u4f7f\u7528\u4e5f\u5f88\u7b80\u5355</li> <li>\u5b89\u5168\uff1a\u652f\u6301SSL\u8bc1\u4e66\u9a8c\u8bc1</li> <li>\u5feb\u901f\uff1a\u6839\u636e\u5b98\u65b9\u63d0\u4f9b\u7684benchmark\u6570\u636e\uff0c\u5355\u5b9e\u4f8b\u652f\u6301\u6bcf\u79d22k+\u8bfb\u64cd\u4f5c</li> <li>\u53ef\u9760\uff1a\u91c7\u7528raft\u7b97\u6cd5\uff0c\u5b9e\u73b0\u5206\u5e03\u5f0f\u7cfb\u7edf\u6570\u636e\u7684\u53ef\u7528\u6027\u548c\u4e00\u81f4\u6027</li> </ul>"},{"location":"k8s/note/chapter-23/#2314","title":"23.1.4 \u6982\u5ff5\u672f\u8bed","text":"<ul> <li> <p>Raft\uff1aetcd\u6240\u91c7\u7528\u7684\u4fdd\u8bc1\u5206\u5e03\u5f0f\u7cfb\u7edf\u5f3a\u4e00\u81f4\u6027\u7684\u7b97\u6cd5\u3002</p> </li> <li> <p>Node\uff1a\u4e00\u4e2aRaft\u72b6\u6001\u673a\u5b9e\u4f8b\u3002</p> </li> <li> <p>Member\uff1a \u4e00\u4e2aetcd\u5b9e\u4f8b\u3002\u5b83\u7ba1\u7406\u7740\u4e00\u4e2aNode\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e3a\u5ba2\u6237\u7aef\u8bf7\u6c42\u63d0\u4f9b\u670d\u52a1\u3002</p> </li> <li> <p>Cluster\uff1a\u7531\u591a\u4e2aMember\u6784\u6210\u53ef\u4ee5\u534f\u540c\u5de5\u4f5c\u7684etcd\u96c6\u7fa4\u3002</p> </li> <li> <p>Peer\uff1a\u5bf9\u540c\u4e00\u4e2aetcd\u96c6\u7fa4\u4e2d\u53e6\u5916\u4e00\u4e2aMember\u7684\u79f0\u547c\u3002</p> </li> <li> <p>Client\uff1a \u5411etcd\u96c6\u7fa4\u53d1\u9001HTTP\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u3002</p> </li> <li> <p>WAL\uff1a\u9884\u5199\u5f0f\u65e5\u5fd7\uff0cetcd\u7528\u4e8e\u6301\u4e45\u5316\u5b58\u50a8\u7684\u65e5\u5fd7\u683c\u5f0f\u3002</p> </li> <li> <p>snapshot\uff1aetcd\u9632\u6b62WAL\u6587\u4ef6\u8fc7\u591a\u800c\u8bbe\u7f6e\u7684\u5feb\u7167\uff0c\u5b58\u50a8etcd\u6570\u636e\u72b6\u6001\u3002</p> </li> <li> <p>Proxy\uff1aetcd\u7684\u4e00\u79cd\u6a21\u5f0f\uff0c\u4e3aetcd\u96c6\u7fa4\u63d0\u4f9b\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u3002</p> </li> <li> <p>Leader\uff1aRaft\u7b97\u6cd5\u4e2d\u901a\u8fc7\u7ade\u9009\u800c\u4ea7\u751f\u7684\u5904\u7406\u6240\u6709\u6570\u636e\u63d0\u4ea4\u7684\u8282\u70b9\u3002</p> </li> <li> <p>Follower\uff1a\u7ade\u9009\u5931\u8d25\u7684\u8282\u70b9\u4f5c\u4e3aRaft\u4e2d\u7684\u4ece\u5c5e\u8282\u70b9\uff0c\u4e3a\u7b97\u6cd5\u63d0\u4f9b\u5f3a\u4e00\u81f4\u6027\u4fdd\u8bc1\u3002</p> </li> <li> <p>Candidate\uff1a\u5f53Follower\u8d85\u8fc7\u4e00\u5b9a\u65f6\u95f4\u63a5\u6536\u4e0d\u5230Leader\u7684\u5fc3\u8df3\u65f6\u8f6c\u53d8\u4e3aCandidate\u5f00\u59cb\u7ade\u9009\u3002</p> </li> <li> <p>Term\uff1a\u67d0\u4e2a\u8282\u70b9\u6210\u4e3aLeader\u5230\u4e0b\u4e00\u6b21\u7ade\u9009\u65f6\u95f4\uff0c\u79f0\u4e3a\u4e00\u4e2aTerm\u3002</p> </li> <li> <p>Index\uff1a\u6570\u636e\u9879\u7f16\u53f7\u3002Raft\u4e2d\u901a\u8fc7Term\u548cIndex\u6765\u5b9a\u4f4d\u6570\u636e\u3002</p> </li> </ul>"},{"location":"k8s/note/chapter-23/#2315","title":"23.1.5 \u76f8\u5173\u539f\u7406","text":""},{"location":"k8s/note/chapter-23/#23151","title":"23.1.5.1 \u6570\u636e\u8bfb\u5199\u987a\u5e8f","text":"<p>\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u5f3a\u4e00\u81f4\u6027\uff0cetcd\u96c6\u7fa4\u4e2d\u6240\u6709\u7684\u6570\u636e\u6d41\u5411\u90fd\u662f\u4e00\u4e2a\u65b9\u5411\uff0c\u4ece Leader \uff08\u4e3b\u8282\u70b9\uff09\u6d41\u5411 Follower\uff0c\u4e5f\u5c31\u662f\u6240\u6709 Follower \u7684\u6570\u636e\u5fc5\u987b\u4e0e Leader \u4fdd\u6301\u4e00\u81f4\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\u4f1a\u88ab\u8986\u76d6\u3002</p> <p>\u7528\u6237\u5bf9\u4e8eetcd\u96c6\u7fa4\u6240\u6709\u8282\u70b9\u8fdb\u884c\u8bfb\u5199</p> <ul> <li>\u8bfb\u53d6\uff1a\u7531\u4e8e\u96c6\u7fa4\u6240\u6709\u8282\u70b9\u6570\u636e\u662f\u5f3a\u4e00\u81f4\u6027\u7684\uff0c\u8bfb\u53d6\u53ef\u4ee5\u4ece\u96c6\u7fa4\u4e2d\u968f\u4fbf\u54ea\u4e2a\u8282\u70b9\u8fdb\u884c\u8bfb\u53d6\u6570\u636e</li> <li>\u5199\u5165\uff1aetcd\u96c6\u7fa4\u6709leader\uff0c\u5982\u679c\u5199\u5165\u5f80leader\u5199\u5165\uff0c\u53ef\u4ee5\u76f4\u63a5\u5199\u5165\uff0c\u7136\u540e\u7136\u540eLeader\u8282\u70b9\u4f1a\u628a\u5199\u5165\u5206\u53d1\u7ed9\u6240\u6709Follower\uff0c\u5982\u679c\u5f80follower\u5199\u5165\uff0c\u7136\u540eLeader\u8282\u70b9\u4f1a\u628a\u5199\u5165\u5206\u53d1\u7ed9\u6240\u6709Follower</li> </ul>"},{"location":"k8s/note/chapter-23/#23152-leader","title":"23.1.5.2 leader\u9009\u4e3e","text":"<p>\u5047\u8bbe\u4e09\u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u4e09\u4e2a\u8282\u70b9\u4e0a\u5747\u8fd0\u884cTimer\uff08\u6bcf\u4e2aTimer\u6301\u7eed\u65f6\u95f4\u662f\u968f\u673a\u7684\uff09\uff0cRaft\u7b97\u6cd5\u4f7f\u7528\u968f\u673aTimer\u6765\u521d\u59cb\u5316Leader\u9009\u4e3e\u6d41\u7a0b\uff0c\u7b2c\u4e00\u4e2a\u8282\u70b9\u7387\u5148\u5b8c\u6210\u4e86Timer\uff0c\u968f\u540e\u5b83\u5c31\u4f1a\u5411\u5176\u4ed6\u4e24\u4e2a\u8282\u70b9\u53d1\u9001\u6210\u4e3aLeader\u7684\u8bf7\u6c42\uff0c\u5176\u4ed6\u8282\u70b9\u63a5\u6536\u5230\u8bf7\u6c42\u540e\u4f1a\u4ee5\u6295\u7968\u56de\u5e94\u7136\u540e\u7b2c\u4e00\u4e2a\u8282\u70b9\u88ab\u9009\u4e3e\u4e3aLeader\u3002</p> <p>\u6210\u4e3aLeader\u540e\uff0c\u8be5\u8282\u70b9\u4f1a\u4ee5\u56fa\u5b9a\u65f6\u95f4\u95f4\u9694\u5411\u5176\u4ed6\u8282\u70b9\u53d1\u9001\u901a\u77e5\uff0c\u786e\u4fdd\u81ea\u5df1\u4ecd\u662fLeader\u3002\u6709\u4e9b\u60c5\u51b5\u4e0b\u5f53Follower\u4eec\u6536\u4e0d\u5230Leader\u7684\u901a\u77e5\u540e\uff0c\u6bd4\u5982\u8bf4Leader\u8282\u70b9\u5b95\u673a\u6216\u8005\u5931\u53bb\u4e86\u8fde\u63a5\uff0c\u5176\u4ed6\u8282\u70b9\u4f1a\u91cd\u590d\u4e4b\u524d\u9009\u4e3e\u8fc7\u7a0b\u9009\u4e3e\u51fa\u65b0\u7684Leader\u3002</p>"},{"location":"k8s/note/chapter-23/#23153","title":"23.1.5.3 \u5224\u65ad\u6570\u636e\u662f\u5426\u5199\u5165","text":"<p>etcd\u8ba4\u4e3a\u5199\u5165\u8bf7\u6c42\u88abLeader\u8282\u70b9\u5904\u7406\u5e76\u5206\u53d1\u7ed9\u4e86\u591a\u6570\u8282\u70b9\u540e\uff0c\u5c31\u662f\u4e00\u4e2a\u6210\u529f\u7684\u5199\u5165\u3002\u90a3\u4e48\u591a\u5c11\u8282\u70b9\u5982\u4f55\u5224\u5b9a\u5462\uff0c\u5047\u8bbe\u603b\u7ed3\u70b9\u6570\u662fN\uff0c\u90a3\u4e48\u591a\u6570\u8282\u70b9 <code>Quorum=N/2+1</code>\u3002\u5173\u4e8e\u5982\u4f55\u786e\u5b9aetcd\u96c6\u7fa4\u5e94\u8be5\u6709\u591a\u5c11\u4e2a\u8282\u70b9\u7684\u95ee\u9898\uff0c\u4e0a\u56fe\u7684\u5de6\u4fa7\u7684\u56fe\u8868\u7ed9\u51fa\u4e86\u96c6\u7fa4\u4e2d\u8282\u70b9\u603b\u6570(Instances)\u5bf9\u5e94\u7684Quorum\u6570\u91cf\uff0c\u7528Instances\u51cf\u53bbQuorom\u5c31\u662f\u96c6\u7fa4\u4e2d\u5bb9\u9519\u8282\u70b9\uff08\u5141\u8bb8\u51fa\u6545\u969c\u7684\u8282\u70b9\uff09\u7684\u6570\u91cf\u3002</p> <p>\u6240\u4ee5\u5728\u96c6\u7fa4\u4e2d\u63a8\u8350\u7684\u6700\u5c11\u8282\u70b9\u6570\u91cf\u662f3\u4e2a\uff0c\u56e0\u4e3a1\u548c2\u4e2a\u8282\u70b9\u7684\u5bb9\u9519\u8282\u70b9\u6570\u90fd\u662f0\uff0c\u4e00\u65e6\u6709\u4e00\u4e2a\u8282\u70b9\u5b95\u6389\u6574\u4e2a\u96c6\u7fa4\u5c31\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\u4e86\u3002</p>"},{"location":"k8s/note/chapter-23/#232-etcd","title":"23.2 ETCD\u67b6\u6784\u53ca\u89e3\u6790","text":""},{"location":"k8s/note/chapter-23/#2321","title":"23.2.1 \u67b6\u6784\u56fe","text":""},{"location":"k8s/note/chapter-23/#2322","title":"23.2.2 \u67b6\u6784\u89e3\u6790","text":"<p>\u4ece etcd \u7684\u67b6\u6784\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0cetcd \u4e3b\u8981\u5206\u4e3a\u56db\u4e2a\u90e8\u5206\u3002</p> <ul> <li>HTTP Server\uff1a\u7528\u4e8e\u5904\u7406\u7528\u6237\u53d1\u9001\u7684 API \u8bf7\u6c42\u4ee5\u53ca\u5176\u5b83 etcd \u8282\u70b9\u7684\u540c\u6b65\u4e0e\u5fc3\u8df3\u4fe1\u606f\u8bf7\u6c42\u3002</li> <li>Store\uff1a\u7528\u4e8e\u5904\u7406 etcd \u652f\u6301\u7684\u5404\u7c7b\u529f\u80fd\u7684\u4e8b\u52a1\uff0c\u5305\u62ec\u6570\u636e\u7d22\u5f15\u3001\u8282\u70b9\u72b6\u6001\u53d8\u66f4\u3001\u76d1\u63a7\u4e0e\u53cd\u9988\u3001\u4e8b\u4ef6\u5904\u7406\u4e0e\u6267\u884c\u7b49\u7b49\uff0c\u662f etcd \u5bf9\u7528\u6237\u63d0\u4f9b\u7684\u5927\u591a\u6570 API \u529f\u80fd\u7684\u5177\u4f53\u5b9e\u73b0\u3002</li> <li>Raft\uff1aRaft \u5f3a\u4e00\u81f4\u6027\u7b97\u6cd5\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u662f etcd \u7684\u6838\u5fc3\u3002</li> <li>WAL\uff1aWrite Ahead Log\uff08\u9884\u5199\u5f0f\u65e5\u5fd7\uff09\uff0c\u662f etcd \u7684\u6570\u636e\u5b58\u50a8\u65b9\u5f0f\u3002\u9664\u4e86\u5728\u5185\u5b58\u4e2d\u5b58\u6709\u6240\u6709\u6570\u636e\u7684\u72b6\u6001\u4ee5\u53ca\u8282\u70b9\u7684\u7d22\u5f15\u4ee5\u5916\uff0cetcd \u5c31\u901a\u8fc7 WAL \u8fdb\u884c\u6301\u4e45\u5316\u5b58\u50a8\u3002WAL \u4e2d\uff0c\u6240\u6709\u7684\u6570\u636e\u63d0\u4ea4\u524d\u90fd\u4f1a\u4e8b\u5148\u8bb0\u5f55\u65e5\u5fd7\u3002</li> <li>Snapshot \u662f\u4e3a\u4e86\u9632\u6b62\u6570\u636e\u8fc7\u591a\u800c\u8fdb\u884c\u7684\u72b6\u6001\u5feb\u7167\uff1b</li> <li>Entry \u8868\u793a\u5b58\u50a8\u7684\u5177\u4f53\u65e5\u5fd7\u5185\u5bb9\u3002</li> </ul> <p>\u901a\u5e38\uff0c\u4e00\u4e2a\u7528\u6237\u7684\u8bf7\u6c42\u53d1\u9001\u8fc7\u6765\uff0c\u4f1a\u7ecf\u7531 HTTP Server \u8f6c\u53d1\u7ed9 Store \u8fdb\u884c\u5177\u4f53\u7684\u4e8b\u52a1\u5904\u7406\uff0c\u5982\u679c\u6d89\u53ca\u5230\u8282\u70b9\u7684\u4fee\u6539\uff0c\u5219\u4ea4\u7ed9 Raft \u6a21\u5757\u8fdb\u884c\u72b6\u6001\u7684\u53d8\u66f4\u3001\u65e5\u5fd7\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u518d\u540c\u6b65\u7ed9\u522b\u7684 etcd \u8282\u70b9\u4ee5\u786e\u8ba4\u6570\u636e\u63d0\u4ea4\uff0c\u6700\u540e\u8fdb\u884c\u6570\u636e\u7684\u63d0\u4ea4\uff0c\u518d\u6b21\u540c\u6b65\u3002</p>"},{"location":"k8s/note/chapter-23/#233","title":"23.3 \u5e94\u7528\u573a\u666f","text":""},{"location":"k8s/note/chapter-23/#2331","title":"23.3.1 \u670d\u52a1\u6ce8\u518c\u53d1\u73b0","text":"<ul> <li>\u524d\u540e\u7aef\u4e1a\u52a1\u6ce8\u518c\u53d1\u73b0</li> </ul> <p>\u4e2d\u95f4\u4ef7\u5df2\u7ecf\u540e\u7aef\u670d\u52a1\u5728etcd\u4e2d\u6ce8\u518c\uff0c\u524d\u7aef\u548c\u4e2d\u95f4\u4ef7\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u4eceetcd\u4e2d\u53d1\u73b0\u76f8\u5173\u670d\u52a1\u5668\u7136\u540e\u670d\u52a1\u5668\u4e4b\u95f4\u6839\u636e\u8c03\u7528\u5173\u7cfb\u76f8\u5173\u7ed1\u5b9a\u8c03\u7528</p> <ul> <li>\u591a\u7ec4\u540e\u7aef\u670d\u52a1\u5668\u6ce8\u518c\u53d1\u73b0 </li> </ul> <p>\u540e\u7aef\u591a\u4e2a\u65e0\u72b6\u6001\u76f8\u540c\u526f\u672c\u7684app\u53ef\u4ee5\u540c\u4e8b\u6ce8\u518c\u5230etcd\u4e2d\uff0c\u524d\u7aef\u53ef\u4ee5\u901a\u8fc7haproxy\u4eceetcd\u4e2d\u83b7\u53d6\u5230\u540e\u7aef\u7684ip\u548c\u7aef\u53e3\u7ec4\uff0c\u7136\u540e\u8fdb\u884c\u8bf7\u6c42\u8f6c\u53d1\uff0c\u53ef\u4ee5\u7528\u6765\u6545\u969c\u8f6c\u79fb\u5c4f\u853d\u540e\u7aef\u7aef\u53e3\u5df2\u7ecf\u540e\u7aef\u591a\u7ec4app\u5b9e\u4f8b\u3002</p>"},{"location":"k8s/note/chapter-23/#2332","title":"23.3.2 \u6d88\u606f\u53d1\u5e03\u4e0e\u8ba2\u9605","text":"<p>etcd\u53ef\u4ee5\u5145\u5f53\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u751f\u4ea7\u8005\u53ef\u4ee5\u5f80etcd\u4e2d\u6ce8\u518ctopic\u5e76\u53d1\u9001\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u4eceetcd\u4e2d\u8ba2\u9605topic\uff0c\u6765\u83b7\u53d6\u751f\u4ea7\u8005\u53d1\u9001\u81f3etcd\u4e2d\u7684\u6d88\u606f\u3002</p>"},{"location":"k8s/note/chapter-23/#2333","title":"23.3.3 \u8d1f\u8f7d\u5747\u8861","text":"<p>\u540e\u7aef\u591a\u7ec4\u76f8\u540c\u7684\u670d\u52a1\u63d0\u4f9b\u8005\u53ef\u4ee5\u7ecf\u81ea\u5df1\u670d\u52a1\u6ce8\u518c\u5230etcd\u4e2d\uff0cetcd\u5e76\u4e14\u4f1a\u4e0e\u6ce8\u518c\u7684\u670d\u52a1\u8fdb\u884c\u76d1\u63a7\u68c0\u67e5\uff0c\u670d\u52a1\u8bf7\u6c42\u8fd9\u9996\u5148\u4eceetcd\u4e2d\u83b7\u53d6\u5230\u53ef\u7528\u7684\u670d\u52a1\u63d0\u4f9b\u8005\u771f\u6b63\u7684ip:port\uff0c\u7136\u540e\u5bf9\u6b64\u591a\u7ec4\u670d\u52a1\u53d1\u9001\u8bf7\u6c42\uff0cetcd\u5728\u5176\u4e2d\u5145\u5f53\u4e86\u8d1f\u8f7d\u5747\u8861\u7684\u529f\u80fd</p>"},{"location":"k8s/note/chapter-23/#2334","title":"23.3.4 \u5206\u5e03\u5f0f\u901a\u77e5\u4e0e\u534f\u8c03","text":"<p> * \u5f53etcd watch\u670d\u52a1\u53d1\u73b0\u4e22\u5931\uff0c\u4f1a\u901a\u77e5\u670d\u52a1\u68c0\u67e5 * \u63a7\u5236\u5668\u5411etcd\u53d1\u9001\u542f\u52a8\u670d\u52a1\uff0cetcd\u901a\u77e5\u670d\u52a1\u8fdb\u884c\u76f8\u5e94\u64cd\u4f5c * \u5f53\u670d\u52a1\u5b8c\u6210work\u4f1a\u8bb2\u72b6\u6001\u66f4\u65b0\u81f3etcd\uff0cetcd\u5bf9\u5e94\u4f1a\u901a\u77e5\u7528\u6237</p>"},{"location":"k8s/note/chapter-23/#2335","title":"23.3.5 \u5206\u5e03\u5f0f\u9501","text":"<p>\u5f53\u6709\u591a\u4e2a\u7ade\u4e89\u8005node\u8282\u70b9\uff0cetcd\u4f5c\u4e3a\u603b\u63a7\uff0c\u5728\u5206\u5e03\u5f0f\u96c6\u7fa4\u4e2d\u4e0e\u4e00\u4e2a\u8282\u70b9\u6210\u529f\u5206\u914dlock</p>"},{"location":"k8s/note/chapter-23/#2336","title":"23.3.6 \u5206\u5e03\u5f0f\u961f\u5217!","text":"<p>\u6709\u5bf9\u4e2anode\uff0cetcd\u6839\u636e\u6bcf\u4e2anode\u6765\u521b\u5efa\u5bf9\u5e94node\u7684\u961f\u5217\uff0c\u6839\u636e\u4e0d\u540c\u7684\u961f\u5217\u53ef\u4ee5\u5728etcd\u4e2d\u627e\u5230\u5bf9\u5e94\u7684competitor</p>"},{"location":"k8s/note/chapter-23/#2337-leader","title":"23.3.7 \u96c6\u7fa4\u53ca\u7231\u4f60\u4e0eLeader\u9009\u4e3e","text":"<p>etcd\u53ef\u4ee5\u6839\u636eraft\u7b97\u6cd5\u5728\u591a\u4e2anode\u8282\u70b9\u6765\u9009\u4e3e\u51faleader</p>"},{"location":"k8s/note/chapter-23/#234","title":"23.4 \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"k8s/note/chapter-23/#2341","title":"23.4.1 \u5355\u673a\u5b89\u88c5","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u4e8c\u8fdb\u5236\u6216\u6e90\u7801\u4e0b\u8f7d\u5b89\u88c5\uff0c\u4f46\u662f\u5371\u5bb3\u9700\u8981\u81ea\u5df1\u5199\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u4f55\u8981\u542f\u52a8\u9700\u8981\u81ea\u5df1\u5199\u670d\u52a1\u542f\u52a8\u6587\u4ef6\uff0c\u63a8\u8350\u4f7f\u7528yum\u5b89\u88c5\u65b9\u5f0f</p> <pre><code>hostnamectl set-hostname etcd-1\nwget http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nrpm -ivh epel-release-latest-7.noarch.rpm\n# yum \u4ed3\u5e93\u4e2d\u7684etcd\u7248\u672c\u4e3a3.3.11\uff0c\u5982\u679c\u9700\u8981\u6700\u65b0\u7248\u672c\u7684etcd\u53ef\u4ee5\u8fdb\u884c\u4e8c\u8fdb\u5236\u5b89\u88c5\nyum -y install etcd\nsystemctl enable etcd\n</code></pre> <p>\u53ef\u4ee5\u67e5\u770byum\u5b89\u88c5\u7684etcd\u7684\u6709\u6548\u914d\u7f6e\u6587\u4ef6\uff0c\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u6765\u4fee\u6539\u6570\u636e\u5b58\u50a8\u76ee\u5f55\uff0c\u5df2\u7ecf\u76d1\u542c\u7aef\u53e3url/etcd\u7684\u540d\u79f0\u7b49</p> <ul> <li>etcd \u9ed8\u8ba4\u5c06\u6570\u636e\u5b58\u653e\u5230\u5f53\u524d\u8def\u5f84\u7684 <code>default.etcd/</code> \u76ee\u5f55\u4e0b</li> <li>\u5728 <code>http://localhost:2380</code> \u548c\u96c6\u7fa4\u4e2d\u5176\u4ed6\u8282\u70b9\u901a\u4fe1</li> <li>\u5728 <code>http://localhost:2379</code> \u63d0\u4f9b HTTP API \u670d\u52a1\uff0c\u4f9b\u5ba2\u6237\u7aef\u4ea4\u4e92</li> <li>\u8be5\u8282\u70b9\u7684\u540d\u79f0\u9ed8\u8ba4\u4e3a <code>default</code></li> <li>heartbeat \u4e3a 100ms\uff0c\u540e\u9762\u4f1a\u8bf4\u660e\u8fd9\u4e2a\u914d\u7f6e\u7684\u4f5c\u7528  </li> <li>election \u4e3a 1000ms\uff0c\u540e\u9762\u4f1a\u8bf4\u660e\u8fd9\u4e2a\u914d\u7f6e\u7684\u4f5c\u7528</li> <li>snapshot count \u4e3a 10000\uff0c\u540e\u9762\u4f1a\u8bf4\u660e\u8fd9\u4e2a\u914d\u7f6e\u7684\u4f5c\u7528</li> <li>\u96c6\u7fa4\u548c\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a uuid</li> <li>\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u8fd0\u884c raft\uff0c\u9009\u4e3e\u51fa leader</li> </ul> <pre><code>[root@VM_0_8_centos tmp]# grep -Ev \"^#|^$\" /etc/etcd/etcd.conf\nETCD_DATA_DIR=\"/var/lib/etcd/default.etcd\"\nETCD_LISTEN_CLIENT_URLS=\"http://localhost:2379\"\nETCD_NAME=\"default\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://localhost:2379\"\n[root@VM_0_8_centos tmp]# systemctl status etcd\n</code></pre>"},{"location":"k8s/note/chapter-23/#2342","title":"23.4.2 \u96c6\u7fa4\u90e8\u7f72","text":""},{"location":"k8s/note/chapter-23/#23421","title":"23.4.2.1 \u4e3b\u673a\u4fe1\u606f","text":"\u4e3b\u673a\u540d\u79f0 \u7cfb\u7edf IP\u5730\u5740 \u90e8\u7f72\u7ec4\u4ef6 etcd-0-8 CentOS 7.3 172.16.0.8 etcd etcd-0-17 CentOS 7.3 172.16.0.17 etcd etcd-0-14 CentOS 7.3 172.16.0.14 etcd"},{"location":"k8s/note/chapter-23/#23422-hosts","title":"23.4.2.2 HOSTS\u914d\u7f6e","text":"<p>\u5728\u6b64\u793a\u4f8b\u7528\u4e09\u4e2a\u8282\u70b9\u6765\u90e8\u7f72etcd\u96c6\u7fa4\uff0c\u5404\u8282\u70b9\u4fee\u6539hosts</p> <pre><code>cat &gt;&gt; /etc/hosts &lt;&lt; EOF\n172.16.0.8 etcd-0-8\n172.16.0.14 etcd-0-14\n172.16.0.17 etcd-0-17\nEOF\n</code></pre>"},{"location":"k8s/note/chapter-23/#23423-etcd","title":"23.4.2.3 ETCD\u5b89\u88c5","text":"<p>\u4e09\u4e2a\u8282\u70b9\u5747\u5b89\u88c5etcd</p> <pre><code>wget http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nrpm -ivh epel-release-latest-7.noarch.rpm\nyum -y install etcd\nsystemctl enable etcd\nmkdir -p /data/app/etcd/\nchown etcd:etcd /data/app/etcd/\n</code></pre>"},{"location":"k8s/note/chapter-23/#23424-etcd","title":"23.4.2.4 ETCD\u914d\u7f6e","text":"<ul> <li>etcd\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6</li> </ul> <pre><code>[root@etcd-0-8 app]# cat /etc/etcd/etcd.conf\n#[Member]\n#ETCD_CORS=\"\"\nETCD_DATA_DIR=\"/data/app/etcd/\"                                                                                     # etcd\u6570\u636e\u5b58\u50a8\u76ee\u5f55\uff0c\u5efa\u8bae\u5b58\u50a8\u5728\u6570\u636e\u76d8\n#ETCD_WAL_DIR=\"\"\nETCD_LISTEN_PEER_URLS=\"http://172.16.0.8:2380\"                                                      # \u4e0e\u540c\u4f34\u7684\u901a\u8baf\u5730\u5740\uff0c\u548c\u5176\u4ed6\u8282\u70b9\u540c\u4f34\u7684\u901a\u8baf\u5730\u5740 \nETCD_LISTEN_CLIENT_URLS=\"http://127.0.0.1:2379,http://172.16.0.8:2379\"      # \u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\u5730\u5740\n#ETCD_MAX_SNAPSHOTS=\"5\"                                                                                                     # etcd\u6700\u5927\u5feb\u7167\u4fdd\u5b58\u6570\n#ETCD_MAX_WALS=\"5\"                                                                                                              # etcd \u6700\u5927wals\nETCD_NAME=\"etcd-0-8\"                                                                                                            # etcd\u8282\u70b9\u540d\u79f0\uff0c\u96c6\u7fa4\u5185\u9700\u8981\u552f\u4e00\n#ETCD_SNAPSHOT_COUNT=\"100000\"                                                         # \u6307\u5b9a\u6709\u591a\u5c11\u4e8b\u52a1\uff08transaction\uff09\u88ab\u63d0\u4ea4\u65f6\uff0c\u89e6\u53d1\u622a\u53d6\u5feb\u7167\u4fdd\u5b58\u5230\u78c1\u76d8\n#ETCD_HEARTBEAT_INTERVAL=\"100\"                                                          # leader \u591a\u4e45\u53d1\u9001\u4e00\u6b21\u5fc3\u8df3\u5230 followers\u3002\u9ed8\u8ba4\u503c\u662f 100ms\n#ETCD_ELECTION_TIMEOUT=\"1000\"                                     # \u91cd\u65b0\u6295\u7968\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5982\u679c follow \u5728\u8be5\u65f6\u95f4\u95f4\u9694\u6ca1\u6709\u6536\u5230\u5fc3\u8df3\u5305\uff0c\u4f1a\u89e6\u53d1\u91cd\u65b0\u6295\u7968\uff0c\u9ed8\u8ba4\u4e3a 1000 ms\n#ETCD_QUOTA_BACKEND_BYTES=\"0\"\n#ETCD_MAX_REQUEST_BYTES=\"1572864\"\n#ETCD_GRPC_KEEPALIVE_MIN_TIME=\"5s\"\n#ETCD_GRPC_KEEPALIVE_INTERVAL=\"2h0m0s\"\n#ETCD_GRPC_KEEPALIVE_TIMEOUT=\"20s\"\n#\n#[Clustering]\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://172.16.0.8:2380\"                                      # \u8be5\u8282\u70b9\u540c\u4f34\u76d1\u542c\u5730\u5740\uff0c\u8fd9\u4e2a\u503c\u4f1a\u544a\u8bc9\u96c6\u7fa4\u4e2d\u5176\u4ed6\u8282\u70b9\nETCD_ADVERTISE_CLIENT_URLS=\"http://127.0.0.1:2379,http://172.16.0.8:2379\"    # \u5bf9\u5916\u516c\u544a\u7684\u8be5\u8282\u70b9\u5ba2\u6237\u7aef\u76d1\u542c\u5730\u5740\uff0c\u8fd9\u4e2a\u503c\u4f1a\u544a\u8bc9\u96c6\u7fa4\u4e2d\u5176\u4ed6\u8282\u70b9\n#ETCD_DISCOVERY=\"\"\n#ETCD_DISCOVERY_FALLBACK=\"proxy\"\n#ETCD_DISCOVERY_PROXY=\"\"\n#ETCD_DISCOVERY_SRV=\"\"\nETCD_INITIAL_CLUSTER=\"etcd-0-8=http://172.16.0.8:2380,etcd-0-17=http://172.16.0.17:2380,etcd-0-14=http://172.16.0.14:2380\"                                                  # \u96c6\u7fa4\u4e2d\u6240\u6709\u8282\u70b9\u7684\u4fe1 \nETCD_INITIAL_CLUSTER_TOKEN=\"etcd-token\"                          # \u521b\u5efa\u96c6\u7fa4\u7684 token\uff0c\u8fd9\u4e2a\u503c\u6bcf\u4e2a\u96c6\u7fa4\u4fdd\u6301\u552f\u4e00\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u5982\u679c\u4f60\u8981\u91cd\u65b0\u521b\u5efa\u96c6\u7fa4\uff0c\u5373\u4f7f\u914d\u7f6e\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u4e5f\u4f1a\u518d\u6b21\u751f\u6210\u65b0\u7684\u96c6\u7fa4\u548c\u8282\u70b9 uuid\uff1b\u5426\u5219\u4f1a\u5bfc\u81f4\u591a\u4e2a\u96c6\u7fa4\u4e4b\u95f4\u7684\u51b2\u7a81\uff0c\u9020\u6210\u672a\u77e5\u7684\u9519\u8bef\nETCD_INITIAL_CLUSTER_STATE=\"new\"\n#ETCD_STRICT_RECONFIG_CHECK=\"true\"                                   # \u65b0\u5efa\u96c6\u7fa4\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u503c\u4e3a new\uff1b\u5047\u5982\u5df2\u7ecf\u5b58\u5728\u7684\u96c6\u7fa4\uff0c\u8fd9\u4e2a\u503c\u4e3a existing\n#ETCD_ENABLE_V2=\"true\"\n#\n#[Proxy]\n#ETCD_PROXY=\"off\"\n#ETCD_PROXY_FAILURE_WAIT=\"5000\"\n#ETCD_PROXY_REFRESH_INTERVAL=\"30000\"\n#ETCD_PROXY_DIAL_TIMEOUT=\"1000\"\n#ETCD_PROXY_WRITE_TIMEOUT=\"5000\"\n#ETCD_PROXY_READ_TIMEOUT=\"0\"\n#\n#[Security]\n#ETCD_CERT_FILE=\"\"\n#ETCD_KEY_FILE=\"\"\n#ETCD_CLIENT_CERT_AUTH=\"false\"\n#ETCD_TRUSTED_CA_FILE=\"\"\n#ETCD_AUTO_TLS=\"false\"\n#ETCD_PEER_CERT_FILE=\"\"\n#ETCD_PEER_KEY_FILE=\"\"\n#ETCD_PEER_CLIENT_CERT_AUTH=\"false\"\n#ETCD_PEER_TRUSTED_CA_FILE=\"\"\n#ETCD_PEER_AUTO_TLS=\"false\"\n#\n#[Logging]\n#ETCD_DEBUG=\"false\"\n#ETCD_LOG_PACKAGE_LEVELS=\"\"\n#ETCD_LOG_OUTPUT=\"default\"\n#\n#[Unsafe]\n#ETCD_FORCE_NEW_CLUSTER=\"false\"\n#\n#[Version]\n#ETCD_VERSION=\"false\"\n#ETCD_AUTO_COMPACTION_RETENTION=\"0\"\n#\n#[Profiling]\n#ETCD_ENABLE_PPROF=\"false\"\n#ETCD_METRICS=\"basic\"\n#\n#[Auth]\n#ETCD_AUTH_TOKEN=\"simple\"\n</code></pre> <p>etcd-0-8\u914d\u7f6e\uff1a</p> <pre><code>[root@etcd-server ~]# hostnamectl set-hostname etcd-0-8\n[root@etcd-0-8 ~]# egrep \"^#|^$\" /etc/etcd/etcd.conf -v\nETCD_DATA_DIR=\"/data/app/etcd/\"\nETCD_LISTEN_PEER_URLS=\"http://172.16.0.8:2380\"\nETCD_LISTEN_CLIENT_URLS=\"http://127.0.0.1:2379,http://172.16.0.8:2379\"\nETCD_NAME=\"etcd-0-8\"\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://172.16.0.8:2380\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://127.0.0.1:2379,http://172.16.0.8:2379\"\nETCD_INITIAL_CLUSTER=\"etcd-0-8=http://172.16.0.8:2380,etcd-0-17=http://172.16.0.17:2380,etcd-0-14=http://172.16.0.14:2380\"\nETCD_INITIAL_CLUSTER_TOKEN=\"etcd-token\"\nETCD_INITIAL_CLUSTER_STATE=\"new\"\n</code></pre> <p>etcd-0-14\u914d\u7f6e\uff1a</p> <pre><code>[root@etcd-server ~]# hostnamectl set-hostname etcd-0-14\n[root@etcd-server ~]# mkdir -p /data/app/etcd/\n[root@etcd-0.14 ~]# egrep \"^#|^$\" /etc/etcd/etcd.conf -v\nETCD_DATA_DIR=\"/data/app/etcd/\"\nETCD_LISTEN_PEER_URLS=\"http://172.16.0.14:2380\"\nETCD_LISTEN_CLIENT_URLS=\"http://127.0.0.1:2379,http://172.16.0.14:2379\"\nETCD_NAME=\"etcd-0-14\"\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://172.16.0.14:2380\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://127.0.0.1:2379,http://172.16.0.14:2379\"\nETCD_INITIAL_CLUSTER=\"etcd-0-8=http://172.16.0.8:2380,etcd-0-17=http://172.16.0.17:2380,etcd-0-14=http://172.16.0.14:2380\"\nETCD_INITIAL_CLUSTER_TOKEN=\"etcd-token\"\nETCD_INITIAL_CLUSTER_STATE=\"new\"\n</code></pre> <ul> <li>etcd-0-7\u914d\u7f6e:</li> </ul> <pre><code>[root@etcd-server ~]# hostnamectl set-hostname etcd-0-17\n[root@etcd-server ~]# mkdir -p /data/app/etcd/\n[root@etcd-0-17 ~]# egrep \"^#|^$\" /etc/etcd/etcd.conf -v\nETCD_DATA_DIR=\"/data/app/etcd/\"\nETCD_LISTEN_PEER_URLS=\"http://172.16.0.17:2380\"\nETCD_LISTEN_CLIENT_URLS=\"http://127.0.0.1:2379,http://172.16.0.17:2379\"\nETCD_NAME=\"etcd-0-17\"\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://172.16.0.17:2380\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://127.0.0.1:2379,http://172.16.0.17:2379\"\nETCD_INITIAL_CLUSTER=\"etcd-0-8=http://172.16.0.8:2380,etcd-0-17=http://172.16.0.17:2380,etcd-0-14=http://172.16.0.14:2380\"\nETCD_INITIAL_CLUSTER_TOKEN=\"etcd-token\"\nETCD_INITIAL_CLUSTER_STATE=\"new\"\n</code></pre> <ul> <li>\u914d\u7f6e\u5b8c\u6210\u540e\u542f\u52a8\u670d\u52a1</li> </ul> <pre><code>systemctl start etcd\n</code></pre>"},{"location":"k8s/note/chapter-23/#23425","title":"23.4.2.5 \u67e5\u770b\u96c6\u7fa4\u72b6\u6001","text":"<ul> <li>\u67e5\u770betcd\u72b6\u6001</li> </ul> <pre><code>[root@etcd-0-8 default.etcd]# systemctl status etcd\n\u25cf etcd.service - Etcd Server\n   Loaded: loaded (/usr/lib/systemd/system/etcd.service; enabled; vendor preset: disabled)\n   Active: active (running) since \u4e8c 2019-12-03 15:55:28 CST; 8s ago\n Main PID: 24510 (etcd)\n   CGroup: /system.slice/etcd.service\n           \u2514\u250024510 /usr/bin/etcd --name=etcd-0-8 --data-dir=/data/app/etcd/ --listen-client-urls=http://172.16.0.8:2379\n\n12\u6708 03 15:55:28 etcd-0-8 etcd[24510]: set the initial cluster version to 3.0\n12\u6708 03 15:55:28 etcd-0-8 etcd[24510]: enabled capabilities for version 3.0\n12\u6708 03 15:55:30 etcd-0-8 etcd[24510]: peer 56e0b6dad4c53d42 became active\n12\u6708 03 15:55:30 etcd-0-8 etcd[24510]: established a TCP streaming connection with peer 56e0b6dad4c53d42 (stream Message reader)\n12\u6708 03 15:55:30 etcd-0-8 etcd[24510]: established a TCP streaming connection with peer 56e0b6dad4c53d42 (stream Message writer)\n12\u6708 03 15:55:30 etcd-0-8 etcd[24510]: established a TCP streaming connection with peer 56e0b6dad4c53d42 (stream MsgApp v2 reader)\n12\u6708 03 15:55:30 etcd-0-8 etcd[24510]: established a TCP streaming connection with peer 56e0b6dad4c53d42 (stream MsgApp v2 writer)\n12\u6708 03 15:55:32 etcd-0-8 etcd[24510]: updating the cluster version from 3.0 to 3.3\n12\u6708 03 15:55:32 etcd-0-8 etcd[24510]: updated the cluster version from 3.0 to 3.3\n12\u6708 03 15:55:32 etcd-0-8 etcd[24510]: enabled capabilities for version 3.3\n</code></pre> <ul> <li>\u67e5\u770b\u7aef\u53e3\u76d1\u542c(\u5982\u679c\u672a\u5728\u672c\u5730\u76d1\u542c\u73af\u56de\u5730\u5740\uff0c\u90a3\u4e48\u5728\u672c\u5730\u4f7f\u7528etcdctl\u4e0d\u80fd\u6b63\u5e38\u8fde\u5165\u8fdb\u53bb)</li> </ul> <pre><code>[root@etcd-0-8 default.etcd]# netstat -lntup |grep etcd\ntcp        0      0 172.16.0.8:2379         0.0.0.0:*               LISTEN      25167/etcd\ntcp        0      0 127.0.0.1:2379          0.0.0.0:*               LISTEN      25167/etcd\ntcp        0      0 172.16.0.8:2380         0.0.0.0:*               LISTEN      25167/etcd\n</code></pre> <ul> <li>\u67e5\u770b\u96c6\u7fa4\u72b6\u6001(\u53ef\u4ee5\u770b\u5230etcd-0-17)</li> </ul> <pre><code>[root@etcd-0-8 default.etcd]# etcdctl member list\n2d2e457c6a1a76cb: name=etcd-0-8 peerURLs=http://172.16.0.8:2380 clientURLs=http://127.0.0.1:2379,http://172.16.0.8:2379 isLeader=false\n56e0b6dad4c53d42: name=etcd-0-14 peerURLs=http://172.16.0.14:2380 clientURLs=http://127.0.0.1:2379,http://172.16.0.14:2379 isLeader=true\nd2d2e9fc758e6790: name=etcd-0-17 peerURLs=http://172.16.0.17:2380 clientURLs=http://127.0.0.1:2379,http://172.16.0.17:2379 isLeader=false\n\n[root@etcd-0-8 ~]# etcdctl cluster-health\nmember 2d2e457c6a1a76cb is healthy: got healthy result from http://127.0.0.1:2379\nmember 56e0b6dad4c53d42 is healthy: got healthy result from http://127.0.0.1:2379\nmember d2d2e9fc758e6790 is healthy: got healthy result from http://127.0.0.1:2379\ncluster is healthy\n</code></pre>"},{"location":"k8s/note/chapter-23/#235","title":"23.5 \u7b80\u5355\u4f7f\u7528","text":""},{"location":"k8s/note/chapter-23/#2351","title":"23.5.1 \u589e\u52a0","text":"<ul> <li>set</li> </ul> <p>\u6307\u5b9a\u67d0\u4e2a\u952e\u7684\u503c\u3002\u4f8b\u5982:</p> <pre><code>$ etcdctl set /testdir/testkey \"Hello world\"\nHello world\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u5305\u62ec\uff1a</p> <pre><code>--ttl '0' \u8be5\u952e\u503c\u7684\u8d85\u65f6\u65f6\u95f4(\u5355\u4f4d\u4e3a\u79d2)\uff0c\u4e0d\u914d\u7f6e(\u9ed8\u8ba4\u4e3a0)\u5219\u6c38\u4e0d\u8d85\u65f6\n--swap-with-value value \u82e5\u8be5\u952e\u73b0\u5728\u7684\u503c\u662fvalue\uff0c\u5219\u8fdb\u884c\u8bbe\u7f6e\u64cd\u4f5c\n--swap-with-index '0'   \u82e5\u8be5\u952e\u73b0\u5728\u7684\u7d22\u5f15\u503c\u662f\u6307\u5b9a\u7d22\u5f15\uff0c\u5219\u8fdb\u884c\u8bbe\u7f6e\u64cd\u4f5c\n</code></pre> <ul> <li>mk</li> </ul> <p>\u5982\u679c\u7ed9\u5b9a\u7684\u952e\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u952e\u503c\u3002\u4f8b\u5982:</p> <pre><code>$ etcdctl mk /testdir/testkey \"Hello world\"\nHello world\n</code></pre> <p>\u5f53\u952e\u5b58\u5728\u7684\u65f6\u5019\uff0c\u6267\u884c\u8be5\u547d\u4ee4\u4f1a\u62a5\u9519\uff0c\u4f8b\u5982:</p> <pre><code>$ etcdctl mk /testdir/testkey \"Hello world\"\nError:  105: Key already exists (/testdir/testkey) [8]\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u4e3a:</p> <pre><code>--ttl '0'  \u8d85\u65f6\u65f6\u95f4(\u5355\u4f4d\u4e3a\u79d2\uff09\uff0c\u4e0d\u914d\u7f6e(\u9ed8\u8ba4\u4e3a 0)\u3002\u5219\u6c38\u4e0d\u8d85\u65f6\n</code></pre> <ul> <li>mkdir</li> </ul> <p>\u5982\u679c\u7ed9\u5b9a\u7684\u952e\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u952e\u76ee\u5f55\u3002\u4f8b\u5982\uff1a</p> <pre><code>$ etcdctl mkdir testdir2\n</code></pre> <p>\u5f53\u952e\u76ee\u5f55\u5b58\u5728\u7684\u65f6\u5019\uff0c\u6267\u884c\u8be5\u547d\u4ee4\u4f1a\u62a5\u9519\uff0c\u4f8b\u5982\uff1a</p> <pre><code>$ etcdctl mkdir testdir2\nError:  105: Key already exists (/testdir2) [9]\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u4e3a\uff1a</p> <pre><code>--ttl '0' \u8d85\u65f6\u65f6\u95f4(\u5355\u4f4d\u4e3a\u79d2)\uff0c\u4e0d\u914d\u7f6e(\u9ed8\u8ba4\u4e3a0)\u5219\u6c38\u4e0d\u8d85\u65f6\u3002\n</code></pre> <ul> <li>setdir</li> </ul> <p>\u521b\u5efa\u4e00\u4e2a\u952e\u76ee\u5f55\u3002\u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\u5c31\u521b\u5efa\uff0c\u5982\u679c\u76ee\u5f55\u5b58\u5728\u66f4\u65b0\u76ee\u5f55TTL\u3002</p> <pre><code>$ etcdctl setdir testdir3\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u4e3a:</p> <pre><code>--ttl '0' \u8d85\u65f6\u65f6\u95f4(\u5355\u4f4d\u4e3a\u79d2)\uff0c\u4e0d\u914d\u7f6e(\u9ed8\u8ba4\u4e3a0)\u5219\u6c38\u4e0d\u8d85\u65f6\u3002\n</code></pre>"},{"location":"k8s/note/chapter-23/#2352","title":"23.5.2 \u5220\u9664","text":"<ul> <li>rm</li> </ul> <p>\u5220\u9664\u67d0\u4e2a\u952e\u503c\u3002\u4f8b\u5982:</p> <pre><code>$ etcdctl rm /testdir/testkey\nPrevNode.Value: Hello\n</code></pre> <p>\u5f53\u952e\u4e0d\u5b58\u5728\u65f6\uff0c\u5219\u4f1a\u62a5\u9519\u3002\u4f8b\u5982:</p> <pre><code>$ etcdctl rm /testdir/testkey\nError:  100: Key not found (/testdir/testkey) [7]\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u4e3a\uff1a</p> <pre><code>--dir \u5982\u679c\u952e\u662f\u4e2a\u7a7a\u76ee\u5f55\u6216\u8005\u952e\u503c\u5bf9\u5219\u5220\u9664\n--recursive \u5220\u9664\u76ee\u5f55\u548c\u6240\u6709\u5b50\u952e\n--with-value  \u68c0\u67e5\u73b0\u6709\u7684\u503c\u662f\u5426\u5339\u914d\n--with-index '0'\u68c0\u67e5\u73b0\u6709\u7684index\u662f\u5426\u5339\u914d\n</code></pre> <ul> <li>rmdir</li> </ul> <p>\u5220\u9664\u4e00\u4e2a\u7a7a\u76ee\u5f55\uff0c\u6216\u8005\u952e\u503c\u5bf9\u3002</p> <pre><code>$ etcdctl setdir dir1\n$ etcdctl rmdir dir1\n</code></pre> <p>\u82e5\u76ee\u5f55\u4e0d\u7a7a\uff0c\u4f1a\u62a5\u9519:</p> <pre><code>$ etcdctl set /dir/testkey hi\nhi\n$ etcdctl rmdir /dir\nError:  108: Directory not empty (/dir) [17]\n</code></pre>"},{"location":"k8s/note/chapter-23/#2353","title":"23.5.3 \u66f4\u65b0","text":"<ul> <li>update</li> </ul> <p>\u5f53\u952e\u5b58\u5728\u65f6\uff0c\u66f4\u65b0\u503c\u5185\u5bb9\u3002\u4f8b\u5982\uff1a</p> <pre><code>$ etcdctl update /testdir/testkey \"Hello\"\nHello\n</code></pre> <p>\u5f53\u952e\u4e0d\u5b58\u5728\u65f6\uff0c\u5219\u4f1a\u62a5\u9519\u3002\u4f8b\u5982:</p> <pre><code>$ etcdctl update /testdir/testkey2 \"Hello\"\nError:  100: Key not found (/testdir/testkey2) [6]\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u4e3a:</p> <pre><code>--ttl '0' \u8d85\u65f6\u65f6\u95f4(\u5355\u4f4d\u4e3a\u79d2)\uff0c\u4e0d\u914d\u7f6e(\u9ed8\u8ba4\u4e3a 0)\u5219\u6c38\u4e0d\u8d85\u65f6\u3002\n</code></pre> <ul> <li>updatedir</li> </ul> <p>\u66f4\u65b0\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u76ee\u5f55\u3002</p> <pre><code>$ etcdctl updatedir testdir2\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u4e3a:</p> <pre><code>--ttl '0' \u8d85\u65f6\u65f6\u95f4(\u5355\u4f4d\u4e3a\u79d2)\uff0c\u4e0d\u914d\u7f6e(\u9ed8\u8ba4\u4e3a0)\u5219\u6c38\u4e0d\u8d85\u65f6\u3002\n</code></pre>"},{"location":"k8s/note/chapter-23/#2354","title":"23.5.4 \u67e5\u8be2","text":"<ul> <li>get</li> </ul> <p>\u83b7\u53d6\u6307\u5b9a\u952e\u7684\u503c\u3002\u4f8b\u5982\uff1a</p> <pre><code>$ etcdctl get /testdir/testkey\nHello world\n</code></pre> <p>\u5f53\u952e\u4e0d\u5b58\u5728\u65f6\uff0c\u5219\u4f1a\u62a5\u9519\u3002\u4f8b\u5982\uff1a</p> <pre><code>$ etcdctl get /testdir/testkey2\nError:  100: Key not found (/testdir/testkey2) [5]\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u4e3a:</p> <pre><code>--sort \u5bf9\u7ed3\u679c\u8fdb\u884c\u6392\u5e8f\n--consistent \u5c06\u8bf7\u6c42\u53d1\u7ed9\u4e3b\u8282\u70b9\uff0c\u4fdd\u8bc1\u83b7\u53d6\u5185\u5bb9\u7684\u4e00\u81f4\u6027\u3002\n</code></pre> <ul> <li>ls</li> </ul> <p>\u5217\u51fa\u76ee\u5f55(\u9ed8\u8ba4\u4e3a\u6839\u76ee\u5f55)\u4e0b\u7684\u952e\u6216\u8005\u5b50\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e0d\u663e\u793a\u5b50\u76ee\u5f55\u4e2d\u5185\u5bb9\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>$ etcdctl ls\n/testdir\n/testdir2\n/dir\n\n$ etcdctl ls dir\n/dir/testkey\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u5305\u62ec:</p> <pre><code>--sort \u5c06\u8f93\u51fa\u7ed3\u679c\u6392\u5e8f\n--recursive \u5982\u679c\u76ee\u5f55\u4e0b\u6709\u5b50\u76ee\u5f55\uff0c\u5219\u9012\u5f52\u8f93\u51fa\u5176\u4e2d\u7684\u5185\u5bb9\n-p \u5bf9\u4e8e\u8f93\u51fa\u4e3a\u76ee\u5f55\uff0c\u5728\u6700\u540e\u6dfb\u52a0/\u8fdb\u884c\u533a\u5206\n</code></pre>"},{"location":"k8s/note/chapter-23/#2355-watch","title":"23.5.5 watch","text":"<ul> <li>watch</li> </ul> <p>\u76d1\u6d4b\u4e00\u4e2a\u952e\u503c\u7684\u53d8\u5316\uff0c\u4e00\u65e6\u952e\u503c\u53d1\u751f\u66f4\u65b0\uff0c\u5c31\u4f1a\u8f93\u51fa\u6700\u65b0\u7684\u503c\u5e76\u9000\u51fa\u3002</p> <p>\u4f8b\u5982:\u7528\u6237\u66f4\u65b0testkey\u952e\u503c\u4e3aHello watch\u3002</p> <pre><code>$ etcdctl get /testdir/testkey\nHello world\n$ etcdctl set /testdir/testkey \"Hello watch\"\nHello watch\n$ etcdctl watch testdir/testkey\nHello watch\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u5305\u62ec:</p> <pre><code>--forever  \u4e00\u76f4\u76d1\u6d4b\u76f4\u5230\u7528\u6237\u6309CTRL+C\u9000\u51fa\n--after-index '0' \u5728\u6307\u5b9aindex\u4e4b\u524d\u4e00\u76f4\u76d1\u6d4b\n--recursive \u8fd4\u56de\u6240\u6709\u7684\u952e\u503c\u548c\u5b50\u952e\u503c\n</code></pre> <ul> <li>exec-watch</li> </ul> <p>\u76d1\u6d4b\u4e00\u4e2a\u952e\u503c\u7684\u53d8\u5316\uff0c\u4e00\u65e6\u952e\u503c\u53d1\u751f\u66f4\u65b0\uff0c\u5c31\u6267\u884c\u7ed9\u5b9a\u547d\u4ee4\u3002</p> <p>\u4f8b\u5982\uff1a\u7528\u6237\u66f4\u65b0testkey\u952e\u503c\u3002</p> <pre><code>$ etcdctl exec-watch testdir/testkey -- sh -c 'ls'\nconfig  Documentation  etcd  etcdctl  README-etcdctl.md  README.md  READMEv2-etcdctl.md\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u5305\u62ec:</p> <pre><code>--after-index '0' \u5728\u6307\u5b9a index \u4e4b\u524d\u4e00\u76f4\u76d1\u6d4b\n--recursive \u8fd4\u56de\u6240\u6709\u7684\u952e\u503c\u548c\u5b50\u952e\u503c\n</code></pre>"},{"location":"k8s/note/chapter-23/#2356","title":"23.5.6 \u5907\u4efd","text":"<p>\u5907\u4efdetcd\u7684\u6570\u636e\u3002</p> <pre><code>$ etcdctl backup --data-dir /var/lib/etcd  --backup-dir /home/etcd_backup\n</code></pre> <p>\u652f\u6301\u7684\u9009\u9879\u5305\u62ec:</p> <pre><code>--data-dir  etcd\u7684\u6570\u636e\u76ee\u5f55\n--backup-dir \u5907\u4efd\u5230\u6307\u5b9a\u8def\u5f84\n</code></pre>"},{"location":"k8s/note/chapter-23/#2357-member","title":"23.5.7 member","text":"<p>\u901a\u8fc7<code>list</code>\u3001<code>add</code>\u3001<code>remove</code>\u547d\u4ee4\u5217\u51fa\u3001\u6dfb\u52a0\u3001\u5220\u9664etcd\u5b9e\u4f8b\u5230etcd\u96c6\u7fa4\u4e2d\u3002</p> <p>\u67e5\u770b\u96c6\u7fa4\u4e2d\u5b58\u5728\u7684\u8282\u70b9</p> <pre><code>$ etcdctl member list\n8e9e05c52164694d: name=dev-master-01 peerURLs=http://localhost:2380 clientURLs=http://localhost:2379 isLeader=true\n</code></pre> <p>\u5220\u9664\u96c6\u7fa4\u4e2d\u5b58\u5728\u7684\u8282\u70b9</p> <pre><code>$ etcdctl member remove 8e9e05c52164694d\nRemoved member 8e9e05c52164694d from cluster\n</code></pre> <p>\u5411\u96c6\u7fa4\u4e2d\u65b0\u52a0\u8282\u70b9</p> <pre><code>$ etcdctl member add etcd3 http://192.168.1.100:2380\nAdded member named etcd3 with ID 8e9e05c52164694d to cluster\n</code></pre>"},{"location":"k8s/note/chapter-23/#236","title":"23.6 \u793a\u4f8b","text":"<pre><code># \u8bbe\u7f6e\u4e00\u4e2akey\u503c\n[root@etcd-0-8 ~]# etcdctl set /msg \"hello k8s\"\nhello k8s\n\n# \u83b7\u53d6key\u7684\u503c\n[root@etcd-0-8 ~]# etcdctl get /msg\nhello k8s\n\n# \u83b7\u53d6key\u503c\u7684\u8be6\u7ec6\u4fe1\u606f\n[root@etcd-0-8 ~]# etcdctl -o extended get /msg\nKey: /msg\nCreated-Index: 12\nModified-Index: 12\nTTL: 0\nIndex: 12\n\nhello k8s\n\n# \u83b7\u53d6\u4e0d\u5b58\u5728\u7684key\u56de\u62a5\u9519\n[root@etcd-0-8 ~]# etcdctl get /xxzx\nError:  100: Key not found (/xxzx) [12]\n\n# \u8bbe\u7f6ekey\u7684ttl\uff0c\u8fc7\u671f\u540e\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\n[root@etcd-0-8 ~]# etcdctl set /testkey \"tmp key test\" --ttl 5\ntmp key test\n[root@etcd-0-8 ~]# etcdctl get /testkey\nError:  100: Key not found (/testkey) [14]\n\n# key \u66ff\u6362\u64cd\u4f5c\n[root@etcd-0-8 ~]# etcdctl get /msg\nhello k8s\n[root@etcd-0-8 ~]# etcdctl set --swap-with-value \"hello k8s\" /msg \"goodbye\"\ngoodbye\n[root@etcd-0-8 ~]# etcdctl get /msg\ngoodbye\n\n# mk \u4ec5\u5f53key\u4e0d\u5b58\u5728\u65f6\u521b\u5efa(set\u5bf9\u540c\u4e00\u4e2akey\u4f1a\u8986\u76d6)\n[root@etcd-0-8 ~]# etcdctl get /msg\ngoodbye\n[root@etcd-0-8 ~]# etcdctl mk /msg \"mktest\"\nError:  105: Key already exists (/msg) [18]\n[root@etcd-0-8 ~]# etcdctl mk /msg1 \"mktest\"\nmktest\n\n# \u521b\u5efa\u81ea\u6392\u5e8f\u7684key\n[root@etcd-0-8 ~]# etcdctl mk --in-order /queue s1\ns1\n[root@etcd-0-8 ~]# etcdctl mk --in-order /queue s2\ns2\n[root@etcd-0-8 ~]# etcdctl ls --sort /queue\n/queue/00000000000000000021\n/queue/00000000000000000022\n[root@etcd-0-8 ~]# etcdctl get /queue/00000000000000000021\ns1\n\n# \u66f4\u65b0key\u503c\n[root@etcd-0-8 ~]# etcdctl update /msg1 \"update test\"\nupdate test\n[root@etcd-0-8 ~]# etcdctl get /msg1\nupdate test\n\n# \u66f4\u65b0key\u7684ttl\u53ca\u503c\n[root@etcd-0-8 ~]# etcdctl update --ttl 5 /msg \"aaa\"\naaa\n\n# \u521b\u5efa\u76ee\u5f55\n[root@etcd-0-8 ~]# etcdctl mkdir /testdir\n\n# \u5220\u9664\u7a7a\u76ee\u5f55\n[root@etcd-0-8 ~]# etcdctl mkdir /test1\n[root@etcd-0-8 ~]# etcdctl rmdir /test1\n\n# \u5220\u9664\u975e\u7a7a\u76ee\u5f55\n[root@etcd-0-8 ~]# etcdctl get /testdir\n/testdir: is a directory\n[root@etcd-0-8 ~]#\n[root@etcd-0-8 ~]# etcdctl rm --recursive /testdir\n\n# \u5217\u51fa\u76ee\u5f55\u5185\u5bb9\n[root@etcd-0-8 ~]# etcdctl ls /\n/tmp\n/msg1\n/queue\n[root@etcd-0-8 ~]# etcdctl ls /tmp\n/tmp/a\n/tmp/b\n\n# \u9012\u5f52\u5217\u51fa\u76ee\u5f55\u7684\u5185\u5bb9\n[root@etcd-0-8 ~]# etcdctl ls --recursive /\n/msg1\n/queue\n/queue/00000000000000000021\n/queue/00000000000000000022\n/tmp\n/tmp/b\n/tmp/a\n\n# \u76d1\u542ckey\uff0c\u5f53key\u53d1\u751f\u6539\u53d8\u7684\u65f6\u5019\u6253\u5370\u51fa\u53d8\u5316\n[root@etcd-0-8 ~]# etcdctl watch /msg1\nxxx\n\n[root@VM_0_17_centos ~]# etcdctl update /msg1 \"xxx\"\nxxx\n\n# \u76d1\u542c\u67d0\u4e2a\u76ee\u5f55\uff0c\u5f53\u76ee\u5f55\u4e2d\u4efb\u4f55 node \u6539\u53d8\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u6253\u5370\u51fa\u6765\n[root@etcd-0-8 ~]# etcdctl watch --recursive /\n[update] /msg1\nxxx\n\n[root@VM_0_17_centos ~]# etcdctl update /msg1 \"xxx\"\nxxx\n\n# \u4e00\u76f4\u76d1\u542c\uff0c\u9664\u975e `CTL + C` \u5bfc\u81f4\u9000\u51fa\u76d1\u542c\n[root@etcd-0-8 ~]# etcdctl watch --forever /\n\n\n# \u76d1\u542c\u76ee\u5f55\uff0c\u5f53\u53d1\u751f\u53d8\u5316\u65f6\u6267\u884c\u4e00\u6761\u547d\u4ee4\n[root@etcd-0-8 ~]# etcdctl exec-watch --recursive / -- sh -c \"echo change\"\nchange\n\n# backup\n[root@etcd-0-14 ~]# etcdctl backup --data-dir /data/app/etcd --backup-dir /root/etcd_backup\n2019-12-04 10:25:16.113237 I | ignoring EntryConfChange raft entry\n2019-12-04 10:25:16.113268 I | ignoring EntryConfChange raft entry\n2019-12-04 10:25:16.113272 I | ignoring EntryConfChange raft entry\n2019-12-04 10:25:16.113293 I | ignoring member attribute update on /0/members/2d2e457c6a1a76cb/attributes\n2019-12-04 10:25:16.113299 I | ignoring member attribute update on /0/members/d2d2e9fc758e6790/attributes\n2019-12-04 10:25:16.113305 I | ignoring member attribute update on /0/members/56e0b6dad4c53d42/attributes\n2019-12-04 10:25:16.113310 I | ignoring member attribute update on /0/members/56e0b6dad4c53d42/attributes\n2019-12-04 10:25:16.113314 I | ignoring member attribute update on /0/members/2d2e457c6a1a76cb/attributes\n2019-12-04 10:25:16.113319 I | ignoring member attribute update on /0/members/d2d2e9fc758e6790/attributes\n2019-12-04 10:25:16.113384 I | ignoring member attribute update on /0/members/56e0b6dad4c53d42/attributes\n\n# \u4f7f\u7528v3\u7248\u672c\n[root@etcd-0-14 ~]# export ETCDCTL_API=3\n[root@etcd-0-14 ~]# etcdctl --endpoints=\"http://172.16.0.8:2379,http://172.16.0.14:2379,http://172.16.0.17:2379\" snapshot save mysnapshot.db\nSnapshot saved at mysnapshot.db\n[root@etcd-0-14 ~]# etcdctl snapshot status mysnapshot.db -w json\n{\"hash\":928285884,\"revision\"    :0,\"totalKey\":5,\"totalSize\":20480}\n</code></pre> <ul> <li> <p>\u53c2\u8003\u94fe\u63a5</p> </li> <li> <p>https://github.com/etcd-io/etcd</p> </li> <li>https://www.yuque.com/lurunhao/nl81zh/hb8sie</li> <li>https://www.hi-linux.com/posts/40915.html</li> <li>https://cizixs.com/2016/08/02/intro-to-etcd/  </li> <li>Etcd Raft\u4f7f\u7528\u5165\u95e8\u53ca\u539f\u7406\u89e3\u6790</li> <li>https://juejin.im/post/5dabc50ef265da5b591b761a</li> <li>https://www.infoq.cn/article/coreos-analyse-etcd/</li> </ul>"},{"location":"k8s/note/chapter-24/","title":"\u4e8c\u5341\u56db \u56fd\u4ea7\u5bb9\u5668\u7ba1\u7406\u5e73\u53f0KubeSphere\u5b9e\u6218\u6392\u9519","text":"<p>\u6982\u8ff0\uff1a\u8fd1\u671f\u5728\u4f7f\u7528QingCloud\u7684Kubesphere\uff0c\u6781\u597d\u7684\u7528\u6237\u4f53\u9a8c\uff0c\u79c1\u6709\u5316\u90e8\u7f72\uff0c\u65e0\u57fa\u7840\u8bbe\u65bd\u4f9d\u8d56\uff0c\u65e0 Kubernetes \u4f9d\u8d56\uff0c\u652f\u6301\u8de8\u7269\u7406\u673a\u3001\u865a\u62df\u673a\u3001\u4e91\u5e73\u53f0\u90e8\u7f72\uff0c\u53ef\u4ee5\u7eb3\u7ba1\u4e0d\u540c\u7248\u672c\u3001\u4e0d\u540c\u5382\u5546\u7684 Kubernetes \u96c6\u7fa4\u3002\u5728k8s\u4e0a\u5c42\u8fdb\u884c\u4e86\u5c01\u88c5\u5b9e\u73b0\u4e86\u57fa\u4e8e\u89d2\u8272\u7684\u6743\u9650\u63a7\u5236\uff0cDevOPS\u6d41\u6c34\u7ebf\u5feb\u901f\u5b9e\u73b0CI/CD\uff0c\u5185\u7f6eharbor/gitlab/jenkins/sonarqube\u7b49\u5e38\u7528\u5de5\u5177\uff0c\u57fa\u4e8e\u57fa\u4e8e OpenPitrix \u63d0\u4f9b\u5e94\u7528\u7684\u5168\u751f\u547d\u5468\u671f\u7ba1\u7406\uff0c\u5305\u542b\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u53d1\u5e03\u3001\u5347\u7ea7\uff0c\u4e0b\u67b6\u7b49\u5e94\u7528\u76f8\u5173\u64cd\u4f5c\u81ea\u5df1\u4f53\u9a8c\u8fd8\u662f\u975e\u5e38\u7684\u68d2\u3002 \u540c\u6837\u4f5c\u4e3a\u5f00\u6e90\u9879\u76ee\uff0c\u96be\u514d\u5b58\u5728\u4e00\u4e9bbug\uff0c\u5728\u81ea\u5df1\u7684\u4f7f\u7528\u4e2d\u9047\u5230\u4e0b\u6392\u9519\u601d\u8def\uff0c\u975e\u5e38\u611f\u8c22qingcloud\u793e\u533a\u63d0\u4f9b\u7684\u6280\u672f\u534f\u52a9\uff0c\u5bf9k8s\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u53bb\u4f53\u9a8c\u4e0b\u56fd\u4ea7\u7684\u5e73\u53f0\uff0c\u5982\u4e1d\u822c\u987a\u6ed1\u7684\u4f53\u9a8c\uff0crancher\u7684\u7528\u6237\u4e5f\u53ef\u4ee5\u6765\u5bf9\u4e0d\u4f53\u9a8c\u4e0b\u3002</p>"},{"location":"k8s/note/chapter-24/#241","title":"24.1 \u6e05\u7406\u9000\u51fa\u72b6\u6001\u7684\u5bb9\u5668","text":"<p>\u5728\u96c6\u7fa4\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u6709\u4e9bcontainer\u7531\u4e8e\u5f02\u5e38\u72b6\u6001\u9000\u51faExited\uff0c\u9700\u8981\u53bb\u53ca\u65f6\u6e05\u7406\u91ca\u653e\u78c1\u76d8\uff0c\u53ef\u4ee5\u5c06\u5176\u8bbe\u7f6e\u6210\u5b9a\u65f6\u4efb\u52a1\u6267\u884c</p> <pre><code>docker rm `docker ps -a | grep Exited |awk '{print $1}'`\n</code></pre>"},{"location":"k8s/note/chapter-24/#242-pod","title":"24.2 \u6e05\u7406\u5f02\u5e38\u6216\u88ab\u9a71\u9010\u7684 pod","text":"<ul> <li>\u6e05\u7406kubesphere-devops-system\u7684ns\u4e0b\u6e05\u7406</li> </ul> <pre><code>kubectl delete pods -n kubesphere-devops-system $(kubectl get pods -n kubesphere-devops-system | grep Evicted |awk '{print $1}')\nkubectl delete pods -n kubesphere-devops-system $(kubectl get pods -n kubesphere-devops-system | grep CrashLoopBackOff |awk '{print $1}')\n</code></pre> <ul> <li>\u4e3a\u65b9\u4fbf\u6e05\u7406\u6307\u5b9ans\u6e05\u7406evicted/crashloopbackoff\u7684pod/\u6e05\u7406exited\u7684\u5bb9\u5668</li> </ul> <pre><code>#!/bin/bash\n# auth:kaliarch\n\nclear_evicted_pod() {\n  ns=$1\n  kubectl delete pods -n ${ns} $(kubectl get pods -n ${ns} | grep Evicted |awk '{print $1}')\n}\nclear_crash_pod() {\n  ns=$1\n  kubectl delete pods -n ${ns} $(kubectl get pods -n ${ns} | grep CrashLoopBackOff |awk '{print $1}')\n}\nclear_exited_container() {\n  docker rm `docker ps -a | grep Exited |awk '{print $1}'`\n}\n\n\necho \"1.clear exicted pod\"\necho \"2.clear crash pod\"\necho \"3.clear exited container\"\nread -p \"Please input num:\" num\n\n\ncase ${num} in \n\"1\")\n  read -p \"Please input oper namespace:\" ns\n  clear_evicted_pod ${ns}\n  ;;\n\n\n\"2\")\n  read -p \"Please input oper namespace:\" ns\n  clear_crash_pod ${ns}\n  ;;\n\"3\")\n  clear_exited_container\n  ;;\n\"*\")\n  echo \"input error\"\n  ;;\nesac\n</code></pre> <ul> <li>\u6e05\u7406\u5168\u90e8ns\u4e2devicted/crashloopbackoff\u7684pod</li> </ul> <pre><code># \u83b7\u53d6\u6240\u6709ns\nkubectl get ns | grep -v \"NAME\" |awk '{print $1}'\n\n# \u6e05\u7406\u9a71\u9010\u72b6\u6001\u7684pod\nfor ns in `kubectl get ns | grep -v \"NAME\" | awk '{print $1}'`;do kubectl delete pods -n ${ns} $(kubectl get pods -n ${ns} | grep \"Evicted\" |awk '{print $1}');done\n# \u6e05\u7406\u5f02\u5e38pod\nfor ns in `kubectl get ns | grep -v \"NAME\" | awk '{print $1}'`;do kubectl delete pods -n ${ns} $(kubectl get pods -n ${ns} | grep \"CrashLoopBackOff\" |awk '{print $1}');done\n</code></pre>"},{"location":"k8s/note/chapter-24/#243-docker","title":"24.3 Docker \u6570\u636e\u8fc1\u79fb","text":"<p>\u5728\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u672a\u6307\u5b9adocker\u6570\u636e\u76ee\u5f55\uff0c\u7cfb\u7edf\u76d850G\uff0c\u968f\u7740\u65f6\u95f4\u63a8\u79fb\u78c1\u76d8\u4e0d\u591f\u7528\uff0c\u9700\u8981\u8fc1\u79fbdocker\u6570\u636e\uff0c\u4f7f\u7528\u8f6f\u8fde\u63a5\u65b9\u5f0f\uff1a \u9996\u9009\u6302\u8f7d\u65b0\u78c1\u76d8\u5230/data\u76ee\u5f55</p> <pre><code>systemctl stop docker\n\nmkdir -p /data/docker/  \n\nrsync -avz /var/lib/docker/ /data/docker/  \n\nmv /var/lib/docker /data/docker_bak\n\nln -s /data/docker /var/lib/\n\nsystemctl daemon-reload\n\nsystemctl start docker\n</code></pre>"},{"location":"k8s/note/chapter-24/#244-kubesphere","title":"24.4 kubesphere \u7f51\u7edc\u6392\u9519","text":"<ul> <li>\u95ee\u9898\u63cf\u8ff0\uff1a</li> </ul> <p>\u5728kubesphere\u7684node\u8282\u70b9\u6216master\u8282\u70b9\uff0c\u624b\u52a8\u53bb\u542f\u52a8\u5bb9\u5668\uff0c\u5728\u5bb9\u5668\u91cc\u9762\u65e0\u6cd5\u8fde\u901a\u516c\u7f51\uff0c\u662f\u6211\u7684\u914d\u7f6e\u54ea\u91cc\u4e0d\u5bf9\u4e48\uff0c\u4e4b\u524d\u9ed8\u8ba4\u4f7f\u7528calico\uff0c\u73b0\u5728\u6539\u6210fluannel\u4e5f\u4e0d\u884c\uff0c\u5728kubesphere\u4e2d\u90e8\u7f72deployment\u4e2d\u7684pod\u7684\u5bb9\u5668\u4e0a\u53ef\u4ee5\u51fa\u516c\u7f51\uff0c\u5728node\u6216master\u5355\u72ec\u624b\u52a8\u542f\u52a8\u7684\u8bbf\u95ee\u4e0d\u4e86\u516c\u7f51</p> <p>\u67e5\u770b\u624b\u52a8\u542f\u52a8\u7684\u5bb9\u5668\u7f51\u7edc\u4e0a\u8d70\u7684docker0</p> <pre><code>root@fd1b8101475d:/# ip a\n\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n\n    inet 127.0.0.1/8 scope host lo\n\n       valid_lft forever preferred_lft forever\n\n2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN group default qlen 1\n\n    link/ipip 0.0.0.0 brd 0.0.0.0\n\n105: eth0@if106: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default \n\n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n\n    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0\n\n       valid_lft forever preferred_lft forever\n</code></pre> <p>\u5728pods\u4e2d\u7684\u5bb9\u5668\u7f51\u7edc\u7528\u7684\u662fkube-ipvs0</p> <pre><code>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1\n\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n\n    inet 127.0.0.1/8 scope host lo\n\n       valid_lft forever preferred_lft forever\n\n2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop qlen 1\n\n    link/ipip 0.0.0.0 brd 0.0.0.0\n\n4: eth0@if18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue\n\n    link/ether c2:27:44:13:df:5d brd ff:ff:ff:ff:ff:ff\n\n    inet 10.233.97.175/32 scope global eth0\n\n       valid_lft forever preferred_lft forever\n</code></pre> <ul> <li>\u89e3\u51b3\u65b9\u6848\uff1a</li> </ul> <p>\u67e5\u770bdocker\u542f\u52a8\u914d\u7f6e</p> <p></p> <p>\u4fee\u6539\u6587\u4ef6/etc/systemd/system/docker.service.d/docker-options.conf\u4e2d\u53bb\u6389\u53c2\u6570\uff1a--iptables=false  \u8fd9\u4e2a\u53c2\u6570\u7b49\u4e8efalse\u65f6\u4f1a\u4e0d\u5199iptables</p> <pre><code>[Service]\nEnvironment=\"DOCKER_OPTS=  --registry-mirror=https://registry.docker-cn.com --data-root=/var/lib/docker --log-opt max-size=10m --log-opt max-file=3 --insecure-registry=harbor.devops.kubesphere.local:30280\"\n</code></pre>"},{"location":"k8s/note/chapter-24/#245-kubesphere","title":"24.5 kubesphere \u5e94\u7528\u8def\u7531\u5f02\u5e38","text":"<p>\u5728kubesphere\u4e2d\u5e94\u7528\u8def\u7531ingress\u4f7f\u7528\u7684\u662fnginx\uff0c\u5728web\u754c\u9762\u914d\u7f6e\u4f1a\u5bfc\u81f4\u4e24\u4e2ahost\u4f7f\u7528\u540c\u4e00\u4e2aca\u8bc1\u4e66\uff0c\u53ef\u4ee5\u901a\u8fc7\u6ce8\u91ca\u6587\u4ef6\u914d\u7f6e</p> <p>\u26a0\ufe0f\u6ce8\u610f\uff1aingress\u63a7\u5236deployment\u5728\uff1a</p> <p></p> <pre><code>kind: Ingress\napiVersion: extensions/v1beta1\nmetadata:\n  name: prod-app-ingress\n  namespace: prod-net-route\n  resourceVersion: '8631859'\n  labels:\n    app: prod-app-ingress\n  annotations:\n    desc: \u751f\u4ea7\u73af\u5883\u5e94\u7528\u8def\u7531\n    nginx.ingress.kubernetes.io/client-body-buffer-size: 1024m\n    nginx.ingress.kubernetes.io/proxy-body-size: 2048m\n    nginx.ingress.kubernetes.io/proxy-read-timeout: '3600'\n    nginx.ingress.kubernetes.io/proxy-send-timeout: '1800'\n    nginx.ingress.kubernetes.io/service-upstream: 'true'\nspec:\n  tls:\n    - hosts:\n        - smartms.tools.anchnet.com\n      secretName: smartms-ca\n    - hosts:\n        - smartsds.tools.anchnet.com\n      secretName: smartsds-ca\n  rules:\n    - host: smartms.tools.anchnet.com\n      http:\n        paths:\n          - path: /\n            backend:\n              serviceName: smartms-frontend-svc\n              servicePort: 80\n    - host: smartsds.tools.anchnet.com\n      http:\n        paths:\n          - path: /\n            backend:\n              serviceName: smartsds-frontend-svc\n\n              servicePort: 80\n</code></pre>"},{"location":"k8s/note/chapter-24/#246-jenkins-agent","title":"24.6 Jenkins \u7684 Agent","text":"<p>\u7528\u6237\u5728\u81ea\u5df1\u7684\u4f7f\u7528\u573a\u666f\u5f53\u4e2d\uff0c\u53ef\u80fd\u4f1a\u4f7f\u7528\u4e0d\u540c\u7684\u8bed\u8a00\u7248\u672c\u6d3b\u4e0d\u540c\u7684\u5de5\u5177\u7248\u672c\u3002\u8fd9\u7bc7\u6587\u6863\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u66ff\u6362\u5185\u7f6e\u7684 agent\u3002</p> <p>\u9ed8\u8ba4base-build\u955c\u50cf\u4e2d\u6ca1\u6709sonar-scanner\u5de5\u5177\uff0cKubesphere Jenkins \u7684\u6bcf\u4e00\u4e2a agent \u90fd\u662f\u4e00\u4e2aPod\uff0c\u5982\u679c\u8981\u66ff\u6362\u5185\u7f6e\u7684agent\uff0c\u5c31\u9700\u8981\u66ff\u6362 agent \u7684\u76f8\u5e94\u955c\u50cf\u3002</p> <p>\u6784\u5efa\u6700\u65b0 kubesphere/builder-base:advanced-1.0.0 \u7248\u672c\u7684 agent \u955c\u50cf</p> <p>\u66f4\u65b0\u4e3a\u6307\u5b9a\u7684\u81ea\u5b9a\u4e49\u955c\u50cf\uff1accr.ccs.tencentyun.com/testns/base:v1</p> <p>\u53c2\u8003\u94fe\u63a5\uff1ahttps://kubesphere.io/docs/advanced-v2.0/zh-CN/devops/devops-admin-faq/#%E5%8D%87%E7%BA%A7-jenkins-agent-%E7%9A%84%E5%8C%85%E7%89%88%E6%9C%AC </p> <p>\u5728 KubeSphere \u4fee\u6539 jenkins-casc-config \u4ee5\u540e\uff0c\u60a8\u9700\u8981\u5728 Jenkins Dashboard \u7cfb\u7edf\u7ba1\u7406\u4e0b\u7684 configuration-as-code \u9875\u9762\u91cd\u65b0\u52a0\u8f7d\u60a8\u66f4\u65b0\u8fc7\u7684\u7cfb\u7edf\u914d\u7f6e\u3002</p> <p>\u53c2\u8003\uff1a</p> <p>https://kubesphere.io/docs/advanced-v2.0/zh-CN/devops/jenkins-setting/#%E7%99%BB%E9%99%86-jenkins-%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD </p> <p>jenkins\u4e2d\u66f4\u65b0base\u955c\u50cf </p> <p>\u26a0\ufe0f\u5148\u4fee\u6539kubesphere\u4e2djenkins\u7684\u914d\u7f6e\uff0cjenkins-casc-config</p>"},{"location":"k8s/note/chapter-24/#247-devops-mail","title":"24.7 Devops \u4e2d Mail\u7684\u53d1\u9001","text":"<p>\u53c2\u8003\uff1ahttps://www.cloudbees.com/blog/mail-step-jenkins-workflow</p> <p>\u5185\u7f6e\u53d8\u91cf\uff1a</p> \u53d8\u91cf\u540d \u89e3\u91ca BUILD_NUMBER The current build number, such as \"153\" BUILD_ID The current build ID, identical to BUILD_NUMBER for builds created in 1.597+, but a YYYY-MM-DD_hh-mm-ss timestamp for older builds BUILD_DISPLAY_NAME The display name of the current build, which is something like \"#153\" by default. JOB_NAME Name of the project of this build, such as \"foo\" or \"foo/bar\". (To strip off folder paths from a Bourne shell script, try: ${JOB_NAME}) BUILD_TAG String of \"jenkins-${JOB_NAME}-${BUILD_NUMBER}\". Convenient to put into a resource file, a jar file, etc for easier identification. EXECUTOR_NUMBER The unique number that identifies the current executor (among executors of the same machine) that\u2019s carrying out this build. This is the number you see in the \"build executor status\", except that the number starts from 0, not 1. NODE_NAME Name of the slave if the build is on a slave, or \"master\" if run on master NODE_LABELS Whitespace-separated list of labels that the node is assigned. WORKSPACE The absolute path of the directory assigned to the build as a workspace. JENKINS_HOME The absolute path of the directory assigned on the master node for Jenkins to store data. JENKINS_URL Full URL of Jenkins, like http://server:port/jenkins/ (note: only available if Jenkins URL set in system configuration) BUILD_URL Full URL of this build, like http://server:port/jenkins/job/foo/15/ (Jenkins URL must be set) SVN_REVISION Subversion revision number that's currently checked out to the workspace, such as \"12345\" SVN_URL Subversion URL that's currently checked out to the workspace. JOB_URL Full URL of this job, like http://server:port/jenkins/job/foo/ (Jenkins URL must be set) <p>\u6700\u7ec8\u81ea\u5df1\u5199\u4e86\u9002\u5e94\u81ea\u5df1\u4e1a\u52a1\u7684\u6a21\u7248\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528  </p> <p><pre><code>mail to: 'xuel@net.com',\n          charset:'UTF-8', // or GBK/GB18030\n          mimeType:'text/plain', // or text/html\n          subject: \"Kubesphere ${env.JOB_NAME} [${env.BUILD_NUMBER}] \u53d1\u5e03\u6b63\u5e38Running Pipeline: ${currentBuild.fullDisplayName}\",\n          body: \"\"\"\n          ---------Anchnet Devops Kubesphere Pipeline job--------------------\n\n\n          \u9879\u76ee\u540d\u79f0 : ${env.JOB_NAME}\n          \u6784\u5efa\u6b21\u6570 : ${env.BUILD_NUMBER}\n          \u626b\u63cf\u4fe1\u606f : \u5730\u5740:${SONAR_HOST}\n          \u955c\u50cf\u5730\u5740 : ${REGISTRY}/${QHUB_NAMESPACE}/${APP_NAME}:${IMAGE_TAG}\n          \u6784\u5efa\u8be6\u60c5\uff1aSUCCESSFUL: Job ${env.JOB_NAME} [${env.BUILD_NUMBER}]\n          \u6784\u5efa\u72b6\u6001 : ${env.JOB_NAME} jenkins \u53d1\u5e03\u8fd0\u884c\u6b63\u5e38\n          \u6784\u5efaURL : ${env.BUILD_URL}\"\"\"\n</code></pre> </p>"},{"location":"k8s/note/chapter-24/#248-kubesphere","title":"24.8 kubesphere\u5e94\u7528\u4e0a\u4f20\u95ee\u9898","text":""},{"location":"k8s/note/chapter-24/#2481-413","title":"24.8.1 \u6587\u4ef6\u4e0a\u4f20413","text":"<p>\u5c06\u5e94\u7528\u90e8\u7f72\u8fdb\u5165kubesphere\u4e2d\uff0c\u5e94\u7528\u4e2d\u6709\u8bbe\u7f6e\u4e0a\u4f20\u6587\u4ef6\u529f\u80fd\uff0c\u6d4b\u8bd5\u4e0a\u6b21\u5f02\u5e38\u65e0\u6cd5\u6b63\u5e38\u4e0a\u4f20\uff0c\u6587\u4ef6\u4e0a\u4f20\uff0cingress413\u62a5\u9519\uff0ckubesphere\u4f7f\u7528\u7684\u662fingress-nginx\u63a7\u5236\u5668\uff0c\u53ef\u4ee5\u5728\u5176\u4e2d\u6ce8\u89e3\u6dfb\u52a0k-v\u6765\u652f\u6301\uff0c</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u5e94\u7528\u8def\u7531\u81ea\u5b9a\u4e49max body size</p> <p>https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#custom-max-body-size</p>"},{"location":"k8s/note/chapter-24/#2482-504","title":"24.8.2 \u5927\u6587\u4ef6\u4e0a\u4f20\u540e\u7aef504","text":"<p>\u5927\u6587\u4ef6\u4e0a\u4f20\u540e\u7aef\u54cd\u5e94504\u89e3\u51b3\u65b9\u6848\uff1a</p> <pre><code>proxy read timeoutnginx.ingress.kubernetes.io/proxy-read-timeout\n</code></pre>"},{"location":"k8s/note/chapter-24/#249","title":"24.9 \u8de8\u57df\u95ee\u9898","text":"<p>kubesphere\u4f7f\u7528ingress-nginx\u652f\u6301\u8de8\u57df\uff0c\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u94fe\u63a5\u5728\u6ce8\u89e3\u4e2d\u6dfb\u52a0</p> <p>https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#enable-cors</p> <p>\u6d4b\u8bd5\u73af\u5883\u53ef\u4ee5\u4f7f\u7528\u53ef\u4ee5\u4f7f\u7528hosts\uff0c\u5c06\u57df\u540d\u89e3\u6790\u5230\u672c\u5730\uff0c\u524d\u7aef\u5229\u7528nginx\u6765\u505a\u9759\u6001\u6587\u4ef6\u670d\u52a1\uff0c\u53cd\u5411\u4ee3\u7406\u540e\u7aefapi\uff0c\u53ef\u4ee5\u53c2\u8003\u793a\u4f8b\uff1a</p> <pre><code>server {\n  listen 80;\n  server_name localhost;\n  # \u5f3a\u5236https\u8df3\u8f6c\n  # rewrite ^(.*)$ https://$host$1 permanent;\n  location / {\n    index      index.html;\n    root       /smart-frontend;\n    try_files $uri $uri/ /index.html;\n    client_body_buffer_size 200m;\n    charset utf-8;\n  }\n  location /api {\n      proxy_pass http://smart-backend:8080/api;\n      proxy_read_timeout 1200;\n      client_max_body_size 1024m;\n  }\n      gzip  on; #\u5f00\u542fgzip\n      gzip_vary on;\n      gzip_min_length 1k; #\u4e0d\u538b\u7f29\u4e34\u754c\u503c,\u5927\u4e8e1k\u7684\u624d\u538b\u7f29,\u4e00\u822c\u4e0d\u7528\u6539\n      gzip_buffers 4 16k;\n      gzip_comp_level 6; #\u538b\u7f29\u7ea7\u522b,\u6570\u5b57\u8d8a\u5927\u538b\u7f29\u7684\u8d8a\u597d\n      gzip_types  text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png image/x-icon;\n}\n</code></pre>"},{"location":"k8s/note/chapter-24/#2410","title":"24.10  \u6dfb\u52a0\u8282\u70b9","text":"<p>\u540e\u671f\u9010\u6e10\u4e1a\u52a1\u4e0a\u6765\uff0c\u96c6\u7fa4\u8282\u70b9\u8d44\u6e90\u4e0d\u8db3\uff0c\u65b0\u589enode\u8282\u70b9\uff0c\u5c06node\u8282\u70b9\u7684\u6570\u636e\u76d8\u6dfb\u52a0\u5230ceph\u8282\u70b9</p>"},{"location":"k8s/note/chapter-24/#24101-ceph","title":"24.10.1 ceph\u96c6\u7fa4\u6dfb\u52a0\u8282\u70b9","text":"<ul> <li> <p>\u7cfb\u7edf\u914d\u7f6e</p> </li> <li> <p>\u514d\u8d39\u5bc6\u94a5\u914d\u7f6e</p> </li> <li>hosts\u914d\u7f6e</li> <li>docker\u5b89\u88c5\u5e76\u8fc1\u79fb\u81f3\u6570\u636e\u76d8</li> <li>cgroup\u542f\u7528</li> <li>ceph\u6570\u636e\u8282\u70b9\u6dfb\u52a0</li> </ul> <p>ceph\u96c6\u7fa4\u914d\u7f6e\u6dfb\u52a0node03\u96c6\u7fa4\u7684\u6570\u636e\u76d8\u8282\u70b9\uff08\u5982\u679c\u6570\u636e\u5b58\u50a8\u7c7b\u8db3\u591f\uff0c\u53ef\u4ee5\u4e0d\u7528\u6dfb\u52a0\u6570\u636e\u8282\u70b9\uff09</p> <pre><code>[root@node03 docker]# mkfs.xfs /dev/vdd\n[root@node03 docker]# mkdir -p /var/local/osd3\n[root@node03 docker]# mount /dev/vdd /var/local/osd3/\n\n\u6dfb\u52a0vdd\u5230/etc/fstab\u4e2d\n[root@node03 docker]# yum -y install yum-plugin-priorities epel-release\n\n[root@node03 yum.repos.d]# chmod 777 -R /var/local/osd3/\n[root@node03 yum.repos.d]# chmod 777 -R /var/local/osd3/*  master\u8282\u70b9\u5229\u7528ceph-deploy\u90e8\u7f72node03\u8282\u70b9[root@master ceph]# ceph-deploy install node03\n[root@master ceph]# ceph-deploy  gatherkeys master\n[root@master ceph]# ceph-deploy osd prepare node03:/var/local/osd3\n</code></pre> <ul> <li>\u6fc0\u6d3bosd</li> </ul> <pre><code>[root@master ceph]# ceph-deploy osd activate node03:/var/local/osd3\n</code></pre> <ul> <li>\u67e5\u770b\u72b6\u6001</li> </ul> <pre><code>[root@master ceph]# ceph-deploy osd list master node01 node02 node03\n</code></pre> <ul> <li>\u62f7\u8d1d\u5bc6\u94a5</li> </ul> <pre><code>[root@master ceph]# ceph-deploy admin master node01 node02 node03\n</code></pre> <ul> <li>\u5728node03\u8282\u70b9\u8bbe\u7f6e\u6743\u9650</li> </ul> <pre><code>[root@node03 yum.repos.d]# chmod +r /etc/ceph/ceph.client.admin.keyring\n</code></pre> <ul> <li>\u5728master\u8bbe\u7f6eMDS</li> </ul> <pre><code>[root@master ceph]# ceph-deploy mds create node01 node02 node03\n</code></pre> <ul> <li>\u67e5\u770b\u72b6\u6001</li> </ul> <pre><code>[root@master ceph]# ceph health\n[root@master ceph]# ceph - \u7531\u4e8e\u662f\u65b0\u589enode\u8282\u70b9\uff0c\u6570\u636e\u9700\u8981\u5e73\u8861\u56de\u586b\uff0c\u6b64\u523b\u67e5\u770b\u96c6\u7fa4\u72b6\u6001[root@master conf]# ceph -s\n    cluster 5b9eb8d2-1c12-4f6d-ae9c-85078795794b\n     health HEALTH_ERR\n            44 pgs backfill_wait\n            1 pgs backfilling\n            1 pgs inconsistent\n            45 pgs stuck unclean\n            recovery 1/55692 objects degraded (0.002%)\n            recovery 9756/55692 objects misplaced (17.518%)\n            2 scrub errors\n     monmap e1: 1 mons at {master=172.16.60.2:6789/0}\n            election epoch 35, quorum 0 master\n     osdmap e2234: 4 osds: 4 up, 4 in; 45 remapped pgs\n            flags sortbitwise,require_jewel_osds\n      pgmap v5721471: 192 pgs, 2 pools, 104 GB data, 27846 objects\n            230 GB used, 1768 GB / 1999 GB avail\n            1/55692 objects degraded (0.002%)\n            9756/55692 objects misplaced (17.518%)\n                 146 active+clean\n                  44 active+remapped+wait_backfill\n                   1 active+remapped+backfilling\n                   1 active+clean+inconsistent\nrecovery io 50492 kB/s, 13 objects/s\n  client io 20315 B/s wr, 0 op/s rd, 5 op/s wr \n</code></pre> <ul> <li>\u6700\u7ec8\u7684\u95ee\u9898\uff0c\u76ee\u524d\u7531\u4e8e\u65b0\u589e\u4e86node\u8282\u70b9\uff0c\u65b0\u589eceph\u6570\u636e\u8282\u70b9\u9700\u8981\u6570\u636e\u540c\u6b65</li> </ul> <pre><code>[root@master conf]# ceph -s\n    cluster 5b9eb8d2-1c12-4f6d-ae9c-85078795794b\n     health HEALTH_ERR\n            1 pgs inconsistent\n            2 scrub errors\n     monmap e1: 1 mons at {master=172.16.60.2:6789/0}\n            election epoch 35, quorum 0 master\n     osdmap e2324: 4 osds: 4 up, 4 in\n            flags sortbitwise,require_jewel_osds\n      pgmap v5723479: 192 pgs, 2 pools, 104 GB data, 27848 objects\n            229 GB used, 1769 GB / 1999 GB avail\n                 191 active+clean\n                   1 active+clean+inconsistent\n  client io 78305 B/s wr, 0 op/s rd, 18 op/s wr\u4fee\u590d[root@master conf]# ceph -s\n    cluster 5b9eb8d2-1c12-4f6d-ae9c-85078795794b\n     health HEALTH_OK\n     monmap e1: 1 mons at {master=172.16.60.2:6789/0}\n            election epoch 35, quorum 0 master\n     osdmap e2324: 4 osds: 4 up, 4 in\n            flags sortbitwise,require_jewel_osds\n      pgmap v5724320: 192 pgs, 2 pools, 104 GB data, 27848 objects\n            229 GB used, 1769 GB / 1999 GB avail\n                 192 active+clean\n  client io 227 kB/s wr, 0 op/s rd, 7 op/s wr\n# \u540c\u6b65\u5b8c\u6210\n[root@master conf]# ceph health\nHEALTH_OK\n</code></pre>"},{"location":"k8s/note/chapter-24/#24102-node","title":"24.10.2 node\u8282\u70b9\u6dfb\u52a0","text":"<p>kubesphere\u4e3a\u65b9\u4fbf\u65b0\u589e\u8282\u70b9\uff0c\u63d0\u4f9b\u4e86\u65b9\u4fbf\u7684\u811a\u6b65\u4e00\u952e\u65b0\u589e\uff0c\u53ef\u53c2\u8003\uff1ahttps://kubesphere.com.cn/docs/v2.1/zh-CN/installation/add-nodes/ </p> <p>\u4fee\u6539host.ini</p> <p>```[all] master ansible_connection=local  ip=172.16.60.2 node01  ansible_host=172.16.60.3  ip=172.16.60.3  node02  ansible_host=172.16.60.4  ip=172.16.60.4 node03  ansible_host=172.16.60.5  ip=172.16.60.5 [kube-master] master          [kube-node] master node01  node02 node03 <pre><code>\u5728 \"/script\" \u76ee\u5f55\u6267\u884c add-nodes.sh\u811a\u672c\u3002\u5f85\u6269\u5bb9\u811a\u672c\u6267\u884c\u6210\u529f\u540e\uff0c\u5373\u53ef\u770b\u5230\u5305\u542b\u65b0\u8282\u70b9\u7684\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f\uff0c\u53ef\u901a\u8fc7 KubeSphere \u63a7\u5236\u53f0\u7684\u83dc\u5355\u9009\u62e9 \u57fa\u7840\u8bbe\u65bd \u7136\u540e\u8fdb\u5165 \u4e3b\u673a\u7ba1\u7406 \u9875\u9762\u67e5\u770b\uff0c\u6216\u8005\u901a\u8fc7 Kubectl \u5de5\u5177\u6267\u884c kubectl get node\u547d\u4ee4\uff0c\u67e5\u770b\u6269\u5bb9\u540e\u7684\u96c6\u7fa4\u8282\u70b9\u8be6\u7ec6\u4fe1\u606f\u3002\n\n```shell\n[root@master scripts]# ./add-nodes.sh\n</code></pre></p> <p>\u67e5\u770b\u9a8c\u8bc1</p> <pre><code>[root@master conf]# kubectl get nodes -owide\nNAME     STATUS   ROLES         AGE    VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION          CONTAINER-RUNTIME\nmaster   Ready    master        136d   v1.15.5   172.16.60.2   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-693.el7.x86_64   docker://18.6.2\nnode01   Ready    node,worker   136d   v1.15.5   172.16.60.3   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-693.el7.x86_64   docker://18.6.2\nnode02   Ready    node,worker   136d   v1.15.5   172.16.60.4   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-693.el7.x86_64   docker://18.6.2\nnode03   Ready    worker        10m    v1.15.5   172.16.60.5   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-693.el7.x86_64   docker://19.3.5\n[root@master conf]# kubectl label node  node-role.kubernetes.io/node=\ncommon.yaml            hosts.ini              plugin-qingcloud.yaml  \n[root@master conf]# kubectl label node node03  node-role.kubernetes.io/node=   \nnode/node03 labeled\n[root@master conf]# kubectl get nodes -owide                                \nNAME     STATUS   ROLES         AGE    VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION          CONTAINER-RUNTIME\nmaster   Ready    master        136d   v1.15.5   172.16.60.2   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-693.el7.x86_64   docker://18.6.2\nnode01   Ready    node,worker   136d   v1.15.5   172.16.60.3   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-693.el7.x86_64   docker://18.6.2\nnode02   Ready    node,worker   136d   v1.15.5   172.16.60.4   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-693.el7.x86_64   docker://18.6.2\nnode03   Ready    node,worker   11m    v1.15.5   172.16.60.5   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-693.el7.x86_64   docker://19.3.5\n[root@master conf]# \n</code></pre> <p></p>"},{"location":"k8s/note/chapter-24/#2411-k8s","title":"24.11  K8s\u96c6\u7fa4\u8d44\u6e90\u4e0d\u5747","text":"<p>\u53ef\u4ee5\u53d1\u73b0k8s\u8d44\u6e90\u4f7f\u7528\u4e0d\u5747\u8861\uff0c\u4e4b\u524d\u7684\u90e8\u7f72\u5e94\u7528\u4e3a\u5236\u5b9anodeSelect\uff0c\u5bfc\u81f4\u4e00\u4e9b\u7cfb\u7edf\u670d\u52a1\u8fd0\u884c\u5728node\u8282\u70b9\uff0c\u67e5\u770bnode2\u5185\u5b58\u5360\u7528\u5f88\u5927,\u5bfc\u81f4\u96c6\u7fa4\u5f02\u5e38\u544a\u8b66\u6216\u91cd\u542f</p> <p></p> <p>\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b</p> <pre><code>kubectl get pods -o wide --all-namespaces |grep node02 |awk '{print $1,  $2}'\n</code></pre> <p>\u5c06\u4e00\u4e9b\u7cfb\u7edf\u5e94\u7528\u901a\u8fc7nodeselect\u6765\u8c03\u5ea6\u5230master\u8282\u70b9\uff0c\u4ee5\u51cf\u8f7bnode2\u8282\u70b9\u7684\u5185\u5b58\u538b\u529b\u3002</p> <pre><code>`kubectl  get nodes --show-labels`\n</code></pre> <p>\u5728node2\u4e0a\u67e5\u770b\u7cfb\u7edf\u7ec4\u5efa\u6dfb\u52a0nodeselector\u6765\u91cd\u65b0\u8c03\u5ea6</p> <pre><code>      nodeSelector:\n        node-role.kubernetes.io/master: master\n</code></pre> <p></p> <p>\u67e5\u770b\u73b0\u5b58\u5728node2\u4e0a\u9762\u7684kubesphere\u7cfb\u7edfdeployment</p> <p></p> <p>\u901a\u8fc7\u8c03\u5ea6\u5b8c\u6210\uff0c\u67e5\u770bnode2\u7684\u5185\u5b58\u8d1f\u8f7d\u5df2\u7ecf\u4e0b\u6765\u4e86</p> <p></p>"},{"location":"k8s/note/chapter-24/#2412-kubesphere-devops","title":"24.12 kubesphere devops\u5de5\u7a0b","text":"<p>\u65b0\u589e\u4e86node03\u8282\u70b9\uff0cdevops\u5de5\u7a0b\u4e00\u5468\u4e3a\u961f\u5217\u4e2d\u4e3a\u6b64\u65f6\u8fd0\u884c\u8be5job\u7684\u5b9e\u4f8b\u672a\u5b8c\u6210\u521d\u59cb\u5316\uff0c\u767b\u5f55\u96c6\u7fa4\u67e5\u770b\uff0cnode03\u4e0a\u7684base pod\u5728pull agent\u955c\u50cf\uff0c\u4e3a\u4e86\u5feb\u901f\uff0c\u76f4\u63a5\u5728node\u8282\u70b9\uff0csave base\u955c\u50cf\u7136\u540e\u5728node03\u4e0aload</p> <p></p> <pre><code>[root@master ~]# kubectl describe pods -n kubesphere-devops-system $(kubectl get pods -n kubesphere-devops-system |grep -E \"^base\" |awk '{print $1}')\n</code></pre> <p></p>"},{"location":"k8s/note/chapter-24/#2413-kubesphere","title":"24.13  kubesphere \u5e94\u7528\u5b89\u88c5","text":"<p>\u76ee\u524d\u81ea\u5df1\u7684kubesphere\u96c6\u7fa4\u4e3a2.1\uff0c\u5728\u5177\u4f53\u7684\u5728\u9879\u76ee\u4e2d\u6dfb\u52a0\u4e86repo\u540e\uff0c\u540e\u53f0\u56de\u81ea\u5df1\u53bb\u540c\u6b65\u955c\u50cf\u6570\u636e\u8fd8\u662f\u9700\u8981\u4e3a\u624b\u52a8\u5728\u90a3\u4e2a\u5730\u65b9\u89e6\u53d1\u4e0b\uff0c\u6211\u6dfb\u52a0\u4e86\u51e0\u4e2ahelm \u7684repo\uff0c\u597d\u50cf\u91cc\u9762\u7684chart\u6ca1\u6709\u5728web\u754c\u9762\u663e\u793a\uff0c\u5728\u6dfb\u52a0\u4e86repo\u7684\u9879\u76ee\u4e0b\uff0c\u6211\u65b0\u5efa\u5e94\u7528\uff0c\u7136\u540e\u9009\u62e9\u6765\u81eakubesphere\u7684\u5e94\u7528\u5546\u5e97\uff0c\u5176\u4e2d\u53ea\u6709\u51e0\u4e2acharts\uff0c\u53d1\u73b0\u4e0d\u4e86\u6dfb\u52a0\u7684helm \u6e90\u7684chartscharts\uff0c\u5728\u670d\u52a1\u5668\u5185\u90e8\u662f\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4search\u5230\u3002\u54a8\u8be2\u793e\u533a\u6682\u65f6\u4e3a\u6536\u5230\u56de\u590d\uff0c\u8bb0\u5f97v2.0\u7248\u672c\u540e\u53f0\u6709\u4e2a\u4efb\u52a1\u4f1a\u53bb\u540c\u6b65charts\uff0c\u76ee\u524d2.1\u7248\u672c\uff0c\u5148\u4f7f\u7528helm\u547d\u4ee4\u5728\u96c6\u7fa4\u5185\u8fdb\u884c\u624b\u52a8helm\u5b89\u88c5</p> <pre><code>[root@master common-service]# helm install -n consul --namespace common-service -f consul/values-production.yaml consul/\nNAME:   consul\nLAST DEPLOYED: Tue Jan 14 17:56:27 2020\nNAMESPACE: common-service\nSTATUS: DEPLOYED\n\n\nRESOURCES:\n==&gt; v1/Pod(related)\nNAME      READY  STATUS   RESTARTS  AGE\nconsul-0  0/2    Pending  0         0s\n\n\n==&gt; v1/Service\nNAME       TYPE       CLUSTER-IP   EXTERNAL-IP  PORT(S)                                                AGE\nconsul     ClusterIP  None         &lt;none&gt;       8400/TCP,8301/TCP,8301/UDP,8300/TCP,8600/TCP,8600/UDP  1s\nconsul-ui  ClusterIP  10.233.59.7  &lt;none&gt;       80/TCP                                                 1s\n==&gt; v1/StatefulSet\nNAME    READY  AGE\nconsul  0/3    0s\n\n\n==&gt; v1beta1/PodDisruptionBudget\nNAME        MIN AVAILABLE  MAX UNAVAILABLE  ALLOWED DISRUPTIONS  AGE\nconsul-pdb  1              N/A              0                    1s\n\n\nNOTES:\n  ** Please be patient while the chart is being deployed **\n\n\n  Consul can be accessed within the cluster on port 8300 at consul.common-service.svc.cluster.local\n\n\nIn order to access to the Consul Web UI:\n\n\n    kubectl port-forward --namespace common-service svc/consul-ui 80:80\n    echo \"Consul URL: http://127.0.0.1:80\"\n\n\nPlease take into account that you need to wait until a cluster leader is elected before using the Consul Web UI.\n\n\nIn order to check the status of the cluster you can run the following command:\n\n\n    kubectl exec -it consul-0 -- consul members\n\n\nFurthermore, to know which Consul node is the cluster leader run this other command:\n\n\n    kubectl exec -it consul-0 -- consul operator raf\n</code></pre> <p></p> <p>\u5177\u4f53\u95ee\u9898\u53ef\u4ee5\u53c2\u8003\u5e16\u5b50\uff1ahttps://kubesphere.com.cn/forum/d/669-kubesphere</p>"},{"location":"k8s/note/chapter-24/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>Kubernetes\u5b98\u7f51\u6559\u7a0b</li> <li>Kubernetes\u4e2d\u6587\u793e\u533a</li> <li>\u4eceKubernetes\u5230Cloud Native</li> <li>Kubernetes Handbook</li> <li>Kubernetes\u4ece\u5165\u95e8\u5230\u5b9e\u6218</li> <li>Kubernetes\u6307\u5357</li> <li>awesome-kubernetes</li> <li>\u4eceDocker\u5230Kubernetes\u8fdb\u9636</li> <li>python\u5fae\u670d\u52a1\u5b9e\u6218</li> <li>\u4e91\u539f\u751f\u4e4b\u8def</li> <li>CNCF Cloud Native Interactive Landscape</li> </ul>"},{"location":"k8s/note/chapter-24/#_2","title":"\u89c6\u9891","text":"<ul> <li>\u9a6c\u54e5(docker\u5bb9\u5668\u6280\u672f+k8s\u96c6\u7fa4\u6280\u672f)</li> <li>\u5fae\u670d\u52a1\u5bb9\u5668\u5316\u5b9e\u6218</li> </ul> <p>\u5982\u679c\u6b64\u7b14\u8bb0\u5bf9\u60a8\u6709\u4efb\u4f55\u5e2e\u52a9\uff0c\u66f4\u591a\u6587\u7ae0\uff0c\u6b22\u8fce\u5173\u6ce8\u535a\u5ba2\u4e00\u5757\u5b66\u4e60\u4ea4\u6d41\ud83d\udc4f</p> <p>\u200b   </p>"},{"location":"k8s/note/chapter-24/#_3","title":"\u8bf7\u6211\u559d\u5496\u5561\u2615\ufe0f","text":"<ul> <li>\u5fae\u4fe1 )</li> <li>\u652f\u4ed8\u5b9d </li> </ul>"},{"location":"k8s/note/chapter-3/","title":"\u4e09 \u96c6\u7fa4\u90e8\u7f72","text":"<p>\u4e3a\u7b80\u5355\u4e0a\u624b\u4f53\u9a8c\u529f\u80fd\uff0c\u53ef\u4ee5\u5148\u5229\u7528kubeadm\u5b89\u88c5\u6d4b\u8bd5\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4e8c\u8fdb\u5236\u6216\u8005\u4e00\u4e9b\u6210\u719f\u7684\u96c6\u7fa4\u9ad8\u53ef\u7528\u5b89\u88c5\u65b9\u5f0f\uff0cKubeadm \u662f K8S \u5b98\u65b9\u63d0\u4f9b\u7684\u5feb\u901f\u90e8\u7f72\u5de5\u5177\uff0c\u5b83\u63d0\u4f9b\u4e86 kubeadm init \u4ee5\u53ca kubeadm join \u8fd9\u4e24\u4e2a\u547d\u4ee4\u4f5c\u4e3a\u5feb\u901f\u521b\u5efa kubernetes \u96c6\u7fa4\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u672c\u7ae0\u8282\u8bf4\u660e\u4e86\u4f7f\u7528 kubeadm \u6765\u90e8\u7f72 K8S \u96c6\u7fa4\u7684\u8fc7\u7a0b\u3002</p> <ul> <li>\u96c6\u7fa4\u7ec4\u7ec7\u7ed3\u6784</li> </ul> \u9879\u76ee \u8bf4\u660e \u96c6\u7fa4\u89c4\u6a21 Master\u3001node1\u3001node2 \u7cfb\u7edf CentOS 7.3 \u7f51\u7edc\u89c4\u5212 POD\uff1a10.244.0.0/16\u3001Service\uff1a10.96.0.0/12"},{"location":"k8s/note/chapter-3/#31","title":"3.1 \u90e8\u7f72\u524d\u51c6\u5907","text":"<p>\u672c\u5c0f\u8282\u7684\u6240\u6709\u7684\u64cd\u4f5c\uff0c\u5728\u6240\u6709\u7684\u8282\u70b9\u4e0a\u8fdb\u884c</p>"},{"location":"k8s/note/chapter-3/#311-firewalld-selinux","title":"3.1.1 \u5173\u95ed firewalld \u548c selinux","text":"<pre><code>setenforce 0\nsed -i '/^SELINUX=/cSELINUX=disabled' /etc/selinux/config\n\nsystemctl stop firewalld\nsystemctl disable firewalld\n</code></pre>"},{"location":"k8s/note/chapter-3/#312-ipvs","title":"3.1.2 \u52a0\u8f7d ipvs \u5185\u6838\u6a21\u5757","text":"<ul> <li>\u5b89\u88c5 IPVS \u6a21\u5757</li> </ul> <pre><code>yum -y install ipvsadm ipset sysstat conntrack libseccomp\n</code></pre> <ul> <li>\u8bbe\u7f6e\u5f00\u673a\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6</li> </ul> <pre><code>cat &gt;&gt;/etc/modules-load.d/ipvs.conf&lt;&lt;EOF\nip_vs_dh\nip_vs_ftp\nip_vs\nip_vs_lblc\nip_vs_lblcr\nip_vs_lc\nip_vs_nq\nip_vs_pe_sip\nip_vs_rr\nip_vs_sed\nip_vs_sh\nip_vs_wlc\nip_vs_wrr\nnf_conntrack_ipv4\nEOF\n</code></pre> <ul> <li>\u8bbe\u7f6e\u5f00\u673a\u52a0\u8f7d IPVS \u6a21\u5757</li> </ul> <pre><code>systemctl enable systemd-modules-load.service   # \u8bbe\u7f6e\u5f00\u673a\u52a0\u8f7d\u5185\u6838\u6a21\u5757\nlsmod | grep -e ip_vs -e nf_conntrack_ipv4      # \u91cd\u542f\u540e\u68c0\u67e5 ipvs \u6a21\u5757\u662f\u5426\u52a0\u8f7d\n</code></pre> <ul> <li>\u5982\u679c\u96c6\u7fa4\u5df2\u7ecf\u90e8\u7f72\u5728\u4e86 iptables \u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u547d\u4ee4\u4fee\u6539\uff0c\u4fee\u6539 mode \u4e3a ipvs \u91cd\u542f\u96c6\u7fa4\u5373\u53ef\u3002</li> </ul> <pre><code>kubectl edit -n kube-system configmap kube-proxy\n</code></pre>"},{"location":"k8s/note/chapter-3/#313-docker-k8s","title":"3.1.3 \u4e0b\u8f7d Docker \u548c K8S","text":"<ul> <li>\u8bbe\u7f6e docker \u6e90</li> </ul> <pre><code>curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n</code></pre> <ul> <li>\u8bbe\u7f6e k8s \u6e90</li> </ul> <pre><code>cat &gt;&gt;/etc/yum.repos.d/kuberetes.repo&lt;&lt;EOF\n[kuberneres]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\ngpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\nenabled=1\nEOF\n</code></pre> <ul> <li>\u5b89\u88c5 docker-ce \u548c kubernetes</li> </ul> <pre><code>yum install docker-ce kubelet kubectl kubeadm -y\n</code></pre> <pre><code>systemctl start docker\nsystemctl enable docker\nsystemctl enable kubelet\n</code></pre>"},{"location":"k8s/note/chapter-3/#314-k8s","title":"3.1.4 \u8bbe\u7f6e\u5185\u6838\u53ca K8S \u53c2\u6570","text":"<ul> <li>\u8bbe\u7f6e\u5185\u6838\u53c2\u6570</li> </ul> <pre><code>cat &gt;&gt;/etc/sysctl.conf&lt;&lt;EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nEOF\n</code></pre> <ul> <li>\u8bbe\u7f6e kubelet \u5ffd\u7565 swap\uff0c\u4f7f\u7528 ipvs</li> </ul> <pre><code>cat &gt;/etc/sysconfig/kubelet&lt;&lt;EOF\nKUBELET_EXTRA_ARGS=\"--fail-swap-on=false\"\nKUBE_PROXY_MODE=ipvs\nEOF\n</code></pre>"},{"location":"k8s/note/chapter-3/#32-master","title":"3.2 \u90e8\u7f72 Master","text":"<p>\u672c\u5c0f\u8282\u7684\u6240\u6709\u7684\u64cd\u4f5c\uff0c\u53ea\u5728 Master \u8282\u70b9\u4e0a\u8fdb\u884c</p>"},{"location":"k8s/note/chapter-3/#321","title":"3.2.1 \u63d0\u524d\u62c9\u53d6\u955c\u50cf","text":"<p>\u5bbf\u4e3b\u673a\u6700\u597d\u80fd\u8bbf\u95ee\u56fd\u5916\u8d44\u6e90\uff0c\u5728kubeadm init \u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f1a\u5230\u8c37\u6b4c\u7684 docker hub \u62c9\u53d6\u955c\u50cf\uff0c\u5982\u679c\u5bbf\u4e3b\u673a\u6d4b\u8bd5\u65e0\u6cd5\u8bbf\u95ee k8s.gcr.io \u53ef\u4ee5\u5728\u670d\u52a1\u5668\u6240\u4ee5\u6211\u4eec\u8981\u63d0\u524d\u90e8\u7f72\u597d\u4ee3\u7406\u8f6f\u4ef6\uff0c\u672c\u4f8b\u4e2d\u76d1\u542c\u4e2a\u672c\u673a 9666 \u8fdb\u884c\u90e8\u7f72\u3002</p> <p>\u5982\u679c\u6761\u4ef6\u4e0d\u5141\u8bb8\u53ef\u4ee5\u53c2\u8003: https://blog.csdn.net/jinguangliu/article/details/82792617 \u6765\u89e3\u51b3\u955c\u50cf\u95ee\u9898\u3002</p> <ul> <li>\u914d\u7f6e Docker \u62c9\u53d6\u955c\u50cf\u65f6\u5019\u7684\u4ee3\u7406\u5730\u5740\uff0cvim /usr/lib/systemd/system/docker.service\u3002</li> </ul> <pre><code>[Service]\nEnvironment=\"HTTPS_PROXY=127.0.0.1:9666\"\nEnvironment=\"NO_PROXY=127.0.0.0/8,172.16.0.0/16\"\n</code></pre> <ul> <li>\u63d0\u524d\u62c9\u53d6\u521d\u59cb\u5316\u9700\u8981\u7684\u955c\u50cf</li> </ul> <pre><code>kubeadm config images pull\n</code></pre> <ul> <li>\u4f7f\u7528\u5176\u4ed6\u6e90\u955c\u50cf</li> </ul> <pre><code>docker pull mirrorgooglecontainers/kube-apiserver:v1.14.2\ndocker pull mirrorgooglecontainers/kube-controller-manager:v1.14.2\ndocker pull mirrorgooglecontainers/kube-scheduler:v1.14.2\ndocker pull mirrorgooglecontainers/kube-proxy:v1.14.2\ndocker pull mirrorgooglecontainers/pause:3.1\ndocker pull mirrorgooglecontainers/etcd:3.3.10\ndocker pull coredns/coredns:1.3.1\n\n\n\u5229\u7528`kubeadm config images list` \u67e5\u770b\u9700\u8981\u7684docker image name\n\nk8s.gcr.io/kube-apiserver:v1.14.2\nk8s.gcr.io/kube-controller-manager:v1.14.2\nk8s.gcr.io/kube-scheduler:v1.14.2\nk8s.gcr.io/kube-proxy:v1.14.2\nk8s.gcr.io/pause:3.1\nk8s.gcr.io/etcd:3.3.10\nk8s.gcr.io/coredns:1.3.1\n\n# \u4fee\u6539tag\n\ndocker tag docker.io/mirrorgooglecontainers/kube-apiserver:v1.14.2 k8s.gcr.io/kube-apiserver:v1.14.2\ndocker tag docker.io/mirrorgooglecontainers/kube-scheduler:v1.14.2 k8s.gcr.io/kube-scheduler:v1.14.2\ndocker tag docker.io/mirrorgooglecontainers/kube-proxy:v1.14.2 k8s.gcr.io/kube-proxy:v1.14.2\ndocker tag docker.io/mirrorgooglecontainers/kube-controller-manager:v1.14.2 k8s.gcr.io/kube-controller-manager:v1.14.2\ndocker tag docker.io/mirrorgooglecontainers/etcd:3.3.10  k8s.gcr.io/etcd:3.3.10\ndocker tag docker.io/mirrorgooglecontainers/pause:3.1  k8s.gcr.io/pause:3.1\ndocker tag docker.io/coredns/coredns:1.3.1  k8s.gcr.io/coredns:1.3.1\n\ndocker rmi `docker images |grep docker.io/ |awk '{print $1\":\"$2}'`\n</code></pre>"},{"location":"k8s/note/chapter-3/#322-master","title":"3.2.2 \u521d\u59cb\u5316Master","text":"<ul> <li>\u4f7f\u7528 kubeadm \u521d\u59cb\u5316 k8s \u96c6\u7fa4</li> </ul> <pre><code>kubeadm init --kubernetes-version=v1.14.0 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12 --ignore-preflight-errors=Swap\n</code></pre> <ul> <li>\u5982\u679c\u6709\u62a5\u9519\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u67e5\u770b</li> </ul> <pre><code>journalctl -xeu kubelet\n</code></pre> <ul> <li>\u5982\u679c\u521d\u59cb\u5316\u8fc7\u7a0b\u88ab\u4e2d\u65ad\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u6765\u6062\u590d</li> </ul> <pre><code>kubeadm reset\n</code></pre> <ul> <li>\u4e0b\u9762\u662f\u6700\u540e\u6267\u884c\u6210\u529f\u663e\u793a\u7684\u7ed3\u679c\uff0c\u9700\u8981\u4fdd\u5b58\u8fd9\u4e2a\u6267\u884c\u7ed3\u679c\uff0c\u4ee5\u8ba9 node \u8282\u70b9\u52a0\u5165\u96c6\u7fa4</li> </ul> <pre><code>Your Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 172.16.100.9:6443 --token 2dyd69.hrfsjkkxs4stim7n \\\n    --discovery-token-ca-cert-hash sha256:4e30c1f41aefb177b708a404ccb7e818e31647c7dbdd2d42f6c5c9894b6f41e7\n</code></pre> <ul> <li>\u6700\u597d\u4ee5\u666e\u901a\u7528\u6237\u7684\u8eab\u4efd\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4</li> </ul> <pre><code># \u5728\u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55\u4e0b\u521b\u5efa.kube\u76ee\u5f55\u5e76\u914d\u7f6e\u8bbf\u95ee\u96c6\u7fa4\u7684config \u6587\u4ef6\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n</code></pre> <ul> <li>\u90e8\u7f72 flannel \u7f51\u7edc\u63d2\u4ef6</li> </ul> <pre><code>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n</code></pre> <ul> <li>\u67e5\u770b kube-system \u547d\u540d\u7a7a\u95f4\u4e2d\u8fd0\u884c\u7684 pods</li> </ul> <pre><code>kubectl get pods -n kube-system\n</code></pre> <ul> <li>\u67e5\u770b k8s \u96c6\u7fa4\u7ec4\u4ef6\u7684\u72b6\u6001</li> </ul> <pre><code>kubectl get ComponentStatus\n</code></pre> <ul> <li>\u914d\u7f6e\u547d\u4ee4\u8865\u5168</li> </ul> <pre><code>yum install -y bash-completion\nsource /usr/share/bash-completion/bash_completion\nsource &lt;(kubectl completion bash)\necho \"source &lt;(kubectl completion bash)\" &gt;&gt; ~/.bashrc\n</code></pre>"},{"location":"k8s/note/chapter-3/#33-node","title":"3.3 \u90e8\u7f72 Node","text":"<p>\u672c\u5c0f\u8282\u7684\u6240\u6709\u7684\u64cd\u4f5c\uff0c\u53ea\u5728 Node \u8282\u70b9\u4e0a\u8fdb\u884c\u3002</p>"},{"location":"k8s/note/chapter-3/#331","title":"3.3.1 \u52a0\u5165\u96c6\u7fa4","text":"<ul> <li>\u52a0\u5165\u96c6\u7fa4\uff0c\u6ce8\u610f\u5728\u547d\u4ee4\u5c3e\u90e8\u52a0\u4e0a --ignore-preflight-errors=Swap \uff0c\u4ee5\u5ffd\u7565 k8s \u5bf9\u4e3b\u673a swap \u7684\u68c0\u67e5\uff08k8s\u4e3a\u4e86\u6027\u80fd\u6240\u4ee5\u8981\u6c42\u8fdb\u5236 swap \uff09</li> </ul> <pre><code>kubeadm join 172.16.100.9:6443 --token 2dyd69.hrfsjkkxs4stim7n \\\n    --discovery-token-ca-cert-hash sha256:4e30c1f41aefb177b708a404ccb7e818e31647c7dbdd2d42f6c5c9894b6f41e7 --ignore-preflight-errors=Swap\n</code></pre> <ul> <li>\u8fd4\u56de\u7ed3\u679c\uff0c\u8868\u793a\u52a0\u5165\u96c6\u7fa4\u6210\u529f</li> </ul> <pre><code>This node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun 'kubectl get nodes' on the control-plane to see this node join the cluster.\n</code></pre>"},{"location":"k8s/note/chapter-3/#332","title":"3.3.2 \u67e5\u770b\u8fdb\u5ea6","text":"<p>\u5f53 node \u8282\u70b9\u52a0\u5165 K8S \u96c6\u7fa4\u4e2d\u540e\uff0cMaster \u4f1a\u8c03\u5ea6\u5230 Node \u8282\u70b9\u4e0a\u4e00\u4e9b\u7ec4\u4ef6\uff0c\u7528\u4e8e\u5904\u7406\u96c6\u7fa4\u4e8b\u52a1\uff0c\u8fd9\u4e9b\u7ec4\u4ef6\u6ca1\u6709\u4e0b\u8f7d\u5b8c\u6210\u4e4b\u524d Node \u8282\u70b9\u5728\u96c6\u7fa4\u4e2d\u8fd8\u662f\u672a\u5c31\u7eea\u72b6\u6001</p> <ul> <li>\u5728 node \u6267\u884c\u4e0b\u9762\u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b\u955c\u50cf\u7684\u4e0b\u8f7d\u8fdb\u5ea6\uff0c\u4e0b\u9762\u662f\u6700\u7ec8\u7ed3\u679c\u663e\u793a</li> </ul> <pre><code>$ docker image ls\nREPOSITORY               TAG                 IMAGE ID            CREATED             SIZE\nk8s.gcr.io/kube-proxy    v1.14.0             5cd54e388aba        6 weeks ago         82.1MB\nquay.io/coreos/flannel   v0.11.0-amd64       ff281650a721        3 months ago        52.6MB\nk8s.gcr.io/pause         3.1                 da86e6ba6ca1        16 months ago       742kB\n</code></pre> <ul> <li>\u53ef\u4ee5\u5728 Master \u4e0a\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u6765\u67e5\u770b\u65b0\u52a0\u5165\u7684\u8282\u70b9\u72b6\u6001</li> </ul> <pre><code>$ kubectl get nodes\nNAME     STATUS   ROLES    AGE     VERSION\nmaster   Ready    master   3d21h   v1.14.1\nnode1    Ready    &lt;none&gt;   3d21h   v1.14.1\nnode2    Ready    &lt;none&gt;   3d21h   v1.14.1\n</code></pre> <ul> <li>\u67e5\u770b\u96c6\u7fa4\u72b6\u6001</li> </ul> <pre><code>[root@master ~]# kubectl cluster-info \nKubernetes master is running at https://10.234.2.204:6443\nKubeDNS is running at https://10.234.2.204:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\nMetrics-server is running at https://10.234.2.204:6443/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy\n\nTo further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.\n[root@master ~]# kubectl get componentstatuses\nNAME                 STATUS    MESSAGE             ERROR\ncontroller-manager   Healthy   ok                  \nscheduler            Healthy   ok                  \netcd-0               Healthy   {\"health\":\"true\"}   \n</code></pre> <p>\u5982\u679c\u5acc\u7f51\u7edcpull\u955c\u50cf\u6162\u53ef\u4ee5\u5728\u4e00\u53f0\u4e0a\u9762\u5c06\u955c\u50cf\u6253\u5305\u53d1\u9001\u81f3\u5176\u4ed6node\u8282\u70b9 <pre><code>\u62f7\u8d1d\u5230node\u8282\u70b9\nfor i in /tmp/*.tar; do scp -i $i root@172.16.0.15:/root/;done\n\n\nnode\u8282\u70b9\u8fd8\u539f\nfor i in *.tar ;do docker load -i $i;done\n</code></pre></p> <ul> <li>\u67e5\u770b kube-system \u8fd9\u4e2a k8s \u547d\u540d\u7a7a\u95f4\u4e2d\u6709\u54ea\u4e9b\u7ec4\u4ef6\uff0c\u5206\u522b\u8fd0\u884c\u5728\u54ea\u4e2a\u8282\u70b9\uff0c-o wide \u662f\u4ee5\u8be6\u7ec6\u65b9\u5f0f\u663e\u793a\u3002</li> </ul> <pre><code>$ kubectl get pods -n kube-system -o wide\n\nNAME                                 READY   STATUS    RESTARTS   AGE     IP              NODE         NOMINATED NODE   READINESS GATES\ncoredns-fb8b8dccf-cp24r              1/1     Running   0          26m     10.244.0.2      i-xeahpl98   &lt;none&gt;           &lt;none&gt;\ncoredns-fb8b8dccf-ljswp              1/1     Running   0          26m     10.244.0.3      i-xeahpl98   &lt;none&gt;           &lt;none&gt;\netcd-i-xeahpl98                      1/1     Running   0          25m     172.16.100.9    i-xeahpl98   &lt;none&gt;           &lt;none&gt;\nkube-apiserver-i-xeahpl98            1/1     Running   0          25m     172.16.100.9    i-xeahpl98   &lt;none&gt;           &lt;none&gt;\nkube-controller-manager-i-xeahpl98   1/1     Running   0          25m     172.16.100.9    i-xeahpl98   &lt;none&gt;           &lt;none&gt;\nkube-flannel-ds-amd64-crft8          1/1     Running   3          16m     172.16.100.6    i-me87b6gw   &lt;none&gt;           &lt;none&gt;\nkube-flannel-ds-amd64-nckw4          1/1     Running   0          6m41s   172.16.100.10   i-qhcc2owe   &lt;none&gt;           &lt;none&gt;\nkube-flannel-ds-amd64-zb7sg          1/1     Running   0          23m     172.16.100.9    i-xeahpl98   &lt;none&gt;           &lt;none&gt;\nkube-proxy-7kjkf                     1/1     Running   0          6m41s   172.16.100.10   i-qhcc2owe   &lt;none&gt;           &lt;none&gt;\nkube-proxy-c5xs2                     1/1     Running   2          16m     172.16.100.6    i-me87b6gw   &lt;none&gt;           &lt;none&gt;\nkube-proxy-rdzq2                     1/1     Running   0          26m     172.16.100.9    i-xeahpl98   &lt;none&gt;           &lt;none&gt;\nkube-scheduler-i-xeahpl98            1/1     Running   0          25m     172.16.100.9    i-xeahpl98   &lt;none&gt;           &lt;none&gt;\n</code></pre>"},{"location":"k8s/note/chapter-3/#333","title":"3.3.3 \u955c\u50cf\u4e0b\u8f7d\u592a\u6162","text":"<p>node \u8282\u70b9\u9700\u8981\u7ffb\u5899\u4e0b\u8f7d\u955c\u50cf\u592a\u6162\uff0c\u5efa\u8bae\u4f7f\u7528 docker \u955c\u50cf\u7684\u5bfc\u5165\u5bfc\u51fa\u529f\u80fd \u5148\u5c06master\u7684\u4e09\u4e2a\u955c\u50cf\u6253\u5305\u53d1\u9001\u5230node\u8282\u70b9\uff0cload\u540e\u518djion</p> <ul> <li>\u5bfc\u51fa</li> </ul> <pre><code>docker image save -o /tmp/kube-proxy.tar k8s.gcr.io/kube-proxy\ndocker image save -o /tmp/flannel.tar quay.io/coreos/flannel\ndocker image save -o /tmp/pause.tar k8s.gcr.io/pause\n</code></pre> <ul> <li>\u5bfc\u5165</li> </ul> <pre><code>docker image load -i /tmp/kube-proxy.tar\ndocker image load -i /tmp/pause.tar\ndocker image load -i /tmp/flannel.tar\n</code></pre>"},{"location":"k8s/note/chapter-4/","title":"\u56db \u5165\u95e8\u547d\u4ee4","text":""},{"location":"k8s/note/chapter-4/#41-kubectl","title":"4.1 kubectl","text":"<p>kubectl \u662f apiserver \u7684\u5ba2\u6237\u7aef\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u662f\u901a\u8fc7\u8fde\u63a5 master \u8282\u70b9\u4e0a\u7684 apiserver \uff0c\u5b9e\u73b0\u5404\u79cd k8s \u5bf9\u8c61\u7684\u589e\u5220\u6539\u67e5\u7b49\u57fa\u672c\u64cd\u4f5c\uff0c\u5728 k8s \u53ef\u88ab\u7ba1\u7406\u7684\u5bf9\u8c61\u6709\u5f88\u591a\u4e2a</p> <pre><code>\u57fa\u672c\u547d\u4ee4 (\u521d\u7ea7):\n  create         \u4ece\u6587\u4ef6\u6216\u6807\u51c6\u8f93\u5165\u521b\u5efa\u8d44\u6e90\n  expose         \u83b7\u53d6\u4e00\u4e2a\u590d\u5236\u63a7\u5236\u5668, \u670d\u52a1, \u90e8\u7f72\u6216\u8005\u66b4\u9732\u4e00\u4e2a POD \u5c06\u5176\u4f5c\u4e3a\u65b0\u7684 Kubernetes \u670d\u52a1\u516c\u5f00\n  run            \u521b\u5efa\u5e76\u8fd0\u884c\u7279\u5b9a\u7684\u955c\u50cf, \u521b\u5efa\u4f7f\u7528 deployment \u6216 job \u7ba1\u7406\u7684\u5bb9\u5668\n  set            \u8bbe\u7f6e\u5bf9\u8c61\u7684\u7279\u5b9a\u529f\u80fd, \u4f8b\u5982\u53d1\u5e03, \u6bcf\u6b21\u53bbset \u4e0d\u7528\u7684image tag\n\n\u57fa\u672c\u547d\u4ee4 (\u4e2d\u7ea7):\n  explain        \u6587\u6863\u6216\u8005\u8d44\u6e90, \u53ef\u4ee5\u7528\u6765\u67e5\u770b\u8d44\u6e90\u6e05\u5355\u5199\u6cd5\n  get            \u663e\u793a\u4e00\u4e2a\u6216\u591a\u4e2a\u8d44\u6e90\n  edit           \u7f16\u8f91\u670d\u52a1\u5668\u4e0a\u7684\u8d44\u6e90\n  delete         \u6309\u6587\u4ef6\u540d, \u6807\u51c6\u8f93\u5165, \u8d44\u6e90\u548c\u540d\u79f0\u6216\u8d44\u6e90\u548c\u6807\u7b7e\u9009\u62e9\u5668\u5220\u9664\u8d44\u6e90\n\n\u90e8\u7f72\u547d\u4ee4:\n  rollout        \u7ba1\u7406\u8d44\u6e90\u7684\u90e8\u7f72\n  scale          \u4e3a\u90e8\u7f72\u8bbe\u7f6e\u65b0\u5927\u5c0f, ReplicaSet, Replication Controller, Job\n  autoscale      \u81ea\u52a8\u6269\u5c55\u4e00\u4e2a\u90e8\u7f72, ReplicaSet, \u6216\u8005 ReplicationController\n\n\u7fa4\u96c6\u7ba1\u7406\u547d\u4ee4:\n  certificate    \u4fee\u6539\u8bc1\u4e66\u8d44\u6e90\n  cluster-info   \u663e\u793a\u7fa4\u96c6\u4fe1\u606f\n  top            \u663e\u793a\u8d44\u6e90(CPU / \u5185\u5b58/ \u5b58\u50a8)\u4f7f\u7528\u60c5\u51b5, \u9700\u8981\u5b89\u88c5metrics-server\n  cordon         \u5c06\u8282\u70b9\u6807\u8bb0\u4e3a\u4e0d\u53ef\u8c03\u5ea6\n  uncordon       \u5c06\u8282\u70b9\u6807\u8bb0\u4e3a\u53ef\u8c03\u5ea6\n  drain          \u8bbe\u5b9a node \u8fdb\u5165\u7ef4\u62a4\u6a21\u5f0f\n  taint          \u66f4\u65b0\u4e00\u4e2a\u6216\u591a\u4e2a\u8282\u70b9\u4e0a\u7684\u6c61\u70b9\n\n\u6545\u969c\u6392\u9664\u548c\u8c03\u8bd5\u547d\u4ee4:\n  describe       \u663e\u793a\u7279\u5b9a\u8d44\u6e90\u6216\u8d44\u6e90\u7ec4\u7684\u8be6\u7ec6\u4fe1\u606f\n  logs           \u5728\u5bb9\u5668\u4e2d\u6253\u5370\u5bb9\u5668\u7684\u65e5\u5fd7\n  attach         \u9644\u52a0\u5230\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\n  exec           \u5728\u5bb9\u5668\u4e2d\u6267\u884c\u547d\u4ee4\n  port-forward   \u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u672c\u5730\u7aef\u53e3\u8f6c\u53d1\u5230 pod\n  proxy          \u8fd0\u884c\u4ee3\u7406\u5230 Kubernetes API \u670d\u52a1\u5668\n  cp             \u5c06\u6587\u4ef6\u548c\u76ee\u5f55\u590d\u5236\u5230\u5bb9\u5668, \u548c\u4ece\u5bb9\u5668\u590d\u5236, \u8de8\u5bb9\u5668\u590d\u5236\u6587\u4ef6\n  auth           \u68c0\u67e5\u6388\u6743\n\n\u9ad8\u7ea7\u547d\u4ee4:\n  diff           \u9488\u5bf9\u5c06\u8981\u5e94\u7528\u7684\u7248\u672c\u7684 Diff \u5b9e\u65f6\u7248\u672c\n  apply          \u901a\u8fc7\u6587\u4ef6\u540d\u6216\u6807\u51c6\u8f93\u5165\u5c06\u914d\u7f6e\u5e94\u7528\u4e8e\u8d44\u6e90\n  patch          \u4f7f\u7528\u7b56\u7565\u5408\u5e76\u8865\u4e01\u66f4\u65b0\u8d44\u6e90\u7684\u5b57\u6bb5\n  replace        \u7528\u6587\u4ef6\u540d\u6216\u6807\u51c6\u8f93\u5165\u66ff\u6362\u8d44\u6e90\n  wait           \u5b9e\u9a8c\u9636\u6bb5\u547d\u4ee4: \u5728\u4e00\u4e2a\u6216\u591a\u4e2a\u8d44\u6e90\u4e0a\u7b49\u5f85\u7279\u5b9a\u6761\u4ef6, \u5b9a\u4e49\u4e00\u4e2a\u89e6\u53d1\u5668\n  convert        \u5728\u4e0d\u540c\u7684API\u7248\u672c\u4e4b\u95f4\u8f6c\u6362\u914d\u7f6e\u6587\u4ef6\n  kustomize      \u4ece\u76ee\u5f55\u6216\u8fdc\u7a0b URL \u6784\u5efa kustomization \u76ee\u6807\n\n\u8bbe\u7f6e\u547d\u4ee4:\n  label          \u66f4\u65b0\u8d44\u6e90\u4e0a\u7684\u6807\u7b7e\n  annotate       \u66f4\u65b0\u8d44\u6e90\u4e0a\u7684\u6ce8\u91ca\n  completion     \u547d\u4ee4\u8865\u5168\u76f8\u5173\u529f\u80fd\n\n\u5176\u4ed6\u547d\u4ee4:\n  api-resources  \u5728\u670d\u52a1\u5668\u4e0a\u6253\u5370\u652f\u6301\u7684API\u8d44\u6e90\n  api-versions   \u4ee5 \"group/version\" \u7684\u5f62\u5f0f\u5728\u670d\u52a1\u5668\u4e0a\u6253\u5370\u652f\u6301\u7684API\u7248\u672c\n  config         \u4fee\u6539 kubeconfig \u6587\u4ef6\n  plugin         \u63d0\u4f9b\u4e0e\u63d2\u4ef6\u4ea4\u4e92\u7684\u5b9e\u7528\u7a0b\u5e8f\n  version        \u6253\u5370\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7248\u672c\u4fe1\u606f\n</code></pre>"},{"location":"k8s/note/chapter-4/#42-run","title":"4.2 run","text":"<ul> <li>\u521b\u5efa\u63a7\u5236\u5668\u5e76\u8fd0\u884c\u955c\u50cf</li> </ul> <p>\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a nginx \u7684 deployment\uff0c\u955c\u50cf\u4e3a nginx:latest ,\u5982\u679c\u4e0d\u77e5\u9053\u526f\u672c\u6570\uff0c\u5219\u4e3a1</p> <pre><code>kubectl run nginx --image=nginx:latest\n</code></pre> <ul> <li>\u6307\u5b9a\u8fd0\u884c\u7684 POD \u6570\u91cf</li> </ul> <pre><code>kubectl run nginx --image=nginx --replicas=5  # \u542f\u52a8 5 \u4e2a POD\n</code></pre> <ul> <li>\u4e0d\u8fd0\u884c\u5bb9\u5668\u7684\u9ed8\u8ba4\u547d\u4ee4\uff0c\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u6307\u4ee4</li> </ul> <pre><code>kubectl run nginx --image=nginx --command -- &lt;cmd&gt; &lt;arg1&gt; ... &lt;argN&gt;\n</code></pre> <ul> <li>\u8fd0\u884c\u4e00\u4e2a\u5468\u671f\u4efb\u52a1</li> </ul> <pre><code>kubectl run pi --schedule=\"0/5 * * * ?\" --image=perl --restart=OnFailure -- perl -Mbignum=bpi -wle 'print bpi(2000)'\n</code></pre> <ul> <li>\u6307\u5b9a\u63a7\u5236\u5668\u540d\u79f0\u8fd0\u884c nginx \u6307\u5b9a\u7aef\u53e3\u548c\u526f\u672c\u6570\u91cf\uff0c\u4ee5\u6d4b\u8bd5\u6a21\u5f0f\u8fd0\u884c </li> </ul> <p>\u6307\u5b9a\u53c2\u6570 dry-run \u53ef\u4ee5\u7528\u6765\u9a8c\u8bc1\u5199\u7684 yaml \u6587\u4ef6\u662f\u5426\u5b58\u5728\u5f02\u5e38\uff0c\u4e0d\u4f1a\u771f\u6b63\u6267\u884c</p> <pre><code>kubectl run nginx-deploy --image=nginx --port=80 --replicas=1 --dry-run=true\n</code></pre> <ul> <li>\u67e5\u770b\u5bb9\u5668\u662f\u5426\u8fd0\u884c</li> </ul> <pre><code>kubectl get deployment\n</code></pre> <ul> <li>\u67e5\u770b\u88ab\u8c03\u5ea6\u7684\u4e3b\u673a</li> </ul> <pre><code>kubectl get pod -o wide\n</code></pre> <ul> <li>\u901a\u8fc7 ip \u5730\u5740\u76f4\u63a5\u8bbf\u95ee\uff0c\u7531\u4e8e\u6240\u6709\u7684 POD \u5904\u4e8e\u540c\u4e00\u4e2a\u7f51\u7edc\u4e2d\uff0c\u6240\u4ee5\u5728\u96c6\u7fa4\u5185\u90e8\u662f\u53ef\u4ee5\u8bbf\u95ee\u7684</li> </ul> <pre><code>curl 10.244.2.2\n</code></pre> <ul> <li>\u5047\u5982\u73b0\u5728\u5220\u9664\u521a\u521b\u5efa\u7684\u8fd9\u4e2a POD\uff0c\u90a3\u4e48\u526f\u672c\u63a7\u5236\u5668\u4f1a\u81ea\u52a8\u5728\u5176\u4ed6\u7684 node \u4e0a\u91cd\u5efa\u8fd9\u4e2a POD</li> </ul> <pre><code>kubectl delete pods nginx-deploy-5c9b546997-jsmk6\n</code></pre> <ul> <li>\u518d\u6b21\u6267\u884c\u67e5\u770b\uff0c\u4f1a\u53d1\u73b0\u5bb9\u5668\u5df2\u7ecf\u88ab\u8c03\u5ea6\u5230\u5176\u4ed6\u8282\u70b9\u4e0a\u8fd0\u884c\u4e86</li> </ul> <pre><code>kubectl get pod -o wide\n</code></pre>"},{"location":"k8s/note/chapter-4/#43-expose","title":"4.3 expose","text":"<p>\u73b0\u5728\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f POD \u7684 IP \u5730\u5740\u53ef\u80fd\u968f\u65f6\u53d1\u751f\u53d8\u52a8\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f5c\u4e3a\u8bbf\u95ee\u7684\u5165\u53e3\uff0c\u90a3\u4e48\u5c31\u9700\u8981 service \u6765\u4ee3\u7406 POD \u6765\u521b\u5efa\u4e00\u4e2a\u56fa\u5b9a\u7684\u7aef\u70b9\u3002</p> <ul> <li>\u521b\u5efa\u4e00\u4e2a service \u6765\u66b4\u9732\u4e00\u4e2a\u670d\u52a1</li> </ul> <p>\u5728\u63a7\u5236\u5668 nginx-deploy \u4e0a\u521b\u5efa\u540d\u5b57\u4e3a nginx \u7684 service , \u5b83\u5de5\u4f5c\u7aef\u53e3\u4e3a 80, \u4ee3\u7406\u7684\u540e\u7aef\u5bb9\u5668\u7aef\u53e3 80, \u534f\u8bae\u4e3a TCP</p> <pre><code>kubectl expose deployment nginx-deploy --name=nginx --port=80 --target-port=80 --protocol=TCP\n</code></pre> <ul> <li>\u53ef\u4ee5\u770b\u5230\u521a\u521a\u521b\u5efa\u7684\u540d\u5b57\u4e3a nginx \u7684 service \uff0c\u73b0\u5728\u5c31\u53ef\u4ee5\u5728\u96c6\u7fa4\u5185\u7528 service \u7684\u5730\u5740\u6765\u8bbf\u95ee\u4e86, \u5982\u679c\u5916\u90e8\u8bbf\u95ee\u53ef\u4ee5\u4f7f\u7528 NodePort \u6a21\u5f0f</li> </ul> <pre><code>kubectl get service\n</code></pre> <ul> <li>\u5220\u9664\u4e00\u4e2a\u4efb\u52a1</li> </ul> <pre><code>kubectl delete deployment nginx-deploy\n</code></pre>"},{"location":"k8s/note/chapter-4/#44-cp","title":"4.4 cp","text":"<ul> <li>\u62f7\u8d1d\u5bbf\u4e3b\u673a\u6587\u4ef6\u6216\u76ee\u5f55\u5230pod\u4e2d\uff0c\u26a0\ufe0f\u8981\u6c42tar\u4e8c\u8fdb\u5236\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\u5bb9\u5668\u4e2d\uff0c\u4e0d\u7136\u62f7\u8d1d\u4f1a\u5931\u8d25</li> </ul> <pre><code>kubectl cp /tmp/foo_dir &lt;some-pod&gt;:/tmp/bar_dir\n\n[root@master ~]# kubectl cp flannel.tar  nginx-58cd4d4f44-8pwb7:/usr/share/nginx/html \n[root@master ~]# kubectl cp mainfile/  nginx-58cd4d4f44-8pwb7:/usr/share/nginx/html \n[root@master ~]# kubectl exec -it nginx-58cd4d4f44-8pwb7 -- /bin/bash\nroot@nginx-58cd4d4f44-8pwb7:/# ls -l /usr/share/nginx/html/\ntotal 54108\n-rw-r--r-- 1 root root      537 Jul 11  2017 50x.html\n-rw-r--r-- 1 root root      355 May 27 06:47 dashboard-adminuser.yaml\n-rw------- 1 root root 55390720 May 27 01:49 flannel.tar\n-rw-r--r-- 1 root root      612 Jul 11  2017 index.html\ndrwxr-xr-x 4 root root       51 Aug 17 14:16 mainfile\n</code></pre>"},{"location":"k8s/note/chapter-4/#45-port-forward","title":"4.5 port-forward","text":"<ul> <li>\u7aef\u53e3\u8f6c\u53d1\uff0c\u5c06svc\u5730\u5740\u6216\u7740pods\u7aef\u53e3\u5229\u7528kubelet\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u4e0a,\u5c06\u8bbf\u95ee\u5bbf\u4e3b\u673a\u76848888\u7aef\u53e3\u7684\u6240\u6709\u6d41\u91cf\u8f6c\u53d1\u52308111svc</li> </ul> <pre><code>kubectl port-forward --address 0.0.0.0 service/nginx 8888 8111\n</code></pre> <ul> <li>\u8f6c\u53d1pods\u7aef\u53e3,\u5c06\u8bbf\u95ee\u5bbf\u4e3b\u673a\u76848888\u7aef\u53e3\u6d41\u91cf\u8f6c\u53d1\u5230pod\u76845000\u7aef\u53e3</li> </ul> <pre><code>kubectl port-forward pod/mypod 8888:5000\n</code></pre>"},{"location":"k8s/note/chapter-4/#46-coredns","title":"4.6 coredns","text":"<p>service \u63d0\u4f9b\u4e86\u5bf9 pod \u7684\u56fa\u5b9a\u8bbf\u95ee\u7aef\u70b9\uff0c\u4f46\u662f service \u672c\u8eab\u7684\u53d8\u52a8\u6211\u4eec\u65e0\u6cd5\u77e5\u6653\uff0c\u9700\u8981 coredns \u5bf9 service \u505a\u57df\u540d\u89e3\u6790\u3002</p> <ul> <li>\u67e5\u770b coredns \u8fd0\u884c\u72b6\u6001</li> </ul> <pre><code>kubectl get pods -n kube-system -o wide |grep coredns\n</code></pre> <ul> <li>\u67e5\u770b\u5404\u4e2a kube-system \u547d\u540d\u7a7a\u95f4\u8fd0\u884c\u7684\u670d\u52a1\uff0c\u53ef\u4ee5\u770b\u5230 kube-dns \u8fd0\u884c\u7684 IP \u5730\u5740</li> </ul> <pre><code>kubectl get service -n kube-system\n</code></pre> <ul> <li>\u4f7f\u7528 kube-dns \u6765\u89e3\u6790 nginx \u8fd9\u4e2a service \u7684\u5730\u5740\u5c31\u53ef\u4ee5\u6b63\u5e38\u89e3\u6790\u4e86</li> </ul> <pre><code>dig -t A nginx.default.svc.cluster.local @10.96.0.10\n</code></pre> <ul> <li>\u521b\u5efa\u4e00\u4e2a\u8bbf\u95ee nginx \u5ba2\u6237\u7aef\u5bb9\u5668\uff0c\u5e76\u8fdb\u5165\u4ea4\u4e92\u5f0f\u6a21\u5f0f\uff0c\u8fd9\u4e2a\u5bb9\u5668\u9ed8\u8ba4\u7684 dns \u670d\u52a1\u5668\u5c31\u662f kube-dns \u6240\u5728\u7684\u670d\u52a1\u5668</li> </ul> <pre><code>kubectl run client --image=busybox --replicas=1 -it --restart=Never\n</code></pre> <pre><code>/ # cat /etc/resolv.conf \nnameserver 10.96.0.10                                               # kube-dns \u5730\u5740\nsearch default.svc.cluster.local svc.cluster.local cluster.local    # \u9ed8\u8ba4\u7684\u89e3\u6790\u641c\u7d22\u57df\noptions ndots:5\n</code></pre> <ul> <li>\u5728 busybox \u8fd9\u4e2a\u5bb9\u5668\u4e2d\u8bf7\u6c42 nginx \u8fd9\u4e2a\u57df\u540d\u7684 service \uff0c\u80fd\u591f\u6b63\u5e38\u8bbf\u95ee</li> </ul> <pre><code>wget -O - -q http://nginx:80/\n</code></pre>"},{"location":"k8s/note/chapter-4/#47-pod","title":"4.7 \u6a21\u62df POD \u88ab\u5220\u9664","text":"<ul> <li>\u73b0\u5728\u6211\u4eec\u5220\u9664 service \u540e\u7aef\u7684 POD \uff0c\u526f\u672c\u63a7\u5236\u5668\u4f1a\u81ea\u52a8\u521b\u5efa\u65b0\u7684 POD\uff0c\u800c service \u5219\u4f1a\u81ea\u52a8\u6307\u5411\u65b0\u521b\u5efa\u7684 POD</li> </ul> <pre><code>kubectl delete pods nginx-deploy-5c9b546997-4w24n\n</code></pre> <ul> <li>\u67e5\u770b\u7531\u526f\u672c\u63a7\u5236\u5668\u81ea\u52a8\u521b\u5efa\u7684 POD</li> </ul> <pre><code>kubectl get pods\n</code></pre> <ul> <li>\u5728 busybox \u8fd9\u4e2a\u5bb9\u5668\u4e2d\u8bf7\u6c42 nginx \u8fd9\u4e2a\u57df\u540d\u7684 service \uff0c\u8bbf\u95ee\u6ca1\u6709\u53d7\u5230\u5f71\u54cd</li> </ul> <pre><code>wget -O - -q http://nginx:80/\n</code></pre>"},{"location":"k8s/note/chapter-4/#48-service","title":"4.8 \u6a21\u62df service \u88ab\u5220\u9664","text":"<ul> <li>\u5f53\u6211\u4eec\u5220\u9664 service \u5e76\u4e14\u91cd\u65b0\u5efa\u7acb\u4e00\u4e2a service \u518d\u6b21\u67e5\u770b service \u7684\u5730\u5740\u5df2\u7ecf\u53d1\u751f\u53d8\u5316\u4e86</li> </ul> <pre><code>kubectl delete service nginx\n</code></pre> <pre><code>kubectl expose deployment nginx-deploy --name=nginx --port=80 --target-port=80 --protocol=TCP\n</code></pre> <pre><code>kubectl get service\n</code></pre> <ul> <li>\u5728 busybox \u8fd9\u4e2a\u5bb9\u5668\u4e2d\u8bf7\u6c42 nginx \u8fd9\u4e2a\u57df\u540d\u7684 service \uff0c\u8bbf\u95ee\u6ca1\u6709\u4ecd\u7136\u6ca1\u6709\u53d7\u5230\u5f71\u54cd</li> </ul> <pre><code>wget -O - -q http://nginx:80/\n</code></pre>"},{"location":"k8s/note/chapter-4/#49-labels","title":"4.9 labels","text":"<p>\u4e3a\u4ec0\u4e48 Pod \u88ab\u5220\u9664\u540e\uff0cservic \u4ecd\u7136\u80fd\u591f\u6b63\u786e\u7684\u8c03\u5ea6\u5230\u65b0\u7684 POD \u4e0a\uff0c\u8fd9\u5c31\u662f k8s \u7684 labels \u8fd9\u4e2a\u673a\u5236\u6765\u4fdd\u8bc1\u7684\u3002</p> <p>\u80fd\u591f\u4f7f\u7528\u6807\u7b7e\u673a\u5236\u4e0d\u6b62\u6709 pod\u3001\u5728 k8s \u4e2d\u5f88\u591a\u5bf9\u8c61\u90fd\u53ef\u4ee5\u4f7f\u7528\u6807\u7b7e\uff0c\u4f8b\u5982\uff1anode\u3001service</p> <ul> <li>\u67e5\u770b service \u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f1a\u53d1\u73b0\u6807\u7b7e\u9009\u62e9\u5668</li> </ul> <pre><code>kubectl describe service nginx\n</code></pre> <pre><code>Name:              nginx\nNamespace:         default\nLabels:            run=nginx-deploy\nAnnotations:       &lt;none&gt;\nSelector:          run=nginx-deploy       # \u8fd9\u4e2a\u9009\u62e9\u5668\u4f1a\u81ea\u52a8\u9009\u4e2d run \u6807\u7b7e\uff0c\u4e14\u503c\u4e3a nginx-deploy \u7684 POD\nType:              ClusterIP\nIP:                10.101.149.4\nPort:              &lt;unset&gt;  80/TCP\nTargetPort:        80/TCP\nEndpoints:         10.244.2.4:80          # \u5f53 service \u7684\u540e\u7aef\uff0c\u5f53 POD \u53d1\u751f\u53d8\u52a8\u5219\u7acb\u5373\u4f1a\u66f4\u65b0\nSession Affinity:  None\nEvents:            &lt;none&gt;\n</code></pre> <ul> <li>\u67e5\u770b POD \u7684\u6807\u7b7e\uff0c\u4f1a\u770b\u5230\u62e5\u6709 run=nginx-deploy \u6807\u7b7e\u7684\u5bb9\u5668\uff0c\u800c\u4eba\u4e3a\u5220\u9664\u4e00\u4e2a POD \u540e\uff0c\u526f\u672c\u63a7\u5236\u5668\u521b\u5efa\u7684\u526f\u672c\u4e0a\u7684\u6807\u7b7e\u4e0d\u4f1a\u53d8\u5316\uff0c\u6240\u4ee5\u6807\u7b7e\u53c8\u88ab service \u5173\u8054\u3002</li> </ul> <pre><code>kubectl get pods --show-labels\n</code></pre> <pre><code>NAME                            READY   STATUS    RESTARTS   AGE     LABELS\nclient                          1/1     Running   0          21m     run=client\nnginx-deploy-5c9b546997-kh88w   1/1     Running   0          8m37s   pod-template-hash=5c9b546997,run=nginx-deploy\n</code></pre> <ul> <li>\u67e5\u770b POD \u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u5230 POD \u7684\u8be6\u7ec6\u4fe1\u606f</li> </ul> <pre><code>kubectl describe deployment nginx-deploy\n</code></pre> <ul> <li>\u6839\u636e\u6807\u7b7e\u8fc7\u6ee4\uff0c\u4f7f\u7528 -l \u6765\u6307\u5b9a\u6807\u7b7e\u540d\u79f0\u6216\u540c\u65f6\u8fc7\u6ee4\u5176\u503c</li> </ul> <pre><code>kubectl get pods --show-labels -l run=nginx-deploy\n</code></pre> <ul> <li>\u6807\u7b7e\u9009\u62e9\u5668\u96c6\u4e2d\u8fd0\u7b97</li> </ul> <pre><code>\u5173\u7cfb\u4e0e:  KEY,KEY KEY=VALUE2,KEY=VALUE2       # -l run,app\n\u7b49\u503c\u5173\u7cfb:KEY = VALUE KEY != VALUE           # -l run=nginx-deploy,app!=myapp\n\u96c6\u5408\u5173\u7cfb:KYE in|not in (VALUE1,VALUE2)      # -l \"release in (canary,bata,alpha)\"  \n</code></pre> <ul> <li>\u663e\u793a\u6307\u5b9a\u7684\u6807\u7b7e\u7684\u503c\uff0c\u4e0b\u9762\u663e\u793a\u4e86\u4e24\u4e2a\u6807\u7b7e</li> </ul> <pre><code>kubectl get pods --show-labels -L run,pod-template-hash\n</code></pre> <ul> <li>\u4e3a\u6307\u5b9a\u7684 POD \u6253\u6807\u7b7e\uff0c\u4e3a client \u8fd9\u4e2a POD \u6253\u4e0a\u4e00\u4e2a release \u6807\u7b7e\uff0c\u5176\u503c\u4e3a canary</li> </ul> <pre><code>kubectl label pods client release=canary\n</code></pre> <ul> <li>\u4fee\u6539 POD \u7684\u6807\u7b7e\uff0c\u4f7f\u7528 --overwrite \u8fdb\u884c\u4fee\u6539\u539f\u6709\u6807\u7b7e</li> </ul> <pre><code>kubectl label pods client release=stable --overwrite\n</code></pre> <ul> <li>\u5220\u9664\u6307\u5b9a\u7684 nodes \u4e0a\u7684\u6807\u7b7e\uff0c\u4f7f\u7528\u6807\u7b7e\u540d\u79f0\u52a0 - \u7b26\u53f7</li> </ul> <pre><code>kubectl label nodes node2 disktype-\n</code></pre> <ul> <li>\u8bb8\u591a\u8d44\u6e90\u652f\u6301\u5185\u5d4c\u5b57\u6bb5\u6765\u5b9a\u4e49\u5176\u4f7f\u7528\u7684\u6807\u7b7e\u9009\u62e9\u5668\uff0c\u4f8b\u5982 service \u5173\u8054 pod \u65f6\u5019\uff1a</li> </ul> <pre><code>matchLabels: \u76f4\u63a5\u7ed9\u5b9a\u952e\u503c\nmatchExpressions: \u57fa\u4e8e\u7ed9\u5b9a\u7684\u8868\u8fbe\u5f0f\u6765\u5b9a\u4e49\u4f7f\u7528\u6807\u7b7e\u9009\u62e9\u5668: {key:\"KEY\",operator:\"OPERATOR\",value:[VAL1,VAL2,...]}\n    \u4f7f\u7528 key \u4e0e value \u8fdb\u884c operator \u8fd0\u7b97, \u590d\u5408\u6761\u4ef6\u7684\u624d\u88ab\u9009\u62e9\n    \u64cd\u4f5c\u7b26:\n        In, NotIn: \u5176 value \u5217\u8868\u5fc5\u987b\u6709\u503c\n        Exists, NotExists: \u5176 value \u5fc5\u987b\u4e3a\u7a7a\n</code></pre> <ul> <li>k8s \u4e2d\u5f88\u591a\u5bf9\u8c61\u90fd\u53ef\u4ee5\u6253\u6807\u7b7e\uff0c\u4f8b\u5982\u7ed9 nodes \u6253\u4e00\u4e2a\u6807\u8bb0\uff0c\u968f\u540e\u5728\u6dfb\u52a0\u8d44\u6e90\u65f6\u5019\u5c31\u53ef\u4ee5\u8ba9\u8d44\u6e90\u5bf9\u8282\u70b9\u6709\u503e\u5411\u6027\u4e86</li> </ul> <pre><code>kubectl label nodes node2 disktype=ssd\n</code></pre> <pre><code>kubectl get nodes --show-labels\n</code></pre>"},{"location":"k8s/note/chapter-4/#410","title":"4.10 \u52a8\u6001\u6269\u5bb9","text":"<ul> <li>\u6269\u5bb9\u4e00\u4e2a\u96c6\u7fa4\u7684\u7684 POD\uff0c\u4e0b\u9762\u547d\u4ee4\u8868\u793a\u4fee\u6539 deployment \u63a7\u5236\u5668\u4e0b\u7684 nginx-deply \u5bb9\u5668\u7684\u526f\u672c\u6570\u91cf\u4e3a2</li> </ul> <pre><code>kubectl scale --replicas=5 deployment nginx-deploy\n</code></pre>"},{"location":"k8s/note/chapter-4/#411","title":"4.11 \u6eda\u52a8\u5347\u7ea7","text":"<ul> <li>\u66f4\u6362 nginx-deploy \u8fd9\u4e2a\u63a7\u5236\u5668\u4e0b\u7684 nginx-deploy \u5bb9\u5668\u955c\u50cf\u4e3a ikubernetes/myapp:v2</li> </ul> <pre><code>kubectl set image deployment nginx-deploy nginx-deploy=ikubernetes/myapp:v2\n</code></pre> <ul> <li>\u67e5\u770b\u66f4\u65b0\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230 5 \u4e2a\u5bb9\u5668\u4e2d\u8fd0\u884c\u7684\u955c\u50cf\u5168\u90e8\u66f4\u65b0\u5b8c</li> </ul> <pre><code>kubectl rollout status deployment nginx-deploy\n</code></pre> <pre><code>[root@node1 ~]# kubectl rollout status deployment nginx-deploy\nWaiting for deployment \"nginx-deploy\" rollout to finish: 3 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 3 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 3 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 3 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 3 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 4 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 4 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 4 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 4 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 4 out of 5 new replicas have been updated...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 2 old replicas are pending termination...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 2 old replicas are pending termination...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 2 old replicas are pending termination...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 1 old replicas are pending termination...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 1 old replicas are pending termination...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 1 old replicas are pending termination...\nWaiting for deployment \"nginx-deploy\" rollout to finish: 4 of 5 updated replicas are available...\ndeployment \"nginx-deploy\" successfully rolled out\n</code></pre> <ul> <li>\u56de\u6eda\u64cd\u4f5c\uff0c\u4e0d\u6307\u5b9a\u4efb\u4f55\u7684\u955c\u50cf\u5219\u4e3a\u4e0a\u4e00\u4e2a\u7248\u672c\u7684\u955c\u50cf</li> </ul> <pre><code>kubectl rollout undo deployment nginx-deploy\n</code></pre> <p>\u5982\u679c\u9632\u6b62\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u88ab\u8c03\u5ea6\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5b66\u4e60\u5c31\u7eea\u6027\u68c0\u6d4b\u624d\u80fd\u5b9e\u73b0</p>"},{"location":"k8s/note/chapter-4/#412","title":"4.12 \u96c6\u7fa4\u5916\u8bbf\u95ee","text":"<ul> <li>\u4fee\u6539 service \u7684\u7f51\u7edc\u7c7b\u578b\u4e3a NodePort</li> </ul> <pre><code>kubectl edit service nginx\n</code></pre> <pre><code>type: ClusterIP -&gt; type: NodePort\n</code></pre> <ul> <li>\u67e5\u770b service \u7684\u4fe1\u606f\uff0c\u53d1\u73b0\u591a\u4e86\u4e00\u4e2a 30982 \u7aef\u53e3</li> </ul> <pre><code>kubectl get service\n</code></pre> <pre><code>NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE\nkubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP        15h\nnginx        NodePort    10.105.27.11   &lt;none&gt;        80:30982/TCP   42m\n</code></pre> <ul> <li>\u5728\u96c6\u7fa4\u5916\u90e8\u4f7f\u7528\u4efb\u610f\u7684 node IP \u5730\u5740 + \u7aef\u53e3\u6765\u8bbf\u95ee</li> </ul> <pre><code>http://172.16.100.101:30982/\n</code></pre>"},{"location":"k8s/note/chapter-4/#413","title":"4.13 \u6392\u67e5\u65e5\u5fd7","text":"<ul> <li>\u67e5\u770b\u4e00\u4e2a pod \u7684\u67d0\u4e2a\u5bb9\u5668\u7684\u8fd0\u884c\u65e5\u5fd7</li> </ul> <pre><code>kubectl logs pod-demo busybox\n</code></pre>"},{"location":"k8s/note/chapter-4/#414-pod","title":"4.14 \u8fde\u5165 POD \u5bb9\u5668","text":"<pre><code>kubectl exec -it pod-demo -c myapp -- /bin/sh\n</code></pre>"},{"location":"k8s/note/chapter-5/","title":"\u4e94 \u914d\u7f6e\u6e05\u5355\u4f7f\u7528","text":"<p>apiserver \u4ec5\u63a5\u6536 json \u683c\u5f0f\u7684\u8d44\u6e90\u5b9a\u4e49\uff0cyaml \u683c\u5f0f\u5b9a\u4e49\u63d0\u4f9b\u7684\u914d\u7f6e\u6e05\u5355\uff0capiserver \u53ef\u81ea\u52a8\u5c06\u5176\u8f6c\u6362\u4e3a json \u683c\u5f0f\uff0c\u800c\u540e\u518d\u8fdb\u884c\u6267\u884c\u3002</p>"},{"location":"k8s/note/chapter-5/#51","title":"5.1 \u53ef\u914d\u7f6e\u7684\u5bf9\u8c61","text":"<ul> <li>\u53ef\u7528\u8d44\u6e90\u6e05\u5355\u914d\u7f6e\u7684\u5bf9\u8c61</li> </ul> <pre><code>workload\uff1aPod\u3001ReplicaSet\u3001Deployment\u3001StatefulSet\u3001DaemonSet\u3001Job\u3001CronJob\n\u670d\u52a1\u53d1\u73b0\u53ca\u5747\u8861\uff1aService\u3001Ingress\n\u914d\u7f6e\u4e0e\u5b58\u50a8\uff1aVolume\u3001CSI\n    ConfigMap\u3001Secret\n    DownwardAPI\n\u96c6\u7fa4\u7ea7\u8d44\u6e90\n    Namespace\u3001None\u3001Role\u3001ClusterRole\u3001RoleBinding\u3001ClusterRoleBinding\n\u5143\u6570\u636e\u7c7b\u578b\u8d44\u6e90\n    HPA\u3001PodTemplate\u3001LimitRange\n</code></pre>"},{"location":"k8s/note/chapter-5/#52","title":"5.2 \u914d\u7f6e\u6e05\u5355\u7ec4\u6210","text":"<ul> <li>\u914d\u7f6e\u6e05\u5355\u7ec4\u6210\u90e8\u5206\uff0c\u5927\u90e8\u5206\u8d44\u6e90\u4f7f\u7528\u914d\u7f6e\u6e05\u5355\u65b9\u5f0f\u6765\u521b\u5efa</li> </ul> <pre><code>apiVersion\n    # \u4ee5 \"group/version\" \u5f62\u5f0f\u6307\u660e\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u5c5e\u4e8e\u54ea\u4e2a API \u7ec4\uff08\u7248\u672c\uff09\nkind:\n    # \u8d44\u6e90\u7c7b\u522b\uff0c\u6807\u8bb0\u521b\u5efa\u4ec0\u4e48\u7c7b\u578b\u7684\u8d44\u6e90\nmetadata:\n    # \u5143\u6570\u636e\u5185\u90e8\u662f\u5d4c\u5957\u7684\u5b57\u6bb5\n    # \u5b9a\u4e49\u4e86\u8d44\u6e90\u5bf9\u8c61\u7684\u540d\u79f0\u3001\u547d\u540d\u7a7a\u95f4\uff08k8s\u7ea7\u522b\u7684\u4e0d\u662f\u7cfb\u7edf\u7684\uff09\u7b49\u3001\u6807\u7b7e\u3001\u6ce8\u89e3\u7b49\nspec:\n    # \u89c4\u8303\u5b9a\u4e49\u8d44\u6e90\u5e94\u8be5\u62e5\u6709\u4ec0\u4e48\u6837\u7684\u7279\u6027\uff0c\u4f9d\u9760\u63a7\u5236\u5668\u786e\u4fdd\u7279\u6027\u80fd\u591f\u88ab\u6ee1\u8db3\n    # \u5b83\u662f\u7528\u6237\u5b9a\u4e49\u7684\u6240\u671f\u671b\u4e86\u8d44\u6e90\u72b6\u6001\nstatus:\n    # \u663e\u793a\u8d44\u6e90\u7684\u5f53\u524d\u72b6\u6001\uff0ck8s \u5c31\u662f\u786e\u4fdd\u5f53\u524d\u72b6\u6001\u5411\u76ee\u6807\u72b6\u6001\u65e0\u9650\u9760\u8fd1\u4ece\u800c\u6ee1\u8db3\u7528\u6237\u671f\u671b\n    # \u5b83\u662f\u53ea\u8bfb\u7684\uff0c\u4ee3\u8868\u4e86\u8d44\u6e90\u5f53\u524d\u72b6\u6001\n</code></pre> <ul> <li>\u83b7\u53d6\u5168\u90e8\u7684 api \u7248\u672c</li> </ul> <pre><code>kubectl api-versions\n</code></pre> <ul> <li>\u83b7\u53d6\u5168\u90e8\u7684 api \u8d44\u6e90\u5bf9\u8c61</li> </ul> <p>\u4ece\u5185\u5bb9\u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u7f29\u5199\uff0c\u65b9\u4fbf\u6211\u4eec\u65e5\u5e38\u547d\u4ee4\u540e\u7b80\u5199</p> <pre><code>kubectl api-resources\n\nkubectl get po          # \u67e5\u770bpod\nkubectl get deploy      # \u67e5\u770bdeployment\nkubectl get svc         # \u67e5\u770bservice\nkubectl get cm          # \u67e5\u770b configmap\n...\n</code></pre>"},{"location":"k8s/note/chapter-5/#53","title":"5.3 \u83b7\u53d6\u6e05\u5355\u5e2e\u52a9","text":"<ul> <li>\u67e5\u770b k8s \u67d0\u4e2a\u5185\u7f6e\u5bf9\u8c61\u7684\u914d\u7f6e\u6e05\u5355\u683c\u5f0f\uff0c\u5e94\u8be5\u5305\u542b\u54ea\u4e9b\u5b57\u6bb5\uff0c\u4f7f\u7528 . \u6765\u663e\u793a\u5b57\u6bb5\u7684\u683c\u5f0f\u5e2e\u52a9\u4fe1\u606f</li> </ul> <pre><code>kubectl explain pods\nkubectl explain pods.metadata\n</code></pre>"},{"location":"k8s/note/chapter-5/#54","title":"5.4 \u6e05\u5355\u57fa\u672c\u683c\u5f0f","text":"<ul> <li>\u5b9a\u4e49\u4e00\u4e2a\u8d44\u6e90\u6e05\u5355</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-deme\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n  - name: busybox\n    image: busybox:latest\n    command:\n    - \"/bin/sh\"\n    - \"-c\"\n    - \"sleep 10\"\n</code></pre>"},{"location":"k8s/note/chapter-5/#55","title":"5.5 \u5feb\u6377\u83b7\u53d6\u6e05\u5355","text":"<ul> <li>\u4f7f\u7528 -o \u53c2\u6570\u6765\u6307\u5b9a\u5bf9\u8c61\u6570\u636e\u7684\u8f93\u51fa\u683c\u5f0f\uff0c\u4f7f\u7528 --dry-run \u6765\u6d4b\u8bd5\u6027\u6267\u884c\u4e00\u4e2a\u6307\u4ee4\uff0c\u5b83\u4e24\u4e2a\u7ed3\u5408\u8d77\u6765\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u521b\u5efa\uff0c\u4e14\u751f\u6210 yaml \u683c\u5f0f\u914d\u7f6e\u6587\u4ef6\u4e86 -o yaml --dry-run</li> </ul> <pre><code>kubectl create secret docker-registry regsecret --docker-server=registry-vpc.cn-hangzhou.aliyuncs.com --docker-username=admin --docker-password=123456 --docker-email=420123641@qq.com -o yaml --dry-run\n</code></pre>"},{"location":"k8s/note/chapter-5/#56-create","title":"5.6 create \u521b\u5efa","text":"<ul> <li>\u521b\u5efa\u8d44\u6e90\u6e05\u5355\u4e2d\u7684\u8d44\u6e90\uff0c\u8fd9\u6837\u521b\u5efa\u7684\u4e3a\u88f8 POD \uff0c\u6ca1\u6709\u63a7\u5236\u5668\u7ba1\u7406\uff0c\u6240\u4ee5\u5220\u9664\u540e\u4e0d\u4f1a\u81ea\u52a8\u91cd\u5efa\uff0c\u6210\u4e3a\u81ea\u4e3b\u5f0f POD</li> </ul> <pre><code>kubectl create -f pod-demo.yaml\n</code></pre>"},{"location":"k8s/note/chapter-5/#57-delete","title":"5.7 delete \u5220\u9664","text":"<ul> <li>\u5220\u9664\u8d44\u6e90\u6e05\u5355\u4e2d\u5b9a\u4e49\u7684 POD</li> </ul> <pre><code>kubectl delete -f pod-demo.yaml\n</code></pre>"},{"location":"k8s/note/chapter-5/#58-apply","title":"5.8 apply \u521b\u5efa\u6216\u66f4\u65b0","text":"<p>apply \u53ef\u4ee5\u6267\u884c\u591a\u6b21\uff0c\u5982\u679c\u53d1\u73b0\u6587\u4ef6\u4e0d\u540c\uff0c\u5219\u66f4\u65b0</p> <pre><code>kubectl apply -f pod-demo.yaml\n</code></pre>"},{"location":"k8s/note/chapter-6/","title":"\u516d POD \u914d\u7f6e\u6e05\u5355","text":""},{"location":"k8s/note/chapter-6/#61-podsmetadata-pod","title":"6.1 pods.metadata POD\u5143\u6570\u636e","text":""},{"location":"k8s/note/chapter-6/#611-labels","title":"6.1.1 labels \u6807\u7b7e","text":"<ul> <li>labels \u5b9a\u4e49\u6807\u7b7e\uff0c\u952e\u503c\u5bf9\u7ec4\u6210\u7684\u6807\u7b7e</li> </ul> <pre><code>  labels:\n    app: myapp\n    tier: frontend\n</code></pre>"},{"location":"k8s/note/chapter-6/#62-podsspec","title":"6.2 pods.spec \u89c4\u8303","text":""},{"location":"k8s/note/chapter-6/#621-nodename","title":"6.2.1 nodeName \u8fd0\u884c\u8282\u70b9","text":"<ul> <li>\u5728\u4f7f\u7528\u8d44\u6e90\u6e05\u5355\u5b9a\u4e49 pod \u65f6\u5019\uff0c\u4f7f\u7528 nodeName \u53ef\u4ee5\u76f4\u63a5\u7ed1\u5b9a\u8d44\u6e90\u5bf9\u8c61\u5728\u54ea\u4e2a POD \u8fd0\u884c\u7684\u8282\u70b9</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-deme\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  nodeName: node2                           # \u76f4\u63a5\u6307\u5b9a POD \u8fd0\u884c\u7684\u8282\u70b9\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n    imagePullPolicy: IfNotPresent\n</code></pre>"},{"location":"k8s/note/chapter-6/#622-nodeselector","title":"6.2.2 nodeSelector \u8282\u70b9\u9009\u62e9","text":"<ul> <li>\u5728\u4f7f\u7528\u8d44\u6e90\u6e05\u5355\u5b9a\u4e49 pod \u65f6\u5019\uff0c\u4f7f\u7528 nodeSelector \uff08\u8282\u70b9\u6807\u7b7e\u9009\u62e9\u5668\uff09\u5b57\u6bb5\uff0c\u6765\u5b9a\u4e49\u8282\u70b9\u7684\u503e\u5411\u6027</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-deme\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  nodeSelector:                            # \u5728 spec \u4e2d\u5b9a\u4e49\u8fd9\u4e2a POD \u7684\u8282\u70b9\u503e\u5411\u6027\n    disktype: ssd                         # \u8fd9\u4e2a POD \u6700\u7ec8\u4f1a\u8fd0\u884c\u5728\u62e5\u6709 disktype \u6807\u7b7e\u4e14\u503c\u4e3a ssd \u7684 nodes \u4e0a\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n    imagePullPolicy: IfNotPresent\n    ports:\n</code></pre> <ul> <li>\u4ece\u6587\u4ef6\u542f\u52a8 pod\uff0c\u89c2\u5bdf pod \u8fd0\u884c\u7684\u8282\u70b9\uff0c\u4f1a\u53d1\u73b0\u5df2\u7ecf\u8fd0\u884c\u5728\u6709\u6807\u7b7e\u7684 node \u8282\u70b9\u4e0a\u4e86</li> </ul> <pre><code>kubectl create -f pod-demo.yaml\n</code></pre> <pre><code>kubectl get pods -o wide\n</code></pre> <pre><code>NAME       READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES\npod-demo   1/1     Running   0          21s   10.244.2.29   node3   &lt;none&gt;           &lt;none&gt;\n</code></pre>"},{"location":"k8s/note/chapter-6/#623-restartpolicy-pod","title":"6.2.3 restartPolicy POD\u91cd\u542f\u7b56\u7565","text":"<p>Always\uff1a\u4e00\u65e6\u5bb9\u5668\u6302\u4e86\uff0c\u90a3\u4e48\u603b\u662f\u91cd\u542f\u5b83\uff0ck8s \u6bcf\u6b21\u91cd\u542f\u7b56\u7565\u4e3a 30 \u79d2\u7684\u4e24\u500d\uff0c\u76f4\u5230\u7b49\u5f85 300 \u79d2\u91cd\u542f\u3002</p> <p>OnFailure\uff1a\u53ea\u6709\u5176\u72b6\u6001\u4e3a\u9519\u8bef\u7684\u65f6\u5019\u624d\u53bb\u91cd\u542f\u5b83</p> <p>Never\uff1a\u4ece\u6765\u4e0d\u91cd\u542f\uff0c\u6302\u4e86\u5c31\u6302\u4e86</p> <pre><code>\u4e00\u65e6\u67d0\u4e2a POD \u88ab\u8c03\u5ea6\u5230\u67d0\u4e2a\u8282\u70b9\u4e0a\uff0c\u53ea\u8981\u8fd9\u4e2a\u8282\u70b9\u5728\uff0c\u90a3\u4e48\u5b83\u5c31\u4e0d\u4f1a\u88ab\u91cd\u65b0\u8c03\u5ea6\uff0c\u53ea\u80fd\u88ab\u91cd\u542f\uff0c\u9664\u975e POD \u88ab\u5220\u9664\u624d\u4f1a\u88ab\u91cd\u65b0\u8c03\u5ea6\uff0c\u6216\u8005 node \u6302\u4e86\uff0c\u624d\u4f1a\u88ab\u91cd\u65b0\u8c03\u5ea6\uff0c\u5426\u5219\u53ea\u8981 node \u5728\uff0c\u90a3\u4e48 POD \u5c31\u4e0d\u4f1a\u88ab\u91cd\u65b0\u8c03\u5ea6\uff0c\u5982\u679c POD \u542f\u52a8\u5931\u8d25\uff0c\u90a3\u4e48\u5c06\u4e0d\u65ad\u7684\u91cd\u542f POD\u3002\n</code></pre> <pre><code>\u5f53\u9700\u8981\u7ec8\u6b62 POD \uff0ck8s \u53d1\u9001 kill -15 \u4fe1\u53f7\uff0c\u8ba9\u5bb9\u5668\u5e73\u6ed1\u7684\u7ec8\u6b62\uff0c\u7b49\u5f85 30 \u79d2\u7684\u5bbd\u9650\u671f\uff0c\u5982\u679c\u6ca1\u6709\u7ec8\u6b62\uff0c\u90a3\u4e48\u5219\u53d1\u9001 kill \u4fe1\u53f7\n</code></pre>"},{"location":"k8s/note/chapter-6/#624-hostnetwork","title":"6.2.4 hostNetwork \u4e3b\u673a\u7f51\u7edc\u7a7a\u95f4","text":"<p>\u4f7f\u7528\u5e03\u5c14\u503c\u6307\u5b9a\u662f\u5426\u8ba9 POD \u4f7f\u7528\u4e3b\u673a\u7684\u7f51\u7edc\u540d\u79f0\u7a7a\u95f4</p>"},{"location":"k8s/note/chapter-6/#625-hostpid-pid","title":"6.2.5 hostPID \u4e3b\u673aPID\u7a7a\u95f4","text":"<p>\u4f7f\u7528\u5e03\u5c14\u503c\u6307\u5b9a\u662f\u5426\u8ba9 POD \u4f7f\u7528\u4e3b\u673a\u7684PID\u540d\u79f0\u7a7a\u95f4</p>"},{"location":"k8s/note/chapter-6/#626-containers","title":"6.2.6 containers \u914d\u7f6e","text":"<p>kubectl explain pods.spec.containers</p> <p>\u63cf\u8ff0 POD \u5185\u6240\u8fd0\u884c\u5bb9\u5668\uff0c\u8bed\u6cd5\uff1acontainers &lt;[]Object&gt;\uff0c\u8868\u793a\u5b83\u7684\u503c\u4e3a\u6570\u7ec4\uff0c\u6570\u7ec4\u5185\u4f7f\u7528\u5bf9\u8c61\u7684\u65b9\u5f0f\u6765\u63cf\u8ff0\u4e00\u4e2a\u5bb9\u5668\uff0c\u5bf9\u8c61\u53ef\u4ee5\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li>\u53ef\u7528\u53c2\u6570</li> </ul> \u53c2\u6570 \u4f5c\u7528 args command env \u5411\u5bb9\u5668\u4f20\u9012\u73af\u5883\u53d8\u91cf envFrom image imagePullPolicy lifecycle livenessProbe name ports readinessProbe resources securityContext stdin stdinOnce terminationMessagePath terminationMessagePolicy tty volumeDevices volumeMounts workingDir <ul> <li>\u793a\u4f8b\u578b\u914d\u7f6e</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-deme                     # pod \u7684\u540d\u79f0\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n    - name: myapp                      # \u8fd0\u884c\u7684\u5bb9\u5668\u540d\u79f0\n      image: ikubernetes/myapp:v1      # \u5bb9\u5668\u7684\u955c\u50cf\n      imagePullPolicy: IfNotPresent    # \u4ece\u4ed3\u5e93\u83b7\u53d6\u955c\u50cf\u7684\u7b56\u7565\n      ports:                           # \u5b9a\u4e49\u5bb9\u5668\u66b4\u6f0f\u7684\u7aef\u53e3\n    - name: busybox\n      image: busybox:latest\n      command:\n        - \"/bin/sh\"\n        - \"-c\"\n        - \"sleep 10\"\n</code></pre>"},{"location":"k8s/note/chapter-6/#6261-imagepullpolicy","title":"6.2.6.1 imagePullPolicy\u4e0b\u8f7d\u7b56\u7565","text":"<ul> <li>imagePullPolicy \u955c\u50cf\u83b7\u53d6\u7684\u7b56\u7565\uff0c\u8be6\u89c1\uff1a<code>kubectl explain pods.spec.containers</code></li> </ul> <pre><code>Always            # \u603b\u662f\u4ece\u4ed3\u5e93\u4e0b\u8f7d\nNever             # \u4ece\u4e0d\u4e0b\u8f7d\uff0c\u672c\u5730\u6709\u5c31\u7528\uff0c\u6ca1\u6709\u5c31\u5931\u8d25\nIfNotPresent      # \u5982\u679c\u672c\u5730\u5b58\u5728\u5c31\u76f4\u63a5\u4f7f\u7528\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5c31\u4e0b\u8f7d\n</code></pre> <p>\u5982\u679c\u6807\u7b7e\u662f latest \u90a3\u4e48\u5219\u59cb\u7ec8\u4ece\u4ed3\u5e93\u4e0b\u8f7d</p>"},{"location":"k8s/note/chapter-6/#6262-ports","title":"6.2.6.2 ports \u7aef\u53e3\u4fe1\u606f","text":"<ul> <li>ports \u5b9a\u4e49\u5bb9\u5668\u4fdd\u66b4\u9732\u7684\uff0c\u8be6\u89c1\uff1a<code>kubectl explain pods.spec.containers.ports</code></li> </ul> <p>\u5728\u6b64\u5904\u66b4\u9732\u7684\u7aef\u53e3\u53ef\u4e3a\u7cfb\u7edf\u63d0\u4f9b\u6709\u5173\u5bb9\u5668\u7684\u7f51\u7edc\u8fde\u63a5\u7684\u4fe1\u606f\uff0c\u4f46\u4e3b\u8981\u662f\u4fe1\u606f\u6027\u7684\uff0c\u6b64\u5904\u6ca1\u6709\u6307\u5b9a\u7684\u7aef\u53e3\u4e5f\u4e0d\u4f1a\u963b\u6b62\u5bb9\u5668\u66b4\u9732\u8be5\u7aef\u53e3\uff0c\u5bb9\u5668\u4e2d\u4efb\u4f55\u4fa6\u542c 0.0.0.0 \u5730\u5740\u7684\u7aef\u53e3\u90fd\u53ef\u4ee5\u4ece\u7f51\u7edc\u8bbf\u95ee</p> <pre><code>    ports:                    # \u5b9a\u4e49\u4e24\u4e2a\u7aef\u53e3\u5bf9\u8c61\u4e00\u4e2a http \u4e00\u4e2a https\n    - name: http              # \u5b9a\u4e49\u8fd9\u4e2a\u7aef\u53e3\u7684\u540d\u79f0\uff0c\u65b9\u4fbf\u522b\u7684\u5bf9\u8c61\u53d6\u5f15\u7528\n      containerPort: 80       # \u7aef\u53e3\u53f7\n    - name: https             # \u65b9\u4fbf\u5f15\u7528\u7684\u540d\u79f0\n      containerPort: 443      # \u8fd9\u4e2a\u7aef\u53e3\u53f7\u4ec5\u4ec5\u662f\u8d77\u5230\u4fe1\u606f\u7684\u4f5c\u7528\uff0c\u65b9\u4fbf\u67e5\u770b\u548c\u4f7f\u7528\u540d\u79f0\u5f15\u7528\n</code></pre>"},{"location":"k8s/note/chapter-6/#6263-env","title":"6.2.6.3 env \u4f20\u9012\u73af\u5883\u53d8\u91cf","text":"<ul> <li>Use Pod fields</li> </ul> <pre><code>      env:\n        - name: MY_NODE_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: spec.nodeName\n        - name: MY_POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: MY_POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        - name: MY_POD_IP\n          valueFrom:\n            fieldRef:\n              fieldPath: status.podIP\n        - name: MY_POD_SERVICE_ACCOUNT\n          valueFrom:\n            fieldRef:\n              fieldPath: spec.serviceAccountName\n</code></pre> <ul> <li>Use Container fields</li> </ul> <pre><code>      env:\n        - name: MY_CPU_REQUEST\n          valueFrom:\n            resourceFieldRef:\n              containerName: test-container\n              resource: requests.cpu\n        - name: MY_CPU_LIMIT\n          valueFrom:\n            resourceFieldRef:\n              containerName: test-container\n              resource: limits.cpu\n        - name: MY_MEM_REQUEST\n          valueFrom:\n            resourceFieldRef:\n              containerName: test-container\n              resource: requests.memory\n        - name: MY_MEM_LIMIT\n          valueFrom:\n            resourceFieldRef:\n              containerName: test-container\n              resource: limits.memory\n</code></pre> <pre><code>\u5728\u5bb9\u5668\u4e2d\u83b7\u53d6 POD \u7684\u4fe1\u606f\n\n\u53ef\u4ee5\u4f7f\u7528\u73af\u5883\u53d8\u91cf\n\u53ef\u4ee5\u4f7f\u7528 downwardAPI\nhttps://kubernetes.io/zh/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/\n</code></pre>"},{"location":"k8s/note/chapter-6/#6264-command-entrypoint","title":"6.2.6.4 command ENTRYPOINT","text":"<ul> <li>command \u5b9a\u4e49\u5bb9\u5668\u8fd0\u884c\u7684\u7a0b\u5e8f\uff0c\u8be6\u89c1\uff1a</li> </ul> <p>https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/</p> <p>\u4e00\u4e2a entrypoint array \u800c command \u542f\u52a8\u7684\u7a0b\u5e8f\u662f\u4e0d\u4f1a\u8fd0\u884c\u5728 Shell \u4e2d\u7684\uff0c\u5982\u679c\u60f3\u8981\u8fd0\u884c\u5728 Shell \u4e2d\u9700\u8981\u81ea\u5df1\u586b\u5199\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u8fd9\u4e2a\u6307\u4ee4\uff0c\u90a3\u4e48\u5c06\u8fd0\u884c docker \u955c\u50cf\u4e2d\u7684 ENTRYPOINT\u3002</p> Image Entrypoint Image Cmd Container command Container args Command run <code>[/ep-1]</code> <code>[foo bar]</code> <code>[ep-1 foo bar]</code> <code>[/ep-1]</code> <code>[foo bar]</code> <code>[/ep-2]</code> <code>[ep-2]</code> <code>[/ep-1]</code> <code>[foo bar]</code> <code>[zoo boo]</code> <code>[ep-1 zoo boo]</code> <code>[/ep-1]</code> <code>[foo bar]</code> <code>[/ep-2]</code> <code>[zoo boo]</code> <code>[ep-2 zoo boo]</code>"},{"location":"k8s/note/chapter-6/#6265-args-cmd","title":"6.2.6.5 args CMD","text":"<ul> <li>args \u5411 command \u4f20\u9012\u53c2\u6570\u7684</li> </ul> <p>\u5982\u679c\u4f60\u6ca1\u6709\u5b9a\u4e49 args \u800c\u955c\u50cf\u4e2d\u53c8\u5b58\u5728 ENTRYPOINT \u6307\u4ee4\u548c CMD \u6307\u4ee4\uff0c\u90a3\u4e48\u955c\u50cf\u81ea\u5df1\u7684 CMD \u5c06\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9 ENTRYPOINT\u3002\u5982\u679c\u624b\u52a8\u6307\u5b9a\u4e86 args \u90a3\u4e48\u955c\u50cf\u4e2d\u7684 CMD \u5b57\u6bb5\u4e0d\u518d\u4f5c\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012\u3002</p> <p>\u5982\u679c\u5728 args \u4e2d\u5f15\u7528\u4e86\u53d8\u91cf\uff0c\u5219\u9700\u8981\u4f7f\u7528 $(VAR_NAME) \u6765\u5f15\u7528\u4e00\u4e2a\u53d8\u91cf\uff0c\u5982\u679c\u4e0d\u60f3\u5728\u8fd9\u91cc\u8fdb\u884c\u547d\u4ee4\u66ff\u6362\uff0c\u90a3\u4e48\u53ef\u4ee5 $$(VAR_NAME)\uff0c\u8f6c\u4e49\u540e\u5728\u5bb9\u5668\u5185\u4f7f\u7528\u3002</p> <pre><code>env:\n- name: MESSAGE\n  value: \"hello kaliarch\"\ncommand: [\"/bin/echo\"]\nargs: [\"$(MESSAGE)\"]\n</code></pre>"},{"location":"k8s/note/chapter-6/#6266-annotations","title":"6.2.6.6 annotations \u6ce8\u89e3\u4fe1\u606f","text":"<p>annotations \u4e0e label \u4e0d\u540c\u7684\u5730\u65b9\u5728\u4e8e\uff0c\u5b83\u4e0d\u80fd\u7528\u4e8e\u6311\u9009\u8d44\u6e90\u5bf9\u8c61\uff0c\u4ec5\u4e3a\u5bf9\u8c61\u63d0\u4f9b\u5143\u6570\u636e\uff0c\u5b83\u7684\u957f\u5ea6\u4e0d\u53d7\u9650\u5236</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-deme\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\n  annotations:                                      # \u6ce8\u89e3\u5173\u952e\u5b57\n    kaliarch/created-by: \"xuel\"                     # \u6dfb\u52a0\u952e\u503c\u5bf9\u7684\u8d44\u6e90\u6ce8\u89e3\nspec:\n  containers:\n  - name: myapp\n    image: ikubernetes/myapp:v1\n    imagePullPolicy: IfNotPresent\n</code></pre>"},{"location":"k8s/note/chapter-6/#6267-pod","title":"6.2.6.7 POD \u751f\u547d\u5468\u671f","text":"<ul> <li>\u4e00\u822c\u72b6\u6001</li> </ul> <pre><code>Pending\uff1a\u5df2\u7ecf\u521b\u5efa\u4f46\u662f\u6ca1\u6709\u9002\u5408\u8fd0\u884c\u5b83\u7684\u8282\u70b9\uff0c\u5df2\u7ecf\u8c03\u5ea6\uff0c\u4f46\u662f\u5c1a\u672a\u5b8c\u6210\nRunning\uff1a\u8fd0\u884c\u72b6\u6001\nFailed\uff1a \u542f\u52a8\u5931\u8d25\nSucceed\uff1a\u6210\u529f\uff0c\u8fd9\u4e2a\u72b6\u6001\u5f88\u77ed\nUnkown\uff1a \u672a\u77e5\u7684\u72b6\u6001\uff0c\u5982\u679c Apiserver \u4e0e kubelet \u901a\u4fe1\u5931\u8d25\u5219\u4f1a\u5904\u4e8e\u8fd9\u4e2a\u72b6\u6001\n</code></pre> <ul> <li>\u521b\u5efa POD \u9636\u6bb5</li> </ul> <p>\u7528\u6237\u7684\u521b\u5efa\u8bf7\u6c42\u63d0\u4ea4\u7ed9 apiserver \uff0c\u800c apiserver \u4f1a\u5c06\u8bf7\u6c42\u7684\u76ee\u6807\u72b6\u6001\u4fdd\u5b58\u5728 etcd \u4e2d\uff0c\u800c\u540e apiserver \u4f1a\u8bf7\u6c42 schedule \u8fdb\u884c\u8c03\u5ea6\uff0c\u5e76\u4e14\u628a\u8c03\u5ea6\u7684\u7ed3\u679c\u66f4\u65b0\u5728 etcd \u7684 pod \u72b6\u6001\u4e2d\uff0c\u968f\u540e\u4e00\u65e6\u4fdd\u5b58\u5728 etcd \u4e2d\uff0c\u5e76\u5b8c\u6210 schedule \u66f4\u65b0\u540e\u76ee\u6807\u8282\u70b9\u7684 kubelet \u5c31\u4f1a\u4ece etcd \u7684\u72b6\u6001\u53d8\u5316\u5f97\u77e5\u6709\u65b0\u4efb\u52a1\u7ed9\u81ea\u5df1\uff0c\u6240\u4ee5\u6b64\u65f6\u4f1a\u62ff\u5230\u7528\u6237\u6240\u5e0c\u671b\u7684\u8d44\u6e90\u6e05\u5355\u76ee\u6807\u72b6\u6001\uff0c\u6839\u636e\u6e05\u5355\u5728\u5f53\u524d\u8282\u70b9\u8fd0\u884c\u8fd9\u4e2a POD\uff0c\u5982\u679c\u521b\u5efa\u6210\u529f\u6216\u8005\u5931\u8d25\uff0c\u5219\u5c06\u7ed3\u679c\u53d1\u56de\u7ed9 apiserver \uff0capiserver \u518d\u6b21\u4fdd\u5b58\u5728 etcd \u4e2d\u3002</p>"},{"location":"k8s/note/chapter-6/#6268-livenessprobe","title":"6.2.6.8 livenessProbe \u5b58\u6d3b\u6027\u63a2\u6d4b","text":"<p>\u8be6\u7ec6\u89c1\uff1akubectl explain pods.spec.containers.livenessProbe</p> <ul> <li>livenessProbe / readinessProbe \u662f k8s \u4e24\u4e2a\u751f\u547d\u5468\u671f\uff0c\u8fd9\u4e24\u4e2a\u751f\u547d\u5468\u671f\u90fd\u53ef\u4ee5\u5b9a\u4e49\u63a2\u9488\u6765\u63a2\u6d4b\u5bb9\u5668\u72b6\u6001\u505a\u51fa\u4e0d\u540c\u53cd\u5e94</li> </ul> <pre><code>livenessProbe     # \u6307\u793a\u5bb9\u5668\u662f\u5426\u6b63\u5728\u8fd0\u884c\u3002\u5982\u679c\u5b58\u6d3b\u63a2\u6d4b\u5931\u8d25\uff0c\u5219\u4f9d\u636e restartPolicy \u7b56\u7565\u6765\u8fdb\u884c\u91cd\u542f\nreadinessProbe    # \u6307\u793a\u5bb9\u5668\u662f\u5426\u51c6\u5907\u597d\u670d\u52a1\u8bf7\u6c42\u3002\u5982\u679c\u5c31\u7eea\u63a2\u6d4b\u5931\u8d25\u7aef\u70b9\u63a7\u5236\u5668\u5c06\u4ece\u4e0e Pod \u5339\u914d\u7684\u6240\u6709 Service \u7684\u7aef\u70b9\u4e2d\u5220\u9664\u8be5 Pod \u7684 IP \u5730\u5740\n</code></pre> <ul> <li>livenessProbe / readinessProbe \u53ef\u7528\u7684\u63a2\u9488\u548c\u63a2\u9488\u7279\u6027\uff0c\u63a2\u9488\u53ea\u80fd\u5b9a\u4e49\u4e00\u79cd\u7c7b\u578b\uff0c\u4f8b\u5982\uff1aHTTPGetAction</li> </ul> <pre><code>exec          # \u5728\u5bb9\u5668\u5185\u6267\u884c\u6307\u5b9a\u547d\u4ee4\u3002\u5982\u679c\u547d\u4ee4\u9000\u51fa\u65f6\u8fd4\u56de\u7801\u4e3a 0 \u5219\u8ba4\u4e3a\u8bca\u65ad\u6210\u529f\u3002\ntcpSocket     # \u5bf9\u6307\u5b9a\u7aef\u53e3\u4e0a\u7684\u5bb9\u5668\u7684 IP \u5730\u5740\u8fdb\u884c TCP \u68c0\u67e5\u3002\u5982\u679c\u7aef\u53e3\u6253\u5f00\uff0c\u5219\u8bca\u65ad\u88ab\u8ba4\u4e3a\u662f\u6210\u529f\u7684\u3002\nhttpGet       # HTTP GET \u8bf7\u6c42\u6307\u5b9a\u7aef\u53e3\u548c\u8def\u5f84\u4e0a\u7684\u5bb9\u5668\u3002\u5982\u679c\u54cd\u5e94\u7801\u5927\u4e8e\u7b49\u4e8e200 \u4e14\u5c0f\u4e8e 400\uff0c\u5219\u8bca\u65ad\u88ab\u8ba4\u4e3a\u662f\u6210\u529f\u7684\u3002\n</code></pre> <pre><code>failureThreshold    # \u63a2\u6d4b\u51e0\u6b21\u624d\u5224\u5b9a\u4e3a\u63a2\u6d4b\u5931\u8d25\uff0c\u9ed8\u8ba4\u4e3a 3 \u6b21\u3002\nperiodSeconds       # \u6bcf\u6b21\u63a2\u6d4b\u5468\u671f\u7684\u95f4\u9694\u65f6\u957f\u3002\ntimeoutSeconds      # \u6bcf\u6b21\u63a2\u6d4b\u53d1\u51fa\u540e\u7b49\u5f85\u7ed3\u679c\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a 1 \u79d2\u3002\ninitalDelaySeconds  # \u5728\u5bb9\u5668\u542f\u52a8\u540e\u5ef6\u8fdf\u591a\u4e45\u53bb\u8fdb\u884c\u63a2\u6d4b\uff0c\u9ed8\u8ba4\u4e3a\u542f\u52a8\u5bb9\u5668\u540e\u7acb\u5373\u63a2\u6d4b\u3002\n</code></pre> <ul> <li>\u4f7f\u7528 exec \u63a2\u9488\uff0c\u5b9e\u9a8c\u7ed3\u679c\u5e94\u8be5\u4e3a 39 \u79d2\u540e POD \u663e\u793a ERROR \uff0c\u4f46\u4e0d\u81ea\u52a8\u91cd\u542f POD</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: execlive\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n    - name: busybox\n      image: busybox\n      command:\n        - \"/bin/sh\"\n        - \"-c\"\n        - \"touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 3600\"    # \u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u7b49\u5f85 30 \u79d2\uff0c\u8fd9\u4e2a\u65f6\u95f4\u63a2\u9488\u5e94\u8be5\u662f\u6210\u529f\u7684\uff0c30 \u79d2\u540e\u5219\u5931\u8d25\n      livenessProbe:                                   # \u5bb9\u5668\u7684\u5b58\u6d3b\u6027\u68c0\u6d4b\uff0c\u5982\u679c\u5931\u8d25\u5219\u6309\u7167 restartPolicy \u7b56\u7565\u6765\u91cd\u542f POD\n        exec:                                          # exec \u7c7b\u578b\u63a2\u9488\uff0c\u8fdb\u5165\u5bb9\u5668\u6267\u884c\u4e00\u6761\u547d\u4ee4\n          command: [\"test\", \"-e\" ,\"/tmp/healthy\"]      # \u6267\u884c\u7684\u547d\u4ee4\u4e3a\u6d4b\u8bd5\u6587\u4ef6\u5b58\u5728\u6027\n        initialDelaySeconds: 2                         # \u5bb9\u5668\u542f\u52a8\u540e\u5ef6\u8fdf\u591a\u4e45\u8fdb\u884c\u63a2\u6d4b\n        periodSeconds: 3                               # \u6bcf\u6b21\u63a2\u6d4b\u5468\u671f\u7684\u95f4\u9694\u65f6\u957f\u4e3a 3 \u79d2\n        failureThreshold: 3                            # 3 \u6b21\u5931\u8d25\u540e\u5219\u5224\u5b9a\u4e3a\u5bb9\u5668\u63a2\u6d4b\u5b58\u6d3b\u6027\u5931\u8d25\n  restartPolicy: Never                                 # \u5f53\u63a2\u6d4b\u5230\u5bb9\u5668\u5931\u8d25\u662f\u5426\u91cd\u542f POD\n</code></pre> <ul> <li>\u4f7f\u7528 httpGet \u63a2\u9488\uff0c\u5b9e\u9a8c\u7ed3\u679c\u5e94\u8be5\u5927\u7ea6 40 \u79d2\u540e\u63a2\u6d4b\u5b58\u6d3b\u6027\u5931\u8d25\uff0c\u81ea\u52a8\u91cd\u542f POD\uff0c\u7b2c\u4e00\u6b21\u91cd\u542f\u4f1a\u7acb\u5373\u8fdb\u884c\uff0c\u968f\u540e\u662f 30 \u79d2\u76842\u500d\u76f4\u5230 300 \u79d2\u3002</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: httpgetlive\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n    - name: nginx\n      image: ikubernetes/myapp:v1\n      ports:\n        - name: http\n          containerPort: 80\n        - name: https\n          containerPort: 443\n      livenessProbe:                   # \u5bb9\u5668\u7684\u5b58\u6d3b\u6027\u68c0\u6d4b\uff0c\u5982\u679c\u5931\u8d25\u5219\u6309\u7167 restartPolicy \u7b56\u7565\u6765\u91cd\u542f POD\n        httpGet:                       # httpget \u63a2\u9488\n          path: /error.html            # \u63a2\u6d4b\u7684\u9875\u9762\uff0c\u4e3a\u4e86\u6548\u679c\u8fd9\u4e2a\u9875\u9762\u4e0d\u5b58\u5728\n          port: http                   # \u63a2\u6d4b\u7684\u7aef\u53e3\uff0c\u4f7f\u7528\u540d\u79f0\u5f15\u7528\u5bb9\u5668\u7684\u7aef\u53e3\n          httpHeaders:                 # httpget \u65f6\u5019\u8bbe\u7f6e\u8bf7\u6c42\u5934\n            - name: X-Custom-Header\n              value: Awesome\n        initialDelaySeconds: 15        # \u5bb9\u5668\u542f\u52a8\u540e\u5ef6\u8fdf\u591a\u4e45\u8fdb\u884c\u63a2\u6d4b\n        timeoutSeconds: 1              # \u6bcf\u6b21\u63a2\u6d4b\u53d1\u51fa\u7b49\u5f85\u7ed3\u679c\u7684\u65f6\u957f\n  restartPolicy: Always                # \u5f53\u63a2\u6d4b\u5230\u5bb9\u5668\u5931\u8d25\u662f\u5426\u91cd\u542f POD\n</code></pre>"},{"location":"k8s/note/chapter-6/#6269-readinessprobe","title":"6.2.6.9 readinessProbe \u5c31\u7eea\u6027\u68c0\u6d4b","text":"<p>\u4f8b\u5982\u6709\u4e00\u4e2a\u5bb9\u5668\u8fd0\u884c\u7684\u662f tomcat \uff0c\u800c tomcat \u5c55\u5f00 war \u5305\uff0c\u90e8\u7f72\u5b8c\u6210\u7684\u65f6\u95f4\u53ef\u80fd\u8f83\u957f\uff0c\u800c\u9ed8\u8ba4 k8s \u4f1a\u5728\u5bb9\u5668\u542f\u52a8\u5c31\u6807\u8bb0\u4e3a read \u72b6\u6001\uff0c\u63a5\u6536 service \u7684\u8c03\u5ea6\u8bf7\u6c42\uff0c\u4f46\u662f\u5bb9\u5668\u542f\u52a8\u4e0d\u4ee3\u8868 tomcat \u5df2\u7ecf\u6210\u529f\u8fd0\u884c\uff0c\u6240\u4ee5\u9700\u8981 readinessProbe \u8fdb\u884c\u5c31\u7eea\u6027\u63a2\u6d4b\uff0c\u6765\u51b3\u5b9a\u662f\u5426\u53ef\u4ee5\u63a5\u5165 service \u4e0a\u3002</p> <ul> <li>livenessProbe / readinessProbe \u53ef\u7528\u7684\u63a2\u9488\u548c\u63a2\u9488\u7279\u6027\u57fa\u672c\u4e00\u6837\uff0c\u63a2\u9488\u53ea\u80fd\u5b9a\u4e49\u4e00\u79cd\u7c7b\u578b\uff0c\u4f8b\u5982\uff1aHTTPGetAction</li> </ul> <pre><code>livenessProbe     # \u6307\u793a\u5bb9\u5668\u662f\u5426\u6b63\u5728\u8fd0\u884c\u3002\u5982\u679c\u5b58\u6d3b\u63a2\u6d4b\u5931\u8d25\uff0c\u5219\u4f9d\u636e restartPolicy \u7b56\u7565\u6765\u8fdb\u884c\u91cd\u542f\nreadinessProbe    # \u6307\u793a\u5bb9\u5668\u662f\u5426\u51c6\u5907\u597d\u670d\u52a1\u8bf7\u6c42\u3002\u5982\u679c\u5c31\u7eea\u63a2\u6d4b\u5931\u8d25\u7aef\u70b9\u63a7\u5236\u5668\u5c06\u4ece\u4e0e Pod \u5339\u914d\u7684\u6240\u6709 Service \u7684\u7aef\u70b9\u4e2d\u5220\u9664\u8be5 Pod \u7684 IP \u5730\u5740\n</code></pre> <ul> <li>\u4f7f\u7528 httpGet \u63a2\u9488\uff0c\u5b9e\u9a8c\u7ed3\u679c\u5e94\u8be5\u5927\u7ea6 40 \u79d2\u540e\u63a2\u6d4b\u5b58\u6d3b\u6027\u5931\u8d25\uff0c\u81ea\u52a8\u91cd\u542f POD\uff0c\u7b2c\u4e00\u6b21\u91cd\u542f\u4f1a\u7acb\u5373\u8fdb\u884c\uff0c\u968f\u540e\u662f 30 \u79d2\u76842\u500d\u76f4\u5230 300 \u79d2\u3002</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: httpgetread\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n    - name: nginx\n      image: ikubernetes/myapp:v1\n      ports:\n        - name: http\n          containerPort: 80\n        - name: https\n          containerPort: 443\n      livenessProbe:                   # \u5bb9\u5668\u7684\u5b58\u6d3b\u6027\u68c0\u6d4b\uff0c\u5982\u679c\u5931\u8d25\u5219\u6309\u7167 restartPolicy \u7b56\u7565\u6765\u91cd\u542f POD\n        httpGet:                       # httpget \u63a2\u9488\n          path: /error.html            # \u63a2\u6d4b\u7684\u9875\u9762\uff0c\u4e3a\u4e86\u6548\u679c\u8fd9\u4e2a\u9875\u9762\u4e0d\u5b58\u5728\n          port: http                   # \u63a2\u6d4b\u7684\u7aef\u53e3\uff0c\u4f7f\u7528\u540d\u79f0\u5f15\u7528\u5bb9\u5668\u7684\u7aef\u53e3\n          httpHeaders:                 # httpget \u65f6\u5019\u8bbe\u7f6e\u8bf7\u6c42\u5934\n            - name: X-Custom-Header\n              value: Awesome\n        initialDelaySeconds: 15        # \u5bb9\u5668\u542f\u52a8\u540e\u5ef6\u8fdf\u591a\u4e45\u8fdb\u884c\u63a2\u6d4b\n        timeoutSeconds: 1              # \u6bcf\u6b21\u63a2\u6d4b\u53d1\u51fa\u7b49\u5f85\u7ed3\u679c\u7684\u65f6\u957f\n  restartPolicy: Always                # \u5f53\u63a2\u6d4b\u5230\u5bb9\u5668\u5931\u8d25\u662f\u5426\u91cd\u542f POD\n</code></pre> <ul> <li>\u624b\u52a8\u8fdb\u5165\u5bb9\u5668\uff0c\u5220\u9664 index.html \u4ee5\u89e6\u53d1\u5c31\u7eea\u6027\u63a2\u9488\u7684\u68c0\u6d4b</li> </ul> <pre><code>kubectl exec -it httpgetread -- /bin/sh\n$ rm -f /usr/share/nginx/html/index.html\n</code></pre> <ul> <li>\u7ed3\u679c\u8fd9\u4e2a POD \u7684 READY \u72b6\u6001\u5df2\u7ecf\u53d8\u6210\u975e\u5c31\u7eea\u4e86\uff0c\u6b64\u65f6 service \u4e0d\u4f1a\u518d\u8c03\u5ea6\u5230\u8fd9\u4e2a\u8282\u70b9\u4e86</li> </ul> <pre><code>[root@node1 ~]# kubectl get pods -w\nNAME                            READY   STATUS    RESTARTS   AGE\nhttpgetread                     0/1     Running   0          2m50s\n</code></pre> <ul> <li>\u5728\u5bb9\u5668\u5185\u518d\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u4ee5\u89e6\u53d1\u5c31\u7eea\u6027\u63a2\u9488\u7684\u68c0\u6d4b</li> </ul> <pre><code>kubectl exec -it httpgetread -- /bin/sh\n$ echo \"hello worlld\" &gt;&gt;/usr/share/nginx/html/index.html\n</code></pre> <ul> <li>\u7ed3\u679c\u8fd9\u4e2a POD \u7684\u7684 READY \u72b6\u6001\u5df2\u7ecf\u7f16\u7a0b\u5c31\u7eea\u4e86\uff0c\u6b64\u65f6 service \u4f1a\u8c03\u5ea6\u5230\u8fd9\u4e2a\u8282\u70b9\u4e86</li> </ul> <pre><code>[root@node1 ~]# kubectl get pods -w\nNAME                            READY   STATUS    RESTARTS   AGE\nhttpgetread                     1/1     Running   0          8m15s\n</code></pre>"},{"location":"k8s/note/chapter-6/#62610-lifecycle","title":"6.2.6.10 lifecycle \u751f\u547d\u5468\u671f\u94a9\u5b50","text":"<p>\u8be6\u89c1\uff1akubectl explain pods.spec.containers.lifecycle</p> <pre><code>postStart           # \u5728\u5bb9\u5668\u542f\u52a8\u540e\u7acb\u5373\u6267\u884c\u7684\u547d\u4ee4\uff0c\u5982\u679c\u8fd9\u4e2a\u64cd\u4f5c\u5931\u8d25\u4e86\uff0c\u90a3\u4e48\u5bb9\u5668\u4f1a\u7ec8\u6b62\uff0c\u4e14\u6839\u636e restartPolicy \u6765\u51b3\u5b9a\u662f\u5426\u91cd\u542f\npreStop             # \u5728\u5bb9\u5668\u7ec8\u6b62\u524d\u7acb\u5373\u6267\u884c\u7684\u547d\u4ee4\n</code></pre> <ul> <li>postStart / preStop \u7684\u57fa\u672c\u4f7f\u7528</li> </ul> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: lifecycle-demo\nspec:\n  containers:\n  - name: lifecycle-demo-container\n    image: nginx\n\n    lifecycle:\n      postStart:\n        exec:\n          command: [\"/bin/sh\", \"-c\", \"echo Hello from the postStart handler &gt; /usr/share/message\"]\n      preStop:\n        exec:\n          command: [\"/usr/sbin/nginx\",\"-s\",\"quit\"]\n</code></pre> <p>POD\u63a7\u5236\u5668</p> <p>\u63a7\u5236\u5668\u7ba1\u7406\u7684 POD \u53ef\u4ee5\u5b9e\u73b0\uff0c\u81ea\u52a8\u7ef4\u62a4 POD \u526f\u672c\u6570\u91cf\uff0c\u5b83\u80fd\u5b9e\u73b0 POD \u7684\u6269\u5bb9\u548c\u7f29\u5bb9\uff0c\u4f46\u662f\u4e0d\u80fd\u5b9e\u73b0\u6eda\u52a8\u66f4\u65b0\u7b49\u9ad8\u7ea7\u529f\u80fd\u3002</p> \u540d\u79f0 \u4f5c\u7528 ReplicationController \u539f\u6765 k8s \u53ea\u6709\u8fd9\u4e00\u79cd\u63a7\u5236\u5668\uff0c\u76ee\u524d\u5df2\u7ecf\u63a5\u8fd1\u5e9f\u5f03 ReplicaSet \u4ee3\u7528\u6237\u521b\u5efa\u6307\u5b9a\u6570\u91cf\u7684 POD \u526f\u672c\uff0c\u8fd8\u652f\u6301\u6269\u7f29\u5bb9\uff0c\u88ab\u79f0\u4e3a\u65b0\u4e00\u4ee3\u7684 ReplicationController\u3002\u4e3b\u8981\u7531 3 \u4e2a\u6307\u6807\uff0c1. \u7528\u6237\u5e0c\u671b\u7684 POD \u526f\u672c\uff0c2. \u6807\u7b7e\u9009\u62e9\u5668\uff0c\u5224\u5b9a POD \u662f\u5426\u5f52\u81ea\u5df1\u7ba1\u7406\uff0c3. \u5982\u679c POD \u526f\u672c\u4e0d\u591f\uff0c\u6309\u7167\u54ea\u4e2a POD template \u521b\u5efa POD\uff0c\u4f46\u4e00\u822c\u6211\u4eec\u4e0d\u76f4\u63a5\u4f7f\u7528 ReplicaSet\u3002 Deployment Deployment \u901a\u8fc7\u63a7\u5236 ReplicaSet \u6765\u5b9e\u73b0\u529f\u80fd\uff0c\u9664\u4e86\u652f\u6301 ReplicaSet \u7684\u6269\u7f29\u5bb9\u610f\u5916\uff0c\u8fd8\u652f\u6301\u6eda\u52a8\u66f4\u65b0\u548c\u56de\u6eda\u7b49\uff0c\u8fd8\u63d0\u4f9b\u4e86\u58f0\u660e\u5f0f\u7684\u914d\u7f6e\uff0c\u8fd9\u4e2a\u662f\u6211\u4eec\u65e5\u5e38\u4f7f\u7528\u6700\u591a\u7684\u63a7\u5236\u5668\u3002\u5b83\u662f\u7528\u6765\u7ba1\u7406\u65e0\u72b6\u6001\u7684\u5e94\u7528\u3002 DaemonSet \u7528\u4e8e\u786e\u4fdd\u96c6\u7fa4\u5185\u7684\u6bcf\u4e2a node \u4e0a\u53ea\u8fd0\u884c\u4e00\u4e2a\u6307\u5b9a\u7684 POD\uff0c\u5982\u679c\u6709\u65b0\u589e\u7684\u8282\u70b9\u4e5f\u90fd\u4f1a\u81ea\u52a8\u8fd0\u884c\u8fd9\u4e2a POD\uff0c\u6240\u4ee5\u8fd9\u4e2a\u63a7\u5236\u5668\u65e0\u9700\u5b9a\u4e49 POD \u8fd0\u884c\u7684\u6570\u91cf\uff0c\u53ea\u9700\u8981\u5b9a\u4e49\u6807\u7b7e\u9009\u62e9\u5668\u548c POD template\u3002\u6240\u4ee5\u53ef\u4ee5\u8ddf\u6839\u636e\u6807\u7b7e\u9009\u62e9\u5668\u9009\u4e2d\u7684 node \u4e0a\u53ea\u8fd0\u884c\u4e00\u4e2a POD \u526f\u672c\u3002 Job \u6267\u884c\u4e00\u4e2a\u4e00\u6b21\u6027\u4efb\u52a1\uff0c\u4f8b\u5982\u6570\u636e\u5e93\u5907\u4efd\uff0c\u4efb\u52a1\u5b8c\u6210\u540e\u6b63\u5e38\u9000\u51fa\uff0c\u5219 POD \u4e0d\u4f1a\u518d\u88ab\u542f\u52a8\u4e86\uff0c\u9664\u975e\u4efb\u52a1\u5f02\u5e38\u7ec8\u6b62\u3002 CronJob \u6267\u884c\u4e00\u4e9b\u5468\u671f\u6027\u4efb\u52a1 StatefulSet \u7ba1\u7406\u6709\u72b6\u6001\u7684 POD \uff0c\u4f46\u662f\u5bf9\u6bcf\u4e2a\u4e0d\u540c\u7684\u6709\u72b6\u6001\u5e94\u7528\u9700\u8981\u81ea\u884c\u7f16\u5199\u811a\u672c\uff0c\u5b8c\u6210\u5bf9\u6709\u72b6\u6001\u670d\u52a1\u7684\u7ba1\u7406\uff0c\u4e3a\u4e86\u89e3\u51b3 StatefulSet \u4e0d\u65b9\u4fbf\u7f16\u5199\u6709\u72b6\u6001\u5e94\u7528\u7ba1\u7406\u7684\u95ee\u9898\u3002k8s \u8fd8\u63d0\u4f9b\u4e86 helm \u8fd9\u6837\u7c7b\u4f3c\u4e8e yum \u7684\u65b9\u5f0f\uff0c\u65b9\u4fbf\u7528\u6237\u4ece helm \u5e02\u573a\u6765\u5b89\u88c5\u4e00\u4e2a\u6709\u72b6\u6001\u7684\u5e94\u7528\u3002"},{"location":"k8s/note/chapter-7/","title":"\u4e03 \u63a7\u5236\u5668\u914d\u7f6e\u6e05\u5355","text":""},{"location":"k8s/note/chapter-7/#71-replicaset","title":"7.1 ReplicaSet \u63a7\u5236\u5668","text":"<p>\u8be6\u89c1\uff1akubectl explain replicaset</p> <ul> <li>\u6e05\u5355\u89c4\u8303</li> </ul> <pre><code>apiVersion  &lt;string&gt;    # api \u7248\u672c\u53f7\uff0c\u4e00\u822c\u4e3a apps/v1\nkind        &lt;string&gt;    # \u8d44\u6e90\u7c7b\u522b\uff0c\u6807\u8bb0\u521b\u5efa\u4ec0\u4e48\u7c7b\u578b\u7684\u8d44\u6e90\nmetadata    &lt;Object&gt;    # POD \u5143\u6570\u636e\nspec        &lt;Object&gt;    # \u5143\u6570\u636e\n</code></pre>"},{"location":"k8s/note/chapter-7/#711-replicasetspec","title":"7.1.1 replicaset.spec \u89c4\u8303","text":"<ol> <li> <p>replicas \u526f\u672c\u6570\u91cf\uff0c\u6307\u5b9a\u4e00\u4e2a\u6570\u5b57</p> </li> <li> <p>selector \u6807\u7b7e\u9009\u62e9\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528 matchLabels\u3001matchExpressions \u4e24\u79cd\u7c7b\u578b\u7684\u9009\u62e9\u5668\u6765\u9009\u4e2d\u76ee\u6807 POD</p> </li> </ol> <pre><code>matchLabels\uff1a\u76f4\u63a5\u7ed9\u5b9a\u952e\u503c\nmatchExpressions\uff1a\u57fa\u4e8e\u7ed9\u5b9a\u7684\u8868\u8fbe\u5f0f\u6765\u5b9a\u4e49\u4f7f\u7528\u6807\u7b7e\u9009\u62e9\u5668\uff1a{key:\"KEY\",operator:\"OPERATOR\",value:[VAL1,VAL2,...]}\n    \u4f7f\u7528 key \u4e0e value \u8fdb\u884c operator \u8fd0\u7b97\uff0c\u590d\u5408\u6761\u4ef6\u7684\u624d\u88ab\u9009\u62e9\n    \u64cd\u4f5c\u7b26\uff1a\n        In\u3001NotIn\uff1a\u5176 value \u5217\u8868\u5fc5\u987b\u6709\u503c\n        Exists\u3001NotExists\uff1a\u5176 value \u5fc5\u987b\u4e3a\u7a7a\n</code></pre> <ol> <li>template \u6a21\u677f\uff0c\u8fd9\u91cc\u9762\u5b9a\u4e49\u7684\u5c31\u662f\u4e00\u4e2a POD \u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u53ea\u5305\u542b\u4e86 pod.metadata \u548c pod.spec \u4e24\u90e8\u5206\u3002</li> </ol>"},{"location":"k8s/note/chapter-7/#712","title":"7.1.2 \u6e05\u5355\u793a\u4f8b","text":"<pre><code>apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  name: myrs\n  namespace: default\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: myapp\n      release: canary\n  template:\n    metadata:\n      name: myapp-pod     # \u8fd9\u4e2a\u5176\u5b9e\u6ca1\u7528\uff0c\u56e0\u4e3a\u521b\u5efa\u7684 POD \u4ee5 rs \u7684\u540d\u5b57\u5f00\u5934\n      labels:\n        app: myapp        # \u6807\u7b7e\u4e00\u5b9a\u8981\u7b26\u5408 replicaset \u6807\u7b7e\u9009\u62e9\u5668\u7684\u89c4\u5219\uff0c\u5426\u5219\u5c06\u9677\u5165\u521b\u5efa pod \u7684\u6b7b\u5faa\u73af\uff0c\u76f4\u5230\u8d44\u6e90\u8017\u5c3d\n        release: canary\n    spec:\n      containers:\n        - name: myapp-containers\n          image: ikubernetes/myapp:v1\n          ports:\n            - name: http\n              containerPort: 80\n</code></pre>"},{"location":"k8s/note/chapter-7/#72-deployment","title":"7.2 Deployment\u63a7\u5236\u5668","text":"<p>Deployment \u901a\u8fc7\u63a7\u5236 ReplicaSet \u6765\u5b9e\u73b0\u529f\u80fd\uff0c\u9664\u4e86\u652f\u6301 ReplicaSet \u7684\u6269\u7f29\u5bb9\u610f\u5916\uff0c\u8fd8\u652f\u6301\u6eda\u52a8\u66f4\u65b0\u548c\u56de\u6eda\u7b49\uff0c\u8fd8\u63d0\u4f9b\u4e86\u58f0\u660e\u5f0f\u7684\u914d\u7f6e\uff0c\u8fd9\u4e2a\u662f\u6211\u4eec\u65e5\u5e38\u4f7f\u7528\u6700\u591a\u7684\u63a7\u5236\u5668\u3002\u5b83\u662f\u7528\u6765\u7ba1\u7406\u65e0\u72b6\u6001\u7684\u5e94\u7528\u3002</p> <p>Deployment \u5728\u6eda\u52a8\u66f4\u65b0\u65f6\u5019\uff0c\u901a\u8fc7\u63a7\u5236\u591a\u4e2a ReplicaSet \u6765\u5b9e\u73b0\uff0cReplicaSet \u53c8\u63a7\u5236\u591a\u4e2a POD\uff0c\u591a\u4e2a ReplicaSet \u76f8\u5f53\u4e8e\u591a\u4e2a\u5e94\u7528\u7684\u7248\u672c\u3002</p> <p></p> <pre><code>graph TB\nDeployment[Deployment] --&gt; replicaset1(replicaset1) \nDeployment[Deployment] --&gt; replicaset2(replicaset2)\nDeployment[Deployment] --&gt; replicaset3(replicaset3)\nreplicaset1(replicaset1) --&gt; POD1{POD}\nreplicaset1(replicaset1) --&gt; POD2{POD}\nreplicaset2(replicaset1) --&gt; POD5{POD}\nreplicaset2(replicaset1) --&gt; POD6{POD}\nreplicaset3(replicaset1) --&gt; POD9{POD}\nreplicaset3(replicaset1) --&gt; POD10{POD}</code></pre> <ul> <li>\u6e05\u5355\u89c4\u8303\uff0c\u8be6\u89c1\uff1akubectl explain deployment</li> </ul> <pre><code>apiVersion  &lt;string&gt;    # apps/v1\n\nkind        &lt;string&gt;    # \u8d44\u6e90\u7c7b\u522b\uff0c\u6807\u8bb0\u521b\u5efa\u4ec0\u4e48\u7c7b\u578b\u7684\u8d44\u6e90\n\nmetadata    &lt;Object&gt;    # POD \u5143\u6570\u636e\n\nspec        &lt;Object&gt;    # \u5143\u6570\u636e\n</code></pre>"},{"location":"k8s/note/chapter-7/#721-replicasetspec","title":"7.2.1 replicaset.spec \u5bf9\u8c61\u89c4\u8303","text":"<ol> <li> <p>replicas \u526f\u672c\u6570\u91cf\uff0c\u6307\u5b9a\u4e00\u4e2a\u6570\u5b57</p> </li> <li> <p>selector \u6807\u7b7e\u9009\u62e9\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528 matchLabels\u3001matchExpressions \u4e24\u79cd\u7c7b\u578b\u7684\u9009\u62e9\u5668\u6765\u9009\u4e2d\u76ee\u6807 POD</p> </li> </ol> <pre><code>matchLabels\uff1a\u76f4\u63a5\u7ed9\u5b9a\u952e\u503c\nmatchExpressions\uff1a\u57fa\u4e8e\u7ed9\u5b9a\u7684\u8868\u8fbe\u5f0f\u6765\u5b9a\u4e49\u4f7f\u7528\u6807\u7b7e\u9009\u62e9\u5668\uff1a{key:\"KEY\",operator:\"OPERATOR\",value:[VAL1,VAL2,...]}\n    \u4f7f\u7528 key \u4e0e value \u8fdb\u884c operator \u8fd0\u7b97\uff0c\u590d\u5408\u6761\u4ef6\u7684\u624d\u88ab\u9009\u62e9\n    \u64cd\u4f5c\u7b26\uff1a\n        In\u3001NotIn\uff1a\u5176 value \u5217\u8868\u5fc5\u987b\u6709\u503c\n        Exists\u3001NotExists\uff1a\u5176 value \u5fc5\u987b\u4e3a\u7a7a\n</code></pre> <ol> <li> <p>template \u6a21\u677f\uff0c\u8fd9\u91cc\u9762\u5b9a\u4e49\u7684\u5c31\u662f\u4e00\u4e2a POD \u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u53ea\u5305\u542b\u4e86 pod.metadata \u548c pod.spec \u4e24\u90e8\u5206\u3002</p> </li> <li> <p>strategy \u66f4\u65b0\u7b56\u7565\uff0c\u652f\u6301\u6eda\u52a8\u66f4\u65b0\u3001\u652f\u6301\u6eda\u52a8\u66f4\u65b0\u7684\u66f4\u65b0\u65b9\u5f0f</p> </li> </ol> <pre><code>type\uff1a                # \u66f4\u65b0\u7c7b\u578b\uff0cRecreate \u66ff\u6362\u66f4\u65b0\uff0cRollingUpdate \u6eda\u52a8\u66f4\u65b0\u7b56\u7565\nrollingUpdate\uff1a       # \u6eda\u52a8\u66f4\u65b0\u65f6\u5019\u7684\u7b56\u7565\uff0c\u8fd9\u662f\u9ed8\u8ba4\u7684\u66f4\u65b0\u7b56\u7565\n    maxSurge\uff1a        # \u6eda\u52a8\u66f4\u65b0\u65f6\u5019\u5141\u8bb8\u4e34\u65f6\u8d85\u51fa\u591a\u5c11\u4e2a\uff0c\u53ef\u4ee5\u6307\u5b9a\u6570\u91cf\u6216\u8005\u767e\u5206\u6bd4\uff0c\u9ed8\u8ba4 25%\n    maxUnavailable\uff1a  # \u6700\u591a\u5141\u8bb8\u591a\u5c11\u4e2a POD \u4e0d\u53ef\u7528\uff0c\u9ed8\u8ba4 25%\n</code></pre> <ul> <li> <p>Recreate\uff1a\u66ff\u6362\u66f4\u65b0\u4f1a\u5148\u5220\u9664\u65e7\u7684\u5bb9\u5668\u7ec4\uff0c\u5728\u521b\u5efa\u65b0\u7684\u5bb9\u5668\u7ec4\uff0c\u5347\u7ea7\u8fc7\u7a0b\u4e2d\u4e1a\u52a1\u4f1a\u4e2d\u65ad</p> </li> <li> <p>RollingUpdate\uff1a\u6eda\u52a8\u66f4\u65b0\u5c06\u9010\u6b65\u7528\u65b0\u7248\u672c\u7684\u5b9e\u4f8b\u66ff\u4ee3\u65e7\u7248\u672c\u7684\u5b9e\u4f8b\uff0c\u5347\u7ea7\u8fc7\u7a0b\u4e2d\uff0c\u4e1a\u52a1\u6d41\u91cf\u4f1a\u540c\u65f6\u8d1f\u8f7d\u5230\u65b0\u65e7\u4e24\u4e2a\u7248\u672c\u7684POD\u4e0a\uff0c\u56e0\u6b64\u4e1a\u52a1\u4e0d\u4f1a\u4e2d\u65ad\u3002</p> </li> <li> <p>revisionHistoryLimit \u6eda\u52a8\u66f4\u65b0\u540e\u6700\u591a\u4fdd\u5b58\u591a\u5c11\u4e2a\u66f4\u65b0\u7684\u5386\u53f2\u7248\u672c\uff0c\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57</p> </li> <li> <p>paused \u5f53\u66f4\u65b0\u542f\u52a8\u540e\u63a7\u5236\u662f\u5426\u6682\u505c</p> </li> </ul>"},{"location":"k8s/note/chapter-7/#722","title":"7.2.2 \u6e05\u5355\u793a\u4f8b","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp-deploy\n  namespace: default\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: myapp\n      release: canary\n  template:\n    metadata:\n      labels:\n        app: myapp\n        release: canary\n    spec:\n      containers:\n        - name: myapp\n          image: ikubernetes/myapp:v1\n          ports:\n            - name: http\n              containerPort: 80\n</code></pre>"},{"location":"k8s/note/chapter-7/#723","title":"7.2.3 \u5173\u4e8e\u66f4\u65b0","text":"<ol> <li>\u76f4\u63a5\u4fee\u6539\u6e05\u5355\u6587\u4ef6\uff0ckubectl apply -f deployment.yaml</li> <li>\u4f7f\u7528 kubectl patch \u4f7f\u7528 json \u683c\u5f0f\u7ed9\u51fa\u66f4\u65b0\u7684\u5185\u5bb9</li> </ol> <pre><code>kubectl patch deployment myapp-deploy -p '{\"spec\":{\"replicas\":5}}'    # \u4fee\u6539 POD \u526f\u672c\u6570\u91cf\n\nkubectl patch deployment myapp-deploy -p '{\"spec\":{\"strategy\":{\"rollingUpdate\":{\"maxSurge\":1,\"maxUnavailable\":0}}}}'                                 # \u4fee\u6539\u66f4\u65b0\u7b56\u7565\n</code></pre> <ol> <li>\u4ec5\u66f4\u65b0\u955c\u50cf kubectl set image</li> </ol> <pre><code>kubectl set image deployment myapp-deploy myapp=ikubernetes/myapp:v3\n</code></pre>"},{"location":"k8s/note/chapter-7/#724","title":"7.2.4 \u6a21\u62df\u91d1\u4e1d\u96c0\u53d1\u5e03","text":"<ul> <li>\u5728\u66f4\u65b0\u521a\u521a\u542f\u52a8\u7684\u65f6\u5019\uff0c\u5c06\u66f4\u65b0\u8fc7\u7a0b\u6682\u505c\uff0c\u90a3\u4e48\u53ea\u80fd\u66f4\u65b0\u4e00\u4e2a\uff0c\u8fd9\u5b9e\u73b0\u4e86\u5728\u96c6\u7fa4\u4e2d\u589e\u52a0\u4e00\u4e2a\u91d1\u4e1d\u96c0\u7248\u672c</li> </ul> <pre><code>kubectl set image deployment myapp-deploy myapp=ikubernetes/myapp:v3 &amp;&amp; kubectl rollout pause deployment myapp-deploy\n</code></pre> <ul> <li>\u67e5\u770b\u5df2\u7ecf\u88ab\u66f4\u65b0\u4e2d\u88ab\u6682\u505c\u7684\u63a7\u5236\u5668\u72b6\u6001\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u76f4\u5904\u4e8e\u6682\u505c\u72b6\u6001\u7684 deployment</li> </ul> <pre><code>kubectl rollout status deployment myapp-deploy\n</code></pre> <pre><code>Waiting for deployment \"myapp-deploy\" rollout to finish: 1 out of 5 new replicas have been updated...\n\n\u7b49\u5f85\u90e8\u7f72\"myapp-deploy\"\u90e8\u7f72\u5b8c\u6210: 5\u4e2a\u65b0\u526f\u672c\u4e2d\u76841\u4e2a\u5df2\u66f4\u65b0...\n</code></pre> <ul> <li>\u5982\u679c\u91d1\u4e1d\u96c0\u6ca1\u6709\u95ee\u9898\uff0c\u90a3\u4e48\u7ee7\u7eed\u53ef\u4ee5\u4f7f\u7528\u7ee7\u7eed\u66f4\u65b0\u7684\u547d\u4ee4</li> </ul> <pre><code>kubectl rollout resume deployment myapp-deploy\n</code></pre>"},{"location":"k8s/note/chapter-7/#725","title":"7.2.5 \u66f4\u65b0\u7b56\u7565","text":"<ul> <li>\u6700\u5927\u4e0d\u53ef\u7528\u4e3a 0 \uff0c\u66f4\u65b0\u65f6\u5019\u53ef\u4ee5\u4e34\u65f6\u8d85\u51fa1\u4e2a</li> </ul> <pre><code>kubectl patch deployment myapp-deploy -p '{\"spec\":{\"strategy\":{\"rollingUpdate\":{\"maxSurge\":1,\"maxUnavailable\":0}}}}'\n</code></pre>"},{"location":"k8s/note/chapter-7/#726","title":"7.2.6 \u5173\u4e8e\u56de\u6eda","text":"<ol> <li>rollout undo \u662f\u56de\u6eda\u7684\u547d\u4ee4\uff0c\u9ed8\u8ba4\u6eda\u56de\u4e0a\u4e00\u7248\u672c</li> </ol> <pre><code>kubectl rollout undo deployment myapp-deploy\n</code></pre> <ol> <li>\u67e5\u770b\u53ef\u4ee5\u56de\u6eda\u7684\u7248\u672c</li> </ol> <pre><code>kubectl rollout history deployment myapp-deploy\n</code></pre> <ol> <li>rollout undo \u6307\u5b9a\u56de\u6eda\u7684\u7248\u672c</li> </ol> <pre><code>kubectl rollout undo deployment myapp-deploy --to-revision=2\n</code></pre> <ol> <li>\u67e5\u770b\u5f53\u524d\u7684\u5de5\u4f5c\u7248\u672c</li> </ol> <pre><code>kubectl get rs -o wide\n</code></pre>"},{"location":"k8s/note/chapter-7/#73-daemonset","title":"7.3 DaemonSet\u63a7\u5236\u5668","text":"<ul> <li>\u6e05\u5355\u89c4\u8303\uff0c\u8be6\u89c1 kubectl explain daemonset</li> </ul> <pre><code>apiVersion  &lt;string&gt;    # apps/v1\n\nkind        &lt;string&gt;    # \u8d44\u6e90\u7c7b\u522b\uff0c\u6807\u8bb0\u521b\u5efa\u4ec0\u4e48\u7c7b\u578b\u7684\u8d44\u6e90\n\nmetadata    &lt;Object&gt;    # POD \u5143\u6570\u636e\n\nspec        &lt;Object&gt;    # \u5143\u6570\u636e\n</code></pre>"},{"location":"k8s/note/chapter-7/#731-daemonsetspec","title":"7.3.1 DaemonSet.spec\u89c4\u8303","text":"<p>\u6b64\u5904\u53ea\u5217\u4e3e\u4e0d\u540c\u4e4b\u5904</p> <ol> <li>updateStrategy \u66f4\u65b0\u7b56\u7565\uff0c\u652f\u6301\u6eda\u52a8\u66f4\u65b0\u3001\u652f\u6301\u6eda\u52a8\u66f4\u65b0\u7684\u66f4\u65b0\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u6eda\u52a8\u66f4\u65b0\u6bcf\u4e2a node</li> </ol> <pre><code>rollingUpdate   # \u6eda\u52a8\u66f4\u65b0\uff0c\u5b83\u53ea\u6709\u4e00\u4e2a rollingUpdate \u53c2\u6570\uff0c\u8868\u793a\u6bcf\u6b21\u66f4\u65b0\u51e0\u4e2a node \u4e0a\u7684  DaemonSet \u4efb\u52a1\nOnDelete        # \u5728\u5220\u9664\u65f6\u66f4\u65b0\n</code></pre>"},{"location":"k8s/note/chapter-7/#732","title":"7.3.2 \u6e05\u5355\u793a\u4f8b","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis\n  namespace: default\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: redis\n      role: logstor\n  template:\n    metadata:\n      labels:\n        app: redis\n        role: logstor\n    spec:\n      containers:\n        - name: redis\n          image: redis:4.0-alpine\n          ports:\n            - name: redis\n              containerPort: 6379\n---                                         # \u53ef\u4ee5\u4f7f\u7528 --- \u6765\u5206\u9694\u591a\u4e2a\u8bb0\u5f55\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: filebeat-daemonset\n  namespace: default\nspec:\n  selector:\n    matchLabels:\n      app: filebeat\n      release: stalbe\n  template:\n    metadata:\n      labels:\n        app: filebeat\n        release: stalbe\n    spec:\n      containers:\n        - name: filebeat\n          image: ikubernetes/filebeat:5.6.5-alpine\n          env:                                         # \u5411\u5bb9\u5668\u4f20\u9012\u73af\u5883\u53d8\u91cf\n            - name: REDIS_HOST                         # \u5bb9\u5668\u5185\u7684\u73af\u5883\u53d8\u91cf\u540d\u79f0\n              value: redis.default.svc.cluster.local   # \u73af\u5883\u53d8\u91cf\u503c\uff0c\u6307\u5411 redis service\n            - name: REDIS_LOG_LEVEL\n              value: info\n</code></pre>"},{"location":"k8s/note/chapter-7/#733","title":"7.3.3 \u5173\u4e8e\u66f4\u65b0","text":"<ul> <li>\u66f4\u65b0 filebeat-daemonset \u8fd9\u4e2a daemonset \u63a7\u5236\u5668\u4e0b\u7684 filebeat \u5bb9\u5668\u7684\u955c\u50cf</li> </ul> <pre><code>kubectl set image daemonsets filebeat-daemonset filebeat=ikubernetes/filebeat:5.6.6-alpine\n</code></pre>"},{"location":"k8s/note/chapter-8/","title":"\u516b Service \u914d\u7f6e\u6e05\u5355","text":"<p>Service \u4e3a POD \u63a7\u5236\u5668\u63a7\u5236\u7684 POD \u96c6\u7fa4\u63d0\u4f9b\u4e00\u4e2a\u56fa\u5b9a\u7684\u8bbf\u95ee\u7aef\u70b9\uff0cService \u7684\u5de5\u4f5c\u8fd8\u4f9d\u8d56\u4e8e K8s \u4e2d\u7684\u4e00\u4e2a\u9644\u4ef6\uff0c\u5c31\u662f CoreDNS \uff0c\u5b83\u5c06 Service \u5730\u5740\u63d0\u4f9b\u4e00\u4e2a\u57df\u540d\u89e3\u6790\u3002</p>"},{"location":"k8s/note/chapter-8/#81-service","title":"8.1 Service \u5de5\u4f5c\u6a21\u5f0f","text":"<ol> <li>userspace: 1.1 \u4e4b\u524d\u7248\u672c</li> <li>iptables: 1.10 \u4e4b\u524d\u7248\u672c</li> <li>ipvs\uff1a1.11 \u4e4b\u540e\u7248\u672c</li> </ol>"},{"location":"k8s/note/chapter-8/#82-service","title":"8.2 Service \u7c7b\u578b","text":"\u7c7b\u578b \u4f5c\u7528 ClusterIP \u9ed8\u8ba4\u503c\uff0c\u5206\u914d\u4e00\u4e2a Service \u7f51\u7edc\u7684\u5730\u5740\uff0c\u4ec5\u7528\u4e8e\u96c6\u7fa4\u5185\u90e8\u901a\u4fe1 NodePort \u5982\u679c\u9700\u8981\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u7c7b\u578b ExternalName \u628a\u96c6\u7fa4\u5916\u90e8\u7684\u670d\u52a1\u5f15\u5165\u5230\u96c6\u7fa4\u5185\u90e8\uff0c\u65b9\u4fbf\u5728\u96c6\u7fa4\u5185\u90e8\u4f7f\u7528 LoadBalancer K8S \u5de5\u4f5c\u5728\u4e91\u73af\u5883\u4e2d\uff0c\u8c03\u7528\u4e91\u73af\u5883\u521b\u5efa\u8d1f\u8f7d\u5747\u8861\u5668"},{"location":"k8s/note/chapter-8/#83","title":"8.3 \u8d44\u6e90\u8bb0\u5f55","text":"<p>SVC_NAME.NS_NAME.DOMAIN.LTD</p> <p>\u4f8b\u5982\uff1aredis.default.svc.cluster.local.</p>"},{"location":"k8s/note/chapter-8/#84-service","title":"8.4 Service \u6e05\u5355","text":"<ul> <li>\u6e05\u5355\u7ec4\u6210</li> </ul> <pre><code>apiVersion  &lt;string&gt;    # api \u7248\u672c\u53f7\uff0cv1\nkind        &lt;string&gt;    # \u8d44\u6e90\u7c7b\u522b\uff0c\u6807\u8bb0\u521b\u5efa\u4ec0\u4e48\u7c7b\u578b\u7684\u8d44\u6e90\nmetadata    &lt;Object&gt;    # POD \u5143\u6570\u636e\nspec        &lt;Object&gt;    # \u5143\u6570\u636e\n</code></pre>"},{"location":"k8s/note/chapter-8/#85-servicespec","title":"8.5 service.spec \u89c4\u8303","text":"<ol> <li>clusterIP\uff1a\u6307\u5b9a Service \u5904\u4e8e service \u7f51\u7edc\u7684\u54ea\u4e2a IP\uff0c\u9ed8\u8ba4\u4e3a\u52a8\u6001\u5206\u914d</li> <li>type\uff1a service \u7c7b\u578b\uff0c\u53ef\u7528\uff1aExternalName, ClusterIP, NodePort, and LoadBalancer</li> </ol>"},{"location":"k8s/note/chapter-8/#86-clusterip-service","title":"8.6 ClusterIP \u7c7b\u578b\u7684 service","text":"<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: redis\n  namespace: default\nspec:\n  selector:\n    app: redis\n    role: logstor\n  type: ClusterIP\n  clusterIP: 10.96.0.100\n  ports:\n    - port: 6379         # service \u7aef\u53e3\n      targetPort: 6379   # pod \u76d1\u542c\u7684\u7aef\u53e3\n      protocol: TCP\n</code></pre>"},{"location":"k8s/note/chapter-8/#87-nodeport-service","title":"8.7 NodePort \u7c7b\u578b\u7684 service","text":"<p>NodePort \u662f\u5728 ClusterIP \u7c7b\u578b\u4e0a\u589e\u52a0\u4e86\u4e00\u4e2a\u66b4\u9732\u5728\u4e86 node \u7684\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u4e0a\u7684\u4e00\u4e2a nodePort\uff0c\u6240\u4ee5\u7528\u6237\u53ef\u4ee5\u4ece\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee\u5230\u96c6\u7fa4\u4e86\uff0c\u56e0\u800c\u7528\u6237\u7684\u8bf7\u6c42\u6d41\u7a0b\u662f\uff1aClient -&gt; NodeIP:NodePort -&gt; ClusterIP:ServicePort -&gt; PodIP:ContainerPort\u3002</p> <p>\u53ef\u4ee5\u7406\u89e3\u4e3a NodePort \u589e\u5f3a\u4e86 ClusterIP \u7684\u529f\u80fd\uff0c\u8ba9\u5ba2\u6237\u7aef\u53ef\u4ee5\u5728\u6bcf\u4e2a\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee\u4efb\u610f\u4e00\u4e2a nodeip \u4ece\u800c\u8bbf\u95ee\u5230 clusterIP\uff0c\u518d\u7531 clusterIP \u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u81f3 POD\u3002</p> <ul> <li>\u6e05\u5355\u793a\u4f8b</li> </ul> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: myapp\n  namespace: default\nspec:\n  selector:\n    app: myapp\n    release: canary\n  type: NodePort\n  ports:\n    - port: 80         # service \u7aef\u53e3\n      targetPort: 80   # pod \u76d1\u542c\u7684\u7aef\u53e3\n      nodePort: 30080    # service \u4f1a\u5728\u6bcf\u4e2a node \u4e0a\u6dfb\u52a0 iptables/ipvs \u89c4\u5219\u91cd\u5b9a\u5411\u8fd9\u4e2a\u7aef\u53e3\u7684\u8bbf\u95ee\uff0c\u6240\u4ee5\u5fc5\u987b\u4fdd\u8bc1\u6240\u6709 node \u7684\u8fd9\u4e2a\u7aef\u53e3\u6ca1\u88ab\u5360\u7528\n      protocol: TCP\n</code></pre> <pre><code>\u5728\u96c6\u7fa4\u5916\u90e8\u5c31\u53ef\u4ee5\u4f7f\u7528: http://172.16.100.102:30080 \u6765\u8bbf\u95ee\u8fd9\u4e2a service \u5730\u5740\u4e86\n</code></pre> <pre><code>\u5728\u96c6\u7fa4\u5185\u53ef\u4ee5\u4f7f\u7528 service \u7684\u57df\u540d\u5728 coredns \u4e0a\u89e3\u6790\u5f97\u5230 service \u5730\u5740: dig -t A myapp.default.svc.cluster.local @10.96.0.10\n</code></pre>"},{"location":"k8s/note/chapter-8/#88-loadbalancerip","title":"8.8 loadBalancerIP \u7c7b\u578b","text":"<p>service \u5728\u6bcf\u53f0\u4e3b\u673a\u7684 iptables/ipvs \u89c4\u5219\u5185\uff0c\u8bbf\u95ee\u4efb\u610f\u4e00\u53f0 node \u90fd\u53ef\u4ee5\u5230\u8fbe pod\uff0c\u6240\u4ee5\u5e94\u8be5\u5728\u8fd9\u4e9b nodeip \u524d\u52a0\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5982\u679c\u5de5\u4f5c\u5728\u516c\u6709\u4e91\uff0c\u53ef\u4ee5\u4f7f\u7528 k8s \u5185\u7f6e\u7684 loadBalancerIP\uff0c\u64cd\u4f5c\u516c\u6709\u4e91\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u5373\u670d\u52a1\uff0c\u5b9e\u73b0\u52a8\u6001\u7684\u589e\u5220\u3002</p> <p>\u53ef\u4ee5\u7406\u89e3\u4e3a loadBalancerIP \u589e\u5f3a\u4e86 NodePort \u7c7b\u578b\u7684 service \uff0c\u5728\u96c6\u7fa4\u5916\u90e8\u5bf9\u6bcf\u53f0 nodeip \u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u3002</p>"},{"location":"k8s/note/chapter-8/#89-service","title":"8.9 \u65e0\u96c6\u7fa4\u5730\u5740\u7684 Service","text":"<p>\u65e0\u5934 service \u8868\u793a service \u6ca1\u6709 ClusterIP \u4e5f\u4e0d\u6620\u5c04 NodePort\uff0c\u800c\u662f\u5c06 service \u7684\u57df\u540d\u76f4\u63a5\u89e3\u6790\u4e3a nodeIP \u4ece\u800c\u76f4\u63a5\u8bbf\u95ee nodeIP \u4e0a\u7684 POD\u3002</p> <ul> <li>\u6e05\u5355\u793a\u4f8b</li> </ul> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: myapp-nohead\n  namespace: default\nspec:\n  selector:\n    app: myapp-nohead\n    release: canary\n  type: ClusterIP\n  clusterIP: None\n  ports:\n    - port: 80         # service \u7aef\u53e3\n      targetPort: 80   # pod \u76d1\u542c\u7684\u7aef\u53e3\n</code></pre> <ul> <li>\u67e5\u770b CoreDNS \u670d\u52a1\u5668\u7684\u5730\u5740</li> </ul> <pre><code>kubectl get svc -n kube-system\n</code></pre> <ul> <li>\u5728\u96c6\u7fa4\u5185\u4f7f\u7528 CoreDNS \u7684\u5730\u5740\u89e3\u6790\u65e0\u5934\u7684 serive \u57df\u540d\uff0c\u5f97\u5230\u7684\u76f4\u63a5\u4e3a nodeip \u4e2d\u7684 pod \u5730\u5740\uff0c\u5229\u7528 dns \u7684\u591a\u6761 A \u8bb0\u5f55\u6765\u8d1f\u8f7d\u5747\u8861</li> </ul> <pre><code>dig -t A myapp-nohead.default.svc.cluster.local. @10.96.0.10\n</code></pre> <pre><code>;; ANSWER SECTION:\nmyapp-nohead.default.svc.cluster.local. 5 IN A  10.244.1.75\nmyapp-nohead.default.svc.cluster.local. 5 IN A  10.244.2.74\n</code></pre>"},{"location":"k8s/note/chapter-8/#810-externalname","title":"8.10 externalName \u7c7b\u578b","text":"<p>\u5f53 POD \u9700\u8981\u8bbf\u95ee\u4e00\u4e2a\u96c6\u7fa4\u5916\u90e8\u7684\u670d\u52a1\u65f6\u5019\uff0cexternalName \u53ef\u4ee5\u6620\u5c04\u4e00\u4e2a\u96c6\u7fa4\u5916\u90e8\u7684\u670d\u52a1\u5230\u96c6\u7fa4\u5185\u90e8\uff0c\u4f9b\u96c6\u7fa4\u5185 POD \u8bbf\u95ee\u3002</p> <p>\u5c31\u662f\u628a\u5916\u90e8\u7684\u4e00\u4e2a\u57df\u540d\u5730\u5740\uff0c\u6620\u5c04\u4e3a\u96c6\u7fa4\u5185\u90e8 coredns \u89e3\u6790\u7684\u4e00\u4e2a\u5185\u90e8\u5730\u5740\uff0c\u63d0\u4f9b\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee\u3002</p>"},{"location":"k8s/note/chapter-9/","title":"\u4e5d ingress \u63a7\u5236\u5668","text":"<p>\u5982\u679c k8s \u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u7f51\u7ad9\uff0c\u5e76\u4e14\u8fd9\u4e2a\u7ad9\u70b9\u9700\u8981\u4ee5 https \u8bbf\u95ee\uff0c\u800c iptables/ipvs \u5de5\u4f5c\u5728 4 \u5c42\uff0c\u5ba2\u6237\u53d1\u51fa\u7684 ssl \u8bf7\u6c42\u6839\u672c\u4e0d\u88ab\u89e3\u6790\u5c31\u88ab\u8c03\u5ea6\u5230\u540e\u7aef POD\u4e86\u3002\u89e3\u51b3\u65b9\u6cd5\u6709\u4e24\u4e2a\uff1a</p> <ol> <li> <p>\u53ef\u4ee5\u5728\u516c\u6709\u4e91\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u4e0a\u914d\u7f6e\u4e0a ssl \u8bc1\u4e66\u3002</p> </li> <li> <p>\u65b0\u5efa\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668\u7684 POD \uff0c\u4f8b\u5982 nignx \uff0c\u8fd9\u4e2a POD \u5171\u4eab\u4e3b\u673a\u7684\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 nodeip \u8bbf\u95ee\u5230\u8d1f\u8f7d\u5747\u8861\u5668\uff0cssl \u8bc1\u4e66\u914d\u7f6e\u5728\u8fd9\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668\u4e0a\uff0c\u5bf9\u5916\u8fde\u63a5\u4e3a https \u800c\u5bf9\u5185\u7684\u4ee3\u7406\u4e3a http \u534f\u8bae\u5230 POD \u7f51\u7edc\u7684 POD \u4e0a\u3002</p> </li> <li> <p>\u5b58\u5728\u7684\u95ee\u9898</p> </li> </ol> <pre><code>- \u8d1f\u8f7d\u5747\u8861\u5668 POD \u4f7f\u7528\u8282\u70b9\u7684\u7f51\u7edc\u540d\u79f0\u7a7a\u95f4, \u90a3\u4e48\u5b83\u53ea   \u80fd\u5728\u8fd9\u4e2a node \u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2a\u4e86,\u5426\u5219\u5c31\u51fa\u73b0\u7aef\u53e3\u51b2\u7a81\n- \u8d1f\u8f7d\u5747\u8861\u5668\u662f\u4ee3\u7406 POD \u5378\u8f7d ssl \u8bc1\u4e66\u7684\u5173\u952e\u8282\u70b9, \u5b83\u4e0d\u80fd\u53ea\u8fd0\u884c\u4e00\u4e2a, \u5b83\u9700\u8981\u5728\u6240\u6709\u8282\u70b9\u8fd0\u884c\u4e00\u4e2a\n</code></pre> <ul> <li>\u89e3\u51b3\u65b9\u6cd5</li> </ul> <pre><code>- \u8d1f\u8f7d\u5747\u8861\u5668\u4f7f\u7528 DaemonSet \u5728\u6bcf\u4e2a node \u8282\u70b9\u8fd0\u884c\u4e00\u4e2a,\u4ee3\u7406\u8bf7\u6c42\u81f3 POD \u7f51\u7edc\u7684\u4e2d\u7684 POD \u4e0a\n- \u5982\u679c\u96c6\u7fa4\u8282\u70b9\u975e\u5e38\u7684\u591a,\u5176\u5b9e\u4e0d\u5fc5\u5728\u6bcf\u4e2a node \u8282\u70b9\u90fd\u5fc5\u987b\u8fd0\u884c\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668 POD\n- \u63a7\u5236\u8d1f\u8f7d\u5747\u8861\u5668 POD \u8fd0\u884c\u7684\u6570\u91cf\u53ef\u4ee5\u901a\u8fc7 lables \u6307\u5b9a\u8fd0\u884c\u90a3\u51e0\u4e2a node \u8282\u70b9\u4e0a\n- \u7136\u540e\u53ef\u4ee5\u5728\u8d1f\u8f7d\u5747\u8861\u5668 POD \u6240\u5728\u7684 node \u8282\u70b9\u4e0a\u6253\u4e0a \"\u6c61\u70b9\" \u4f7f\u5176\u4ed6\u7684 POD \u4e0d\u4f1a\u518d\u88ab\u8c03\u5ea6\u4e0a\u6765, \u800c\u53ea\u6709\u8d1f\u8f7d\u5747\u8861\u5668 POD \u53ef\u4ee5\u5bb9\u5fcd\u8fd9\u4e9b \"\u6c61\u70b9\"\n</code></pre> <ul> <li>\u8d1f\u8f7d\u5747\u8861\u5668\u53ef\u9009\uff0c\u6309\u7167\u4f18\u5148\u7ea7\u5148\u540e\u6392\u5e8f</li> </ul> <pre><code>Envoy            # \u4e91\u539f\u751f\u9ad8\u6027\u80fd\u670d\u52a1\u4ee3\u7406,\u5df2\u4ececncf\u6bd5\u4e1a\nTraefik          # \u4e3a\u5fae\u670d\u52a1\u800c\u751f\u7684\u53cd\u5411\u4ee3\u7406\nNginx            # \u6539\u9020\u540e\u53ef\u4ee5\u9002\u7528\u4e8e\u5fae\u670d\u52a1\u73af\u5883\nHAproxy          # \u4e0d\u63a8\u8350\u4f7f\u7528\n</code></pre> <p>\u65b0\u5efa\u4e00\u4e2a service \u5c06\u9700\u8981\u4ee3\u7406\u7684\u4e0d\u540c\u670d\u52a1\u7684 pod \u5206\u7c7b</p> <p>\u65b0\u5efa\u4e00\u4e2a ingress \u8d44\u6e90\uff0c\u4ece service \u4e2d\u53d6\u5f97\u5206\u7c7b\u7ed3\u679c\uff0c\u6620\u5c04\u8fdb Envoy \u4e2d\uff0c\u91cd\u8f7d Envoy \u8f6f\u4ef6\u3002</p>"},{"location":"k8s/note/chapter-9/#91-ingressspec","title":"9.1 ingress.spec \u89c4\u8303","text":"<ul> <li>API \u548c kind</li> </ul> <pre><code>apiVersion: extensions\n\nkind: ingress\n</code></pre> <ul> <li>ingress.spec</li> </ul> <pre><code>backend         # \u540e\u7aef\u6709\u54ea\u4e9b POD\nrules           # \u8c03\u5ea6\u89c4\u5219\n    host        # \u865a\u62df\u4e3b\u673a\n    http        # http \u8def\u5f84\n</code></pre>"},{"location":"k8s/note/chapter-9/#92-ingress-nginx","title":"9.2 ingress-nginx \u4ee3\u7406","text":"<ul> <li>\u540e\u7aef service \u548c pods</li> </ul> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: service-ingress-myapp\n  namespace: default\nspec:\n  selector:\n    app: myapp\n    release: canary\n  ports:\n    - name: http\n      port: 80\n      targetPort: 80\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp\n  namespace: default\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: myapp\n      release: canary\n  template:\n    metadata:\n      labels:\n        app: myapp\n        release: canary\n    spec:\n      containers:\n        - name: myapp\n          image: ikubernetes/myapp:v2\n          ports:\n            - name: http\n              containerPort: 80\n</code></pre> <ul> <li>\u521b\u5efa ingress-nginx</li> </ul> <pre><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.21.0/deploy/mandatory.yaml\n</code></pre> <ul> <li>\u8ba9 ingress-nginx \u5728\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee</li> </ul> <pre><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.21.0/deploy/provider/baremetal/service-nodeport.yaml\n</code></pre> <ul> <li>\u521b\u5efa ingress \u5bf9\u8c61\uff0c\u5b83\u80fd\u5c06 ingress-nginx \u4e0e service \u5173\u8054\uff0c\u4ece\u800c\u5728 service \u540e\u4e3b\u673a\u53d1\u751f\u53d8\u52a8\u7684\u65f6\u5019\uff0c\u53cd\u5e94\u5728 ingress-nginx \u8fd9\u4e2a\u5bb9\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d</li> </ul> <pre><code>apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-deploy-myapp\n  namespace: default\n  annotations:\n    kubernetes.io/ingress.class: \"nginx\"\nspec:\n  rules:\n    - host: myapp.kaliarch.com                       # \u57fa\u4e8e\u4e3b\u673a\u540d\u7684\u8bbf\u95ee\n      http:\n        paths:\n          - path:                                   # \u7a7a\u7684\u65f6\u5019\u4ee3\u8868\u6839\uff0c\u8bbf\u95ee\u6839\u7684\u65f6\u5019\u6620\u5c04\u5230 backend\n            backend:                                # \u540e\u7aef\u7684 service \u7684\u914d\u7f6e\n              serviceName: service-ingress-myapp    # \u5173\u8054 service \u4ece\u800c\u83b7\u53d6\u5230\u540e\u7aef\u4e3b\u673a\u7684\u53d8\u52a8\n              servicePort: 80                       # \u5173\u8054 service \u7684\u5730\u5740\n</code></pre> <ul> <li>\u67e5\u770b ingress-nginx \u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\uff0c\u8fd9\u91cc\u4e3a30080\uff0c\u548c 30443 \u4e24\u4e2a</li> </ul> <pre><code>kubectl get service -n ingress-nginx\n</code></pre> <ul> <li>\u4f7f\u7528 nodeip + ingress-nginx \u66b4\u9732\u7aef\u53e3\u8bbf\u95ee\uff0c\u7531\u4e8e\u4e0a\u9762\u521b\u5efa\u7684 ingress \u4e3a\u57fa\u4e8e\u4e3b\u673a\u540d\u79f0\u7684\uff0c\u6240\u4ee5\u9700\u8981\u5728\u8bbf\u95ee\u65f6\u5728 /etc/hosts \u505a\u597d\u6620\u5c04\u5230 node\u3002</li> </ul> <pre><code>http://myapp.kaliarch.com:30080/index.html  \n</code></pre>"},{"location":"k8s/note/chapter-9/#93-ingress-tomcat","title":"9.3 ingress-tomcat \u4ee3\u7406","text":"<ul> <li>\u540e\u7aef service \u548c pods</li> </ul> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: service-ingress-tomcat\n  namespace: default\nspec:\n  selector:\n    app: tomcat\n    release: canary\n  ports:\n    - name: http\n      port: 8080\n      targetPort: http\n    - name: ajp\n      port: 8009\n      targetPort: ajp\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: deploy-tomcat\n  namespace: default\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: tomcat\n      release: canary\n  template:\n    metadata:\n      labels:\n        app: tomcat\n        release: canary\n    spec:\n      containers:\n        - name: tomcat\n          image: tomcat:8.5.32-jre8-alpine\n          ports:\n            - name: http\n              containerPort: 8080\n            - name: ajp\n              containerPort: 8009\n</code></pre> <ul> <li>\u5236\u4f5c\u81ea\u7b7e\u540d\u8bc1\u4e66\uff0c\u8ba9 ingress-nginx \u5e26\u6709\u8bc1\u4e66\u6765\u8bbf\u95ee</li> </ul> <pre><code># \u751f\u6210 key\nopenssl genrsa -out tls.key 2048\n\n# \u751f\u6210\u81ea\u7b7e\u8bc1\u4e66\uff0cCN=\u57df\u540d\u5fc5\u987b\u8981\u4e0e\u81ea\u5df1\u7684\u57df\u540d\u5b8c\u5168\u4e00\u81f4\nopenssl req -new -x509 -key tls.key -out tls.crt -subj /C=CN/ST=Beijing/L=Beijing/O=DevOps/CN=tomcat.kaliarch.com\n</code></pre> <ul> <li>\u521b\u5efa secret \u8bc1\u4e66\u5bf9\u8c61\uff0c\u5b83\u662f\u6807\u51c6\u7684 k8s \u5bf9\u8c61</li> </ul> <pre><code>kubectl create secret tls tomcat-ingress-secret --cert=tls.crt --key=tls.key\n</code></pre> <ul> <li>\u521b\u5efa\u5e26\u8bc1\u4e66\u7684 ingress \u5bf9\u8c61\uff0c\u5b83\u80fd\u5c06 ingress-tomcat \u4e0e service \u5173\u8054\uff0c\u4ece\u800c\u5728 service \u540e\u4e3b\u673a\u53d1\u751f\u53d8\u52a8\u7684\u65f6\u5019\uff0c\u53cd\u5e94\u5728 ingress-tomcat \u8fd9\u4e2a\u5bb9\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d</li> </ul> <pre><code>apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-deploy-tomcat-tls\n  namespace: default\n  annotations:\n    kubernetes.io/ingress.class: \"nginx\"\nspec:\n  tls:\n    - hosts:\n      - tomcat.kaliarch.com\n      secretName: tomcat-ingress-secret\n  rules:\n    - host: tomcat.kaliarch.com\n      http:\n        paths:\n          - path:\n            backend:\n              serviceName: service-ingress-tomcat\n              servicePort: 8080\n</code></pre> <ul> <li>\u67e5\u770b ingress-nginx \u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\uff0c\u8fd9\u91cc\u4e3a30080\uff0c\u548c 30443 \u4e24\u4e2a</li> </ul> <pre><code>kubectl get service -n ingress-nginx\n</code></pre> <ul> <li>\u4f7f\u7528 nodeip + ingress-nginx \u66b4\u9732\u7aef\u53e3\u8bbf\u95ee\uff0c\u7531\u4e8e\u4e0a\u9762\u521b\u5efa\u7684 ingress \u4e3a\u57fa\u4e8e\u4e3b\u673a\u540d\u79f0\u7684\uff0c\u6240\u4ee5\u9700\u8981\u5728\u8bbf\u95ee\u65f6\u5728 /etc/hosts \u505a\u597d\u6620\u5c04\u5230 node\u3002</li> </ul> <pre><code>https://tomcat.kaliarch.com:30443\n</code></pre>"},{"location":"k8s/samples/aaaaa/","title":"bbbbbbbbbbbbbbbbbbbbbbb","text":"<p>title: \"2021\" date: 2022-03-11T23:02:20+08:00 tags: ['PDF','Vedio'] ShowToc: true #\u663e\u793a\u76ee\u5f55 TocOpen: true  #\u9ed8\u8ba4\u6253\u5f00 draft: true</p> <p>title: '\u3010AIGC\u3011First' date: 2024-03-15T23:02:20+08:00 draft: false tags: [\"html\",\"css\"] categories: ['tech']</p>","tags":["PDF","Vedio"]},{"location":"k8s/samples/aaaaa/#this-a-heading-one","title":"This a heading one!","text":"","tags":["PDF","Vedio"]},{"location":"k8s/samples/aaaaa/#this-a-head-two","title":"This a head two!","text":"<p>This is the paragraph!</p>","tags":["PDF","Vedio"]},{"location":"k8s/samples/demo/","title":"Demo","text":"<p>Hover me</p> <p>Hover me</p>"},{"location":"k8s/samples/demo/#abc","title":"abc","text":"<p>\u5e26\u6709\u5de5\u5177\u63d0\u793a\u7684\u56fe\u6807 </p> <p>Note</p> <p>saasd; asdasd </p> Note <p>saasd; asdasd </p> <p>The HTML specification is maintained by the W3C.</p> <p>Lorem ipsum dolor sit amet, (1) consectetur adipiscing elit.</p> <ol> <li> I'm an annotation! I can contain <code>code</code>, formatted     text, images, ... basically anything that can be expressed in Markdown.</li> </ol> <p>Lorem ipsum dolor sit amet, (1) consectetur adipiscing elit.</p> <ol> <li> <p> I'm an annotation!\u554a\u554a\u554a (1)</p> <ol> <li> I'm an annotation as well!\u554a\u554a\u554a\u554a</li> </ol> </li> </ol> Tab 1Tab 2 <p>Lorem ipsum dolor sit amet, (1) consectetur adipiscing elit.</p> <ol> <li> I'm an annotation!</li> </ol> <p>Phasellus posuere in sem ut cursus (1)</p> <ol> <li> I'm an annotation as well!</li> </ol> <p>abc</p> Tab 1Tab 2 <p>Lorem ipsum dolor sit amet, (1) consectetur adipiscing elit.</p> <ol> <li> I'm an annotation!</li> </ol> <p>Phasellus posuere in sem ut cursus (1)</p> <ol> <li> I'm an annotation as well!</li> </ol> <ul> <li> HTML for content and structure</li> <li> JavaScript for interactivity</li> <li> CSS for text running out of boxes</li> <li> Internet Explorer ... huh?</li> </ul> <p>The <code>range()</code> function is used to generate a sequence of numbers.</p> .browserslistrc<pre><code>\n</code></pre> <p>abc   --8&lt;-- \"demo.md:93:109\"</p> <p>Example</p> Unordered ListOrdered List <pre><code>* Sed sagittis eleifend rutrum\n* Donec vitae suscipit est\n* Nulla tempor lobortis orci\n</code></pre> <pre><code>1. Sed sagittis eleifend rutrum\n2. Donec vitae suscipit est\n3. Nulla tempor lobortis orci\n</code></pre> <p>Attribute Lists</p> <p>nav:     -Home:         - \"index.md\"     k8s:         - \"./kubernetes/demo.md\"</p>"},{"location":"k8s/samples/demo/#attribute-lists","title":"attribute-lists","text":"<p>sdadfasdfassd</p> <p>Please see the project license  for further details.</p> <p>Hover me</p>"},{"location":"k8s/samples/math/","title":"Math","text":"<p>+++ title = 'Math' date = 2024-03-17T12:37:43+08:00 draft = false math = true comments= true +++</p> <p>\u884c\u4e2d\u516c\u5f0f\u793a\u4f8b: $\\sum_{i=0}^n i^2 = \\frac{(n^2+n)(2n+1)}{6}$</p> <p>$\\sum_{i=0}^n i^2 = \\frac{(n^2+n)(2n+1)}{6} $ \u72ec\u7acb\u516c\u5f0f\u793a\u4f8b\uff1a$$\\sum_{i=0}^n i^2 = \\frac{(n^2+n)(2n+1)}{6}$$</p> <ol> <li>\u4fee\u6539extend_head.html \u4ee5\u4e0b\u90fd\u4ee5\u7f51\u7ad9\u6839\u76ee\u5f55\u4f5c\u4e3a\u5f53\u524d\u8def\u5f84\u8fdb\u884c\u8bf4\u660e:\uff1a</li> </ol> <p>\u5982\u679clayouts/partials/extend_head.html\u5b58\u5728\uff0c\u5219\u76f4\u63a5\u5728\u6700\u540e\u8fdb\u884c\u6dfb\u52a0\uff1b\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u65b0\u5efa\u8be5\u8def\u5f84\u5e76\u590d\u5236\u6307\u5b9a\u6587\u4ef6\u5230\u8be5\u76ee\u5f55\u8fdb\u884c\u7f16\u8f91\u3002\u547d\u4ee4\u5982\u4e0b\uff1a <pre><code>adddads=23\n</code></pre></p> <ol> <li>\u4f7f\u7528\u65b9\u6cd5 \u5728\u8981\u7528\u6570\u5b66\u516c\u5f0f\u7684\u6587\u7ae0\u7684front matter\u6dfb\u52a0\u5982\u4e0b\u5b57\u6bb5\u5373\u53ef\u4f7f\u7528\uff1a</li> </ol> <p>math: true # \u662f\u5426\u5f00\u542fmathjax \u540c\u65f6\u53ef\u4ee5\u5728archetypes/defaults.md\u91cc\u52a0\u5165\u4e0a\u9762\u7684\u8bbe\u7f6e\uff0c\u8fd9\u6837\u6bcf\u6b21\u521b\u5efa\u65b0\u6587\u7ae0\u65f6\u90fd\u4f1a\u81ea\u52a8\u6dfb\u52a0\u8be5\u5b57\u6bb5\u3002\u53e6\u5916\u5c06true\u6539\u4e3afalse\uff0c\u5373\u53ef\u5728\u8be5\u6587\u7ae0\u4e2d\u5173\u95ed\u6570\u5b66\u516c\u5f0f\u529f\u80fd\u3002</p> <p>\u4f7f\u7528\u683c\u5f0f\u548cMarkdown\u6570\u5b66\u516c\u5f0f\u7684\u683c\u5f0f\u4e00\u6837\uff0c\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\u5b58\u5728\u8f6c\u4e49\u7684\u5b57\u7b26\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff0c\u8f6c\u4e49*\u5199\u4f5c*\u3002</p> <p>$$0.414213562373095048\\approx6*16<sup>{-1}+a*16</sup>+\\cdots$$ 0.414213562373095048 \u2248 6 \u2217 1 6 \u2212 1 + \ufffd \u2217 1 6 \u2212 2 + 0 \u2217 1 6 \u2212 3 + \u22ef 0.414213562373095048\u22486\u221716  \u22121  +a\u221716  \u22122  +0\u221716  \u22123  +\u22ef}+0*16^{-3</p> <p>\u5f15\u7528 How to enable Math Typesetting in PaperMod? Auto-render Extension \u5efa\u7ad9</p> <p>Hugo \u00ab \u4e0a\u4e00\u9875 Hugo\u4e22\u5931css\u5bfc\u81f4\u663e\u793a\u5f02\u5e38\u95ee\u9898\u89e3\u51b3 \u4e0b\u4e00\u9875 \u00bb SHA\u6d88\u606f\u6458\u8981 \u00a9 2023 3rd's Blog Powered by Hugo &amp; PaperMod <pre><code>ssddsd=230\nex():\n    dd=1;\n</code></pre></p> <p>\u672c\u624b\u518c\u7684\u4e3b\u8981\u5185\u5bb9\u6765\u81ea mathjax-basic-tutorial-and-quick-reference.</p> <p>FREEOPEN</p> <p>\u8bc4\u8bba\u7cfb\u7edf\u53c2\u8003\u94fe\u63a5</p>"},{"location":"k8s/samples/ppt_blibli_youtube/","title":"This a heading one!","text":"","tags":["PDF","Vedio"]},{"location":"k8s/samples/ppt_blibli_youtube/#this-a-head-two","title":"This a head two!","text":"<p>This is the paragraph!</p> <p>{{}}","tags":["PDF","Vedio"]},{"location":"k8s/samples/ppt_blibli_youtube/#a-ppt-srcppt","title":"{a{&lt; ppt src=\"ppt\u7f51\u5740\" &gt;}}","text":"","tags":["PDF","Vedio"]},{"location":"k8s/samples/ppt_blibli_youtube/#a","title":"\u4f7f\u7528\u7684\u65f6\u5019\u628a\u5b57\u6bcda\u53bb\u6389\uff0c\u6211\u52a0\u4e0a\u662f\u4e3a\u4e86\u9632\u6b62\u88ab\u8bc6\u522b\u751f\u6548","text":"<p>{{}} BV122421K7RZ \u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014 {{}}   <p>\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014 \u7248\u6743\u58f0\u660e\uff1a\u672c\u6587\u4e3a\u300cSulv's Blog\u300d\u7684\u539f\u521b\u6587\u7ae0\uff0c\u9075\u5faaCC 4.0 BY-SA\u7248\u6743\u534f\u8bae\uff0c\u8f6c\u8f7d\u8bf7\u9644\u4e0a\u539f\u6587\u51fa\u5904\u94fe\u63a5\u53ca\u672c\u58f0\u660e\u3002 \u539f\u6587\u94fe\u63a5\uff1ahttps://www.sulvblog.cn/posts/blog/shortcodes/#62-bilibili-%e8%a7%86%e9%a2%91 \u7248\u6743\u58f0\u660e\uff1a\u672c\u6587\u4e3a\u300cSulv's Blog\u300d\u7684\u539f\u521b\u6587\u7ae0\uff0c\u9075\u5faaCC 4.0 BY-SA\u7248\u6743\u534f\u8bae\uff0c\u8f6c\u8f7d\u8bf7\u9644\u4e0a\u539f\u6587\u51fa\u5904\u94fe\u63a5\u53ca\u672c\u58f0\u660e\u3002 \u539f\u6587\u94fe\u63a5\uff1ahttps://www.sulvblog.cn/posts/blog/shortcodes/</p>","tags":["PDF","Vedio"]},{"location":"k8s/samples/second/","title":"This a heading one!","text":""},{"location":"k8s/samples/second/#this-a-head-two","title":"This a head two!","text":"<p>This is the paragraph!a</p>"},{"location":"blog/archive/2024/","title":"2024","text":""},{"location":"blog/archive/2021/","title":"2021","text":""},{"location":"blog/category/k8s/","title":"k8s","text":""},{"location":"blog/category/linux/","title":"Linux","text":""},{"location":"blog/page/2/","title":"My awsome Blogs, welcome!","text":""},{"location":"blog/page/3/","title":"My awsome Blogs, welcome!","text":""},{"location":"blog/archive/2024/page/2/","title":"2024","text":""},{"location":"blog/archive/2024/page/3/","title":"2024","text":""},{"location":"blog/category/k8s/page/2/","title":"k8s","text":""}]}