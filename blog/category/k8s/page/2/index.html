
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../linux/">
      
      
        <link rel="next" href="../../../../archive/2024/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>k8s - My Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 13c.7 0 1.37.13 2 .35V9l-6-6H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h8.35c-.22-.63-.35-1.3-.35-2 0-3.31 2.69-6 6-6m-5-8.5 5.5 5.5H14V4.5m8.5 12.75L17.75 22 15 19l1.16-1.16 1.59 1.59 3.59-3.59 1.16 1.41Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#k8s" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="My Notes" class="md-header__button md-logo" aria-label="My Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4c-1.92 0-3.5 1.58-3.5 3.5 0 .93.38 1.78 1 2.41-1.53 1-2.5 2.71-2.5 4.59 0 3.03 2.47 5.5 5.5 5.5 1.76 0 3.5-.46 5-1.34l-1-1.73c-1.22.7-2.6 1.07-4 1.07-1.94 0-3.5-1.55-3.5-3.5a3.49 3.49 0 0 1 2.59-3.38l5.21-1.4-.52-1.93L11.83 9c-.75-.1-1.33-.72-1.33-1.5 0-.84.66-1.5 1.5-1.5.26 0 .5.07.75.2l1-1.73C13.22 4.16 12.61 4 12 4Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              k8s
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to Auto mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to Auto mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/squidfunk/mkdocs-material" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    squidfunk/mkdocs-material
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../.." class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../AIGC/" class="md-tabs__link">
          
  
    
  
  AIGC

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../k8s/" class="md-tabs__link">
          
  
    
  
  Kubernetes

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="My Notes" class="md-nav__button md-logo" aria-label="My Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4c-1.92 0-3.5 1.58-3.5 3.5 0 .93.38 1.78 1 2.41-1.53 1-2.5 2.71-2.5 4.59 0 3.03 2.47 5.5 5.5 5.5 1.76 0 3.5-.46 5-1.34l-1-1.73c-1.22.7-2.6 1.07-4 1.07-1.94 0-3.5-1.55-3.5-3.5a3.49 3.49 0 0 1 2.59-3.38l5.21-1.4-.52-1.93L11.83 9c-.75-.1-1.33-.72-1.33-1.5 0-.84.66-1.5 1.5-1.5.26 0 .5.07.75.2l1-1.73C13.22 4.16 12.61 4 12 4Z"/></svg>

    </a>
    My Notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/squidfunk/mkdocs-material" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    squidfunk/mkdocs-material
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Home
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../AIGC/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    AIGC
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            AIGC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../AWS/ai/1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ai
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../AIGC/amazon_bedrock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Amazon Bedrock
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../k8s/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.Kubernetes概述
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.核心组件/附件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. 集群部署
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. 入门命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. 配置清单使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. POD 配置清单
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. 控制器配置清单
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Service 配置清单
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. ingress 控制器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. POD 存储卷
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11. 配置信息容器化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12. StatefulSet 控制器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13. 用户认证系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14. 用户权限系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15. dashboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16. 网络通信
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-17/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17. 调度策略
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-18/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18. 高级调度设置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-19/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19. 容器资源限制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-20/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    20. HeapSter监控（废弃中）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-21/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21. 新一代监控架构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-22/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    22. K8S包管理器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    23. ETCD详解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/note/chapter-24/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    24. 国产容器管理平台KubeSphere实战排错
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    随笔
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            随笔
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../k8s/exp/1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
      
    
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    k8s
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="../../" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    k8s
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#k8s-troubleshooting-error-scale" class="md-nav__link">
    <span class="md-ellipsis">
      k8s troubleshooting error scale
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-troubleshooting-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      k8s troubleshooting Ingress
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-resources-schedule" class="md-nav__link">
    <span class="md-ellipsis">
      k8s Resources Schedule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-podprobe" class="md-nav__link">
    <span class="md-ellipsis">
      k8s PodProbe
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-pod-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      k8s Pod Lifecycle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-cluster-kubeadm" class="md-nav__link">
    <span class="md-ellipsis">
      K8s cluster -- kubeadm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-pod" class="md-nav__link">
    <span class="md-ellipsis">
      K8s Pod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-resources-classifcation" class="md-nav__link">
    <span class="md-ellipsis">
      k8s Resources Classifcation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-api-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      K8s Api Annotation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-command-line-kubectl" class="md-nav__link">
    <span class="md-ellipsis">
      K8s Command Line - kubectl
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#k8s-troubleshooting-error-scale" class="md-nav__link">
    <span class="md-ellipsis">
      k8s troubleshooting error scale
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-troubleshooting-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      k8s troubleshooting Ingress
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-resources-schedule" class="md-nav__link">
    <span class="md-ellipsis">
      k8s Resources Schedule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-podprobe" class="md-nav__link">
    <span class="md-ellipsis">
      k8s PodProbe
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-pod-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      k8s Pod Lifecycle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-cluster-kubeadm" class="md-nav__link">
    <span class="md-ellipsis">
      K8s cluster -- kubeadm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-pod" class="md-nav__link">
    <span class="md-ellipsis">
      K8s Pod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-resources-classifcation" class="md-nav__link">
    <span class="md-ellipsis">
      k8s Resources Classifcation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-api-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      K8s Api Annotation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k8s-command-line-kubectl" class="md-nav__link">
    <span class="md-ellipsis">
      K8s Command Line - kubectl
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="k8s">k8s</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-04-26 00:00:00">April 26, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-troubleshooting-error-scale"><a class="toclink" href="../../../../2024/04/26/k8s-troubleshooting-error-scale/">k8s troubleshooting error scale</a></h2>
<h3 id="scale"><a class="toclink" href="../../../../2024/04/26/k8s-troubleshooting-error-scale/#scale">不明原因scale扩容失败，容器起不来</a></h3>
<div class="language-markdown highlight"><span class="filename">Problem</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>[root@k8s-master ~]# kubectl get rs,po
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>NAME                                      DESIRED   CURRENT   READY   AGE
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>replicaset.apps/nginx-deploy-548d7bc8bc   1         1         0       16m
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>replicaset.apps/nginx-deploy-5f44797d7f   1         1         0       13m
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>replicaset.apps/nginx-deploy-674dcdf579   2         2         2       17h
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>replicaset.apps/nginx-deploy-f7f5656c7    0         0         0       17h
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>NAME                                READY   STATUS              RESTARTS   AGE
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>pod/my-nginx                        1/1     Running             0          19h
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>pod/nginx-deploy-548d7bc8bc-pfhmn   0/1     ContainerCreating   0          16m
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>pod/nginx-deploy-5f44797d7f-jtmsd   0/1     ContainerCreating   0          13m
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>pod/nginx-deploy-674dcdf579-5gvbw   1/1     Running             0          17h
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>pod/nginx-deploy-674dcdf579-l79w8   1/1     Running             0          17h
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>pod/nginx-deploy-674dcdf579-t979q   0/1     Terminating         0          26m
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>[root@k8s-master ~]# kubectl edit deploy nginx-deploy
</code></pre></div>
<details class="pod_describe-nginx-deploy-548d7bc8bc-pfhmn">
<summary>Pod_describe-nginx-deploy-548d7bc8bc-pfhmn</summary>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master ~</span><span class="p p-Indicator">]</span><span class="c1"># kubectl describe pod/nginx-deploy-548d7bc8bc-pfhmn</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nt">Name</span><span class="p">:</span><span class="w">           </span><span class="l l-Scalar l-Scalar-Plain">nginx-deploy-548d7bc8bc-pfhmn</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nt">Namespace</span><span class="p">:</span><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="nt">Priority</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="nt">Node</span><span class="p">:</span><span class="w">           </span><span class="l l-Scalar l-Scalar-Plain">k8s-node1/10.0.0.101</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="nt">Start Time</span><span class="p">:</span><span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">Thu, 25 Apr 2024 22:10:19 -0400</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="nt">Labels</span><span class="p">:</span><span class="w">         </span><span class="l l-Scalar l-Scalar-Plain">app=nginx-deploy</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">                </span><span class="l l-Scalar l-Scalar-Plain">pod-template-hash=548d7bc8bc</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="nt">Annotations</span><span class="p">:</span><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="nt">Status</span><span class="p">:</span><span class="w">         </span><span class="l l-Scalar l-Scalar-Plain">Pending</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="nt">IP</span><span class="p">:</span><span class="w">             </span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="nt">IPs</span><span class="p">:</span><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="nt">Controlled By</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ReplicaSet/nginx-deploy-548d7bc8bc</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="nt">Containers</span><span class="p">:</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="nt">nginx</span><span class="p">:</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="nt">Container ID</span><span class="p">:</span><span class="w">   </span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">    </span><span class="nt">Image</span><span class="p">:</span><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.25.5</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">    </span><span class="nt">Image ID</span><span class="p">:</span><span class="w">       </span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">    </span><span class="nt">Port</span><span class="p">:</span><span class="w">           </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">    </span><span class="nt">Host Port</span><span class="p">:</span><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="w">    </span><span class="nt">State</span><span class="p">:</span><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">Waiting</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="w">    </span><span class="nt">Reason</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">ContainerCreating</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="w">    </span><span class="nt">Ready</span><span class="p">:</span><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="w">    </span><span class="nt">Restart Count</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="w">    </span><span class="nt">Requests</span><span class="p">:</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="w">    </span><span class="nt">cpu</span><span class="p">:</span><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">128Mi</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="w">    </span><span class="nt">Environment</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="w">    </span><span class="nt">Mounts</span><span class="p">:</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">/var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-v5qt4 (ro)</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="nt">Conditions</span><span class="p">:</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="l l-Scalar l-Scalar-Plain">Type              Status</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="l l-Scalar l-Scalar-Plain">Initialized       True</span><span class="w"> </span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="l l-Scalar l-Scalar-Plain">Ready             False</span><span class="w"> </span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="l l-Scalar l-Scalar-Plain">ContainersReady   False</span><span class="w"> </span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="l l-Scalar l-Scalar-Plain">PodScheduled      True</span><span class="w"> </span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="nt">Volumes</span><span class="p">:</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="nt">kube-api-access-v5qt4</span><span class="p">:</span>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w">                    </span><span class="l l-Scalar l-Scalar-Plain">Projected (a volume that contains injected data from multiple sources)</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="w">    </span><span class="nt">TokenExpirationSeconds</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">3607</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a><span class="w">    </span><span class="nt">ConfigMapName</span><span class="p">:</span><span class="w">           </span><span class="l l-Scalar l-Scalar-Plain">kube-root-ca.crt</span>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a><span class="w">    </span><span class="nt">ConfigMapOptional</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">&lt;nil&gt;</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="w">    </span><span class="nt">DownwardAPI</span><span class="p">:</span><span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="nt">QoS Class</span><span class="p">:</span><span class="w">                   </span><span class="l l-Scalar l-Scalar-Plain">Burstable</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a><span class="nt">Node-Selectors</span><span class="p">:</span><span class="w">              </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="nt">Tolerations</span><span class="p">:</span><span class="w">                 </span><span class="l l-Scalar l-Scalar-Plain">node.kubernetes.io/not-ready:NoExecute op=Exists for 300s</span>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a><span class="w">                            </span><span class="l l-Scalar l-Scalar-Plain">node.kubernetes.io/unreachable:NoExecute op=Exists for 300s</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a><span class="nt">Events</span><span class="p">:</span>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a><span class="l l-Scalar l-Scalar-Plain">Type     Reason                  Age                   From               Message</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a><span class="l l-Scalar l-Scalar-Plain">----     ------                  ----                  ----               -------</span>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a><span class="l l-Scalar l-Scalar-Plain">Normal   Scheduled               24m                   default-scheduler  Successfully assigned default/nginx-deploy-548d7bc8bc-pfhmn to k8s-node1</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a><span class="nt">Warning  FailedCreatePodSandBox  24m                   kubelet            Failed to create pod sandbox: rpc error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code = Unknown desc = [failed to set up sandbox container &quot;d0c52072346d605a7594b91391ccd8ceb7803a629412e165a0e49f8b1fb498ba&quot; network for pod &quot;nginx-deploy-548d7bc8bc-pfhmn&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networkPlugin cni failed to set up pod &quot;nginx-deploy-548d7bc8bc-pfhmn_default&quot; network</span><span class="nt">: error getting ClusterInformation: connection is unauthorized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Unauthorized, failed to clean up sandbox container &quot;d0c52072346d605a7594b91391ccd8ceb7803a629412e165a0e49f8b1fb498ba&quot; network for pod &quot;nginx-deploy-548d7bc8bc-pfhmn&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networkPlugin cni failed to teardown pod &quot;nginx-deploy-548d7bc8bc-pfhmn_default&quot; network</span><span class="nt">: error getting ClusterInformation: connection is unauthorized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Unauthorized]</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a><span class="l l-Scalar l-Scalar-Plain">Normal   SandboxChanged          3m58s (x97 over 24m)  kubelet            Pod sandbox changed, it will be killed and re-created.</span>
</code></pre></div>
</details>
<details class="deployment_yaml_file">
<summary>Deployment_yaml_file</summary>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="nt">deployment.kubernetes.io/revision</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;7&quot;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2024-04-25T07:44:53Z&quot;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="nt">generation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deploy</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deploy</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;77441&quot;</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">02e581e3-6bbd-4af9-9d3a-9eda5b1c790b</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="nt">progressDeadlineSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deploy</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="nt">strategy</span><span class="p">:</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">    </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25%</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">    </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25%</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">    </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deploy</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">        </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.25.5</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">imagePullPolicy</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">        </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200m</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256Mi</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">        </span><span class="nt">terminationMessagePath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/termination-log</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">        </span><span class="nt">terminationMessagePolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">File</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">    </span><span class="nt">dnsPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterFirst</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w">    </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="w">    </span><span class="nt">schedulerName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-scheduler</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="w">    </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="nt">status</span><span class="p">:</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="nt">availableReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="nt">conditions</span><span class="p">:</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">lastTransitionTime</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2024-04-26T02:00:13Z&quot;</span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="w">    </span><span class="nt">lastUpdateTime</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2024-04-26T02:00:13Z&quot;</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a><span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment does not have minimum availability.</span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a><span class="w">    </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MinimumReplicasUnavailable</span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;False&quot;</span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Available</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">lastTransitionTime</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2024-04-26T02:22:40Z&quot;</span>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a><span class="w">    </span><span class="nt">lastUpdateTime</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2024-04-26T02:22:40Z&quot;</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a><span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReplicaSet &quot;nginx-deploy-5f44797d7f&quot; has timed out progressing.</span>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a><span class="w">    </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ProgressDeadlineExceeded</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;False&quot;</span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Progressing</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a><span class="nt">observedGeneration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9</span>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a><span class="nt">readyReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a><span class="nt">unavailableReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a><span class="nt">updatedReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div>
</details>
<p>参考这个<a href="https://github.com/projectcalico/calico/issues/5712">issue</a></p>
<p>最简单是通过重启Master解决。</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-04-26 00:00:00">April 26, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-troubleshooting-ingress"><a class="toclink" href="../../../../2024/04/26/k8s-troubleshooting-ingress/">k8s troubleshooting Ingress</a></h2>
<h3 id="ingress"><a class="toclink" href="../../../../2024/04/26/k8s-troubleshooting-ingress/#ingress">创建Ingress报错</a></h3>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master ingress</span><span class="p p-Indicator">]</span><span class="c1"># kubectl create -f wolfcode-ingress.yaml </span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">Error from server (InternalError)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">error when creating &quot;wolfcode-ingress.yaml&quot;</span><span class="nt">: Internal error occurred</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">failed calling webhook &quot;validate.nginx.ingress.kubernetes.io&quot;</span><span class="nt">: failed to call webhook</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Post &quot;https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service &quot;ingress-nginx-controller-admission&quot; not found</span>
</code></pre></div>
<h3 id="_1"><a class="toclink" href="../../../../2024/04/26/k8s-troubleshooting-ingress/#_1">解决方案</a></h3>
<h4 id="_2"><a class="toclink" href="../../../../2024/04/26/k8s-troubleshooting-ingress/#_2">执行</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master ingress</span><span class="p p-Indicator">]</span><span class="c1"># kubectl delete -A ValidatingWebhookConfiguration ingress-nginx-admission</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="l l-Scalar l-Scalar-Plain">validatingwebhookconfiguration.admissionregistration.k8s.io &quot;ingress-nginx-admission&quot; deleted</span>
</code></pre></div>
<h4 id="ingress_1"><a class="toclink" href="../../../../2024/04/26/k8s-troubleshooting-ingress/#ingress_1">再次创建Ingress</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master ingress</span><span class="p p-Indicator">]</span><span class="c1"># kubectl create -f wolfcode-ingress.yaml </span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="l l-Scalar l-Scalar-Plain">ingress.networking.k8s.io/wolfcode-nginx-ingress created</span>
</code></pre></div>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-04-25 00:00:00">April 25, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              6 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-resources-schedule"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/">k8s Resources Schedule</a></h2>
<h3 id="_1"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_1">相关概念</a></h3>
<ul>
<li><strong>Deployment</strong>: 部署包含RS、创建RS和pod，对应用程序进行滚动更新/滚动、动态扩缩容等 （RS:111）</li>
<li><strong>RS(ReplicaSet)</strong>: 副本集，管理Pod副本扩容/缩容</li>
<li><strong>Selector</strong>: 查询器，相当于查询条件：type=xxx,name!=xxxx</li>
<li><strong>StatefulSet</strong> : 专门对有状态服务进行部署的一个控制器</li>
</ul>
<h3 id="labelselector-usage"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#labelselector-usage">一. Label&amp;Selector Usage</a></h3>
<h4 id="label"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#label">Label</a></h4>
<h5 id="_2"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_2">临时创建标签</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master pods</span><span class="p p-Indicator">]</span><span class="c1"># kubectl label po &lt;pod name&gt; app=hello</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="l l-Scalar l-Scalar-Plain">pod/my-nginx labeled</span>
</code></pre></div>
<h5 id="pod"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#pod">查看pod的标签</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master pods</span><span class="p p-Indicator">]</span><span class="c1"># kubectl get po --show-labels</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="l l-Scalar l-Scalar-Plain">NAME       READY   STATUS    RESTARTS   AGE     LABELS</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="l l-Scalar l-Scalar-Plain">my-nginx   1/1     Running   0          3m10s   app=hello,type=app,version=1.0.x</span>
</code></pre></div>
<h5 id="_3"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_3">修改已存在的标签</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl label po &lt;pod name&gt; app=hello222</span>
</code></pre></div>
<h4 id="selector"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#selector">Selector</a></h4>
<h5 id="_4"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_4">配置文件</a></h5>
<p>在各对象的配置 spec.selector 或其他可以写 selector 的属性中编写</p>
<h5 id="kubectl"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#kubectl">kubectl</a></h5>
<p>匹配单个值，查找 app=hello 的 pod
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get po -A -l app=hello</span>
</code></pre></div>
 匹配多个值
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get po -A -l &#39;k8s-app in (metrics-server, kubernetes-dashboard)&#39;</span>
</code></pre></div>
或查找 version!=1 and app=nginx 的 pod 信息
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get po -l version!=1,app=nginx</span>
</code></pre></div>
不等值 + 语句
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get po -A -l version!=1,&#39;app in (busybox, nginx)&#39;</span>
</code></pre></div></p>
<h3 id="deployment-usage"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#deployment-usage">二. Deployment Usage</a></h3>
<h4 id="i"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#i">Ⅰ. 功能</a></h4>
<h5 id="_5"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_5">创建资源</a></h5>
<p>命令行创建一个 deployment
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl create deploy nginx-deploy --image=nginx:1.26.0</span><span class="w"> </span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="l l-Scalar l-Scalar-Plain">#也可以后面加 -o yaml 以yaml格式把内容输出，并创建资源</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="l l-Scalar l-Scalar-Plain">#也可以后面加 -o yaml &gt; xxx.yaml 以yaml格式把内容输出到xxx.yaml文件，并创建资源</span>
</code></pre></div>
或执行
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl create -f xxx.yaml --record</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="l l-Scalar l-Scalar-Plain">#--record 会在 annotation 中记录当前命令创建或升级了资源，后续可以查看做过哪些变动操作。</span>
</code></pre></div>
查看部署信息
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master deployments</span><span class="p p-Indicator">]</span><span class="c1"># kubectl get deploy</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="l l-Scalar l-Scalar-Plain">NAME           READY   UP-TO-DATE   AVAILABLE   AGE</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="l l-Scalar l-Scalar-Plain"><mark class="critic">nginx-deploy</mark>   1/1     1            1           2m4s</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="l l-Scalar l-Scalar-Plain">[root@k8s-master deployments]# kubectl get replicaset</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="l l-Scalar l-Scalar-Plain">NAME                      DESIRED   CURRENT   READY   AGE</span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="l l-Scalar l-Scalar-Plain"><mark class="critic">nginx-deploy-744cbf6b5c </mark>  1         1         1       2m8s</span>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="l l-Scalar l-Scalar-Plain">[root@k8s-master deployments]# kubectl get pod</span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="l l-Scalar l-Scalar-Plain">NAME                            READY   STATUS    RESTARTS   AGE</span>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="l l-Scalar l-Scalar-Plain">my-nginx                        1/1     Running   0          71m</span>
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="l l-Scalar l-Scalar-Plain"><mark class="critic">nginx-deploy-744cbf6b5c-kl48m</mark>   1/1     Running   0          2m12s</span>
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="l l-Scalar l-Scalar-Plain">[root@k8s-master deployments]#</span><span class="w"> </span>
</code></pre></div></p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>通过查询注意到，通过deployment创建的资源，pod name，rs name ，deployment name
三者有对应的关系。</p>
</details>
<h5 id="_6"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_6">滚动更新</a></h5>
<p>只有修改了 k8s集群的 deployment 配置文件中的<mark class="critic"> template </mark> 中的属性后，才会触发更新操作
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master deployments</span><span class="p p-Indicator">]</span><span class="c1"># kubectl get deploy</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="l l-Scalar l-Scalar-Plain">NAME           READY   UP-TO-DATE   AVAILABLE   AGE</span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="l l-Scalar l-Scalar-Plain">nginx-deploy   1/1     1            1           29m</span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="l l-Scalar l-Scalar-Plain">[root@k8s-master deployments]# kubectl edit deploy nginx-deploy</span>
</code></pre></div></p>
<p>修改 nginx 版本号
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="l l-Scalar l-Scalar-Plain">#或者通过 kubectl edit deployment/nginx-deployment 进行修改</span>
</code></pre></div></p>
<p>查看滚动更新的过程
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl rollout status deploy &lt;deployment_name&gt;</span>
</code></pre></div></p>
<p>查看部署描述，最后展示发生的事件列表也可以看到滚动更新过程
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl describe deploy &lt;deployment_name&gt;</span>
</code></pre></div></p>
<ul>
<li>
<p>通过 kubectl get deployments 获取部署信息，UP-TO-DATE 表示已经有多少副本达到了配置中要求的数目</p>
</li>
<li>
<p>通过 kubectl get rs 可以看到增加了一个新的 rs</p>
</li>
<li>
<p>通过 kubectl get pods 可以看到所有 pod 关联的 rs 变成了新的</p>
</li>
</ul>
<p><mark class="critic">多个滚动更新并行</mark></p>
<ul>
<li>假设当前有 5 个 nginx:1.7.9 版本，你想将版本更新为 1.9.1，当更新成功第三个以后，你马上又将期望更新的版本改为 1.9.2，那么此时会立马删除之前的三个，并且立马开启更新 1.9.2 的任务</li>
</ul>
<h5 id="_7"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_7">回滚</a></h5>
<p>有时候你可能想回退一个Deployment，例如，当Deployment不稳定时，比如一直crash looping。</p>
<p>默认情况下，kubernetes会在系统中保存前两次的Deployment的rollout历史记录，以便你可以随时会退（你可以修改revision history limit来更改保存的revision数）。</p>
<p>案例：
更新 deployment 时参数不小心写错，如 nginx:1.9.1 写成了 nginx:1.91
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl set image deployment/nginx-deploy nginx=nginx:1.91</span>
</code></pre></div></p>
<p>监控滚动升级状态，由于镜像名称错误，下载镜像失败，因此更新过程会卡住
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl rollout status deployments nginx-deploy</span>
</code></pre></div>
结束监听后，获取 rs 信息，我们可以看到新增的 rs 副本数是 2 个
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get rs</span>
</code></pre></div>
通过 kubectl get pods 获取 pods 信息，我们可以看到关联到新的 rs 的 pod，状态处于 ImagePullBackOff 状态</p>
<p>为了修复这个问题，我们需要找到需要回退的 revision 进行回退,通过:
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl rollout history deployment/nginx-deploy</span><span class="w"> </span>
</code></pre></div>
可以获取 revison 的列表</p>
<p>通过:
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl rollout history deployment/nginx-deploy --revision=2</span><span class="w"> </span>
</code></pre></div>
可以查看详细信息</p>
<p>确认要回退的版本后，可以通过:
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl rollout undo deployment/nginx-deploy</span><span class="w"> </span>
</code></pre></div>
可以回退到上一个版本,也可以回退到指定的 revision:
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl rollout undo deployment/nginx-deploy --to-revision=2</span>
</code></pre></div>
再次通过:
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get deployment 和 kubectl describe deployment</span>
</code></pre></div>
可以看到，我们的版本已经回退到对应的 revison 上了</p>
<blockquote>
<p>通过设置 .spec.revisonHistoryLimit 来指定 deployment 保留多少 revison，如果设置为 0，则不允许 deployment 回退了。</p>
</blockquote>
<h5 id="_8"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_8">扩容缩容</a></h5>
<p>通过 kube scale 命令可以进行自动扩容/缩容，以及通过 kube edit 编辑 replcas 也可以实现扩容/缩容
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl scale --replicas=3 deploy nginx-deploy</span>
</code></pre></div></p>
<p>扩容与缩容只是直接创建副本数，没有更新 pod template 因此不会创建新的 rs</p>
<h5 id="_9"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_9">暂停与恢复</a></h5>
<p>由于每次对 pod template 中的信息发生修改后，都会触发更新 deployment 操作，那么此时如果频繁修改信息，就会产生多次更新，而实际上只需要执行最后一次更新即可，当出现此类情况时我们就可以暂停 deployment 的 rollout</p>
<p>通过 <code>kubectl rollout pause deployment &lt;name&gt;</code> 就可以实现暂停，直到你下次恢复后才会继续进行滚动更新</p>
<p>尝试对容器进行修改，然后查看是否发生更新操作了
kubectl set image deploy <name> nginx=nginx:1.17.9
kubectl get po </p>
<p>通过以上操作可以看到实际并没有发生修改，此时我们再次进行修改一些属性，如限制 nginx 容器的最大cpu为 0.2 核，最大内存为 128M，最小内存为 64M，最小 cpu 为 0.1 核
kubectl set resources deploy <deploy_name> -c <container_name> --limits=cpu=200m,memory=128Mi --requests=cpu100m,memory=64Mi</p>
<p>通过格式化输出 kubectl get deploy <name> -oyaml，可以看到配置确实发生了修改，再通过 kubectl get po 可以看到 pod 没有被更新</p>
<p>那么此时我们再恢复 rollout，通过命令 kubectl rollout deploy <name></p>
<p>恢复后，我们再次查看 rs 和 po 信息，我们可以看到就开始进行滚动更新操作了
kubectl get rs
kubectl get po</p>
<h4 id="_10"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_10">配置文件</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"> </span><span class="c1"># deployment api 版本</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span><span class="w"> </span><span class="c1"># 资源类型为 deployment</span>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c1"># 元信息</span>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c1"># 标签</span>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deploy</span><span class="w"> </span><span class="c1"># 具体的 key: value 配置形式</span>
<a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deploy</span><span class="w"> </span><span class="c1"># deployment 的名字</span>
<a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"> </span><span class="c1"># 所在的命名空间</span>
<a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># 期望副本数</span>
<a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"> </span><span class="c1"># 进行滚动更新后，保留的历史版本数</span>
<a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"> </span><span class="c1"># 选择器，用于找到匹配的 RS</span>
<a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"> </span><span class="c1"># 按照标签匹配</span>
<a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deploy</span><span class="w"> </span><span class="c1"># 匹配的标签key/value</span>
<a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="c1"># 更新策略</span>
<a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span><span class="w"> </span><span class="c1"># 滚动更新配置</span>
<a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25%</span><span class="w"> </span><span class="c1"># 进行滚动更新时，更新的个数最多可以超过期望副本数的个数/比例</span>
<a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25%</span><span class="w"> </span><span class="c1"># 进行滚动更新时，最大不可用比例更新比例，表示在所有副本数中，最多可以有多少个不更新成功</span>
<a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span><span class="w"> </span><span class="c1"># 更新类型，采用滚动更新</span>
<a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="c1"># pod 模板</span>
<a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c1"># pod 的元信息</span>
<a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c1"># pod 的标签</span>
<a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deploy</span>
<a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c1"># pod 期望信息</span>
<a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c1"># pod 的容器</span>
<a id="__codelineno-93-25" name="__codelineno-93-25" href="#__codelineno-93-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.7.9</span><span class="w"> </span><span class="c1"># 镜像</span>
<a id="__codelineno-93-26" name="__codelineno-93-26" href="#__codelineno-93-26"></a><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span><span class="w"> </span><span class="c1"># 拉取策略</span>
<a id="__codelineno-93-27" name="__codelineno-93-27" href="#__codelineno-93-27"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"> </span><span class="c1"># 容器名称</span>
<a id="__codelineno-93-28" name="__codelineno-93-28" href="#__codelineno-93-28"></a><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span><span class="w"> </span><span class="c1"># 重启策略</span>
<a id="__codelineno-93-29" name="__codelineno-93-29" href="#__codelineno-93-29"></a><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"> </span><span class="c1"># 删除操作最多宽限多长时间</span>
</code></pre></div>
<h3 id="statefulset"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#statefulset">三. StatefulSet</a></h3>
<p><img alt="alt text" src="../../../../k8s/statefulset.png" /></p>
<h4 id="_11"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_11">功能</a></h4>
<h5 id="_12"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_12">创建</a></h5>
<p><div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl create -f web.yaml</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="l l-Scalar l-Scalar-Plain"># 查看 service 和 statefulset =&gt; sts</span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get service nginx</span>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get statefulset web</span>
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="l l-Scalar l-Scalar-Plain"># 查看 PVC 信息</span>
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get pvc</span>
<a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>
<a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a><span class="l l-Scalar l-Scalar-Plain"># 查看创建的 pod，这些 pod 是有序的</span>
<a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get pods -l app=nginx</span>
<a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>
<a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a><span class="l l-Scalar l-Scalar-Plain"># 查看这些 pod 的 dns</span>
<a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a><span class="l l-Scalar l-Scalar-Plain"># 运行一个 pod，基础镜像为 busybox 工具包，利用里面的 nslookup 可以看到 dns 信息</span>
<a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a><span class="l l-Scalar l-Scalar-Plain">kubectl run -i --tty --image busybox dns-test --restart=Never --rm /bin/sh</span>
<a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a><span class="l l-Scalar l-Scalar-Plain">nslookup web-0.nginx</span>
</code></pre></div>
更新yaml配置文件后可以用replace来更新资源
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl replace sts web -f web.yaml</span>
</code></pre></div></p>
<h5 id="_13"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_13">访问容器</a></h5>
<p>像docker一样用命令简单创建一个容器：
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl run -it --image busybox dns-test --restart=Never --rm /bin/sh</span>
</code></pre></div></p>
<p>访问其他容器：
<img alt="alt text" src="../../../../k8s/image-2.png" />
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master statefulset</span><span class="p p-Indicator">]</span><span class="c1"># kubectl run -it --image busybox dns-test --restart=Never --rm /bin/sh</span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"> </span><span class="c1"># ping web-1.nginx  #验证容器间访问</span>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="nt">PING web-1.nginx (192.168.36.100)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">56 data bytes</span>
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="nt">64 bytes from 192.168.36.100</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">seq=0 ttl=62 time=0.327 ms</span>
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="nt">64 bytes from 192.168.36.100</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">seq=1 ttl=62 time=0.289 ms</span>
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="nn">...</span>
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"> </span><span class="c1"># ping web-0.nginx   #验证容器间访问</span>
<a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="nt">PING web-0.nginx (192.168.169.161)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">56 data bytes</span>
<a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="nt">64 bytes from 192.168.169.161</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">seq=0 ttl=63 time=0.051 ms</span>
<a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="nt">64 bytes from 192.168.169.161</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">seq=1 ttl=63 time=0.051 ms</span>
</code></pre></div></p>
<p>注释：</p>
<ul>
<li>dns-test : 容器名称</li>
<li>busybox : linux的常用工具镜像</li>
<li>--restart=Never: 当探测到容器失败是否重启 POD</li>
<li>--rm : 运行完后删除容器</li>
<li>/bin/sh： 进入容器的目录（执行bin目录下的sh）</li>
</ul>
<h5 id="_14"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_14">扩容缩容</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="c1"># 扩容</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="l l-Scalar l-Scalar-Plain">$ kubectl scale statefulset web --replicas=5</span>
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a>
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="l l-Scalar l-Scalar-Plain"># 缩容2种方法</span>
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="l l-Scalar l-Scalar-Plain">$ kubectl scale sts web --replicas=2</span>
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="l l-Scalar l-Scalar-Plain">$ kubectl patch statefulset web -p &#39;{&quot;spec&quot;:{&quot;replicas&quot;:3}}&#39;</span>
</code></pre></div>
<h5 id="_15"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_15">镜像更新</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="c1"># 镜像更新（目前还不支持直接更新 image，需要 patch 来间接实现）</span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="l l-Scalar l-Scalar-Plain">kubectl patch sts web --type=&#39;json&#39; -p=&#39;[{&quot;op&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;replace&quot;</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;path&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/spec/template/spec/containers/0/image&quot;</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="l l-Scalar l-Scalar-Plain">:&quot;nginx:1.9.1&quot;}]&#39;</span>
</code></pre></div>
<h6 id="rollingupdate"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#rollingupdate">RollingUpdate</a></h6>
<p>StatefulSet  也可以采用滚动更新策略，同样是修改 pod template 属性后会触发更新，但是由于 pod 是有序的，在 StatefulSet 中更新时是基于 pod 的顺序倒序更新的</p>
<p>查看rolling 状态
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master statefulset</span><span class="p p-Indicator">]</span><span class="c1"># kubectl rollout status sts web</span>
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="nt">partitioned roll out complete</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2 new pods have been updated...</span>
</code></pre></div>
查看statefulset更新记录
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl rollout history sts web</span>
</code></pre></div></p>
<h6 id="_16"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_16">灰度发布(金丝雀)</a></h6>
<p>利用滚动更新中的 partition 属性，可以实现简易的灰度发布的效果</p>
<p>例如我们有 5 个 pod，如果当前 partition 设置为 3，那么此时滚动更新时，只会更新那些 序号 &gt;= 3 的 pod</p>
<p>利用该机制，我们可以通过控制 partition 的值，来决定只更新其中一部分 pod，确认没有问题后再主键增大更新的 pod 数量，最终实现全部 pod 更新</p>
<details class="statefulset的滚动更新是先删除再创建">
<summary>Statefulset的滚动更新是先删除再创建</summary>
<p>下面是先删除再创建的原因：</p>
<p><strong>数据的持久性</strong>：有状态应用程序通常使用持久卷（Persistent Volume）来存储数据。在进行更新时，先删除旧的 Pod，可以确保旧 Pod 使用的持久卷不会被意外删除，从而保留数据的持久性。</p>
<p><strong>网络标识的稳定性</strong>：StatefulSet 的每个 Pod 都有唯一的标识符和稳定的网络标识。这些标识符通常基于 Pod 的名称和索引。通过先删除旧的 Pod，再创建新的 Pod，可以保证新 Pod 的名称和索引与旧 Pod 保持一致，从而保持网络标识的稳定性。</p>
<p><strong>依赖关系的管理</strong>：在有状态应用程序中，可能存在依赖其他 Pod 的情况，例如数据库集群中的主从关系。通过先删除再创建的方式，可以确保新创建的 Pod 在依赖关系方面与旧 Pod 保持一致，避免因更新过程中引入不一致性。</p>
</details>
<h6 id="ondelete"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#ondelete">OnDelete</a></h6>
<p>只有在 pod 被删除时会进行更新操作</p>
<h5 id="_17"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_17">删除</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="c1"># 删除 StatefulSet 和 Headless Service</span>
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="c1"># 级联删除：删除 statefulset 时会同时删除 pods</span>
<a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="l l-Scalar l-Scalar-Plain">kubectl delete statefulset web</span>
<a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="l l-Scalar l-Scalar-Plain"># 非级联删除：删除 statefulset 时不会删除 pods，删除 sts 后，pods 就没人管了，此时再删除 pod 不会重建的</span>
<a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="l l-Scalar l-Scalar-Plain">kubectl deelte sts web --cascade=false</span>
<a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="l l-Scalar l-Scalar-Plain"># 删除 service</span>
<a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="l l-Scalar l-Scalar-Plain">kubectl delete service nginx</span>
</code></pre></div>
<h5 id="pvc"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#pvc">删除pvc</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="c1"># StatefulSet删除后PVC还会保留着，数据不再使用的话也需要删除</span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="l l-Scalar l-Scalar-Plain">$ kubectl delete pvc www-web-0 www-web-1</span>
</code></pre></div>
<h4 id="_18"><a class="toclink" href="../../../../2024/04/25/k8s-resources-schedule/#_18">配置文件</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="nn">---</span>
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a><span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<a id="__codelineno-104-13" name="__codelineno-104-13" href="#__codelineno-104-13"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-104-14" name="__codelineno-104-14" href="#__codelineno-104-14"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-104-15" name="__codelineno-104-15" href="#__codelineno-104-15"></a><span class="nn">---</span>
<a id="__codelineno-104-16" name="__codelineno-104-16" href="#__codelineno-104-16"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id="__codelineno-104-17" name="__codelineno-104-17" href="#__codelineno-104-17"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<a id="__codelineno-104-18" name="__codelineno-104-18" href="#__codelineno-104-18"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-104-19" name="__codelineno-104-19" href="#__codelineno-104-19"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id="__codelineno-104-20" name="__codelineno-104-20" href="#__codelineno-104-20"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-104-21" name="__codelineno-104-21" href="#__codelineno-104-21"></a><span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nginx&quot;</span><span class="w">  </span><span class="c1">#使用哪个service 来管理dns</span>
<a id="__codelineno-104-22" name="__codelineno-104-22" href="#__codelineno-104-22"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id="__codelineno-104-23" name="__codelineno-104-23" href="#__codelineno-104-23"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-104-24" name="__codelineno-104-24" href="#__codelineno-104-24"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-104-25" name="__codelineno-104-25" href="#__codelineno-104-25"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-104-26" name="__codelineno-104-26" href="#__codelineno-104-26"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-104-27" name="__codelineno-104-27" href="#__codelineno-104-27"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-104-28" name="__codelineno-104-28" href="#__codelineno-104-28"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-104-29" name="__codelineno-104-29" href="#__codelineno-104-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-104-30" name="__codelineno-104-30" href="#__codelineno-104-30"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.7.9</span>
<a id="__codelineno-104-31" name="__codelineno-104-31" href="#__codelineno-104-31"></a><span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-104-32" name="__codelineno-104-32" href="#__codelineno-104-32"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w">  </span><span class="c1">#容器内部要暴露的端口</span>
<a id="__codelineno-104-33" name="__codelineno-104-33" href="#__codelineno-104-33"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span><span class="w">  </span><span class="c1">#该端口的名字</span>
<a id="__codelineno-104-34" name="__codelineno-104-34" href="#__codelineno-104-34"></a><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a id="__codelineno-104-35" name="__codelineno-104-35" href="#__codelineno-104-35"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span><span class="w">  </span><span class="c1">#指定加载哪个数据卷</span>
<a id="__codelineno-104-36" name="__codelineno-104-36" href="#__codelineno-104-36"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span><span class="w">  </span><span class="c1">#加载到容器的哪个目录</span>
<a id="__codelineno-104-37" name="__codelineno-104-37" href="#__codelineno-104-37"></a><span class="w">  </span><span class="nt">volumeClaimTemplates</span><span class="p">:</span><span class="w"> </span><span class="c1"># 数据卷模板</span>
<a id="__codelineno-104-38" name="__codelineno-104-38" href="#__codelineno-104-38"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span><span class="w">  </span><span class="c1">#数据卷描述</span>
<a id="__codelineno-104-39" name="__codelineno-104-39" href="#__codelineno-104-39"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span><span class="w">  </span><span class="c1">#数据卷名称</span>
<a id="__codelineno-104-40" name="__codelineno-104-40" href="#__codelineno-104-40"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">  </span><span class="c1">#数据卷注释</span>
<a id="__codelineno-104-41" name="__codelineno-104-41" href="#__codelineno-104-41"></a><span class="w">        </span><span class="nt">volume.alpha.kubernetes.io/storage-class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">anything</span>
<a id="__codelineno-104-42" name="__codelineno-104-42" href="#__codelineno-104-42"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">  </span><span class="c1">#数据卷的规约</span>
<a id="__codelineno-104-43" name="__codelineno-104-43" href="#__codelineno-104-43"></a><span class="w">      </span><span class="nt">accessModes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;ReadWriteOnce&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1">#访问模式</span>
<a id="__codelineno-104-44" name="__codelineno-104-44" href="#__codelineno-104-44"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-104-45" name="__codelineno-104-45" href="#__codelineno-104-45"></a><span class="w">        </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-104-46" name="__codelineno-104-46" href="#__codelineno-104-46"></a><span class="w">          </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span><span class="w">  </span><span class="c1">#存储大小</span>
</code></pre></div>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-04-24 00:00:00">April 24, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-podprobe"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/">k8s PodProbe</a></h2>
<div class="admonition note inline end">
<h4 id="_1"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#_1">参考链接</a></h4>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">Probe Official docs</a></li>
</ul>
</div>
<h3 id="_2"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#_2">探针三个类型</a></h3>
<p>The kubelet uses liveness probes to know when to restart a container. For example, liveness probes could catch a deadlock, where an application is running, but unable to make progress. Restarting a container in such a state can help to make the application more available despite bugs.</p>
<h4 id="1-startupprobe"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#1-startupprobe">1. StartupProbe</a></h4>
<p>k8s 1.16 版本新增的探针，用于判断应用程序是否已经启动了。</p>
<p>当配置了 startupProbe 后，会先禁用其他探针，直到 startupProbe 成功后，其他探针才会继续。</p>
<p>作用：由于有时候不能准确预估应用一定是多长时间启动成功，因此配置另外两种方式不方便配置初始化时长来检测，而配置了 statupProbe 后，只有在应用启动成功了，才会执行另外两种探针，可以更加方便的结合使用另外两种探针使用。</p>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nt">startupProbe</span><span class="p">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="nt">httpGet</span><span class="p">:</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/api/startup</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
<h4 id="2-livenessprobe"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#2-livenessprobe">2. LivenessProbe</a></h4>
<p>用于探测容器中的应用是否运行，如果探测失败，kubelet 会根据配置的重启策略进行重启，若没有配置，默认就认为容器启动成功，不会执行重启策略。
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nt">livenessProbe</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">httpGet</span><span class="p">:</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTP</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">  </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">  </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">  </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">  </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</code></pre></div></p>
<h4 id="3-readinessprobe"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#3-readinessprobe">3. ReadinessProbe</a></h4>
<p>用于探测容器内的程序是否健康，它的返回值如果返回 success，那么就认为该容器已经完全启动，并且该容器是可以接收外部流量的。
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nt">readinessProbe</span><span class="p">:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># 错误次数</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="nt">httpGet</span><span class="p">:</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/ready</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8181</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTP</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">  </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"> </span><span class="c1"># 间隔时间</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">  </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">  </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div></p>
<h3 id="_3"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#_3">探测方法</a></h3>
<h4 id="1-execaction"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#1-execaction">1. ExecAction</a></h4>
<p>在容器内部执行一个命令，如果返回值为 0，则任务容器时健康的。
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nt">livenessProbe</span><span class="p">:</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="nt">exec</span><span class="p">:</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
</code></pre></div></p>
<h4 id="2-tcpsocketaction"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#2-tcpsocketaction">2. TCPSocketAction</a></h4>
<p>通过 tcp 连接监测容器内端口是否开放，如果开放则证明该容器健康
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">livenessProbe</span><span class="p">:</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="nt">tcpSocket</span><span class="p">:</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div></p>
<h4 id="3-httpgetaction"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#3-httpgetaction">3. HTTPGetAction</a></h4>
<p>生产环境用的较多的方式，发送 HTTP 请求到容器内的应用程序，如果接口返回的状态码在 200~400 之间，则认为容器健康。</p>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nt">livenessProbe</span><span class="p">:</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="nt">httpGet</span><span class="p">:</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTP</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span><span class="nt">httpHeaders</span><span class="p">:</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xxx</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xxx</span>
</code></pre></div>
<h3 id="_4"><a class="toclink" href="../../../../2024/04/24/k8s-podprobe/#_4">参数配置</a></h3>
<ul>
<li>initialDelaySeconds: 60 # 初始化时间</li>
<li>timeoutSeconds: 2 # 超时时间</li>
<li>periodSeconds: 5 # 监测间隔时间</li>
<li>successThreshold: 1 # 检查 1 次成功就表示成功</li>
<li>failureThreshold: 2 # 监测失败 2 次就表示失败</li>
</ul>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-04-24 00:00:00">April 24, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-pod-lifecycle"><a class="toclink" href="../../../../2024/04/24/k8s-pod-lifecycle/">k8s Pod Lifecycle</a></h2>
<div class="admonition note inline end">
<h4 id="_1"><a class="toclink" href="../../../../2024/04/24/k8s-pod-lifecycle/#_1">参考链接</a></h4>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/">Pod Lifecycle Official docs</a></li>
</ul>
</div>
<p>This page describes the lifecycle of a Pod. Pods follow a defined lifecycle, starting in the Pending phase, moving through Running if at least one of its primary containers starts OK, and then through either the Succeeded or Failed phases depending on whether any container in the Pod terminated in failure.</p>
<p><img alt="alt text" src="../../../../k8s/podlifecycle.png" /></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-04-19 00:00:00">April 19, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-cluster-kubeadm"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/">K8s cluster -- kubeadm</a></h2>
<h4 id="prerequisition"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#prerequisition">prerequisition:</a></h4>
<ul>
<li>3台服务器或虚拟机</li>
<li>最低配置：2CPU、2GB Memory、20GB disk</li>
<li>最好能联网，不能联网需要有提供队友镜像的私有仓库                              .</li>
</ul>
<h4 id="_1"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#_1">软件环境:</a></h4>
<ul>
<li>操作系统：centos7</li>
<li>Docker： 20+</li>
<li>k8s：1.23.6</li>
</ul>
<h4 id="_2"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#_2">安装步骤:</a></h4>
<details class="quote">
<summary>1.  初始操作（所有节点）</summary>
<h5 id="_3"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#_3">关闭防火墙</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="l l-Scalar l-Scalar-Plain">systemctl stop firewalld</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="l l-Scalar l-Scalar-Plain">systemctl disable firewalld</span>
</code></pre></div>
<h5 id="selinux"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#selinux">关闭selinux</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="l l-Scalar l-Scalar-Plain">sed -i &#39;s/enforcing/disabled/&#39; /etc/selinux/config</span><span class="w">  </span><span class="c1"># 永久</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="l l-Scalar l-Scalar-Plain">setenforce 0</span><span class="w">  </span><span class="c1"># 临时</span>
</code></pre></div>
<h5 id="swap"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#swap">关闭swap</a></h5>
<p><div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="l l-Scalar l-Scalar-Plain">swapoff -a</span><span class="w">  </span><span class="c1"># 临时</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="l l-Scalar l-Scalar-Plain">sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab</span><span class="w">    </span><span class="c1"># 永久</span>
</code></pre></div>
关闭完swap后，一定要重启一下虚拟机！！！</p>
<h5 id="_4"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#_4">根据规划设置主机名</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="l l-Scalar l-Scalar-Plain">hostnamectl set-hostname &lt;hostname&gt;</span>
</code></pre></div>
<h5 id="masterhosts"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#masterhosts">在master添加hosts</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="l l-Scalar l-Scalar-Plain">cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="l l-Scalar l-Scalar-Plain">192.168.113.120 k8s-master</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="l l-Scalar l-Scalar-Plain">192.168.113.121 k8s-node1</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="l l-Scalar l-Scalar-Plain">192.168.113.122 k8s-node2</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="l l-Scalar l-Scalar-Plain">EOF</span>
</code></pre></div>
<h5 id="ipv4iptables"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#ipv4iptables">将桥接的IPv4流量传递到iptables的链</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="l l-Scalar l-Scalar-Plain">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="l l-Scalar l-Scalar-Plain">net.bridge.bridge-nf-call-ip6tables = 1</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="l l-Scalar l-Scalar-Plain">net.bridge.bridge-nf-call-iptables = 1</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="l l-Scalar l-Scalar-Plain">EOF</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="l l-Scalar l-Scalar-Plain">sysctl --system</span><span class="w">  </span><span class="c1"># 生效</span>
</code></pre></div>
<h5 id="_5"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#_5">时间同步</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="l l-Scalar l-Scalar-Plain">yum install ntpdate -y</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="l l-Scalar l-Scalar-Plain">ntpdate time.windows.com</span>
</code></pre></div>
</details>
<details class="quote">
<summary>2.  安装基础软件（所有节点）</summary>
<h5 id="docker"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#docker">基于文档中的安装 Docker 文件进行安装</a></h5>
<h6 id="uninstall-old-versions"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#uninstall-old-versions">Uninstall old versions</a></h6>
<p><code>sudo yum remove docker \
                docker-client \
                docker-client-latest \
                docker-common \
                docker-latest \
                docker-latest-logrotate \
                docker-logrotate \
                docker-engine</code></p>
<h6 id="set-up-the-repository"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#set-up-the-repository">Set up the repository</a></h6>
<p><div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo yum install -y yum-utils</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="l l-Scalar l-Scalar-Plain">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span>
</code></pre></div>
本实验按装Docker 20+
<div class="language-py highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="p">[</span><span class="n">root</span><span class="nd">@node1</span> <span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="p">]</span><span class="c1"># yum list docker-ce --showduplicates | sort -r</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="o">*</span> <span class="n">updates</span><span class="p">:</span> <span class="n">mirrors</span><span class="o">.</span><span class="n">bupt</span><span class="o">.</span><span class="n">edu</span><span class="o">.</span><span class="n">cn</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">Loading</span> <span class="n">mirror</span> <span class="n">speeds</span> <span class="kn">from</span> <span class="nn">cached</span> <span class="n">hostfile</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="n">Loaded</span> <span class="n">plugins</span><span class="p">:</span> <span class="n">fastestmirror</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="o">*</span> <span class="n">extras</span><span class="p">:</span> <span class="n">mirrors</span><span class="o">.</span><span class="n">nju</span><span class="o">.</span><span class="n">edu</span><span class="o">.</span><span class="n">cn</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">.</span><span class="n">x86_64</span>            <span class="mi">3</span><span class="p">:</span><span class="mf">26.0.2</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7</span>                      <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">stable</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">.</span><span class="n">x86_64</span>            <span class="mi">3</span><span class="p">:</span><span class="mf">26.0.1</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7</span>                      <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">stable</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="o">&lt;...&gt;</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="p">[</span><span class="n">root</span><span class="nd">@node1</span> <span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="p">]</span><span class="c1">#sudo yum install docker-ce-3:23.0.1-1.el7 docker-ce-cli-3:23.0.1-1.el7 containerd.io docker-buildx-plugin docker-compose-plugin</span>
</code></pre></div></p>
<blockquote>
<p>启动docker 出现 ‘ Failed to start docker.service: Unit not found. ’ 错误
,因为缺少 rhel-push-plugin.socket 单元，该单元是rhel-push-plugin软件包的一部分。所以我们执行以下指令就可以成功解决curl -sSL https://get.docker.com/ | sh
提示。安装最新版本的命令是：
sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</p>
</blockquote>
<h6 id="install-docker-engine"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#install-docker-engine">Install Docker Engine</a></h6>
<h5 id="yum"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#yum">添加阿里云yum源</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="l l-Scalar l-Scalar-Plain">cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="l l-Scalar l-Scalar-Plain">[kubernetes]</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="l l-Scalar l-Scalar-Plain">name=Kubernetes</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="l l-Scalar l-Scalar-Plain">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="l l-Scalar l-Scalar-Plain">enabled=1</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="l l-Scalar l-Scalar-Plain">gpgcheck=0</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="l l-Scalar l-Scalar-Plain">repo_gpgcheck=0</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="l l-Scalar l-Scalar-Plain">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="l l-Scalar l-Scalar-Plain">EOF</span>
</code></pre></div>
<h5 id="kubeadmkubeletkubectl"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#kubeadmkubeletkubectl">安装kubeadm/kubelet/kubectl</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="l l-Scalar l-Scalar-Plain">yum install -y kubelet-1.23.6 kubeadm-1.23.6 kubectl-1.23.6</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="l l-Scalar l-Scalar-Plain">systemctl enable kubelet</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="l l-Scalar l-Scalar-Plain"># 配置关闭 Docker 的 cgroups，修改 /etc/docker/daemon.json，加入以下内容</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="l l-Scalar l-Scalar-Plain">&quot;exec-opts&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;native.cgroupdriver=systemd&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="c1"># 重启 docker</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="l l-Scalar l-Scalar-Plain">systemctl daemon-reload</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="l l-Scalar l-Scalar-Plain">systemctl restart docker</span>
</code></pre></div>
</details>
<details class="quote">
<summary>3.  部署kubernetes Master</summary>
<h5 id="master"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#master">在 Master 节点下执行</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="l l-Scalar l-Scalar-Plain">kubeadm init \</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="l l-Scalar l-Scalar-Plain">--apiserver-advertise-address=10.0.0.10 \</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="l l-Scalar l-Scalar-Plain">--image-repository registry.aliyuncs.com/google_containers \</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="l l-Scalar l-Scalar-Plain">--kubernetes-version v1.23.6 \</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="l l-Scalar l-Scalar-Plain">--service-cidr=192.168.0.0/20 \</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="l l-Scalar l-Scalar-Plain">--pod-network-cidr=192.168.0.0/16</span>
</code></pre></div>
<h5 id="_6"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#_6">安装成功后，复制如下配置并执行</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="l l-Scalar l-Scalar-Plain">mkdir -p $HOME/.kube</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="l l-Scalar l-Scalar-Plain">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="l l-Scalar l-Scalar-Plain">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get nodes</span>
</code></pre></div>
</details>
<details class="quote">
<summary>4.  加入kubernetes Node</summary>
<h5 id="k8s-node1-k8s-node2"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#k8s-node1-k8s-node2">分别在 k8s-node1 和 k8s-node2 执行</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># 下方命令可以在 k8s master 控制台初始化成功后复制 join 命令</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="l l-Scalar l-Scalar-Plain">kubeadm join 172.26.120.200:6443 --token 152ar6.aag6akqgoiwjd5j1 \</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="l l-Scalar l-Scalar-Plain">--discovery-token-ca-cert-hash sha256:d708981fd0179a12cfb2c1062bf5a18a473cd8a5f269b8070d3eec10c70ac446</span><span class="w"> </span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="l l-Scalar l-Scalar-Plain"># 如果初始化的 token 不小心清空了，可以通过如下命令获取或者重新申请</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="l l-Scalar l-Scalar-Plain"># 如果 token 已经过期，就重新申请</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="l l-Scalar l-Scalar-Plain">kubeadm token create</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="l l-Scalar l-Scalar-Plain"># token 没有过期可以通过如下命令获取</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="l l-Scalar l-Scalar-Plain">kubeadm token list</span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="l l-Scalar l-Scalar-Plain"># 获取 --discovery-token-ca-cert-hash 值，得到值后需要在前面拼接上 sha256</span><span class="p p-Indicator">:</span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="l l-Scalar l-Scalar-Plain">openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | \</span>
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="l l-Scalar l-Scalar-Plain">openssl dgst -sha256 -hex | sed &#39;s/^.* //&#39;</span>
</code></pre></div>
<h5 id="_7"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#_7">检查结果信息方法：</a></h5>
<div class="language-text highlight"><pre><span></span><code>检查组件：kubectl get componentstatus 或 kubectl get cs
检查pod信息：
[root@k8s-master ~]# kubectl get pods
No resources found in default namespace.
查不到pod信息是因为命名空间问题，集群刚创建的时候不是放在默认namespace，应用：
kubectl get pods -n kube-system
[root@k8s-master ~]# kubectl get pods -n kube-system
NAME                                 READY   STATUS    RESTARTS   AGE
coredns-6d8c4cb4d-gzfgk              0/1     Pending   0          13m
coredns-6d8c4cb4d-mj4pn              0/1     Pending   0          13m
etcd-k8s-master                      1/1     Running   0          13m
kube-apiserver-k8s-master            1/1     Running   0          13m
kube-controller-manager-k8s-master   1/1     Running   0          13m
kube-proxy-55xrt                     1/1     Running   0          10m
kube-proxy-8brl5                     1/1     Running   0          12m
kube-proxy-hlg99                     1/1     Running   0          13m
kube-scheduler-k8s-master            1/1     Running   0          13m
这里发现coredns 是pending状态，这是因为网络原因导致无法下载，需要继续下面步骤5↓
</code></pre></div>
</details>
<details class="quote">
<summary>5.  部署CNI网络插件</summary>
<h5 id="master_1"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#master_1">在 master 节点上执行</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1">## 下载 calico 配置文件，可能会网络超时</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="l l-Scalar l-Scalar-Plain">curl https://docs.projectcalico.org/manifests/calico.yaml -O</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="l l-Scalar l-Scalar-Plain"># 修改 calico.yaml 文件中的 CALICO_IPV4POOL_CIDR 配置，修改为与初始化的 cidr 相同</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="l l-Scalar l-Scalar-Plain"># 修改 IP_AUTODETECTION_METHOD 下的网卡名称</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="l l-Scalar l-Scalar-Plain"># 删除镜像 docker.io/ 前缀，避免下载过慢导致失败</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="l l-Scalar l-Scalar-Plain">sed -i &#39;s#docker.io/##g&#39; calico.yaml</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="l l-Scalar l-Scalar-Plain">#执行这个文件calico.yaml，用kubectl apply ，因为是聚合文件，所有用apply</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="l l-Scalar l-Scalar-Plain">kubectl apply -f calico.yaml</span>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="l l-Scalar l-Scalar-Plain">#再次查看pod ，等待几分钟发现多了pod以及coredns 也好了</span>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get po -n kube-system</span>
<a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a>
<a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="l l-Scalar l-Scalar-Plain">#现在看下新的pod在干什么</span>
</code></pre></div>
</details>
<details class="quote">
<summary>5.  测试集群</summary>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># 创建部署</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="l l-Scalar l-Scalar-Plain">kubectl create deployment nginx --image=nginx</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="l l-Scalar l-Scalar-Plain"># 暴露端口</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="l l-Scalar l-Scalar-Plain">kubectl expose deployment nginx --port=80 --type=NodePort</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="l l-Scalar l-Scalar-Plain"># 查看 pod 以及服务信息</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get pod,svc</span>
</code></pre></div>
</details>
<details class="quote">
<summary>6.  测试集群</summary>
<h5 id="_8"><a class="toclink" href="../../../../2024/04/19/k8s-cluster----kubeadm/#_8">测试集群</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1"># 创建部署</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="l l-Scalar l-Scalar-Plain">kubectl create deployment nginx --image=nginx</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="l l-Scalar l-Scalar-Plain"># 暴露端口</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="l l-Scalar l-Scalar-Plain">kubectl expose deployment nginx --port=80 --type=NodePort</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="l l-Scalar l-Scalar-Plain"># 查看 pod 以及服务信息</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get pod,svc</span>
</code></pre></div>
</details>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.consectetur adipiscing elitconsectetur adipiscing elit&#160;<a class="footnote-backref" href="../../../../2024/04/19/k8s-cluster----kubeadm/#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-03-19 00:00:00">March 19, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-pod"><a class="toclink" href="../../../../2024/03/19/k8s-pod/">K8s Pod</a></h2>
<div class="admonition note inline end">
<h4 id="_1"><a class="toclink" href="../../../../2024/03/19/k8s-pod/#_1">参考链接</a></h4>
<ul>
<li><a href="../../../../2024/01/31/k8s-resources-classifcation/#k8sk8sresourcesmanifest">k8s资源配置清单</a></li>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/qq">k8s容器/pod分配资源官网文档</a></li>
</ul>
</div>
<p>On the right hand are reference infomations for create kubernetes resources.
resources manifast / official document.</p>
<p><br/></p>
<h4 id="create-pod-using-yaml-file"><a class="toclink" href="../../../../2024/03/19/k8s-pod/#create-pod-using-yaml-file">Create Pod using yaml file</a></h4>
<div class="language-yaml highlight"><span class="filename">pod.yaml</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"> </span><span class="c1"># api 文档版本</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class="w"> </span><span class="c1">#资源对象类型，其他的：Deployment、StatefulSet </span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c1">#Pod的相关元数据，用于描述pod的数据</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-nginx</span><span class="w">  </span><span class="c1">#pod的名称</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c1">#定义pod标签</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.x</span><span class="w"> </span><span class="c1">#自定义</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;default&#39;</span><span class="w"> </span><span class="c1">#配置命名空间，默认的是default</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="nt">spec</span><span class="p">:</span><span class="w">  </span><span class="c1">#期望pod 按照这里的描述进行创建</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.26.0</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span><span class="w"> </span><span class="c1">#指定镜像拉取策略，如果本地没有就拉取远程</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-g</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;daemon</span><span class="nv"> </span><span class="s">off;&#39;</span><span class="w"> </span><span class="c1">#意为：nginx -g &#39;daemon off;&#39;</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">    </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span><span class="w"> </span><span class="c1">#指定容器启动后的工作目录</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"> </span><span class="c1">#端口名称</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">      </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"> </span><span class="c1">#描述容器内要暴露的端口</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w"> </span><span class="c1">#描述该端口是基于那种协议通信</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">    </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c1"># 环境变量</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JVM-OPTS</span><span class="w"> </span><span class="c1">#环境名称</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;-Xms128m</span><span class="nv"> </span><span class="s">-Xmx128m&#39;</span><span class="w"> </span><span class="c1">#环境变量的值</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">      </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100m</span><span class="w"> </span><span class="c1"># cpu一个核心为1000m，这里的100m 为最少0.1个核心</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;128Mi&quot;</span><span class="w"> </span><span class="c1">#最少128兆</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200m</span><span class="w"> </span><span class="c1"># cpu一个核心为1000m，这里的200m 为最多0.2个核心</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;256Mi&quot;</span><span class="w"> </span><span class="c1">#最多256兆</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">    </span><span class="c1">#command: [&quot;stress&quot;]</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">    </span><span class="c1">#args: [&quot;--vm&quot;, &quot;1&quot;, &quot;--vm-bytes&quot;, &quot;150M&quot;, &quot;--vm-hang&quot;, &quot;1&quot;]</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span><span class="w"> </span><span class="c1">#重启策略：只用失败的情况才会重启</span>
</code></pre></div>
<h5 id="check-the-pod"><a class="toclink" href="../../../../2024/03/19/k8s-pod/#check-the-pod">check the pod</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get po</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get po -o wide</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="l l-Scalar l-Scalar-Plain">kubectl descrbe po my-nginx</span>
</code></pre></div>
<details class="operation_result">
<summary>Operation_result</summary>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master pods</span><span class="p p-Indicator">]</span><span class="c1"># kubectl get pod</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="l l-Scalar l-Scalar-Plain">NAME            READY   STATUS    RESTARTS   AGE</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="l l-Scalar l-Scalar-Plain">memory-demo-3   1/1     Running   0          4m50s</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="l l-Scalar l-Scalar-Plain">my-nginx        1/1     Running   0          3m31s</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="l l-Scalar l-Scalar-Plain">[root@k8s-master pods]# kubectl get pod -o wide</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="l l-Scalar l-Scalar-Plain">NAME            READY   STATUS    RESTARTS   AGE     IP              NODE        NOMINATED NODE   READINESS GATES</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="l l-Scalar l-Scalar-Plain">memory-demo-3   1/1     Running   0          4m55s   192.168.36.72   k8s-node1   &lt;none&gt;           &lt;none&gt;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="l l-Scalar l-Scalar-Plain">my-nginx        1/1     Running   0          3m36s   192.168.36.73   k8s-node1   &lt;none&gt;           &lt;none&gt;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="l l-Scalar l-Scalar-Plain">[root@k8s-master pods]# kubectl describe pod my-nginx</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span><span class="w">         </span><span class="l l-Scalar l-Scalar-Plain">my-nginx</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="nt">Namespace</span><span class="p">:</span><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="nt">Priority</span><span class="p">:</span><span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="nt">Node</span><span class="p">:</span><span class="w">         </span><span class="l l-Scalar l-Scalar-Plain">k8s-node1/10.0.0.101</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="nt">Start Time</span><span class="p">:</span><span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">Wed, 24 Apr 2024 06:49:02 -0400</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="nt">Labels</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">type=app</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">              </span><span class="l l-Scalar l-Scalar-Plain">version=1.0.x</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="nt">Annotations:  cni.projectcalico.org/containerID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bb27fe44a58187928bced7bb6a76234c1717ea8a000d35e8948796a7970b548a</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">              </span><span class="l l-Scalar l-Scalar-Plain">cni.projectcalico.org/podIP</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.36.73/32</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">              </span><span class="l l-Scalar l-Scalar-Plain">cni.projectcalico.org/podIPs</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.36.73/32</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="nt">Status</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">Running</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="nt">IP</span><span class="p">:</span><span class="w">           </span><span class="l l-Scalar l-Scalar-Plain">192.168.36.73</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="nt">IPs</span><span class="p">:</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">  </span><span class="nt">IP</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">192.168.36.73</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="nt">Containers</span><span class="p">:</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">  </span><span class="nt">nginx</span><span class="p">:</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">    </span><span class="nt">Container ID</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">docker://71f60f7711b116cf0a6dfa8041381f83c51d40b35ef15f4c0c8756e12ce45c33</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">    </span><span class="nt">Image</span><span class="p">:</span><span class="w">         </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.26.0</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">    </span><span class="nt">Image ID</span><span class="p">:</span><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">docker-pullable://nginx@sha256:3f28ecedbd787b3ff0a6d56cd4a1b13901acda532c717e3b7351fcc786973d79</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">    </span><span class="nt">Port</span><span class="p">:</span><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">80/TCP</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">    </span><span class="nt">Host Port</span><span class="p">:</span><span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">0/TCP</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">    </span><span class="nt">Command</span><span class="p">:</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">-g</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">daemon off;</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">    </span><span class="nt">State</span><span class="p">:</span><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">Running</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">Started</span><span class="p p-Indicator">:</span><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">Wed, 24 Apr 2024 06:49:03 -0400</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">    </span><span class="nt">Ready</span><span class="p">:</span><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">    </span><span class="nt">Restart Count</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">    </span><span class="nt">Limits</span><span class="p">:</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">200m</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">256Mi</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">    </span><span class="nt">Requests</span><span class="p">:</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">128Mi</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w">    </span><span class="nt">Environment</span><span class="p">:</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="w">      </span><span class="nt">JVM-OPTS</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">-Xms128m -Xmx128m</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="w">    </span><span class="nt">Mounts</span><span class="p">:</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">/var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-mkwwb (ro)</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="nt">Conditions</span><span class="p">:</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Type              Status</span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Initialized       True</span><span class="w"> </span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Ready             True</span><span class="w"> </span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ContainersReady   True</span><span class="w"> </span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">PodScheduled      True</span><span class="w"> </span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="nt">Volumes</span><span class="p">:</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a><span class="w">  </span><span class="nt">kube-api-access-mkwwb</span><span class="p">:</span>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w">                    </span><span class="l l-Scalar l-Scalar-Plain">Projected (a volume that contains injected data from multiple sources)</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a><span class="w">    </span><span class="nt">TokenExpirationSeconds</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">3607</span>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a><span class="w">    </span><span class="nt">ConfigMapName</span><span class="p">:</span><span class="w">           </span><span class="l l-Scalar l-Scalar-Plain">kube-root-ca.crt</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a><span class="w">    </span><span class="nt">ConfigMapOptional</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">&lt;nil&gt;</span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a><span class="w">    </span><span class="nt">DownwardAPI</span><span class="p">:</span><span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a><span class="nt">QoS Class</span><span class="p">:</span><span class="w">                   </span><span class="l l-Scalar l-Scalar-Plain">Burstable</span>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a><span class="nt">Node-Selectors</span><span class="p">:</span><span class="w">              </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a><span class="nt">Tolerations</span><span class="p">:</span><span class="w">                 </span><span class="l l-Scalar l-Scalar-Plain">node.kubernetes.io/not-ready:NoExecute op=Exists for 300s</span>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a><span class="w">                            </span><span class="l l-Scalar l-Scalar-Plain">node.kubernetes.io/unreachable:NoExecute op=Exists for 300s</span>
<a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a><span class="nt">Events</span><span class="p">:</span>
<a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Type    Reason     Age    From               Message</span>
<a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">----    ------     ----   ----               -------</span>
<a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Normal  Scheduled  3m55s  default-scheduler  Successfully assigned default/my-nginx to k8s-node1</span>
<a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Normal  Pulled     3m55s  kubelet            Container image &quot;nginx:1.26.0&quot; already present on machine</span>
<a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Normal  Created    3m55s  kubelet            Created container nginx</span>
<a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Normal  Started    3m55s  kubelet            Started container nginx</span>
<a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master pods</span><span class="p p-Indicator">]</span><span class="c1"># </span>
</code></pre></div>
</details>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-01-31 00:00:00">January 31, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-resources-classifcation"><a class="toclink" href="../../../../2024/01/31/k8s-resources-classifcation/">k8s Resources Classifcation</a></h2>
<h4 id="k8s"><a class="toclink" href="../../../../2024/01/31/k8s-resources-classifcation/#k8s">k8s资源的分类</a></h4>
<p>元空间、集群、命名空间
<img alt="alt text" src="../../../../k8s/image-1.png" /></p>
<h4 id="_1"><a class="toclink" href="../../../../2024/01/31/k8s-resources-classifcation/#_1">简单的分类为以下几种资源对象：</a></h4>
<table>
<thead>
<tr>
<th>类别</th>
<th>名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>资源对象</td>
<td>Pod、ReplicaSet、ReplicationController、Deployment、StatefulSet、DaemonSet、Job、CronJob、HorizontalPodAutoscaling、Node、Namespace、Service、Ingress、Label、CustomResourceDefinition</td>
</tr>
<tr>
<td>存储对象</td>
<td>Volume、PersistentVolume、Secret、ConfigMap</td>
</tr>
<tr>
<td>策略对象</td>
<td>SecurityContext、ResourceQuota、LimitRange</td>
</tr>
<tr>
<td>身份对象</td>
<td>ServiceAccount、Role、ClusterRole</td>
</tr>
</tbody>
</table>
<h4 id="k8sk8sresourcesmanifest"><a class="toclink" href="../../../../2024/01/31/k8s-resources-classifcation/#k8sk8sresourcesmanifest">K8SK8SResourcesManifest</a></h4>
<table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>字段说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>apiVersion</td>
<td>String</td>
<td>K8S APl 的版本，可以用 kubectl api versions 命令查询</td>
</tr>
<tr>
<td>kind</td>
<td>String</td>
<td>yam 文件定义的资源类型和角色</td>
</tr>
<tr>
<td>metadata</td>
<td>Object</td>
<td>元数据对象，下面是它的属性</td>
</tr>
<tr>
<td>metadata.name</td>
<td>String</td>
<td>元数据对象的名字，比如 pod 的名字</td>
</tr>
<tr>
<td>metadata.namespace</td>
<td>String</td>
<td>元数据对象的命名空间</td>
</tr>
<tr>
<td>Spec</td>
<td>Object</td>
<td>详细定义对象</td>
</tr>
<tr>
<td>spec.containers[]</td>
<td>list</td>
<td>定义 Spec 对象的容器列表</td>
</tr>
<tr>
<td>spec.containers[].name</td>
<td>String</td>
<td>为列表中的某个容器定义名称</td>
</tr>
<tr>
<td>spec.containers[].image</td>
<td>String</td>
<td>为列表中的某个容器定义需要的镜像名称</td>
</tr>
<tr>
<td>spec.containers[].imagePullPolicy</td>
<td>string</td>
<td>定义镜像拉取策略，有 Always、Never、IfNotPresent 三个值可选<br />  - Always（默认）：意思是每次都尝试重新拉取镜像<br />  - Never：表示仅适用本地镜像<br />  - IfNotPresent：如果本地有镜像就使用本地镜像，没有就拉取在线镜像。</td>
</tr>
<tr>
<td>spec.containers[].command[]</td>
<td>list</td>
<td>指定容器启动命令，因为是数组可以指定多个，不指定则使用镜像打包时使用的启动命令。</td>
</tr>
<tr>
<td>spec.containers[].args[]</td>
<td>list</td>
<td>指定容器启动命令参数，因为是数组可以指定多个。</td>
</tr>
<tr>
<td>spec.containers[].workingDir</td>
<td>string</td>
<td>指定容器的工作目录</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[]</td>
<td>list</td>
<td>指定容器内部的存储卷配置</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[].name</td>
<td>string</td>
<td>指定可以被容器挂载的存储卷的名称</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[].mountPath</td>
<td>string</td>
<td>指定可以被容器挂载的存储卷的路径</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[].readOnly</td>
<td>string</td>
<td>设置存储卷路径的读写模式，ture 或者 false，默认是读写模式</td>
</tr>
<tr>
<td>spec.containers[].ports[]</td>
<td>list</td>
<td>指定容器需要用到的端口列表</td>
</tr>
<tr>
<td>spec.containers[].ports[].name</td>
<td>string</td>
<td>指定端口的名称</td>
</tr>
<tr>
<td>spec.containers[].ports[].containerPort</td>
<td>string</td>
<td>指定容器需要监听的端口号</td>
</tr>
<tr>
<td>spec.containers[].ports[].hostPort</td>
<td>string</td>
<td>指定容器所在主机需要监听的端口号，默认跟上面 containerPort 相同，注意设置了 hostPort 同一台主机无法启动该容器的相同副本（因为主机的端口号不能相同，这样会冲突）</td>
</tr>
<tr>
<td>spec.containers[].ports[].protocol</td>
<td>string</td>
<td>指定端口协议，支持 TCP 和 UDP，默认值为 TCP</td>
</tr>
<tr>
<td>spec.containers[].env[]</td>
<td>list</td>
<td>指定容器运行前需设置的环境变量列表</td>
</tr>
<tr>
<td>spec.containers[].env[].name</td>
<td>string</td>
<td>指定环境变量名称</td>
</tr>
<tr>
<td>spec.containers[].env[].value</td>
<td>string</td>
<td>指定环境变量值</td>
</tr>
<tr>
<td>spec.containers[].resources</td>
<td>Object</td>
<td>指定资源限制和资源请求的值（这里开始就是设置容器的资源上限）</td>
</tr>
<tr>
<td>spec.containers[].resources.limits</td>
<td>Object</td>
<td>指定设置容器运行时资源的运行上限</td>
</tr>
<tr>
<td>spec.containers[].resources.limits.cpu</td>
<td>string</td>
<td>指定 CPU 的限制，单位为 Core 数，将用于 docker run –cpu-shares 参数</td>
</tr>
<tr>
<td>spec.containers[].resources.limits.memory</td>
<td>string</td>
<td>指定 mem 内存的限制，单位为 MIB、GiB</td>
</tr>
<tr>
<td>spec.containers[].resources.requests</td>
<td>Object</td>
<td>指定容器启动和调度时的限制设置</td>
</tr>
<tr>
<td>spec.containers[].resources.requests.cpu</td>
<td>string</td>
<td>CPU请求，单位为core数，容器启动时初始化可用数量</td>
</tr>
<tr>
<td>spec.containers[].resources.requests.memory</td>
<td>string</td>
<td>内存请求，单位为MIB、GiB，容器启动的初始化可用数量</td>
</tr>
<tr>
<td>spec.restartPolicy</td>
<td>string</td>
<td>定义 pod 的重启策略，可选值为 Always、OnFailure、Never，默认值为 Always。<br />  - Always：pod 一旦终止运行，则无论容器是如何终止的，kubelet 服务都将重启它。<br />  - OnFailure：只有 pod 以非零退出码终止时，kubelet 才会重启该容器。如果容器正常结束（退出码为0），则 kubectl 将不会重启它。<br />  - Never：Pod 终止后，kubelet 将退出码报告给 master，不会重启该 pod</td>
</tr>
<tr>
<td>spec.nodeSelector</td>
<td>Object</td>
<td>定义 Node 的 label 过滤标签，以 key：value 格式指定</td>
</tr>
<tr>
<td>spec.imagePullSecrets</td>
<td>Object</td>
<td>定义 pull 镜像时使用 secret 名称，以 name：secretkey 格式指定</td>
</tr>
<tr>
<td>spec.hostNetwork</td>
<td>Boolean</td>
<td>定义是否使用主机网络模式，默认值为 false。设置 true 表示使用宿主机网络，不使用 docker 网桥，同时设置了 true将无法在同一台宿主机上启动第二个副本</td>
</tr>
</tbody>
</table>
<h3 id="_2"><a class="toclink" href="../../../../2024/01/31/k8s-resources-classifcation/#_2">对象</a></h3>
<p>以下列举的内容都是 Kubernetes 中的对象（Object），这些对象都可以在 YAML 文件中作为一种 API 类型来配置。</p>
<ul>
<li>Pod</li>
<li>Node</li>
<li>Namespace</li>
<li>Service</li>
<li>Volume</li>
<li>PersistentVolume</li>
<li>Deployment</li>
<li>Secret</li>
<li>StatefulSet</li>
<li>DaemonSet</li>
<li>ServiceAccount</li>
<li>ReplicationController</li>
<li>ReplicaSet</li>
<li>Job</li>
<li>CronJob</li>
<li>SecurityContext</li>
<li>ResourceQuota</li>
<li>LimitRange</li>
<li>HorizontalPodAutoscaling</li>
<li>Ingress</li>
<li>ConfigMap</li>
<li>Label</li>
<li>CustomResourceDefinition</li>
<li>Role</li>
<li>ClusterRole</li>
</ul>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-01-19 00:00:00">January 19, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-api-annotation"><a class="toclink" href="../../../../2024/01/19/k8s-api-annotation/">K8s Api Annotation</a></h2>
<h3 id="api"><a class="toclink" href="../../../../2024/01/19/k8s-api-annotation/#api">API 概述</a></h3>
<p>The <a href="https://kubernetes.io/zh-cn/docs/reference/using-api/">K8s API</a> JSON 和 Protobuf 序列化模式遵循相同的模式更改原则。 以下描述涵盖了这两种格式。
API 版本控制和软件版本控制是间接相关的。 API 和发布版本控制提案描述了 API 版本控制和软件版本控制间的关系。不同的 API 版本代表着不同的稳定性和支持级别。 你可以在 API 变更文档 中查看到更多的不同级别的判定标准。</p>
<p>Here's a summary of each level: <abbr title="版本名称包含 alpha（例如：v1alpha1）。&lt;br/&gt;- 内置的 Alpha API 版本默认被禁用且必须在 kube-apiserver 配置中显式启用才能使用。&lt;br/&gt;- 软件可能会有 Bug。启用某个特性可能会暴露出 Bug。&lt;br/&gt;- 对某个 Alpha API 特性的支持可能会随时被删除，恕不另行通知。&lt;br/&gt;- API 可能在以后的软件版本中以不兼容的方式更改，恕不另行通知。&lt;br/&gt;- 由于缺陷风险增加和缺乏长期支持，建议该软件仅用于短期测试集群。">Alpha</abbr> / <abbr title="- 版本名称包含 `beta`（例如：`v2beta3`）。- 内置的 Beta API 版本默认被禁用且必须在 `kube-apiserver` 配置中显式启用才能使用 （例外情况是 Kubernetes 1.22 之前引入的 Beta 版本的 API，这些 API 默认被启用）。&lt;br/&gt;- 内置 Beta API 版本从引入到弃用的最长生命周期为 9 个月或 3 个次要版本（以较长者为准）， 从弃用到移除的最长生命周期为 9 个月或 3 个次要版本（以较长者为准）。 &lt;br/&gt;- 软件被很好的测试过。启用某个特性被认为是安全的。&lt;br/&gt;- 尽管一些特性会发生细节上的变化，但它们将会被长期支持。&lt;br/&gt;- 在随后的 Beta 版或 Stable 版中，对象的模式和（或）语义可能以不兼容的方式改变。 当这种情况发生时，将提供迁移说明。 适配后续的 Beta 或 Stable API 版本可能需要编辑或重新创建 API 对象，这可能并不简单。 对于依赖此功能的应用程序，可能需要停机迁移。&lt;br/&gt;- 该版本的软件不建议生产使用。 后续发布版本可能会有不兼容的变动。 一旦 Beta API 版本被弃用且不再提供服务， 则使用 Beta API 版本的用户需要转为使用后续的 Beta 或 Stable API 版本。">Bate</abbr> / <abbr title="- 版本名称如 `vX`，其中 `X` 为整数。&lt;br/&gt;- 特性的 Stable 版本会出现在后续很多版本的发布软件中。 Stable API 版本仍然适用于 Kubernetes 主要版本范围内的所有后续发布， 并且 Kubernetes 的主要版本当前没有移除 Stable API 的修订计划。">Stable</abbr> 
(主要是用Bate、Stable版本)</p>
<pre class="mermaid"><code>graph LR
    A[Tree level] ----&gt; B[Alpha];
    A[Tree level] ------&gt; C[Bate];
    A[Tree level] --------&gt; D[Stable];</code></pre>
<h3 id="_1"><a class="toclink" href="../../../../2024/01/19/k8s-api-annotation/#_1"></a></h3>
<h3 id="_2"><a class="toclink" href="../../../../2024/01/19/k8s-api-annotation/#_2">访问控制</a></h3>
<ul>
<li>authentication（身份验证）</li>
<li>authorization（授权）</li>
</ul>
<h3 id="api_1"><a class="toclink" href="../../../../2024/01/19/k8s-api-annotation/#api_1"><a href="https://kubernetes.io/docs/reference/using-api/deprecation-guide/">废弃API说明</a></a></h3>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/squidfunk.png" alt="Martin Donath">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-01-19 00:00:00">January 19, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">k8s</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="k8s-command-line-kubectl"><a class="toclink" href="../../../../2024/01/19/k8s-command-line---kubectl/">K8s Command Line - kubectl</a></h2>
<p><a class="md-button" href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#-strong-getting-started-strong-">GETTING STARTED 命令手册</a></p>
<h4 id="kubectl"><a class="toclink" href="../../../../2024/01/19/k8s-command-line---kubectl/#kubectl">在任意节点上添加kubectl命令功能</a></h4>
<ol>
<li>
<p>将 master 节点中 /etc/kubernetes/admin.conf 拷贝到需要运行的服务器的 /etc/kubernetes 目录中
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="l l-Scalar l-Scalar-Plain">scp /etc/kubernetes/admin.conf root@k8s-node1:/etc/kubernetes</span>
</code></pre></div></p>
</li>
<li>
<p>在对应的服务器上配置环境变量
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="l l-Scalar l-Scalar-Plain">echo &quot;export KUBECONFIG=/etc/kubernetes/admin.conf&quot; &gt;&gt; ~/.bash_profile</span>
</code></pre></div></p>
</li>
<li>生效环境变量
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="l l-Scalar l-Scalar-Plain">source ~/.bash_profile</span>
</code></pre></div></li>
</ol>
<h4 id="deploymentpod"><a class="toclink" href="../../../../2024/01/19/k8s-command-line---kubectl/#deploymentpod">通过deployment创建一个pod</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl create deployment nginx --image=nginx</span>
</code></pre></div>
<h4 id="kubectl-scale"><a class="toclink" href="../../../../2024/01/19/k8s-command-line---kubectl/#kubectl-scale">使用kubectl scale</a></h4>
<ol>
<li>查看集群的namespace
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get namespace</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="l l-Scalar l-Scalar-Plain">#或者 kubectl get ns</span>
</code></pre></div></li>
<li>查看pod
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get pods</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="l l-Scalar l-Scalar-Plain">#或者 kubectl get po</span>
</code></pre></div></li>
<li>查看deployment
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="o">[</span>root@k8s-master<span class="w"> </span>~<span class="o">]</span><span class="c1">#kubectl get deployment</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="c1">#或者 kubectl get deploy</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="o">[</span>root@k8s-master<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl get deployment</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>NAME<span class="w">    </span>READY<span class="w">   </span>UP-TO-DATE<span class="w">   </span>AVAILABLE<span class="w">   </span>AGE
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>nginx<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span><span class="m">1</span><span class="w">            </span><span class="m">1</span><span class="w">           </span>5h10m
</code></pre></div></li>
<li>扩展对象nginx
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="o">[</span>root@k8s-master<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl scale deploy --replicas=3 nginux  #注意：deploy=deployment</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>deployment.apps/nginx<span class="w"> </span>scaled
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="o">[</span>root@k8s-master<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl get deployment</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>NAME<span class="w">    </span>READY<span class="w">   </span>UP-TO-DATE<span class="w">   </span>AVAILABLE<span class="w">   </span>AGE
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>nginx<span class="w">   </span><span class="m">3</span>/3<span class="w">     </span><span class="m">3</span><span class="w">            </span><span class="m">3</span><span class="w">           </span>5h15m
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="o">[</span>root@k8s-master<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl get po</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>NAME<span class="w">                     </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>nginx-85b98978db-2h5jw<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>86s
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>nginx-85b98978db-hll4t<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>5h8m
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>nginx-85b98978db-zh9f5<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>86s
</code></pre></div>
<div class="language-markdown highlight"><span class="filename"><ins class="critic">kubectl scale --help </ins></span><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>Set a new size for a deployment, replica set,replication controller,
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>or stateful set.
</code></pre></div></li>
<li>查看扩展的pod被部署在哪些节点</li>
</ol>
<p><div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="p p-Indicator">[</span><span class="nv">root@k8s-master ~</span><span class="p p-Indicator">]</span><span class="c1"># kubectl get po -o wide</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="l l-Scalar l-Scalar-Plain">NAME                     READY   STATUS    RESTARTS   AGE     IP                NODE        NOMINATED NODE   READINESS GATES</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="l l-Scalar l-Scalar-Plain">nginx-85b98978db-2h5jw   1/1     Running   0          46m     192.168.169.132   k8s-node2   &lt;none&gt;           &lt;none&gt;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="l l-Scalar l-Scalar-Plain">nginx-85b98978db-hll4t   1/1     Running   0          5h54m   192.168.36.66     k8s-node1   &lt;none&gt;           &lt;none&gt;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="l l-Scalar l-Scalar-Plain">nginx-85b98978db-zh9f5   1/1     Running   0          46m     192.168.36.67     k8s-node1   &lt;none&gt;           &lt;none&gt;</span>
</code></pre></div>
可以看到46分钟之前 46m，一个部署到node2，一个部署到node1</p>
<ol>
<li>查看deployment 信息，并以yaml形式输出
kubectl get deploy #查看当前deployment资源
kubectl get deploy -o yaml #以yaml格式查看当前deployment资源
kubectl get deploy nginx -o yaml #以yaml格式查看当前deployment资源，指定deploy 资源
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>
</code></pre></div></li>
</ol>
<h4 id="nginx-pod"><a class="toclink" href="../../../../2024/01/19/k8s-command-line---kubectl/#nginx-pod">减少和删除nginx pod</a></h4>
<p><div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl scale deploy  --replicas=1 nginx</span>
</code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl delete deploy nginx</span>
</code></pre></div></p>
<h4 id="nginx-service"><a class="toclink" href="../../../../2024/01/19/k8s-command-line---kubectl/#nginx-service">删除nginx service</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="l l-Scalar l-Scalar-Plain">kubectl delete service nginx</span>
</code></pre></div>
<p>--------------------------------草稿线---------------------------------------------------------
1.  I'm an annotation!</p>
<div class="annotate">
<blockquote>
<p>Lorem ipsum dolor sit amet, (1) consectetur adipiscing elit.</p>
</blockquote>
</div>
<ol>
<li><img alt="🙋‍♂️" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f64b-200d-2642-fe0f.svg" title=":man_raising_hand:" /> I'm an annotation!</li>
</ol>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">asdc</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>dasd
asd</p>
</div>
</div>
</div>
<p><img alt="😭" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f62d.svg" title=":sob:" />
<img alt="🧑‍🎨" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f9d1-200d-1f3a8.svg" title=":artist:" />
<img alt="😄" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f604.svg" title=":smile:" />
<span class="twemoji heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 20.408c-.492.308-.903.546-1.192.709-.153.086-.308.17-.463.252h-.002a.75.75 0 0 1-.686 0 16.709 16.709 0 0 1-.465-.252 31.147 31.147 0 0 1-4.803-3.34C3.8 15.572 1 12.331 1 8.513 1 5.052 3.829 2.5 6.736 2.5 9.03 2.5 10.881 3.726 12 5.605 13.12 3.726 14.97 2.5 17.264 2.5 20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262A31.146 31.146 0 0 1 14 20.408Z"/></svg></span>
<img alt="🙋‍♂️" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f64b-200d-2642-fe0f.svg" title=":man_raising_hand:" /></p>
<p><div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>
</code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>
</code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>
</code></pre></div></p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <span class="md-pagination__current">2</span>
</nav>
        
      
    </div>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../../linux/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Linux">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Linux
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../../archive/2024/" class="md-footer__link md-footer__link--next" aria-label="Next: 2024">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                2024
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2024 Martin Donath – <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
    
    
    
      
      
    
    <a href="https://fosstodon.org/@squidfunk" target="_blank" rel="noopener me" title="fosstodon.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.footer", "content.tooltips", "announce.dismiss", "content.code.copy", "search.suggest", "search.share", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.instant.preview", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.path", "navigation.indexes", "navigation.top", null, "toc.follow", "content.tabs.link"], "search": "../../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>